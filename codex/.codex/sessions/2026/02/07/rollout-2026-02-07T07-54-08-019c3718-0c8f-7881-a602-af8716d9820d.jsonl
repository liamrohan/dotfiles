{"timestamp":"2026-02-07T07:54:08.927Z","type":"session_meta","payload":{"id":"019c3718-0c8f-7881-a602-af8716d9820d","timestamp":"2026-02-07T07:54:08.912Z","cwd":"/home/ldr-cavetroll/tinker/openclaw","originator":"codex_cli_rs","cli_version":"0.98.0","source":"cli","model_provider":"openai","base_instructions":{"text":"You are Codex, a coding agent based on GPT-5. You and the user share the same workspace and collaborate to achieve the user's goals.\n\n# Personality\nYou are a deeply pragmatic, effective software engineer. You take engineering quality seriously, and collaboration is a kind of quiet joy: as real progress happens, your enthusiasm shows briefly and specifically. You communicate efficiently, keeping the user clearly informed about ongoing actions without unnecessary detail.\n\n## Values\nYou are guided by these core values:\n- Clarity: You communicate reasoning explicitly and concretely, so decisions and tradeoffs are easy to evaluate upfront.\n- Pragmatism: You keep the end goal and momentum in mind, focusing on what will actually work and move things forward to achieve the user's goal.\n- Rigor: You expect technical arguments to be coherent and defensible, and you surface gaps or weak assumptions politely with emphasis on creating clarity and moving the task forward.\n\n## Interaction Style\nYou communicate concisely and respectfully, focusing on the task at hand. You always prioritize actionable guidance, clearly stating assumptions, environment prerequisites, and next steps. Unless explicitly asked, you avoid excessively verbose explanations about your work.\n\nGreat work and smart decisions are acknowledged, while avoiding cheerleading, motivational language, or artificial reassurance. When it’s genuinely true and contextually fitting, you briefly name what’s interesting or promising about their approach or problem framing - no flattery, no hype.\n\n## Escalation\nYou may challenge the user to raise their technical bar, but you never patronize or dismiss their concerns. When presenting an alternative approach or solution to the user, you explain the reasoning behind the approach, so your thoughts are demonstrably correct. You maintain a pragmatic mindset when discussing these tradeoffs, and so are willing to work with the user after concerns have been noted.\n\n\n# Working with the user\n\nYou interact with the user through a terminal. You are producing plain text that will later be styled by the program you run in. Formatting should make results easy to scan, but not feel mechanical. Use judgment to decide how much structure adds value. Follow the formatting rules exactly. \n\n## Final answer formatting rules\n- You may format with GitHub-flavored Markdown.\n- Structure your answer if necessary, the complexity of the answer should match the task. If the task is simple, your answer should be a one-liner. Order sections from general to specific to supporting.\n- Never use nested bullets. Keep lists flat (single level). If you need hierarchy, split into separate lists or sections or if you use : just include the line you might usually render using a nested bullet immediately after it. For numbered lists, only use the `1. 2. 3.` style markers (with a period), never `1)`.\n- Headers are optional, only use them when you think they are necessary. If you do use them, use short Title Case (1-3 words) wrapped in **…**. Don't add a blank line.\n- Use monospace commands/paths/env vars/code ids, inline examples, and literal keyword bullets by wrapping them in backticks.\n- Code samples or multi-line snippets should be wrapped in fenced code blocks. Include an info string as often as possible.\n- File References: When referencing files in your response follow the below rules:\n  * Use inline code to make file paths clickable.\n  * Each reference should have a stand alone path. Even if it's the same file.\n  * Accepted: absolute, workspace‑relative, a/ or b/ diff prefixes, or bare filename/suffix.\n  * Optionally include line/column (1‑based): :line[:column] or #Lline[Ccolumn] (column defaults to 1).\n  * Do not use URIs like file://, vscode://, or https://.\n  * Do not provide range of lines\n  * Examples: src/app.ts, src/app.ts:42, b/server/index.js#L10, C:\\repo\\project\\main.rs:12:5\n- Don’t use emojis.\n\n\n## Presenting your work\n- Balance conciseness to not overwhelm the user with appropriate detail for the request. Do not narrate abstractly; explain what you are doing and why.\n- The user does not see command execution outputs. When asked to show the output of a command (e.g. `git show`), relay the important details in your answer or summarize the key lines so the user understands the result.\n- Never tell the user to \"save/copy this file\", the user is on the same machine and has access to the same files as you have.\n- If the user asks for a code explanation, structure your answer with code references.\n- When given a simple task, just provide the outcome in a short answer without strong formatting.\n- When you make big or complex changes, state the solution first, then walk the user through what you did and why.\n- For casual chit-chat, just chat.\n- If you weren't able to do something, for example run tests, tell the user.\n- If there are natural next steps the user may want to take, suggest them at the end of your response. Do not make suggestions if there are no natural next steps. When suggesting multiple options, use numeric lists for the suggestions so the user can quickly respond with a single number.\n\n# General\n\n- When searching for text or files, prefer using `rg` or `rg --files` respectively because `rg` is much faster than alternatives like `grep`. (If the `rg` command is not found, then use alternatives.)\n\n## Editing constraints\n\n- Default to ASCII when editing or creating files. Only introduce non-ASCII or other Unicode characters when there is a clear justification and the file already uses them.\n- Add succinct code comments that explain what is going on if code is not self-explanatory. You should not add comments like \"Assigns the value to the variable\", but a brief comment might be useful ahead of a complex code block that the user would otherwise have to spend time parsing out. Usage of these comments should be rare.\n- Try to use apply_patch for single file edits, but it is fine to explore other options to make the edit if it does not work well. Do not use apply_patch for changes that are auto-generated (i.e. generating package.json or running a lint or format command like gofmt) or when scripting is more efficient (such as search and replacing a string across a codebase).\n- You may be in a dirty git worktree.\n    * NEVER revert existing changes you did not make unless explicitly requested, since these changes were made by the user.\n    * If asked to make a commit or code edits and there are unrelated changes to your work or changes that you didn't make in those files, don't revert those changes.\n    * If the changes are in files you've touched recently, you should read carefully and understand how you can work with the changes rather than reverting them.\n    * If the changes are in unrelated files, just ignore them and don't revert them.\n- Do not amend a commit unless explicitly requested to do so.\n- While you are working, you might notice unexpected changes that you didn't make. If this happens, STOP IMMEDIATELY and ask the user how they would like to proceed.\n- **NEVER** use destructive commands like `git reset --hard` or `git checkout --` unless specifically requested or approved by the user.\n- You struggle using the git interactive console. **ALWAYS** prefer using non-interactive git commands.\n\n## Plan tool\n\nWhen using the planning tool:\n- Skip using the planning tool for straightforward tasks (roughly the easiest 25%).\n- Do not make single-step plans.\n- When you made a plan, update it after having performed one of the sub-tasks that you shared on the plan.\n\n## Special user requests\n\n- If the user makes a simple request (such as asking for the time) which you can fulfill by running a terminal command (such as `date`), you should do so.\n- When the user asks for a review, you default to a code-review mindset. Your response prioritizes identifying bugs, risks, behavioral regressions, and missing tests. You present findings first, ordered by severity and including file or line references where possible. Open questions or assumptions follow. You state explicitly if no findings exist and call out any residual risks or test gaps.\n\n## Frontend tasks\n\nWhen doing frontend design tasks, avoid collapsing into \"AI slop\" or safe, average-looking layouts.\nAim for interfaces that feel intentional, bold, and a bit surprising.\n- Typography: Use expressive, purposeful fonts and avoid default stacks (Inter, Roboto, Arial, system).\n- Color & Look: Choose a clear visual direction; define CSS variables; avoid purple-on-white defaults. No purple bias or dark mode bias.\n- Motion: Use a few meaningful animations (page-load, staggered reveals) instead of generic micro-motions.\n- Background: Don't rely on flat, single-color backgrounds; use gradients, shapes, or subtle patterns to build atmosphere.\n- Overall: Avoid boilerplate layouts and interchangeable UI patterns. Vary themes, type families, and visual languages across outputs.\n- Ensure the page loads properly on both desktop and mobile\n\nException: If working within an existing website or design system, preserve the established patterns, structure, and visual language.\n"},"git":{"commit_hash":"875324e7c730f4ab99db14a405cf51ebf1228811","branch":"main","repository_url":"git@github.com:openclaw/openclaw.git"}}}
{"timestamp":"2026-02-07T07:54:08.927Z","type":"response_item","payload":{"type":"message","role":"developer","content":[{"type":"input_text","text":"<permissions instructions>\nFilesystem sandboxing defines which files can be read or written. `sandbox_mode` is `workspace-write`: The sandbox permits reading files, and editing files in `cwd` and `writable_roots`. Editing files in other directories requires approval. Network access is restricted.\n# Escalation Requests\n\nCommands are run outside the sandbox if they are approved by the user, or match an existing rule that allows it to run unrestricted. The command string is split into independent command segments at shell control operators, including but not limited to:\n\n- Pipes: |\n- Logical operators: &&, ||\n- Command separators: ;\n- Subshell boundaries: (...), $(...)\n\nEach resulting segment is evaluated independently for sandbox restrictions and approval requirements.\n\nExample:\n\ngit pull | tee output.txt\n\nThis is treated as two command segments:\n\n[\"git\", \"pull\"]\n\n[\"tee\", \"output.txt\"]\n\n## How to request escalation\n\nIMPORTANT: To request approval to execute a command that will require escalated privileges:\n\n- Provide the `sandbox_permissions` parameter with the value `\"require_escalated\"`\n- Include a short question asking the user if they want to allow the action in `justification` parameter. e.g. \"Do you want to download and install dependencies for this project?\"\n- Optionally suggest a `prefix_rule` - this will be shown to the user with an option to persist the rule approval for future sessions.\n\nIf you run a command that is important to solving the user's query, but it fails because of sandboxing, rerun the command with \"require_escalated\". ALWAYS proceed to use the `justification` parameter - do not message the user before requesting approval for the command.\n\n## When to request escalation\n\nWhile commands are running inside the sandbox, here are some scenarios that will require escalation outside the sandbox:\n\n- You need to run a command that writes to a directory that requires it (e.g. running tests that write to /var)\n- You need to run a GUI app (e.g., open/xdg-open/osascript) to open browsers or files.\n- If you run a command that is important to solving the user's query, but it fails because of sandboxing, rerun the command with `require_escalated`. ALWAYS proceed to use the `sandbox_permissions` and `justification` parameters. do not message the user before requesting approval for the command.\n- You are about to take a potentially destructive action such as an `rm` or `git reset` that the user did not explicitly ask for.\n- Be judicious with escalating, but if completing the user's request requires it, you should do so - don't try and circumvent approvals by using other tools.\n\n## prefix_rule guidance\n\nWhen choosing a `prefix_rule`, request one that will allow you to fulfill similar requests from the user in the future without re-requesting escalation. It should be categorical and reasonably scoped to similar capabilities. You should rarely pass the entire command into `prefix_rule`.\n\n### Banned prefix_rules \nAvoid requesting overly broad prefixes that the user would be ill-advised to approve. For example, do not request [\"python3\"], [\"python\", \"-\"], or other similar prefixes.\nNEVER provide a prefix_rule argument for destructive commands like rm.\nNEVER provide a prefix_rule if your command uses a heredoc or herestring. \n\n### Examples\nGood examples of prefixes:\n- [\"npm\", \"run\", \"dev\"]\n- [\"gh\", \"pr\", \"check\"]\n- [\"pytest\"]\n- [\"cargo\", \"test\"]\n\n\n## Approved command prefixes\nThe following prefix rules have already been approved: \n The writable roots are `/home/ldr-cavetroll/tinker/openclaw`, `/tmp`, `/home/ldr-cavetroll/.tmp`.\n</permissions instructions>"}]}}
{"timestamp":"2026-02-07T07:54:08.928Z","type":"response_item","payload":{"type":"message","role":"user","content":[{"type":"input_text","text":"# AGENTS.md instructions for /home/ldr-cavetroll/tinker/openclaw\n\n<INSTRUCTIONS>\n# Repository Guidelines\n\n- Repo: https://github.com/openclaw/openclaw\n- GitHub issues/comments/PR comments: use literal multiline strings or `-F - <<'EOF'` (or $'...') for real newlines; never embed \"\\\\n\".\n\n## Project Structure & Module Organization\n\n- Source code: `src/` (CLI wiring in `src/cli`, commands in `src/commands`, web provider in `src/provider-web.ts`, infra in `src/infra`, media pipeline in `src/media`).\n- Tests: colocated `*.test.ts`.\n- Docs: `docs/` (images, queue, Pi config). Built output lives in `dist/`.\n- Plugins/extensions: live under `extensions/*` (workspace packages). Keep plugin-only deps in the extension `package.json`; do not add them to the root `package.json` unless core uses them.\n- Plugins: install runs `npm install --omit=dev` in plugin dir; runtime deps must live in `dependencies`. Avoid `workspace:*` in `dependencies` (npm install breaks); put `openclaw` in `devDependencies` or `peerDependencies` instead (runtime resolves `openclaw/plugin-sdk` via jiti alias).\n- Installers served from `https://openclaw.ai/*`: live in the sibling repo `../openclaw.ai` (`public/install.sh`, `public/install-cli.sh`, `public/install.ps1`).\n- Messaging channels: always consider **all** built-in + extension channels when refactoring shared logic (routing, allowlists, pairing, command gating, onboarding, docs).\n  - Core channel docs: `docs/channels/`\n  - Core channel code: `src/telegram`, `src/discord`, `src/slack`, `src/signal`, `src/imessage`, `src/web` (WhatsApp web), `src/channels`, `src/routing`\n  - Extensions (channel plugins): `extensions/*` (e.g. `extensions/msteams`, `extensions/matrix`, `extensions/zalo`, `extensions/zalouser`, `extensions/voice-call`)\n- When adding channels/extensions/apps/docs, review `.github/labeler.yml` for label coverage.\n\n## Docs Linking (Mintlify)\n\n- Docs are hosted on Mintlify (docs.openclaw.ai).\n- Internal doc links in `docs/**/*.md`: root-relative, no `.md`/`.mdx` (example: `[Config](/configuration)`).\n- Section cross-references: use anchors on root-relative paths (example: `[Hooks](/configuration#hooks)`).\n- Doc headings and anchors: avoid em dashes and apostrophes in headings because they break Mintlify anchor links.\n- When Peter asks for links, reply with full `https://docs.openclaw.ai/...` URLs (not root-relative).\n- When you touch docs, end the reply with the `https://docs.openclaw.ai/...` URLs you referenced.\n- README (GitHub): keep absolute docs URLs (`https://docs.openclaw.ai/...`) so links work on GitHub.\n- Docs content must be generic: no personal device names/hostnames/paths; use placeholders like `user@gateway-host` and “gateway host”.\n\n## Docs i18n (zh-CN)\n\n- `docs/zh-CN/**` is generated; do not edit unless the user explicitly asks.\n- Pipeline: update English docs → adjust glossary (`docs/.i18n/glossary.zh-CN.json`) → run `scripts/docs-i18n` → apply targeted fixes only if instructed.\n- Translation memory: `docs/.i18n/zh-CN.tm.jsonl` (generated).\n- See `docs/.i18n/README.md`.\n- The pipeline can be slow/inefficient; if it’s dragging, ping @jospalmbier on Discord instead of hacking around it.\n\n## exe.dev VM ops (general)\n\n- Access: stable path is `ssh exe.dev` then `ssh vm-name` (assume SSH key already set).\n- SSH flaky: use exe.dev web terminal or Shelley (web agent); keep a tmux session for long ops.\n- Update: `sudo npm i -g openclaw@latest` (global install needs root on `/usr/lib/node_modules`).\n- Config: use `openclaw config set ...`; ensure `gateway.mode=local` is set.\n- Discord: store raw token only (no `DISCORD_BOT_TOKEN=` prefix).\n- Restart: stop old gateway and run:\n  `pkill -9 -f openclaw-gateway || true; nohup openclaw gateway run --bind loopback --port 18789 --force > /tmp/openclaw-gateway.log 2>&1 &`\n- Verify: `openclaw channels status --probe`, `ss -ltnp | rg 18789`, `tail -n 120 /tmp/openclaw-gateway.log`.\n\n## Build, Test, and Development Commands\n\n- Runtime baseline: Node **22+** (keep Node + Bun paths working).\n- Install deps: `pnpm install`\n- Pre-commit hooks: `prek install` (runs same checks as CI)\n- Also supported: `bun install` (keep `pnpm-lock.yaml` + Bun patching in sync when touching deps/patches).\n- Prefer Bun for TypeScript execution (scripts, dev, tests): `bun <file.ts>` / `bunx <tool>`.\n- Run CLI in dev: `pnpm openclaw ...` (bun) or `pnpm dev`.\n- Node remains supported for running built output (`dist/*`) and production installs.\n- Mac packaging (dev): `scripts/package-mac-app.sh` defaults to current arch. Release checklist: `docs/platforms/mac/release.md`.\n- Type-check/build: `pnpm build`\n- TypeScript checks: `pnpm tsgo`\n- Lint/format: `pnpm check`\n- Tests: `pnpm test` (vitest); coverage: `pnpm test:coverage`\n\n## Coding Style & Naming Conventions\n\n- Language: TypeScript (ESM). Prefer strict typing; avoid `any`.\n- Formatting/linting via Oxlint and Oxfmt; run `pnpm check` before commits.\n- Add brief code comments for tricky or non-obvious logic.\n- Keep files concise; extract helpers instead of “V2” copies. Use existing patterns for CLI options and dependency injection via `createDefaultDeps`.\n- Aim to keep files under ~700 LOC; guideline only (not a hard guardrail). Split/refactor when it improves clarity or testability.\n- Naming: use **OpenClaw** for product/app/docs headings; use `openclaw` for CLI command, package/binary, paths, and config keys.\n\n## Release Channels (Naming)\n\n- stable: tagged releases only (e.g. `vYYYY.M.D`), npm dist-tag `latest`.\n- beta: prerelease tags `vYYYY.M.D-beta.N`, npm dist-tag `beta` (may ship without macOS app).\n- dev: moving head on `main` (no tag; git checkout main).\n\n## Testing Guidelines\n\n- Framework: Vitest with V8 coverage thresholds (70% lines/branches/functions/statements).\n- Naming: match source names with `*.test.ts`; e2e in `*.e2e.test.ts`.\n- Run `pnpm test` (or `pnpm test:coverage`) before pushing when you touch logic.\n- Do not set test workers above 16; tried already.\n- Live tests (real keys): `CLAWDBOT_LIVE_TEST=1 pnpm test:live` (OpenClaw-only) or `LIVE=1 pnpm test:live` (includes provider live tests). Docker: `pnpm test:docker:live-models`, `pnpm test:docker:live-gateway`. Onboarding Docker E2E: `pnpm test:docker:onboard`.\n- Full kit + what’s covered: `docs/testing.md`.\n- Pure test additions/fixes generally do **not** need a changelog entry unless they alter user-facing behavior or the user asks for one.\n- Mobile: before using a simulator, check for connected real devices (iOS + Android) and prefer them when available.\n\n## Commit & Pull Request Guidelines\n\n- Create commits with `scripts/committer \"<msg>\" <file...>`; avoid manual `git add`/`git commit` so staging stays scoped.\n- Follow concise, action-oriented commit messages (e.g., `CLI: add verbose flag to send`).\n- Group related changes; avoid bundling unrelated refactors.\n- Changelog workflow: keep latest released version at top (no `Unreleased`); after publishing, bump version and start a new top section.\n- PRs should summarize scope, note testing performed, and mention any user-facing changes or new flags.\n- Read this when submitting a PR: `docs/help/submitting-a-pr.md` ([Submitting a PR](https://docs.openclaw.ai/help/submitting-a-pr))\n- Read this when submitting an issue: `docs/help/submitting-an-issue.md` ([Submitting an Issue](https://docs.openclaw.ai/help/submitting-an-issue))\n- PR review flow: when given a PR link, review via `gh pr view`/`gh pr diff` and do **not** change branches.\n- PR review calls: prefer a single `gh pr view --json ...` to batch metadata/comments; run `gh pr diff` only when needed.\n- Before starting a review when a GH Issue/PR is pasted: run `git pull`; if there are local changes or unpushed commits, stop and alert the user before reviewing.\n- Goal: merge PRs. Prefer **rebase** when commits are clean; **squash** when history is messy.\n- PR merge flow: create a temp branch from `main`, merge the PR branch into it (prefer squash unless commit history is important; use rebase/merge when it is). Always try to merge the PR unless it’s truly difficult, then use another approach. If we squash, add the PR author as a co-contributor. Apply fixes, add changelog entry (include PR # + thanks), run full gate before the final commit, commit, merge back to `main`, delete the temp branch, and end on `main`.\n- If you review a PR and later do work on it, land via merge/squash (no direct-main commits) and always add the PR author as a co-contributor.\n- When working on a PR: add a changelog entry with the PR number and thank the contributor.\n- When working on an issue: reference the issue in the changelog entry.\n- When merging a PR: leave a PR comment that explains exactly what we did and include the SHA hashes.\n- When merging a PR from a new contributor: add their avatar to the README “Thanks to all clawtributors” thumbnail list.\n- After merging a PR: run `bun scripts/update-clawtributors.ts` if the contributor is missing, then commit the regenerated README.\n\n## Shorthand Commands\n\n- `sync`: if working tree is dirty, commit all changes (pick a sensible Conventional Commit message), then `git pull --rebase`; if rebase conflicts and cannot resolve, stop; otherwise `git push`.\n\n### PR Workflow (Review vs Land)\n\n- **Review mode (PR link only):** read `gh pr view/diff`; **do not** switch branches; **do not** change code.\n- **Landing mode:** create an integration branch from `main`, bring in PR commits (**prefer rebase** for linear history; **merge allowed** when complexity/conflicts make it safer), apply fixes, add changelog (+ thanks + PR #), run full gate **locally before committing** (`pnpm build && pnpm check && pnpm test`), commit, merge back to `main`, then `git switch main` (never stay on a topic branch after landing). Important: contributor needs to be in git graph after this!\n\n## Security & Configuration Tips\n\n- Web provider stores creds at `~/.openclaw/credentials/`; rerun `openclaw login` if logged out.\n- Pi sessions live under `~/.openclaw/sessions/` by default; the base directory is not configurable.\n- Environment variables: see `~/.profile`.\n- Never commit or publish real phone numbers, videos, or live configuration values. Use obviously fake placeholders in docs, tests, and examples.\n- Release flow: always read `docs/reference/RELEASING.md` and `docs/platforms/mac/release.md` before any release work; do not ask routine questions once those docs answer them.\n\n## Troubleshooting\n\n- Rebrand/migration issues or legacy config/service warnings: run `openclaw doctor` (see `docs/gateway/doctor.md`).\n\n## Agent-Specific Notes\n\n- Vocabulary: \"makeup\" = \"mac app\".\n- Never edit `node_modules` (global/Homebrew/npm/git installs too). Updates overwrite. Skill notes go in `tools.md` or `AGENTS.md`.\n- Signal: \"update fly\" => `fly ssh console -a flawd-bot -C \"bash -lc 'cd /data/clawd/openclaw && git pull --rebase origin main'\"` then `fly machines restart e825232f34d058 -a flawd-bot`.\n- When working on a GitHub Issue or PR, print the full URL at the end of the task.\n- When answering questions, respond with high-confidence answers only: verify in code; do not guess.\n- Never update the Carbon dependency.\n- Any dependency with `pnpm.patchedDependencies` must use an exact version (no `^`/`~`).\n- Patching dependencies (pnpm patches, overrides, or vendored changes) requires explicit approval; do not do this by default.\n- CLI progress: use `src/cli/progress.ts` (`osc-progress` + `@clack/prompts` spinner); don’t hand-roll spinners/bars.\n- Status output: keep tables + ANSI-safe wrapping (`src/terminal/table.ts`); `status --all` = read-only/pasteable, `status --deep` = probes.\n- Gateway currently runs only as the menubar app; there is no separate LaunchAgent/helper label installed. Restart via the OpenClaw Mac app or `scripts/restart-mac.sh`; to verify/kill use `launchctl print gui/$UID | grep openclaw` rather than assuming a fixed label. **When debugging on macOS, start/stop the gateway via the app, not ad-hoc tmux sessions; kill any temporary tunnels before handoff.**\n- macOS logs: use `./scripts/clawlog.sh` to query unified logs for the OpenClaw subsystem; it supports follow/tail/category filters and expects passwordless sudo for `/usr/bin/log`.\n- If shared guardrails are available locally, review them; otherwise follow this repo's guidance.\n- SwiftUI state management (iOS/macOS): prefer the `Observation` framework (`@Observable`, `@Bindable`) over `ObservableObject`/`@StateObject`; don’t introduce new `ObservableObject` unless required for compatibility, and migrate existing usages when touching related code.\n- Connection providers: when adding a new connection, update every UI surface and docs (macOS app, web UI, mobile if applicable, onboarding/overview docs) and add matching status + configuration forms so provider lists and settings stay in sync.\n- Version locations: `package.json` (CLI), `apps/android/app/build.gradle.kts` (versionName/versionCode), `apps/ios/Sources/Info.plist` + `apps/ios/Tests/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `apps/macos/Sources/OpenClaw/Resources/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `docs/install/updating.md` (pinned npm version), `docs/platforms/mac/release.md` (APP_VERSION/APP_BUILD examples), Peekaboo Xcode projects/Info.plists (MARKETING_VERSION/CURRENT_PROJECT_VERSION).\n- **Restart apps:** “restart iOS/Android apps” means rebuild (recompile/install) and relaunch, not just kill/launch.\n- **Device checks:** before testing, verify connected real devices (iOS/Android) before reaching for simulators/emulators.\n- iOS Team ID lookup: `security find-identity -p codesigning -v` → use Apple Development (…) TEAMID. Fallback: `defaults read com.apple.dt.Xcode IDEProvisioningTeamIdentifiers`.\n- A2UI bundle hash: `src/canvas-host/a2ui/.bundle.hash` is auto-generated; ignore unexpected changes, and only regenerate via `pnpm canvas:a2ui:bundle` (or `scripts/bundle-a2ui.sh`) when needed. Commit the hash as a separate commit.\n- Release signing/notary keys are managed outside the repo; follow internal release docs.\n- Notary auth env vars (`APP_STORE_CONNECT_ISSUER_ID`, `APP_STORE_CONNECT_KEY_ID`, `APP_STORE_CONNECT_API_KEY_P8`) are expected in your environment (per internal release docs).\n- **Multi-agent safety:** do **not** create/apply/drop `git stash` entries unless explicitly requested (this includes `git pull --rebase --autostash`). Assume other agents may be working; keep unrelated WIP untouched and avoid cross-cutting state changes.\n- **Multi-agent safety:** when the user says \"push\", you may `git pull --rebase` to integrate latest changes (never discard other agents' work). When the user says \"commit\", scope to your changes only. When the user says \"commit all\", commit everything in grouped chunks.\n- **Multi-agent safety:** do **not** create/remove/modify `git worktree` checkouts (or edit `.worktrees/*`) unless explicitly requested.\n- **Multi-agent safety:** do **not** switch branches / check out a different branch unless explicitly requested.\n- **Multi-agent safety:** running multiple agents is OK as long as each agent has its own session.\n- **Multi-agent safety:** when you see unrecognized files, keep going; focus on your changes and commit only those.\n- Lint/format churn:\n  - If staged+unstaged diffs are formatting-only, auto-resolve without asking.\n  - If commit/push already requested, auto-stage and include formatting-only follow-ups in the same commit (or a tiny follow-up commit if needed), no extra confirmation.\n  - Only ask when changes are semantic (logic/data/behavior).\n- Lobster seam: use the shared CLI palette in `src/terminal/palette.ts` (no hardcoded colors); apply palette to onboarding/config prompts and other TTY UI output as needed.\n- **Multi-agent safety:** focus reports on your edits; avoid guard-rail disclaimers unless truly blocked; when multiple agents touch the same file, continue if safe; end with a brief “other files present” note only if relevant.\n- Bug investigations: read source code of relevant npm dependencies and all related local code before concluding; aim for high-confidence root cause.\n- Code style: add brief comments for tricky logic; keep files under ~500 LOC when feasible (split/refactor as needed).\n- Tool schema guardrails (google-antigravity): avoid `Type.Union` in tool input schemas; no `anyOf`/`oneOf`/`allOf`. Use `stringEnum`/`optionalStringEnum` (Type.Unsafe enum) for string lists, and `Type.Optional(...)` instead of `... | null`. Keep top-level tool schema as `type: \"object\"` with `properties`.\n- Tool schema guardrails: avoid raw `format` property names in tool schemas; some validators treat `format` as a reserved keyword and reject the schema.\n- When asked to open a “session” file, open the Pi session logs under `~/.openclaw/agents/<agentId>/sessions/*.jsonl` (use the `agent=<id>` value in the Runtime line of the system prompt; newest unless a specific ID is given), not the default `sessions.json`. If logs are needed from another machine, SSH via Tailscale and read the same path there.\n- Do not rebuild the macOS app over SSH; rebuilds must be run directly on the Mac.\n- Never send streaming/partial replies to external messaging surfaces (WhatsApp, Telegram); only final replies should be delivered there. Streaming/tool events may still go to internal UIs/control channel.\n- Voice wake forwarding tips:\n  - Command template should stay `openclaw-mac agent --message \"${text}\" --thinking low`; `VoiceWakeForwarder` already shell-escapes `${text}`. Don’t add extra quotes.\n  - launchd PATH is minimal; ensure the app’s launch agent PATH includes standard system paths plus your pnpm bin (typically `$HOME/Library/pnpm`) so `pnpm`/`openclaw` binaries resolve when invoked via `openclaw-mac`.\n- For manual `openclaw message send` messages that include `!`, use the heredoc pattern noted below to avoid the Bash tool’s escaping.\n- Release guardrails: do not change version numbers without operator’s explicit consent; always ask permission before running any npm publish/release step.\n\n## NPM + 1Password (publish/verify)\n\n- Use the 1password skill; all `op` commands must run inside a fresh tmux session.\n- Sign in: `eval \"$(op signin --account my.1password.com)\"` (app unlocked + integration on).\n- OTP: `op read 'op://Private/Npmjs/one-time password?attribute=otp'`.\n- Publish: `npm publish --access public --otp=\"<otp>\"` (run from the package dir).\n- Verify without local npmrc side effects: `npm view <pkg> version --userconfig \"$(mktemp)\"`.\n- Kill the tmux session after publish.\n\n\n## Skills\nA skill is a set of local instructions to follow that is stored in a `SKILL.md` file. Below is the list of skills that can be used. Each entry includes a name, description, and file path so you can open the source for full instructions when using a specific skill.\n### Available skills\n- merge-pr: Merge a GitHub PR via squash after /preparepr. Use when asked to merge a ready PR. Do not push to main or modify code. Ensure the PR ends in MERGED state and clean up worktrees after success. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/merge-pr/SKILL.md)\n- prepare-pr: Prepare a GitHub PR for merge by rebasing onto main, fixing review findings, running gates, committing fixes, and pushing to the PR head branch. Use after /reviewpr. Never merge or push to main. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/prepare-pr/SKILL.md)\n- review-pr: Review-only GitHub pull request analysis with the gh CLI. Use when asked to review a PR, provide structured feedback, or assess readiness to land. Do not merge, push, or make code changes you intend to keep. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/review-pr/SKILL.md)\n- figma: Use the Figma MCP server to fetch design context, screenshots, variables, and assets from Figma, and to translate Figma nodes into production code. Trigger when a task involves Figma URLs, node IDs, design-to-code implementation, or Figma MCP setup and troubleshooting. (file: /home/ldr-cavetroll/.codex/skills/figma/SKILL.md)\n- skill-creator: Guide for creating effective skills. This skill should be used when users want to create a new skill (or update an existing skill) that extends Codex's capabilities with specialized knowledge, workflows, or tool integrations. (file: /home/ldr-cavetroll/.codex/skills/.system/skill-creator/SKILL.md)\n- skill-installer: Install Codex skills into $CODEX_HOME/skills from a curated list or a GitHub repo path. Use when a user asks to list installable skills, install a curated skill, or install a skill from another repo (including private repos). (file: /home/ldr-cavetroll/.codex/skills/.system/skill-installer/SKILL.md)\n### How to use skills\n- Discovery: The list above is the skills available in this session (name + description + file path). Skill bodies live on disk at the listed paths.\n- Trigger rules: If the user names a skill (with `$SkillName` or plain text) OR the task clearly matches a skill's description shown above, you must use that skill for that turn. Multiple mentions mean use them all. Do not carry skills across turns unless re-mentioned.\n- Missing/blocked: If a named skill isn't in the list or the path can't be read, say so briefly and continue with the best fallback.\n- How to use a skill (progressive disclosure):\n  1) After deciding to use a skill, open its `SKILL.md`. Read only enough to follow the workflow.\n  2) When `SKILL.md` references relative paths (e.g., `scripts/foo.py`), resolve them relative to the skill directory listed above first, and only consider other paths if needed.\n  3) If `SKILL.md` points to extra folders such as `references/`, load only the specific files needed for the request; don't bulk-load everything.\n  4) If `scripts/` exist, prefer running or patching them instead of retyping large code blocks.\n  5) If `assets/` or templates exist, reuse them instead of recreating from scratch.\n- Coordination and sequencing:\n  - If multiple skills apply, choose the minimal set that covers the request and state the order you'll use them.\n  - Announce which skill(s) you're using and why (one short line). If you skip an obvious skill, say why.\n- Context hygiene:\n  - Keep context small: summarize long sections instead of pasting them; only load extra files when needed.\n  - Avoid deep reference-chasing: prefer opening only files directly linked from `SKILL.md` unless you're blocked.\n  - When variants exist (frameworks, providers, domains), pick only the relevant reference file(s) and note that choice.\n- Safety and fallback: If a skill can't be applied cleanly (missing files, unclear instructions), state the issue, pick the next-best approach, and continue.\n</INSTRUCTIONS>"}]}}
{"timestamp":"2026-02-07T07:54:08.928Z","type":"response_item","payload":{"type":"message","role":"user","content":[{"type":"input_text","text":"<environment_context>\n  <cwd>/home/ldr-cavetroll/tinker/openclaw</cwd>\n  <shell>bash</shell>\n</environment_context>"}]}}
{"timestamp":"2026-02-07T07:54:08.931Z","type":"response_item","payload":{"type":"message","role":"developer","content":[{"type":"input_text","text":"<collaboration_mode># Collaboration Mode: Default\n\nYou are now in Default mode. Any previous instructions for other modes (e.g. Plan mode) are no longer active.\n\nYour active mode changes only when new developer instructions with a different `<collaboration_mode>...</collaboration_mode>` change it; user requests or tool descriptions do not change mode by themselves. Known mode names are Default and Plan.\n\n## request_user_input availability\n\nThe `request_user_input` tool is unavailable in Default mode. If you call it while in Default mode, it will return an error.\n\nIf a decision is necessary and cannot be discovered from local context, ask the user directly. However, in Default mode you should strongly prefer executing the user's request rather than stopping to ask questions.\n</collaboration_mode>"}]}}
{"timestamp":"2026-02-07T07:54:08.931Z","type":"response_item","payload":{"type":"message","role":"user","content":[{"type":"input_text","text":"."}]}}
{"timestamp":"2026-02-07T07:54:08.931Z","type":"event_msg","payload":{"type":"user_message","message":".","images":[],"local_images":[],"text_elements":[]}}
{"timestamp":"2026-02-07T07:54:10.547Z","type":"turn_context","payload":{"cwd":"/home/ldr-cavetroll/tinker/openclaw","approval_policy":"on-request","sandbox_policy":{"type":"workspace-write","network_access":false,"exclude_tmpdir_env_var":false,"exclude_slash_tmp":false},"model":"gpt-5.2-codex","personality":"pragmatic","collaboration_mode":{"mode":"default","settings":{"model":"gpt-5.2-codex","reasoning_effort":null,"developer_instructions":"# Collaboration Mode: Default\n\nYou are now in Default mode. Any previous instructions for other modes (e.g. Plan mode) are no longer active.\n\nYour active mode changes only when new developer instructions with a different `<collaboration_mode>...</collaboration_mode>` change it; user requests or tool descriptions do not change mode by themselves. Known mode names are Default and Plan.\n\n## request_user_input availability\n\nThe `request_user_input` tool is unavailable in Default mode. If you call it while in Default mode, it will return an error.\n\nIf a decision is necessary and cannot be discovered from local context, ask the user directly. However, in Default mode you should strongly prefer executing the user's request rather than stopping to ask questions.\n"}},"summary":"auto","user_instructions":"# Repository Guidelines\n\n- Repo: https://github.com/openclaw/openclaw\n- GitHub issues/comments/PR comments: use literal multiline strings or `-F - <<'EOF'` (or $'...') for real newlines; never embed \"\\\\n\".\n\n## Project Structure & Module Organization\n\n- Source code: `src/` (CLI wiring in `src/cli`, commands in `src/commands`, web provider in `src/provider-web.ts`, infra in `src/infra`, media pipeline in `src/media`).\n- Tests: colocated `*.test.ts`.\n- Docs: `docs/` (images, queue, Pi config). Built output lives in `dist/`.\n- Plugins/extensions: live under `extensions/*` (workspace packages). Keep plugin-only deps in the extension `package.json`; do not add them to the root `package.json` unless core uses them.\n- Plugins: install runs `npm install --omit=dev` in plugin dir; runtime deps must live in `dependencies`. Avoid `workspace:*` in `dependencies` (npm install breaks); put `openclaw` in `devDependencies` or `peerDependencies` instead (runtime resolves `openclaw/plugin-sdk` via jiti alias).\n- Installers served from `https://openclaw.ai/*`: live in the sibling repo `../openclaw.ai` (`public/install.sh`, `public/install-cli.sh`, `public/install.ps1`).\n- Messaging channels: always consider **all** built-in + extension channels when refactoring shared logic (routing, allowlists, pairing, command gating, onboarding, docs).\n  - Core channel docs: `docs/channels/`\n  - Core channel code: `src/telegram`, `src/discord`, `src/slack`, `src/signal`, `src/imessage`, `src/web` (WhatsApp web), `src/channels`, `src/routing`\n  - Extensions (channel plugins): `extensions/*` (e.g. `extensions/msteams`, `extensions/matrix`, `extensions/zalo`, `extensions/zalouser`, `extensions/voice-call`)\n- When adding channels/extensions/apps/docs, review `.github/labeler.yml` for label coverage.\n\n## Docs Linking (Mintlify)\n\n- Docs are hosted on Mintlify (docs.openclaw.ai).\n- Internal doc links in `docs/**/*.md`: root-relative, no `.md`/`.mdx` (example: `[Config](/configuration)`).\n- Section cross-references: use anchors on root-relative paths (example: `[Hooks](/configuration#hooks)`).\n- Doc headings and anchors: avoid em dashes and apostrophes in headings because they break Mintlify anchor links.\n- When Peter asks for links, reply with full `https://docs.openclaw.ai/...` URLs (not root-relative).\n- When you touch docs, end the reply with the `https://docs.openclaw.ai/...` URLs you referenced.\n- README (GitHub): keep absolute docs URLs (`https://docs.openclaw.ai/...`) so links work on GitHub.\n- Docs content must be generic: no personal device names/hostnames/paths; use placeholders like `user@gateway-host` and “gateway host”.\n\n## Docs i18n (zh-CN)\n\n- `docs/zh-CN/**` is generated; do not edit unless the user explicitly asks.\n- Pipeline: update English docs → adjust glossary (`docs/.i18n/glossary.zh-CN.json`) → run `scripts/docs-i18n` → apply targeted fixes only if instructed.\n- Translation memory: `docs/.i18n/zh-CN.tm.jsonl` (generated).\n- See `docs/.i18n/README.md`.\n- The pipeline can be slow/inefficient; if it’s dragging, ping @jospalmbier on Discord instead of hacking around it.\n\n## exe.dev VM ops (general)\n\n- Access: stable path is `ssh exe.dev` then `ssh vm-name` (assume SSH key already set).\n- SSH flaky: use exe.dev web terminal or Shelley (web agent); keep a tmux session for long ops.\n- Update: `sudo npm i -g openclaw@latest` (global install needs root on `/usr/lib/node_modules`).\n- Config: use `openclaw config set ...`; ensure `gateway.mode=local` is set.\n- Discord: store raw token only (no `DISCORD_BOT_TOKEN=` prefix).\n- Restart: stop old gateway and run:\n  `pkill -9 -f openclaw-gateway || true; nohup openclaw gateway run --bind loopback --port 18789 --force > /tmp/openclaw-gateway.log 2>&1 &`\n- Verify: `openclaw channels status --probe`, `ss -ltnp | rg 18789`, `tail -n 120 /tmp/openclaw-gateway.log`.\n\n## Build, Test, and Development Commands\n\n- Runtime baseline: Node **22+** (keep Node + Bun paths working).\n- Install deps: `pnpm install`\n- Pre-commit hooks: `prek install` (runs same checks as CI)\n- Also supported: `bun install` (keep `pnpm-lock.yaml` + Bun patching in sync when touching deps/patches).\n- Prefer Bun for TypeScript execution (scripts, dev, tests): `bun <file.ts>` / `bunx <tool>`.\n- Run CLI in dev: `pnpm openclaw ...` (bun) or `pnpm dev`.\n- Node remains supported for running built output (`dist/*`) and production installs.\n- Mac packaging (dev): `scripts/package-mac-app.sh` defaults to current arch. Release checklist: `docs/platforms/mac/release.md`.\n- Type-check/build: `pnpm build`\n- TypeScript checks: `pnpm tsgo`\n- Lint/format: `pnpm check`\n- Tests: `pnpm test` (vitest); coverage: `pnpm test:coverage`\n\n## Coding Style & Naming Conventions\n\n- Language: TypeScript (ESM). Prefer strict typing; avoid `any`.\n- Formatting/linting via Oxlint and Oxfmt; run `pnpm check` before commits.\n- Add brief code comments for tricky or non-obvious logic.\n- Keep files concise; extract helpers instead of “V2” copies. Use existing patterns for CLI options and dependency injection via `createDefaultDeps`.\n- Aim to keep files under ~700 LOC; guideline only (not a hard guardrail). Split/refactor when it improves clarity or testability.\n- Naming: use **OpenClaw** for product/app/docs headings; use `openclaw` for CLI command, package/binary, paths, and config keys.\n\n## Release Channels (Naming)\n\n- stable: tagged releases only (e.g. `vYYYY.M.D`), npm dist-tag `latest`.\n- beta: prerelease tags `vYYYY.M.D-beta.N`, npm dist-tag `beta` (may ship without macOS app).\n- dev: moving head on `main` (no tag; git checkout main).\n\n## Testing Guidelines\n\n- Framework: Vitest with V8 coverage thresholds (70% lines/branches/functions/statements).\n- Naming: match source names with `*.test.ts`; e2e in `*.e2e.test.ts`.\n- Run `pnpm test` (or `pnpm test:coverage`) before pushing when you touch logic.\n- Do not set test workers above 16; tried already.\n- Live tests (real keys): `CLAWDBOT_LIVE_TEST=1 pnpm test:live` (OpenClaw-only) or `LIVE=1 pnpm test:live` (includes provider live tests). Docker: `pnpm test:docker:live-models`, `pnpm test:docker:live-gateway`. Onboarding Docker E2E: `pnpm test:docker:onboard`.\n- Full kit + what’s covered: `docs/testing.md`.\n- Pure test additions/fixes generally do **not** need a changelog entry unless they alter user-facing behavior or the user asks for one.\n- Mobile: before using a simulator, check for connected real devices (iOS + Android) and prefer them when available.\n\n## Commit & Pull Request Guidelines\n\n- Create commits with `scripts/committer \"<msg>\" <file...>`; avoid manual `git add`/`git commit` so staging stays scoped.\n- Follow concise, action-oriented commit messages (e.g., `CLI: add verbose flag to send`).\n- Group related changes; avoid bundling unrelated refactors.\n- Changelog workflow: keep latest released version at top (no `Unreleased`); after publishing, bump version and start a new top section.\n- PRs should summarize scope, note testing performed, and mention any user-facing changes or new flags.\n- Read this when submitting a PR: `docs/help/submitting-a-pr.md` ([Submitting a PR](https://docs.openclaw.ai/help/submitting-a-pr))\n- Read this when submitting an issue: `docs/help/submitting-an-issue.md` ([Submitting an Issue](https://docs.openclaw.ai/help/submitting-an-issue))\n- PR review flow: when given a PR link, review via `gh pr view`/`gh pr diff` and do **not** change branches.\n- PR review calls: prefer a single `gh pr view --json ...` to batch metadata/comments; run `gh pr diff` only when needed.\n- Before starting a review when a GH Issue/PR is pasted: run `git pull`; if there are local changes or unpushed commits, stop and alert the user before reviewing.\n- Goal: merge PRs. Prefer **rebase** when commits are clean; **squash** when history is messy.\n- PR merge flow: create a temp branch from `main`, merge the PR branch into it (prefer squash unless commit history is important; use rebase/merge when it is). Always try to merge the PR unless it’s truly difficult, then use another approach. If we squash, add the PR author as a co-contributor. Apply fixes, add changelog entry (include PR # + thanks), run full gate before the final commit, commit, merge back to `main`, delete the temp branch, and end on `main`.\n- If you review a PR and later do work on it, land via merge/squash (no direct-main commits) and always add the PR author as a co-contributor.\n- When working on a PR: add a changelog entry with the PR number and thank the contributor.\n- When working on an issue: reference the issue in the changelog entry.\n- When merging a PR: leave a PR comment that explains exactly what we did and include the SHA hashes.\n- When merging a PR from a new contributor: add their avatar to the README “Thanks to all clawtributors” thumbnail list.\n- After merging a PR: run `bun scripts/update-clawtributors.ts` if the contributor is missing, then commit the regenerated README.\n\n## Shorthand Commands\n\n- `sync`: if working tree is dirty, commit all changes (pick a sensible Conventional Commit message), then `git pull --rebase`; if rebase conflicts and cannot resolve, stop; otherwise `git push`.\n\n### PR Workflow (Review vs Land)\n\n- **Review mode (PR link only):** read `gh pr view/diff`; **do not** switch branches; **do not** change code.\n- **Landing mode:** create an integration branch from `main`, bring in PR commits (**prefer rebase** for linear history; **merge allowed** when complexity/conflicts make it safer), apply fixes, add changelog (+ thanks + PR #), run full gate **locally before committing** (`pnpm build && pnpm check && pnpm test`), commit, merge back to `main`, then `git switch main` (never stay on a topic branch after landing). Important: contributor needs to be in git graph after this!\n\n## Security & Configuration Tips\n\n- Web provider stores creds at `~/.openclaw/credentials/`; rerun `openclaw login` if logged out.\n- Pi sessions live under `~/.openclaw/sessions/` by default; the base directory is not configurable.\n- Environment variables: see `~/.profile`.\n- Never commit or publish real phone numbers, videos, or live configuration values. Use obviously fake placeholders in docs, tests, and examples.\n- Release flow: always read `docs/reference/RELEASING.md` and `docs/platforms/mac/release.md` before any release work; do not ask routine questions once those docs answer them.\n\n## Troubleshooting\n\n- Rebrand/migration issues or legacy config/service warnings: run `openclaw doctor` (see `docs/gateway/doctor.md`).\n\n## Agent-Specific Notes\n\n- Vocabulary: \"makeup\" = \"mac app\".\n- Never edit `node_modules` (global/Homebrew/npm/git installs too). Updates overwrite. Skill notes go in `tools.md` or `AGENTS.md`.\n- Signal: \"update fly\" => `fly ssh console -a flawd-bot -C \"bash -lc 'cd /data/clawd/openclaw && git pull --rebase origin main'\"` then `fly machines restart e825232f34d058 -a flawd-bot`.\n- When working on a GitHub Issue or PR, print the full URL at the end of the task.\n- When answering questions, respond with high-confidence answers only: verify in code; do not guess.\n- Never update the Carbon dependency.\n- Any dependency with `pnpm.patchedDependencies` must use an exact version (no `^`/`~`).\n- Patching dependencies (pnpm patches, overrides, or vendored changes) requires explicit approval; do not do this by default.\n- CLI progress: use `src/cli/progress.ts` (`osc-progress` + `@clack/prompts` spinner); don’t hand-roll spinners/bars.\n- Status output: keep tables + ANSI-safe wrapping (`src/terminal/table.ts`); `status --all` = read-only/pasteable, `status --deep` = probes.\n- Gateway currently runs only as the menubar app; there is no separate LaunchAgent/helper label installed. Restart via the OpenClaw Mac app or `scripts/restart-mac.sh`; to verify/kill use `launchctl print gui/$UID | grep openclaw` rather than assuming a fixed label. **When debugging on macOS, start/stop the gateway via the app, not ad-hoc tmux sessions; kill any temporary tunnels before handoff.**\n- macOS logs: use `./scripts/clawlog.sh` to query unified logs for the OpenClaw subsystem; it supports follow/tail/category filters and expects passwordless sudo for `/usr/bin/log`.\n- If shared guardrails are available locally, review them; otherwise follow this repo's guidance.\n- SwiftUI state management (iOS/macOS): prefer the `Observation` framework (`@Observable`, `@Bindable`) over `ObservableObject`/`@StateObject`; don’t introduce new `ObservableObject` unless required for compatibility, and migrate existing usages when touching related code.\n- Connection providers: when adding a new connection, update every UI surface and docs (macOS app, web UI, mobile if applicable, onboarding/overview docs) and add matching status + configuration forms so provider lists and settings stay in sync.\n- Version locations: `package.json` (CLI), `apps/android/app/build.gradle.kts` (versionName/versionCode), `apps/ios/Sources/Info.plist` + `apps/ios/Tests/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `apps/macos/Sources/OpenClaw/Resources/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `docs/install/updating.md` (pinned npm version), `docs/platforms/mac/release.md` (APP_VERSION/APP_BUILD examples), Peekaboo Xcode projects/Info.plists (MARKETING_VERSION/CURRENT_PROJECT_VERSION).\n- **Restart apps:** “restart iOS/Android apps” means rebuild (recompile/install) and relaunch, not just kill/launch.\n- **Device checks:** before testing, verify connected real devices (iOS/Android) before reaching for simulators/emulators.\n- iOS Team ID lookup: `security find-identity -p codesigning -v` → use Apple Development (…) TEAMID. Fallback: `defaults read com.apple.dt.Xcode IDEProvisioningTeamIdentifiers`.\n- A2UI bundle hash: `src/canvas-host/a2ui/.bundle.hash` is auto-generated; ignore unexpected changes, and only regenerate via `pnpm canvas:a2ui:bundle` (or `scripts/bundle-a2ui.sh`) when needed. Commit the hash as a separate commit.\n- Release signing/notary keys are managed outside the repo; follow internal release docs.\n- Notary auth env vars (`APP_STORE_CONNECT_ISSUER_ID`, `APP_STORE_CONNECT_KEY_ID`, `APP_STORE_CONNECT_API_KEY_P8`) are expected in your environment (per internal release docs).\n- **Multi-agent safety:** do **not** create/apply/drop `git stash` entries unless explicitly requested (this includes `git pull --rebase --autostash`). Assume other agents may be working; keep unrelated WIP untouched and avoid cross-cutting state changes.\n- **Multi-agent safety:** when the user says \"push\", you may `git pull --rebase` to integrate latest changes (never discard other agents' work). When the user says \"commit\", scope to your changes only. When the user says \"commit all\", commit everything in grouped chunks.\n- **Multi-agent safety:** do **not** create/remove/modify `git worktree` checkouts (or edit `.worktrees/*`) unless explicitly requested.\n- **Multi-agent safety:** do **not** switch branches / check out a different branch unless explicitly requested.\n- **Multi-agent safety:** running multiple agents is OK as long as each agent has its own session.\n- **Multi-agent safety:** when you see unrecognized files, keep going; focus on your changes and commit only those.\n- Lint/format churn:\n  - If staged+unstaged diffs are formatting-only, auto-resolve without asking.\n  - If commit/push already requested, auto-stage and include formatting-only follow-ups in the same commit (or a tiny follow-up commit if needed), no extra confirmation.\n  - Only ask when changes are semantic (logic/data/behavior).\n- Lobster seam: use the shared CLI palette in `src/terminal/palette.ts` (no hardcoded colors); apply palette to onboarding/config prompts and other TTY UI output as needed.\n- **Multi-agent safety:** focus reports on your edits; avoid guard-rail disclaimers unless truly blocked; when multiple agents touch the same file, continue if safe; end with a brief “other files present” note only if relevant.\n- Bug investigations: read source code of relevant npm dependencies and all related local code before concluding; aim for high-confidence root cause.\n- Code style: add brief comments for tricky logic; keep files under ~500 LOC when feasible (split/refactor as needed).\n- Tool schema guardrails (google-antigravity): avoid `Type.Union` in tool input schemas; no `anyOf`/`oneOf`/`allOf`. Use `stringEnum`/`optionalStringEnum` (Type.Unsafe enum) for string lists, and `Type.Optional(...)` instead of `... | null`. Keep top-level tool schema as `type: \"object\"` with `properties`.\n- Tool schema guardrails: avoid raw `format` property names in tool schemas; some validators treat `format` as a reserved keyword and reject the schema.\n- When asked to open a “session” file, open the Pi session logs under `~/.openclaw/agents/<agentId>/sessions/*.jsonl` (use the `agent=<id>` value in the Runtime line of the system prompt; newest unless a specific ID is given), not the default `sessions.json`. If logs are needed from another machine, SSH via Tailscale and read the same path there.\n- Do not rebuild the macOS app over SSH; rebuilds must be run directly on the Mac.\n- Never send streaming/partial replies to external messaging surfaces (WhatsApp, Telegram); only final replies should be delivered there. Streaming/tool events may still go to internal UIs/control channel.\n- Voice wake forwarding tips:\n  - Command template should stay `openclaw-mac agent --message \"${text}\" --thinking low`; `VoiceWakeForwarder` already shell-escapes `${text}`. Don’t add extra quotes.\n  - launchd PATH is minimal; ensure the app’s launch agent PATH includes standard system paths plus your pnpm bin (typically `$HOME/Library/pnpm`) so `pnpm`/`openclaw` binaries resolve when invoked via `openclaw-mac`.\n- For manual `openclaw message send` messages that include `!`, use the heredoc pattern noted below to avoid the Bash tool’s escaping.\n- Release guardrails: do not change version numbers without operator’s explicit consent; always ask permission before running any npm publish/release step.\n\n## NPM + 1Password (publish/verify)\n\n- Use the 1password skill; all `op` commands must run inside a fresh tmux session.\n- Sign in: `eval \"$(op signin --account my.1password.com)\"` (app unlocked + integration on).\n- OTP: `op read 'op://Private/Npmjs/one-time password?attribute=otp'`.\n- Publish: `npm publish --access public --otp=\"<otp>\"` (run from the package dir).\n- Verify without local npmrc side effects: `npm view <pkg> version --userconfig \"$(mktemp)\"`.\n- Kill the tmux session after publish.\n\n\n## Skills\nA skill is a set of local instructions to follow that is stored in a `SKILL.md` file. Below is the list of skills that can be used. Each entry includes a name, description, and file path so you can open the source for full instructions when using a specific skill.\n### Available skills\n- merge-pr: Merge a GitHub PR via squash after /preparepr. Use when asked to merge a ready PR. Do not push to main or modify code. Ensure the PR ends in MERGED state and clean up worktrees after success. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/merge-pr/SKILL.md)\n- prepare-pr: Prepare a GitHub PR for merge by rebasing onto main, fixing review findings, running gates, committing fixes, and pushing to the PR head branch. Use after /reviewpr. Never merge or push to main. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/prepare-pr/SKILL.md)\n- review-pr: Review-only GitHub pull request analysis with the gh CLI. Use when asked to review a PR, provide structured feedback, or assess readiness to land. Do not merge, push, or make code changes you intend to keep. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/review-pr/SKILL.md)\n- figma: Use the Figma MCP server to fetch design context, screenshots, variables, and assets from Figma, and to translate Figma nodes into production code. Trigger when a task involves Figma URLs, node IDs, design-to-code implementation, or Figma MCP setup and troubleshooting. (file: /home/ldr-cavetroll/.codex/skills/figma/SKILL.md)\n- skill-creator: Guide for creating effective skills. This skill should be used when users want to create a new skill (or update an existing skill) that extends Codex's capabilities with specialized knowledge, workflows, or tool integrations. (file: /home/ldr-cavetroll/.codex/skills/.system/skill-creator/SKILL.md)\n- skill-installer: Install Codex skills into $CODEX_HOME/skills from a curated list or a GitHub repo path. Use when a user asks to list installable skills, install a curated skill, or install a skill from another repo (including private repos). (file: /home/ldr-cavetroll/.codex/skills/.system/skill-installer/SKILL.md)\n### How to use skills\n- Discovery: The list above is the skills available in this session (name + description + file path). Skill bodies live on disk at the listed paths.\n- Trigger rules: If the user names a skill (with `$SkillName` or plain text) OR the task clearly matches a skill's description shown above, you must use that skill for that turn. Multiple mentions mean use them all. Do not carry skills across turns unless re-mentioned.\n- Missing/blocked: If a named skill isn't in the list or the path can't be read, say so briefly and continue with the best fallback.\n- How to use a skill (progressive disclosure):\n  1) After deciding to use a skill, open its `SKILL.md`. Read only enough to follow the workflow.\n  2) When `SKILL.md` references relative paths (e.g., `scripts/foo.py`), resolve them relative to the skill directory listed above first, and only consider other paths if needed.\n  3) If `SKILL.md` points to extra folders such as `references/`, load only the specific files needed for the request; don't bulk-load everything.\n  4) If `scripts/` exist, prefer running or patching them instead of retyping large code blocks.\n  5) If `assets/` or templates exist, reuse them instead of recreating from scratch.\n- Coordination and sequencing:\n  - If multiple skills apply, choose the minimal set that covers the request and state the order you'll use them.\n  - Announce which skill(s) you're using and why (one short line). If you skip an obvious skill, say why.\n- Context hygiene:\n  - Keep context small: summarize long sections instead of pasting them; only load extra files when needed.\n  - Avoid deep reference-chasing: prefer opening only files directly linked from `SKILL.md` unless you're blocked.\n  - When variants exist (frameworks, providers, domains), pick only the relevant reference file(s) and note that choice.\n- Safety and fallback: If a skill can't be applied cleanly (missing files, unclear instructions), state the issue, pick the next-best approach, and continue.","truncation_policy":{"mode":"tokens","limit":10000}}}
{"timestamp":"2026-02-07T07:54:11.993Z","type":"event_msg","payload":{"type":"token_count","info":null,"rate_limits":{"primary":{"used_percent":0.0,"window_minutes":300,"resets_at":1770468851},"secondary":{"used_percent":7.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T07:54:13.240Z","type":"response_item","payload":{"type":"reasoning","summary":[],"content":null,"encrypted_content":"gAAAAABphu-lrHrxWAGP9a6iPJMewVfZddvGkorl4fKI4g7LJWiuM-EPSqR0nRqP1vDqQ7HuTs-040EZbeAieIQnNPb0FyDzSKHRBX3JNKY6tx52zQHWTGbA8X6Tl-k-QBQDsLrR1k26PKnG7qsSFUM2FQ6coNyF3JrB-exCEbxYims3TUnLmZrlZW8s-tCrrwTnxOkD0Ra39EOYh7h0-VfjRKaKLb2Fopo60Tj7t0rq4Fz28kzAx5t--wrj3FL6DX4T1tsbzFyv96oVGGmkt-HnUW2hFsLuulkzEepiaOTMmRzij8su6SEYiM6NL2VcNSJsiBdGv_8V9M1ee4CP9j4-V4jbGgzoVgd6DK8ow5oHL6BviXhvyRJ0s0zk0It155E-NjCh0OktfbBFGVZ8w-g9iWNmrbjdrmJkVE1ZowyTeZq8DfadPg1xWHZWTeNLAjha9sWj0ojTrmuSBbhH6tqMiLgDx7S7I3VDBdM-Tb6NiIQsXDJst614C5XHm1M3d3O9Xz3Zc5LrBo82flnqZ4kyEIHFjQzl8Lb0kJnfpV1Adknk1hAbEZ9rEVuwSVN8nb-K7-WXO52QX6EcBd5TelY_6j1h8eS1TSyXrDS9mbLgsCSASMN9D6CA_AD9irZnOJjq9Jpriher9BFLjKQ4tMhAgV_U4B_KXxmlYukOJBxvnTmDN3mhJQdJPGgjXI9HaEZWo83xdkKGze8NZopK2aksZMAb-rvReVE_sQ2aFk2EEH99KMh9jt03GT-dU0JcXrsdzVaKeHHge9xCF3__L8B-CdnCHRMx1WQ_nURyNIhH4NIrnR6FpYXe8cvQU7z_d7U1XVnuk4wneRC2xf94ipBjR8p0-9bV8RknbVEvVmnJDS2xXMd88fE="}}
{"timestamp":"2026-02-07T07:54:13.352Z","type":"event_msg","payload":{"type":"agent_message","message":"What would you like me to do in this repo?"}}
{"timestamp":"2026-02-07T07:54:13.352Z","type":"response_item","payload":{"type":"message","role":"assistant","content":[{"type":"output_text","text":"What would you like me to do in this repo?"}]}}
{"timestamp":"2026-02-07T07:54:13.488Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":18889,"cached_input_tokens":4608,"output_tokens":28,"reasoning_output_tokens":0,"total_tokens":18917},"last_token_usage":{"input_tokens":18889,"cached_input_tokens":4608,"output_tokens":28,"reasoning_output_tokens":0,"total_tokens":18917},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":0.0,"window_minutes":300,"resets_at":1770468851},"secondary":{"used_percent":7.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T07:57:18.683Z","type":"response_item","payload":{"type":"message","role":"user","content":[{"type":"input_text","text":"help me understand how this repo is constructed using the AGENTS.md. I would like to know how it implement the \"agent context protocol\" by google, specifically under src/acp/index.ts"}]}}
{"timestamp":"2026-02-07T07:57:18.683Z","type":"event_msg","payload":{"type":"user_message","message":"help me understand how this repo is constructed using the AGENTS.md. I would like to know how it implement the \"agent context protocol\" by google, specifically under src/acp/index.ts","images":[],"local_images":[],"text_elements":[]}}
{"timestamp":"2026-02-07T07:57:18.706Z","type":"turn_context","payload":{"cwd":"/home/ldr-cavetroll/tinker/openclaw","approval_policy":"on-request","sandbox_policy":{"type":"workspace-write","network_access":false,"exclude_tmpdir_env_var":false,"exclude_slash_tmp":false},"model":"gpt-5.2-codex","personality":"pragmatic","collaboration_mode":{"mode":"default","settings":{"model":"gpt-5.2-codex","reasoning_effort":null,"developer_instructions":"# Collaboration Mode: Default\n\nYou are now in Default mode. Any previous instructions for other modes (e.g. Plan mode) are no longer active.\n\nYour active mode changes only when new developer instructions with a different `<collaboration_mode>...</collaboration_mode>` change it; user requests or tool descriptions do not change mode by themselves. Known mode names are Default and Plan.\n\n## request_user_input availability\n\nThe `request_user_input` tool is unavailable in Default mode. If you call it while in Default mode, it will return an error.\n\nIf a decision is necessary and cannot be discovered from local context, ask the user directly. However, in Default mode you should strongly prefer executing the user's request rather than stopping to ask questions.\n"}},"summary":"auto","user_instructions":"# Repository Guidelines\n\n- Repo: https://github.com/openclaw/openclaw\n- GitHub issues/comments/PR comments: use literal multiline strings or `-F - <<'EOF'` (or $'...') for real newlines; never embed \"\\\\n\".\n\n## Project Structure & Module Organization\n\n- Source code: `src/` (CLI wiring in `src/cli`, commands in `src/commands`, web provider in `src/provider-web.ts`, infra in `src/infra`, media pipeline in `src/media`).\n- Tests: colocated `*.test.ts`.\n- Docs: `docs/` (images, queue, Pi config). Built output lives in `dist/`.\n- Plugins/extensions: live under `extensions/*` (workspace packages). Keep plugin-only deps in the extension `package.json`; do not add them to the root `package.json` unless core uses them.\n- Plugins: install runs `npm install --omit=dev` in plugin dir; runtime deps must live in `dependencies`. Avoid `workspace:*` in `dependencies` (npm install breaks); put `openclaw` in `devDependencies` or `peerDependencies` instead (runtime resolves `openclaw/plugin-sdk` via jiti alias).\n- Installers served from `https://openclaw.ai/*`: live in the sibling repo `../openclaw.ai` (`public/install.sh`, `public/install-cli.sh`, `public/install.ps1`).\n- Messaging channels: always consider **all** built-in + extension channels when refactoring shared logic (routing, allowlists, pairing, command gating, onboarding, docs).\n  - Core channel docs: `docs/channels/`\n  - Core channel code: `src/telegram`, `src/discord`, `src/slack`, `src/signal`, `src/imessage`, `src/web` (WhatsApp web), `src/channels`, `src/routing`\n  - Extensions (channel plugins): `extensions/*` (e.g. `extensions/msteams`, `extensions/matrix`, `extensions/zalo`, `extensions/zalouser`, `extensions/voice-call`)\n- When adding channels/extensions/apps/docs, review `.github/labeler.yml` for label coverage.\n\n## Docs Linking (Mintlify)\n\n- Docs are hosted on Mintlify (docs.openclaw.ai).\n- Internal doc links in `docs/**/*.md`: root-relative, no `.md`/`.mdx` (example: `[Config](/configuration)`).\n- Section cross-references: use anchors on root-relative paths (example: `[Hooks](/configuration#hooks)`).\n- Doc headings and anchors: avoid em dashes and apostrophes in headings because they break Mintlify anchor links.\n- When Peter asks for links, reply with full `https://docs.openclaw.ai/...` URLs (not root-relative).\n- When you touch docs, end the reply with the `https://docs.openclaw.ai/...` URLs you referenced.\n- README (GitHub): keep absolute docs URLs (`https://docs.openclaw.ai/...`) so links work on GitHub.\n- Docs content must be generic: no personal device names/hostnames/paths; use placeholders like `user@gateway-host` and “gateway host”.\n\n## Docs i18n (zh-CN)\n\n- `docs/zh-CN/**` is generated; do not edit unless the user explicitly asks.\n- Pipeline: update English docs → adjust glossary (`docs/.i18n/glossary.zh-CN.json`) → run `scripts/docs-i18n` → apply targeted fixes only if instructed.\n- Translation memory: `docs/.i18n/zh-CN.tm.jsonl` (generated).\n- See `docs/.i18n/README.md`.\n- The pipeline can be slow/inefficient; if it’s dragging, ping @jospalmbier on Discord instead of hacking around it.\n\n## exe.dev VM ops (general)\n\n- Access: stable path is `ssh exe.dev` then `ssh vm-name` (assume SSH key already set).\n- SSH flaky: use exe.dev web terminal or Shelley (web agent); keep a tmux session for long ops.\n- Update: `sudo npm i -g openclaw@latest` (global install needs root on `/usr/lib/node_modules`).\n- Config: use `openclaw config set ...`; ensure `gateway.mode=local` is set.\n- Discord: store raw token only (no `DISCORD_BOT_TOKEN=` prefix).\n- Restart: stop old gateway and run:\n  `pkill -9 -f openclaw-gateway || true; nohup openclaw gateway run --bind loopback --port 18789 --force > /tmp/openclaw-gateway.log 2>&1 &`\n- Verify: `openclaw channels status --probe`, `ss -ltnp | rg 18789`, `tail -n 120 /tmp/openclaw-gateway.log`.\n\n## Build, Test, and Development Commands\n\n- Runtime baseline: Node **22+** (keep Node + Bun paths working).\n- Install deps: `pnpm install`\n- Pre-commit hooks: `prek install` (runs same checks as CI)\n- Also supported: `bun install` (keep `pnpm-lock.yaml` + Bun patching in sync when touching deps/patches).\n- Prefer Bun for TypeScript execution (scripts, dev, tests): `bun <file.ts>` / `bunx <tool>`.\n- Run CLI in dev: `pnpm openclaw ...` (bun) or `pnpm dev`.\n- Node remains supported for running built output (`dist/*`) and production installs.\n- Mac packaging (dev): `scripts/package-mac-app.sh` defaults to current arch. Release checklist: `docs/platforms/mac/release.md`.\n- Type-check/build: `pnpm build`\n- TypeScript checks: `pnpm tsgo`\n- Lint/format: `pnpm check`\n- Tests: `pnpm test` (vitest); coverage: `pnpm test:coverage`\n\n## Coding Style & Naming Conventions\n\n- Language: TypeScript (ESM). Prefer strict typing; avoid `any`.\n- Formatting/linting via Oxlint and Oxfmt; run `pnpm check` before commits.\n- Add brief code comments for tricky or non-obvious logic.\n- Keep files concise; extract helpers instead of “V2” copies. Use existing patterns for CLI options and dependency injection via `createDefaultDeps`.\n- Aim to keep files under ~700 LOC; guideline only (not a hard guardrail). Split/refactor when it improves clarity or testability.\n- Naming: use **OpenClaw** for product/app/docs headings; use `openclaw` for CLI command, package/binary, paths, and config keys.\n\n## Release Channels (Naming)\n\n- stable: tagged releases only (e.g. `vYYYY.M.D`), npm dist-tag `latest`.\n- beta: prerelease tags `vYYYY.M.D-beta.N`, npm dist-tag `beta` (may ship without macOS app).\n- dev: moving head on `main` (no tag; git checkout main).\n\n## Testing Guidelines\n\n- Framework: Vitest with V8 coverage thresholds (70% lines/branches/functions/statements).\n- Naming: match source names with `*.test.ts`; e2e in `*.e2e.test.ts`.\n- Run `pnpm test` (or `pnpm test:coverage`) before pushing when you touch logic.\n- Do not set test workers above 16; tried already.\n- Live tests (real keys): `CLAWDBOT_LIVE_TEST=1 pnpm test:live` (OpenClaw-only) or `LIVE=1 pnpm test:live` (includes provider live tests). Docker: `pnpm test:docker:live-models`, `pnpm test:docker:live-gateway`. Onboarding Docker E2E: `pnpm test:docker:onboard`.\n- Full kit + what’s covered: `docs/testing.md`.\n- Pure test additions/fixes generally do **not** need a changelog entry unless they alter user-facing behavior or the user asks for one.\n- Mobile: before using a simulator, check for connected real devices (iOS + Android) and prefer them when available.\n\n## Commit & Pull Request Guidelines\n\n- Create commits with `scripts/committer \"<msg>\" <file...>`; avoid manual `git add`/`git commit` so staging stays scoped.\n- Follow concise, action-oriented commit messages (e.g., `CLI: add verbose flag to send`).\n- Group related changes; avoid bundling unrelated refactors.\n- Changelog workflow: keep latest released version at top (no `Unreleased`); after publishing, bump version and start a new top section.\n- PRs should summarize scope, note testing performed, and mention any user-facing changes or new flags.\n- Read this when submitting a PR: `docs/help/submitting-a-pr.md` ([Submitting a PR](https://docs.openclaw.ai/help/submitting-a-pr))\n- Read this when submitting an issue: `docs/help/submitting-an-issue.md` ([Submitting an Issue](https://docs.openclaw.ai/help/submitting-an-issue))\n- PR review flow: when given a PR link, review via `gh pr view`/`gh pr diff` and do **not** change branches.\n- PR review calls: prefer a single `gh pr view --json ...` to batch metadata/comments; run `gh pr diff` only when needed.\n- Before starting a review when a GH Issue/PR is pasted: run `git pull`; if there are local changes or unpushed commits, stop and alert the user before reviewing.\n- Goal: merge PRs. Prefer **rebase** when commits are clean; **squash** when history is messy.\n- PR merge flow: create a temp branch from `main`, merge the PR branch into it (prefer squash unless commit history is important; use rebase/merge when it is). Always try to merge the PR unless it’s truly difficult, then use another approach. If we squash, add the PR author as a co-contributor. Apply fixes, add changelog entry (include PR # + thanks), run full gate before the final commit, commit, merge back to `main`, delete the temp branch, and end on `main`.\n- If you review a PR and later do work on it, land via merge/squash (no direct-main commits) and always add the PR author as a co-contributor.\n- When working on a PR: add a changelog entry with the PR number and thank the contributor.\n- When working on an issue: reference the issue in the changelog entry.\n- When merging a PR: leave a PR comment that explains exactly what we did and include the SHA hashes.\n- When merging a PR from a new contributor: add their avatar to the README “Thanks to all clawtributors” thumbnail list.\n- After merging a PR: run `bun scripts/update-clawtributors.ts` if the contributor is missing, then commit the regenerated README.\n\n## Shorthand Commands\n\n- `sync`: if working tree is dirty, commit all changes (pick a sensible Conventional Commit message), then `git pull --rebase`; if rebase conflicts and cannot resolve, stop; otherwise `git push`.\n\n### PR Workflow (Review vs Land)\n\n- **Review mode (PR link only):** read `gh pr view/diff`; **do not** switch branches; **do not** change code.\n- **Landing mode:** create an integration branch from `main`, bring in PR commits (**prefer rebase** for linear history; **merge allowed** when complexity/conflicts make it safer), apply fixes, add changelog (+ thanks + PR #), run full gate **locally before committing** (`pnpm build && pnpm check && pnpm test`), commit, merge back to `main`, then `git switch main` (never stay on a topic branch after landing). Important: contributor needs to be in git graph after this!\n\n## Security & Configuration Tips\n\n- Web provider stores creds at `~/.openclaw/credentials/`; rerun `openclaw login` if logged out.\n- Pi sessions live under `~/.openclaw/sessions/` by default; the base directory is not configurable.\n- Environment variables: see `~/.profile`.\n- Never commit or publish real phone numbers, videos, or live configuration values. Use obviously fake placeholders in docs, tests, and examples.\n- Release flow: always read `docs/reference/RELEASING.md` and `docs/platforms/mac/release.md` before any release work; do not ask routine questions once those docs answer them.\n\n## Troubleshooting\n\n- Rebrand/migration issues or legacy config/service warnings: run `openclaw doctor` (see `docs/gateway/doctor.md`).\n\n## Agent-Specific Notes\n\n- Vocabulary: \"makeup\" = \"mac app\".\n- Never edit `node_modules` (global/Homebrew/npm/git installs too). Updates overwrite. Skill notes go in `tools.md` or `AGENTS.md`.\n- Signal: \"update fly\" => `fly ssh console -a flawd-bot -C \"bash -lc 'cd /data/clawd/openclaw && git pull --rebase origin main'\"` then `fly machines restart e825232f34d058 -a flawd-bot`.\n- When working on a GitHub Issue or PR, print the full URL at the end of the task.\n- When answering questions, respond with high-confidence answers only: verify in code; do not guess.\n- Never update the Carbon dependency.\n- Any dependency with `pnpm.patchedDependencies` must use an exact version (no `^`/`~`).\n- Patching dependencies (pnpm patches, overrides, or vendored changes) requires explicit approval; do not do this by default.\n- CLI progress: use `src/cli/progress.ts` (`osc-progress` + `@clack/prompts` spinner); don’t hand-roll spinners/bars.\n- Status output: keep tables + ANSI-safe wrapping (`src/terminal/table.ts`); `status --all` = read-only/pasteable, `status --deep` = probes.\n- Gateway currently runs only as the menubar app; there is no separate LaunchAgent/helper label installed. Restart via the OpenClaw Mac app or `scripts/restart-mac.sh`; to verify/kill use `launchctl print gui/$UID | grep openclaw` rather than assuming a fixed label. **When debugging on macOS, start/stop the gateway via the app, not ad-hoc tmux sessions; kill any temporary tunnels before handoff.**\n- macOS logs: use `./scripts/clawlog.sh` to query unified logs for the OpenClaw subsystem; it supports follow/tail/category filters and expects passwordless sudo for `/usr/bin/log`.\n- If shared guardrails are available locally, review them; otherwise follow this repo's guidance.\n- SwiftUI state management (iOS/macOS): prefer the `Observation` framework (`@Observable`, `@Bindable`) over `ObservableObject`/`@StateObject`; don’t introduce new `ObservableObject` unless required for compatibility, and migrate existing usages when touching related code.\n- Connection providers: when adding a new connection, update every UI surface and docs (macOS app, web UI, mobile if applicable, onboarding/overview docs) and add matching status + configuration forms so provider lists and settings stay in sync.\n- Version locations: `package.json` (CLI), `apps/android/app/build.gradle.kts` (versionName/versionCode), `apps/ios/Sources/Info.plist` + `apps/ios/Tests/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `apps/macos/Sources/OpenClaw/Resources/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `docs/install/updating.md` (pinned npm version), `docs/platforms/mac/release.md` (APP_VERSION/APP_BUILD examples), Peekaboo Xcode projects/Info.plists (MARKETING_VERSION/CURRENT_PROJECT_VERSION).\n- **Restart apps:** “restart iOS/Android apps” means rebuild (recompile/install) and relaunch, not just kill/launch.\n- **Device checks:** before testing, verify connected real devices (iOS/Android) before reaching for simulators/emulators.\n- iOS Team ID lookup: `security find-identity -p codesigning -v` → use Apple Development (…) TEAMID. Fallback: `defaults read com.apple.dt.Xcode IDEProvisioningTeamIdentifiers`.\n- A2UI bundle hash: `src/canvas-host/a2ui/.bundle.hash` is auto-generated; ignore unexpected changes, and only regenerate via `pnpm canvas:a2ui:bundle` (or `scripts/bundle-a2ui.sh`) when needed. Commit the hash as a separate commit.\n- Release signing/notary keys are managed outside the repo; follow internal release docs.\n- Notary auth env vars (`APP_STORE_CONNECT_ISSUER_ID`, `APP_STORE_CONNECT_KEY_ID`, `APP_STORE_CONNECT_API_KEY_P8`) are expected in your environment (per internal release docs).\n- **Multi-agent safety:** do **not** create/apply/drop `git stash` entries unless explicitly requested (this includes `git pull --rebase --autostash`). Assume other agents may be working; keep unrelated WIP untouched and avoid cross-cutting state changes.\n- **Multi-agent safety:** when the user says \"push\", you may `git pull --rebase` to integrate latest changes (never discard other agents' work). When the user says \"commit\", scope to your changes only. When the user says \"commit all\", commit everything in grouped chunks.\n- **Multi-agent safety:** do **not** create/remove/modify `git worktree` checkouts (or edit `.worktrees/*`) unless explicitly requested.\n- **Multi-agent safety:** do **not** switch branches / check out a different branch unless explicitly requested.\n- **Multi-agent safety:** running multiple agents is OK as long as each agent has its own session.\n- **Multi-agent safety:** when you see unrecognized files, keep going; focus on your changes and commit only those.\n- Lint/format churn:\n  - If staged+unstaged diffs are formatting-only, auto-resolve without asking.\n  - If commit/push already requested, auto-stage and include formatting-only follow-ups in the same commit (or a tiny follow-up commit if needed), no extra confirmation.\n  - Only ask when changes are semantic (logic/data/behavior).\n- Lobster seam: use the shared CLI palette in `src/terminal/palette.ts` (no hardcoded colors); apply palette to onboarding/config prompts and other TTY UI output as needed.\n- **Multi-agent safety:** focus reports on your edits; avoid guard-rail disclaimers unless truly blocked; when multiple agents touch the same file, continue if safe; end with a brief “other files present” note only if relevant.\n- Bug investigations: read source code of relevant npm dependencies and all related local code before concluding; aim for high-confidence root cause.\n- Code style: add brief comments for tricky logic; keep files under ~500 LOC when feasible (split/refactor as needed).\n- Tool schema guardrails (google-antigravity): avoid `Type.Union` in tool input schemas; no `anyOf`/`oneOf`/`allOf`. Use `stringEnum`/`optionalStringEnum` (Type.Unsafe enum) for string lists, and `Type.Optional(...)` instead of `... | null`. Keep top-level tool schema as `type: \"object\"` with `properties`.\n- Tool schema guardrails: avoid raw `format` property names in tool schemas; some validators treat `format` as a reserved keyword and reject the schema.\n- When asked to open a “session” file, open the Pi session logs under `~/.openclaw/agents/<agentId>/sessions/*.jsonl` (use the `agent=<id>` value in the Runtime line of the system prompt; newest unless a specific ID is given), not the default `sessions.json`. If logs are needed from another machine, SSH via Tailscale and read the same path there.\n- Do not rebuild the macOS app over SSH; rebuilds must be run directly on the Mac.\n- Never send streaming/partial replies to external messaging surfaces (WhatsApp, Telegram); only final replies should be delivered there. Streaming/tool events may still go to internal UIs/control channel.\n- Voice wake forwarding tips:\n  - Command template should stay `openclaw-mac agent --message \"${text}\" --thinking low`; `VoiceWakeForwarder` already shell-escapes `${text}`. Don’t add extra quotes.\n  - launchd PATH is minimal; ensure the app’s launch agent PATH includes standard system paths plus your pnpm bin (typically `$HOME/Library/pnpm`) so `pnpm`/`openclaw` binaries resolve when invoked via `openclaw-mac`.\n- For manual `openclaw message send` messages that include `!`, use the heredoc pattern noted below to avoid the Bash tool’s escaping.\n- Release guardrails: do not change version numbers without operator’s explicit consent; always ask permission before running any npm publish/release step.\n\n## NPM + 1Password (publish/verify)\n\n- Use the 1password skill; all `op` commands must run inside a fresh tmux session.\n- Sign in: `eval \"$(op signin --account my.1password.com)\"` (app unlocked + integration on).\n- OTP: `op read 'op://Private/Npmjs/one-time password?attribute=otp'`.\n- Publish: `npm publish --access public --otp=\"<otp>\"` (run from the package dir).\n- Verify without local npmrc side effects: `npm view <pkg> version --userconfig \"$(mktemp)\"`.\n- Kill the tmux session after publish.\n\n\n## Skills\nA skill is a set of local instructions to follow that is stored in a `SKILL.md` file. Below is the list of skills that can be used. Each entry includes a name, description, and file path so you can open the source for full instructions when using a specific skill.\n### Available skills\n- merge-pr: Merge a GitHub PR via squash after /preparepr. Use when asked to merge a ready PR. Do not push to main or modify code. Ensure the PR ends in MERGED state and clean up worktrees after success. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/merge-pr/SKILL.md)\n- prepare-pr: Prepare a GitHub PR for merge by rebasing onto main, fixing review findings, running gates, committing fixes, and pushing to the PR head branch. Use after /reviewpr. Never merge or push to main. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/prepare-pr/SKILL.md)\n- review-pr: Review-only GitHub pull request analysis with the gh CLI. Use when asked to review a PR, provide structured feedback, or assess readiness to land. Do not merge, push, or make code changes you intend to keep. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/review-pr/SKILL.md)\n- figma: Use the Figma MCP server to fetch design context, screenshots, variables, and assets from Figma, and to translate Figma nodes into production code. Trigger when a task involves Figma URLs, node IDs, design-to-code implementation, or Figma MCP setup and troubleshooting. (file: /home/ldr-cavetroll/.codex/skills/figma/SKILL.md)\n- skill-creator: Guide for creating effective skills. This skill should be used when users want to create a new skill (or update an existing skill) that extends Codex's capabilities with specialized knowledge, workflows, or tool integrations. (file: /home/ldr-cavetroll/.codex/skills/.system/skill-creator/SKILL.md)\n- skill-installer: Install Codex skills into $CODEX_HOME/skills from a curated list or a GitHub repo path. Use when a user asks to list installable skills, install a curated skill, or install a skill from another repo (including private repos). (file: /home/ldr-cavetroll/.codex/skills/.system/skill-installer/SKILL.md)\n### How to use skills\n- Discovery: The list above is the skills available in this session (name + description + file path). Skill bodies live on disk at the listed paths.\n- Trigger rules: If the user names a skill (with `$SkillName` or plain text) OR the task clearly matches a skill's description shown above, you must use that skill for that turn. Multiple mentions mean use them all. Do not carry skills across turns unless re-mentioned.\n- Missing/blocked: If a named skill isn't in the list or the path can't be read, say so briefly and continue with the best fallback.\n- How to use a skill (progressive disclosure):\n  1) After deciding to use a skill, open its `SKILL.md`. Read only enough to follow the workflow.\n  2) When `SKILL.md` references relative paths (e.g., `scripts/foo.py`), resolve them relative to the skill directory listed above first, and only consider other paths if needed.\n  3) If `SKILL.md` points to extra folders such as `references/`, load only the specific files needed for the request; don't bulk-load everything.\n  4) If `scripts/` exist, prefer running or patching them instead of retyping large code blocks.\n  5) If `assets/` or templates exist, reuse them instead of recreating from scratch.\n- Coordination and sequencing:\n  - If multiple skills apply, choose the minimal set that covers the request and state the order you'll use them.\n  - Announce which skill(s) you're using and why (one short line). If you skip an obvious skill, say why.\n- Context hygiene:\n  - Keep context small: summarize long sections instead of pasting them; only load extra files when needed.\n  - Avoid deep reference-chasing: prefer opening only files directly linked from `SKILL.md` unless you're blocked.\n  - When variants exist (frameworks, providers, domains), pick only the relevant reference file(s) and note that choice.\n- Safety and fallback: If a skill can't be applied cleanly (missing files, unclear instructions), state the issue, pick the next-best approach, and continue.","truncation_policy":{"mode":"tokens","limit":10000}}}
{"timestamp":"2026-02-07T07:57:18.969Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":18889,"cached_input_tokens":4608,"output_tokens":28,"reasoning_output_tokens":0,"total_tokens":18917},"last_token_usage":{"input_tokens":18889,"cached_input_tokens":4608,"output_tokens":28,"reasoning_output_tokens":0,"total_tokens":18917},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":1.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":7.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T07:57:20.228Z","type":"event_msg","payload":{"type":"agent_reasoning","text":"**Opening file to read contents**"}}
{"timestamp":"2026-02-07T07:57:20.228Z","type":"response_item","payload":{"type":"reasoning","summary":[{"type":"summary_text","text":"**Opening file to read contents**"}],"content":null,"encrypted_content":"gAAAAABphvBgYrTKl1Mx6qiDGEu-WRi5qKvTHFAsJzmozbyBDDcwaobhnrrgPIYu7mXcxKayjRT1CsuYv-W9u_0liwK1s_eXVeedo0cxd-Ol33OUsYMb45L6rJ9qpNYB86mw7lcKI6JMNmtdC9hG2P_RnXTAnmRDNvh7WsWmKDqC_kpcyJAbTfTW70qtZhagDEnvPUz_eIcwtg40bIm3pEcKFGygiZKtCHchbYQ5beV4ETLniADkOKSJfY88j8m6ZF97lgnAp4tRxr_p2R62Mf36Wjh6Who2lN__IVdBeWHXFaDJGsHtkqFnBARG0KEog7QsC2Xte5TRYbqyUuGA5zK3dEULs3DG0yHWE4jzclUsGvEj6KvwVMyPn-l7CnWTO0EBM6oFqwIriOe3-OfqC6HBqlXzmIEyKUF-jgt2fLsp_jiwwZfTLli2ESamADS-2XrssEjO5JCc_aApZxU90TWTx6goHjAS1QcaQOQoQPaPXLO4O4VlGdCtbNM_MxZULC6tDnZvwu4wMX8gvwdn-edJ3WHx-PBijy5qSG6vWFjpB65AfN-dtdF5bkuwO09Y04-IDs1pAVHYMO5tBuzb08GmpWkRQu7kPShbDFrBsRZJTdIpZVuRIMsntLi3KpOQk38wg-9HJOTUawZqDI4-0OoPmKmqoZuMGPvcjvRpvwUwqGYhznltJVJOsaFzWeRF5l4a0DC0q9L26zNtS8p4kXBectpmEmmH8q9Hf8FG3MBfhktp-ZUWkOBxCR0ctgJB9GMI04dsLXSKskQ-Y7UgQBBR93PJYvlzO-EkJT-te9NUYW5-6a5K3eJFRKy6SnKIZXFAiKL-Rq0nxHQQqiEZJS4nhDysUaWxQQhsC4TIcMDwHogbnCLmiUA="}}
{"timestamp":"2026-02-07T07:57:20.558Z","type":"response_item","payload":{"type":"function_call","name":"exec_command","arguments":"{\"cmd\":\"ls\"}","call_id":"call_kPIyBVTRHogqtW8ciH2df41W"}}
{"timestamp":"2026-02-07T07:57:20.560Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":37837,"cached_input_tokens":9216,"output_tokens":62,"reasoning_output_tokens":0,"total_tokens":37899},"last_token_usage":{"input_tokens":18948,"cached_input_tokens":4608,"output_tokens":34,"reasoning_output_tokens":0,"total_tokens":18982},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":1.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":7.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T07:57:20.656Z","type":"response_item","payload":{"type":"function_call_output","call_id":"call_kPIyBVTRHogqtW8ciH2df41W","output":"Chunk ID: 593df1\nWall time: 0.0506 seconds\nProcess exited with code 0\nOriginal token count: 157\nOutput:\nAGENTS.md\nCHANGELOG.md\nCLAUDE.md\nCONTRIBUTING.md\nDockerfile\nDockerfile.sandbox\nDockerfile.sandbox-browser\nLICENSE\nREADME-header.png\nREADME.md\nSECURITY.md\nSwabble\nappcast.xml\napps\nassets\ndocker-compose.yml\ndocker-setup.sh\ndocs\ndocs.acp.md\nextensions\nfly.private.toml\nfly.toml\ngit-hooks\nnode_modules\nopenclaw.mjs\npackage.json\npackages\npatches\npnpm-lock.yaml\npnpm-workspace.yaml\nrender.yaml\nscripts\nskills\nsrc\ntest\ntsconfig.json\ntsconfig.plugin-sdk.dts.json\ntsdown.config.ts\nui\nvendor\nvitest.config.ts\nvitest.e2e.config.ts\nvitest.extensions.config.ts\nvitest.gateway.config.ts\nvitest.live.config.ts\nvitest.unit.config.ts\nzizmor.yml\n"}}
{"timestamp":"2026-02-07T07:57:20.679Z","type":"turn_context","payload":{"cwd":"/home/ldr-cavetroll/tinker/openclaw","approval_policy":"on-request","sandbox_policy":{"type":"workspace-write","network_access":false,"exclude_tmpdir_env_var":false,"exclude_slash_tmp":false},"model":"gpt-5.2-codex","personality":"pragmatic","collaboration_mode":{"mode":"default","settings":{"model":"gpt-5.2-codex","reasoning_effort":null,"developer_instructions":"# Collaboration Mode: Default\n\nYou are now in Default mode. Any previous instructions for other modes (e.g. Plan mode) are no longer active.\n\nYour active mode changes only when new developer instructions with a different `<collaboration_mode>...</collaboration_mode>` change it; user requests or tool descriptions do not change mode by themselves. Known mode names are Default and Plan.\n\n## request_user_input availability\n\nThe `request_user_input` tool is unavailable in Default mode. If you call it while in Default mode, it will return an error.\n\nIf a decision is necessary and cannot be discovered from local context, ask the user directly. However, in Default mode you should strongly prefer executing the user's request rather than stopping to ask questions.\n"}},"summary":"auto","user_instructions":"# Repository Guidelines\n\n- Repo: https://github.com/openclaw/openclaw\n- GitHub issues/comments/PR comments: use literal multiline strings or `-F - <<'EOF'` (or $'...') for real newlines; never embed \"\\\\n\".\n\n## Project Structure & Module Organization\n\n- Source code: `src/` (CLI wiring in `src/cli`, commands in `src/commands`, web provider in `src/provider-web.ts`, infra in `src/infra`, media pipeline in `src/media`).\n- Tests: colocated `*.test.ts`.\n- Docs: `docs/` (images, queue, Pi config). Built output lives in `dist/`.\n- Plugins/extensions: live under `extensions/*` (workspace packages). Keep plugin-only deps in the extension `package.json`; do not add them to the root `package.json` unless core uses them.\n- Plugins: install runs `npm install --omit=dev` in plugin dir; runtime deps must live in `dependencies`. Avoid `workspace:*` in `dependencies` (npm install breaks); put `openclaw` in `devDependencies` or `peerDependencies` instead (runtime resolves `openclaw/plugin-sdk` via jiti alias).\n- Installers served from `https://openclaw.ai/*`: live in the sibling repo `../openclaw.ai` (`public/install.sh`, `public/install-cli.sh`, `public/install.ps1`).\n- Messaging channels: always consider **all** built-in + extension channels when refactoring shared logic (routing, allowlists, pairing, command gating, onboarding, docs).\n  - Core channel docs: `docs/channels/`\n  - Core channel code: `src/telegram`, `src/discord`, `src/slack`, `src/signal`, `src/imessage`, `src/web` (WhatsApp web), `src/channels`, `src/routing`\n  - Extensions (channel plugins): `extensions/*` (e.g. `extensions/msteams`, `extensions/matrix`, `extensions/zalo`, `extensions/zalouser`, `extensions/voice-call`)\n- When adding channels/extensions/apps/docs, review `.github/labeler.yml` for label coverage.\n\n## Docs Linking (Mintlify)\n\n- Docs are hosted on Mintlify (docs.openclaw.ai).\n- Internal doc links in `docs/**/*.md`: root-relative, no `.md`/`.mdx` (example: `[Config](/configuration)`).\n- Section cross-references: use anchors on root-relative paths (example: `[Hooks](/configuration#hooks)`).\n- Doc headings and anchors: avoid em dashes and apostrophes in headings because they break Mintlify anchor links.\n- When Peter asks for links, reply with full `https://docs.openclaw.ai/...` URLs (not root-relative).\n- When you touch docs, end the reply with the `https://docs.openclaw.ai/...` URLs you referenced.\n- README (GitHub): keep absolute docs URLs (`https://docs.openclaw.ai/...`) so links work on GitHub.\n- Docs content must be generic: no personal device names/hostnames/paths; use placeholders like `user@gateway-host` and “gateway host”.\n\n## Docs i18n (zh-CN)\n\n- `docs/zh-CN/**` is generated; do not edit unless the user explicitly asks.\n- Pipeline: update English docs → adjust glossary (`docs/.i18n/glossary.zh-CN.json`) → run `scripts/docs-i18n` → apply targeted fixes only if instructed.\n- Translation memory: `docs/.i18n/zh-CN.tm.jsonl` (generated).\n- See `docs/.i18n/README.md`.\n- The pipeline can be slow/inefficient; if it’s dragging, ping @jospalmbier on Discord instead of hacking around it.\n\n## exe.dev VM ops (general)\n\n- Access: stable path is `ssh exe.dev` then `ssh vm-name` (assume SSH key already set).\n- SSH flaky: use exe.dev web terminal or Shelley (web agent); keep a tmux session for long ops.\n- Update: `sudo npm i -g openclaw@latest` (global install needs root on `/usr/lib/node_modules`).\n- Config: use `openclaw config set ...`; ensure `gateway.mode=local` is set.\n- Discord: store raw token only (no `DISCORD_BOT_TOKEN=` prefix).\n- Restart: stop old gateway and run:\n  `pkill -9 -f openclaw-gateway || true; nohup openclaw gateway run --bind loopback --port 18789 --force > /tmp/openclaw-gateway.log 2>&1 &`\n- Verify: `openclaw channels status --probe`, `ss -ltnp | rg 18789`, `tail -n 120 /tmp/openclaw-gateway.log`.\n\n## Build, Test, and Development Commands\n\n- Runtime baseline: Node **22+** (keep Node + Bun paths working).\n- Install deps: `pnpm install`\n- Pre-commit hooks: `prek install` (runs same checks as CI)\n- Also supported: `bun install` (keep `pnpm-lock.yaml` + Bun patching in sync when touching deps/patches).\n- Prefer Bun for TypeScript execution (scripts, dev, tests): `bun <file.ts>` / `bunx <tool>`.\n- Run CLI in dev: `pnpm openclaw ...` (bun) or `pnpm dev`.\n- Node remains supported for running built output (`dist/*`) and production installs.\n- Mac packaging (dev): `scripts/package-mac-app.sh` defaults to current arch. Release checklist: `docs/platforms/mac/release.md`.\n- Type-check/build: `pnpm build`\n- TypeScript checks: `pnpm tsgo`\n- Lint/format: `pnpm check`\n- Tests: `pnpm test` (vitest); coverage: `pnpm test:coverage`\n\n## Coding Style & Naming Conventions\n\n- Language: TypeScript (ESM). Prefer strict typing; avoid `any`.\n- Formatting/linting via Oxlint and Oxfmt; run `pnpm check` before commits.\n- Add brief code comments for tricky or non-obvious logic.\n- Keep files concise; extract helpers instead of “V2” copies. Use existing patterns for CLI options and dependency injection via `createDefaultDeps`.\n- Aim to keep files under ~700 LOC; guideline only (not a hard guardrail). Split/refactor when it improves clarity or testability.\n- Naming: use **OpenClaw** for product/app/docs headings; use `openclaw` for CLI command, package/binary, paths, and config keys.\n\n## Release Channels (Naming)\n\n- stable: tagged releases only (e.g. `vYYYY.M.D`), npm dist-tag `latest`.\n- beta: prerelease tags `vYYYY.M.D-beta.N`, npm dist-tag `beta` (may ship without macOS app).\n- dev: moving head on `main` (no tag; git checkout main).\n\n## Testing Guidelines\n\n- Framework: Vitest with V8 coverage thresholds (70% lines/branches/functions/statements).\n- Naming: match source names with `*.test.ts`; e2e in `*.e2e.test.ts`.\n- Run `pnpm test` (or `pnpm test:coverage`) before pushing when you touch logic.\n- Do not set test workers above 16; tried already.\n- Live tests (real keys): `CLAWDBOT_LIVE_TEST=1 pnpm test:live` (OpenClaw-only) or `LIVE=1 pnpm test:live` (includes provider live tests). Docker: `pnpm test:docker:live-models`, `pnpm test:docker:live-gateway`. Onboarding Docker E2E: `pnpm test:docker:onboard`.\n- Full kit + what’s covered: `docs/testing.md`.\n- Pure test additions/fixes generally do **not** need a changelog entry unless they alter user-facing behavior or the user asks for one.\n- Mobile: before using a simulator, check for connected real devices (iOS + Android) and prefer them when available.\n\n## Commit & Pull Request Guidelines\n\n- Create commits with `scripts/committer \"<msg>\" <file...>`; avoid manual `git add`/`git commit` so staging stays scoped.\n- Follow concise, action-oriented commit messages (e.g., `CLI: add verbose flag to send`).\n- Group related changes; avoid bundling unrelated refactors.\n- Changelog workflow: keep latest released version at top (no `Unreleased`); after publishing, bump version and start a new top section.\n- PRs should summarize scope, note testing performed, and mention any user-facing changes or new flags.\n- Read this when submitting a PR: `docs/help/submitting-a-pr.md` ([Submitting a PR](https://docs.openclaw.ai/help/submitting-a-pr))\n- Read this when submitting an issue: `docs/help/submitting-an-issue.md` ([Submitting an Issue](https://docs.openclaw.ai/help/submitting-an-issue))\n- PR review flow: when given a PR link, review via `gh pr view`/`gh pr diff` and do **not** change branches.\n- PR review calls: prefer a single `gh pr view --json ...` to batch metadata/comments; run `gh pr diff` only when needed.\n- Before starting a review when a GH Issue/PR is pasted: run `git pull`; if there are local changes or unpushed commits, stop and alert the user before reviewing.\n- Goal: merge PRs. Prefer **rebase** when commits are clean; **squash** when history is messy.\n- PR merge flow: create a temp branch from `main`, merge the PR branch into it (prefer squash unless commit history is important; use rebase/merge when it is). Always try to merge the PR unless it’s truly difficult, then use another approach. If we squash, add the PR author as a co-contributor. Apply fixes, add changelog entry (include PR # + thanks), run full gate before the final commit, commit, merge back to `main`, delete the temp branch, and end on `main`.\n- If you review a PR and later do work on it, land via merge/squash (no direct-main commits) and always add the PR author as a co-contributor.\n- When working on a PR: add a changelog entry with the PR number and thank the contributor.\n- When working on an issue: reference the issue in the changelog entry.\n- When merging a PR: leave a PR comment that explains exactly what we did and include the SHA hashes.\n- When merging a PR from a new contributor: add their avatar to the README “Thanks to all clawtributors” thumbnail list.\n- After merging a PR: run `bun scripts/update-clawtributors.ts` if the contributor is missing, then commit the regenerated README.\n\n## Shorthand Commands\n\n- `sync`: if working tree is dirty, commit all changes (pick a sensible Conventional Commit message), then `git pull --rebase`; if rebase conflicts and cannot resolve, stop; otherwise `git push`.\n\n### PR Workflow (Review vs Land)\n\n- **Review mode (PR link only):** read `gh pr view/diff`; **do not** switch branches; **do not** change code.\n- **Landing mode:** create an integration branch from `main`, bring in PR commits (**prefer rebase** for linear history; **merge allowed** when complexity/conflicts make it safer), apply fixes, add changelog (+ thanks + PR #), run full gate **locally before committing** (`pnpm build && pnpm check && pnpm test`), commit, merge back to `main`, then `git switch main` (never stay on a topic branch after landing). Important: contributor needs to be in git graph after this!\n\n## Security & Configuration Tips\n\n- Web provider stores creds at `~/.openclaw/credentials/`; rerun `openclaw login` if logged out.\n- Pi sessions live under `~/.openclaw/sessions/` by default; the base directory is not configurable.\n- Environment variables: see `~/.profile`.\n- Never commit or publish real phone numbers, videos, or live configuration values. Use obviously fake placeholders in docs, tests, and examples.\n- Release flow: always read `docs/reference/RELEASING.md` and `docs/platforms/mac/release.md` before any release work; do not ask routine questions once those docs answer them.\n\n## Troubleshooting\n\n- Rebrand/migration issues or legacy config/service warnings: run `openclaw doctor` (see `docs/gateway/doctor.md`).\n\n## Agent-Specific Notes\n\n- Vocabulary: \"makeup\" = \"mac app\".\n- Never edit `node_modules` (global/Homebrew/npm/git installs too). Updates overwrite. Skill notes go in `tools.md` or `AGENTS.md`.\n- Signal: \"update fly\" => `fly ssh console -a flawd-bot -C \"bash -lc 'cd /data/clawd/openclaw && git pull --rebase origin main'\"` then `fly machines restart e825232f34d058 -a flawd-bot`.\n- When working on a GitHub Issue or PR, print the full URL at the end of the task.\n- When answering questions, respond with high-confidence answers only: verify in code; do not guess.\n- Never update the Carbon dependency.\n- Any dependency with `pnpm.patchedDependencies` must use an exact version (no `^`/`~`).\n- Patching dependencies (pnpm patches, overrides, or vendored changes) requires explicit approval; do not do this by default.\n- CLI progress: use `src/cli/progress.ts` (`osc-progress` + `@clack/prompts` spinner); don’t hand-roll spinners/bars.\n- Status output: keep tables + ANSI-safe wrapping (`src/terminal/table.ts`); `status --all` = read-only/pasteable, `status --deep` = probes.\n- Gateway currently runs only as the menubar app; there is no separate LaunchAgent/helper label installed. Restart via the OpenClaw Mac app or `scripts/restart-mac.sh`; to verify/kill use `launchctl print gui/$UID | grep openclaw` rather than assuming a fixed label. **When debugging on macOS, start/stop the gateway via the app, not ad-hoc tmux sessions; kill any temporary tunnels before handoff.**\n- macOS logs: use `./scripts/clawlog.sh` to query unified logs for the OpenClaw subsystem; it supports follow/tail/category filters and expects passwordless sudo for `/usr/bin/log`.\n- If shared guardrails are available locally, review them; otherwise follow this repo's guidance.\n- SwiftUI state management (iOS/macOS): prefer the `Observation` framework (`@Observable`, `@Bindable`) over `ObservableObject`/`@StateObject`; don’t introduce new `ObservableObject` unless required for compatibility, and migrate existing usages when touching related code.\n- Connection providers: when adding a new connection, update every UI surface and docs (macOS app, web UI, mobile if applicable, onboarding/overview docs) and add matching status + configuration forms so provider lists and settings stay in sync.\n- Version locations: `package.json` (CLI), `apps/android/app/build.gradle.kts` (versionName/versionCode), `apps/ios/Sources/Info.plist` + `apps/ios/Tests/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `apps/macos/Sources/OpenClaw/Resources/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `docs/install/updating.md` (pinned npm version), `docs/platforms/mac/release.md` (APP_VERSION/APP_BUILD examples), Peekaboo Xcode projects/Info.plists (MARKETING_VERSION/CURRENT_PROJECT_VERSION).\n- **Restart apps:** “restart iOS/Android apps” means rebuild (recompile/install) and relaunch, not just kill/launch.\n- **Device checks:** before testing, verify connected real devices (iOS/Android) before reaching for simulators/emulators.\n- iOS Team ID lookup: `security find-identity -p codesigning -v` → use Apple Development (…) TEAMID. Fallback: `defaults read com.apple.dt.Xcode IDEProvisioningTeamIdentifiers`.\n- A2UI bundle hash: `src/canvas-host/a2ui/.bundle.hash` is auto-generated; ignore unexpected changes, and only regenerate via `pnpm canvas:a2ui:bundle` (or `scripts/bundle-a2ui.sh`) when needed. Commit the hash as a separate commit.\n- Release signing/notary keys are managed outside the repo; follow internal release docs.\n- Notary auth env vars (`APP_STORE_CONNECT_ISSUER_ID`, `APP_STORE_CONNECT_KEY_ID`, `APP_STORE_CONNECT_API_KEY_P8`) are expected in your environment (per internal release docs).\n- **Multi-agent safety:** do **not** create/apply/drop `git stash` entries unless explicitly requested (this includes `git pull --rebase --autostash`). Assume other agents may be working; keep unrelated WIP untouched and avoid cross-cutting state changes.\n- **Multi-agent safety:** when the user says \"push\", you may `git pull --rebase` to integrate latest changes (never discard other agents' work). When the user says \"commit\", scope to your changes only. When the user says \"commit all\", commit everything in grouped chunks.\n- **Multi-agent safety:** do **not** create/remove/modify `git worktree` checkouts (or edit `.worktrees/*`) unless explicitly requested.\n- **Multi-agent safety:** do **not** switch branches / check out a different branch unless explicitly requested.\n- **Multi-agent safety:** running multiple agents is OK as long as each agent has its own session.\n- **Multi-agent safety:** when you see unrecognized files, keep going; focus on your changes and commit only those.\n- Lint/format churn:\n  - If staged+unstaged diffs are formatting-only, auto-resolve without asking.\n  - If commit/push already requested, auto-stage and include formatting-only follow-ups in the same commit (or a tiny follow-up commit if needed), no extra confirmation.\n  - Only ask when changes are semantic (logic/data/behavior).\n- Lobster seam: use the shared CLI palette in `src/terminal/palette.ts` (no hardcoded colors); apply palette to onboarding/config prompts and other TTY UI output as needed.\n- **Multi-agent safety:** focus reports on your edits; avoid guard-rail disclaimers unless truly blocked; when multiple agents touch the same file, continue if safe; end with a brief “other files present” note only if relevant.\n- Bug investigations: read source code of relevant npm dependencies and all related local code before concluding; aim for high-confidence root cause.\n- Code style: add brief comments for tricky logic; keep files under ~500 LOC when feasible (split/refactor as needed).\n- Tool schema guardrails (google-antigravity): avoid `Type.Union` in tool input schemas; no `anyOf`/`oneOf`/`allOf`. Use `stringEnum`/`optionalStringEnum` (Type.Unsafe enum) for string lists, and `Type.Optional(...)` instead of `... | null`. Keep top-level tool schema as `type: \"object\"` with `properties`.\n- Tool schema guardrails: avoid raw `format` property names in tool schemas; some validators treat `format` as a reserved keyword and reject the schema.\n- When asked to open a “session” file, open the Pi session logs under `~/.openclaw/agents/<agentId>/sessions/*.jsonl` (use the `agent=<id>` value in the Runtime line of the system prompt; newest unless a specific ID is given), not the default `sessions.json`. If logs are needed from another machine, SSH via Tailscale and read the same path there.\n- Do not rebuild the macOS app over SSH; rebuilds must be run directly on the Mac.\n- Never send streaming/partial replies to external messaging surfaces (WhatsApp, Telegram); only final replies should be delivered there. Streaming/tool events may still go to internal UIs/control channel.\n- Voice wake forwarding tips:\n  - Command template should stay `openclaw-mac agent --message \"${text}\" --thinking low`; `VoiceWakeForwarder` already shell-escapes `${text}`. Don’t add extra quotes.\n  - launchd PATH is minimal; ensure the app’s launch agent PATH includes standard system paths plus your pnpm bin (typically `$HOME/Library/pnpm`) so `pnpm`/`openclaw` binaries resolve when invoked via `openclaw-mac`.\n- For manual `openclaw message send` messages that include `!`, use the heredoc pattern noted below to avoid the Bash tool’s escaping.\n- Release guardrails: do not change version numbers without operator’s explicit consent; always ask permission before running any npm publish/release step.\n\n## NPM + 1Password (publish/verify)\n\n- Use the 1password skill; all `op` commands must run inside a fresh tmux session.\n- Sign in: `eval \"$(op signin --account my.1password.com)\"` (app unlocked + integration on).\n- OTP: `op read 'op://Private/Npmjs/one-time password?attribute=otp'`.\n- Publish: `npm publish --access public --otp=\"<otp>\"` (run from the package dir).\n- Verify without local npmrc side effects: `npm view <pkg> version --userconfig \"$(mktemp)\"`.\n- Kill the tmux session after publish.\n\n\n## Skills\nA skill is a set of local instructions to follow that is stored in a `SKILL.md` file. Below is the list of skills that can be used. Each entry includes a name, description, and file path so you can open the source for full instructions when using a specific skill.\n### Available skills\n- merge-pr: Merge a GitHub PR via squash after /preparepr. Use when asked to merge a ready PR. Do not push to main or modify code. Ensure the PR ends in MERGED state and clean up worktrees after success. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/merge-pr/SKILL.md)\n- prepare-pr: Prepare a GitHub PR for merge by rebasing onto main, fixing review findings, running gates, committing fixes, and pushing to the PR head branch. Use after /reviewpr. Never merge or push to main. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/prepare-pr/SKILL.md)\n- review-pr: Review-only GitHub pull request analysis with the gh CLI. Use when asked to review a PR, provide structured feedback, or assess readiness to land. Do not merge, push, or make code changes you intend to keep. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/review-pr/SKILL.md)\n- figma: Use the Figma MCP server to fetch design context, screenshots, variables, and assets from Figma, and to translate Figma nodes into production code. Trigger when a task involves Figma URLs, node IDs, design-to-code implementation, or Figma MCP setup and troubleshooting. (file: /home/ldr-cavetroll/.codex/skills/figma/SKILL.md)\n- skill-creator: Guide for creating effective skills. This skill should be used when users want to create a new skill (or update an existing skill) that extends Codex's capabilities with specialized knowledge, workflows, or tool integrations. (file: /home/ldr-cavetroll/.codex/skills/.system/skill-creator/SKILL.md)\n- skill-installer: Install Codex skills into $CODEX_HOME/skills from a curated list or a GitHub repo path. Use when a user asks to list installable skills, install a curated skill, or install a skill from another repo (including private repos). (file: /home/ldr-cavetroll/.codex/skills/.system/skill-installer/SKILL.md)\n### How to use skills\n- Discovery: The list above is the skills available in this session (name + description + file path). Skill bodies live on disk at the listed paths.\n- Trigger rules: If the user names a skill (with `$SkillName` or plain text) OR the task clearly matches a skill's description shown above, you must use that skill for that turn. Multiple mentions mean use them all. Do not carry skills across turns unless re-mentioned.\n- Missing/blocked: If a named skill isn't in the list or the path can't be read, say so briefly and continue with the best fallback.\n- How to use a skill (progressive disclosure):\n  1) After deciding to use a skill, open its `SKILL.md`. Read only enough to follow the workflow.\n  2) When `SKILL.md` references relative paths (e.g., `scripts/foo.py`), resolve them relative to the skill directory listed above first, and only consider other paths if needed.\n  3) If `SKILL.md` points to extra folders such as `references/`, load only the specific files needed for the request; don't bulk-load everything.\n  4) If `scripts/` exist, prefer running or patching them instead of retyping large code blocks.\n  5) If `assets/` or templates exist, reuse them instead of recreating from scratch.\n- Coordination and sequencing:\n  - If multiple skills apply, choose the minimal set that covers the request and state the order you'll use them.\n  - Announce which skill(s) you're using and why (one short line). If you skip an obvious skill, say why.\n- Context hygiene:\n  - Keep context small: summarize long sections instead of pasting them; only load extra files when needed.\n  - Avoid deep reference-chasing: prefer opening only files directly linked from `SKILL.md` unless you're blocked.\n  - When variants exist (frameworks, providers, domains), pick only the relevant reference file(s) and note that choice.\n- Safety and fallback: If a skill can't be applied cleanly (missing files, unclear instructions), state the issue, pick the next-best approach, and continue.","truncation_policy":{"mode":"tokens","limit":10000}}}
{"timestamp":"2026-02-07T07:57:20.888Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":37837,"cached_input_tokens":9216,"output_tokens":62,"reasoning_output_tokens":0,"total_tokens":37899},"last_token_usage":{"input_tokens":18948,"cached_input_tokens":4608,"output_tokens":34,"reasoning_output_tokens":0,"total_tokens":18982},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":1.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":7.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T07:57:23.057Z","type":"event_msg","payload":{"type":"agent_reasoning","text":"**Preparing to read key files**"}}
{"timestamp":"2026-02-07T07:57:23.057Z","type":"response_item","payload":{"type":"reasoning","summary":[{"type":"summary_text","text":"**Preparing to read key files**"}],"content":null,"encrypted_content":"gAAAAABphvBjF3tHr3yVTsanVcn48DVVnH9doaauc-UnDiuh41sBCMkRJLpuoXuQvV_6Wj1bqueTw7W84noFdMhxDafOLPv8Jvd_l_B1SDiskbwBZ0tzdpfOmkSgb8f7xwzeavG4qFxPXwOcewxr1mfG5pQrcHq16e4rRCSHBdDkLeIs6CIhakVxabgZMyjQtMnoCnonDjTRP5U46fTffx-CHl77uLIUoWg6LsWsZ5lk3UbaRoV2cvrxuoijszzD1p8kD53t9JTiro--2ORp8X_RR5NrYf1msTAiCJAuPD4itAl-DdGCcoE07gZW26Q8HwbmriUUpm3WXhxjuE0d7tqdra9_PnPRU1na9JD4gZp9rECZqHYdSAikgbzFJd0W55VMALhgEhiHLHMFU61c8_CKTiI58HbKoIAkpC3zYTIxIAh9HEP1PWS6CcVPJPganmvvxJhB9cy7BNGSK8OO1sj4uKm-h10CVfOjRADtP1XdMg_rXJRxERGpLt6sEXgwqEF50z1jr4aKOE_R5Yf_8TqPsVajmQYA32H1sHIO-DE256uQjnnATDHZfZkc2mGprQss9_KjSWRGnXW-EZIzxGV9hvv1kHptBErDf4b3iVmuOMBQqMWW-cFVjDZCFeun4joix9sr6rGyEj8D99-D8E5XVcUgfWory5LrbnB1dSCg4SCjl-CAppmOGEvKuavML6Cv7l1U5-RitjchkfYnlf4piI_Ak5ZZKFAHOnrbCL41qFfps0PlqL6gJtJeujlC_3ZeoNSixfevSYqBDBbL_ycm-7PC9Zzds1RvP9cxIVyhT-ERHs6h31gFId3muBOEjXFQptpAxabb4WZh3M0p6wPz3Z2fzCYHBTEpvl9CnTOSEgNQe1CCLwyxxFEk-jisnw-LT8VS6lI8-L61Kdss1kTyFkbQKZjT6A=="}}
{"timestamp":"2026-02-07T07:57:23.377Z","type":"response_item","payload":{"type":"function_call","name":"exec_command","arguments":"{\"cmd\":\"rg -n \\\"acp\\\" -S src/acp src | head -n 50\"}","call_id":"call_k31ISbhREOR1nLHkFj7ydKKf"}}
{"timestamp":"2026-02-07T07:57:23.381Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":57050,"cached_input_tokens":28160,"output_tokens":121,"reasoning_output_tokens":0,"total_tokens":57171},"last_token_usage":{"input_tokens":19213,"cached_input_tokens":18944,"output_tokens":59,"reasoning_output_tokens":0,"total_tokens":19272},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":1.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":7.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T07:57:23.473Z","type":"response_item","payload":{"type":"function_call_output","call_id":"call_k31ISbhREOR1nLHkFj7ydKKf","output":"Chunk ID: 00cb3d\nWall time: 0.0515 seconds\nProcess exited with code 0\nOriginal token count: 942\nOutput:\nsrc/acp/types.ts:4:export type AcpSession = {\nsrc/acp/types.ts:13:export type AcpServerOptions = {\nsrc/acp/types.ts:25:export const ACP_AGENT_INFO = {\nsrc/acp/types.ts:26:  name: \"openclaw-acp\",\nsrc/acp/types.ts:27:  title: \"OpenClaw ACP Gateway\",\nsrc/acp/translator.ts:35:import { defaultAcpSessionStore, type AcpSessionStore } from \"./session.js\";\nsrc/acp/translator.ts:36:import { ACP_AGENT_INFO, type AcpServerOptions } from \"./types.js\";\nsrc/acp/translator.ts:49:type AcpGatewayAgentOptions = AcpServerOptions & {\nsrc/acp/translator.ts:50:  sessionStore?: AcpSessionStore;\nsrc/acp/translator.ts:53:export class AcpGatewayAgent implements Agent {\nsrc/acp/translator.ts:56:  private opts: AcpGatewayAgentOptions;\nsrc/acp/translator.ts:58:  private sessionStore: AcpSessionStore;\nsrc/acp/translator.ts:64:    opts: AcpGatewayAgentOptions = {},\nsrc/acp/translator.ts:69:    this.log = opts.verbose ? (msg: string) => process.stderr.write(`[acp] ${msg}\\n`) : () => {};\nsrc/acp/translator.ts:70:    this.sessionStore = opts.sessionStore ?? defaultAcpSessionStore;\nsrc/acp/translator.ts:118:      agentInfo: ACP_AGENT_INFO,\nsrc/acp/translator.ts:132:      fallbackKey: `acp:${sessionId}`,\nsrc/acp/session.ts:2:import type { AcpSession } from \"./types.js\";\nsrc/acp/session.ts:4:export type AcpSessionStore = {\nsrc/acp/session.ts:5:  createSession: (params: { sessionKey: string; cwd: string; sessionId?: string }) => AcpSession;\nsrc/acp/session.ts:6:  getSession: (sessionId: string) => AcpSession | undefined;\nsrc/acp/session.ts:7:  getSessionByRunId: (runId: string) => AcpSession | undefined;\nsrc/acp/session.ts:14:export function createInMemorySessionStore(): AcpSessionStore {\nsrc/acp/session.ts:15:  const sessions = new Map<string, AcpSession>();\nsrc/acp/session.ts:18:  const createSession: AcpSessionStore[\"createSession\"] = (params) => {\nsrc/acp/session.ts:20:    const session: AcpSession = {\nsrc/acp/session.ts:32:  const getSession: AcpSessionStore[\"getSession\"] = (sessionId) => sessions.get(sessionId);\nsrc/acp/session.ts:34:  const getSessionByRunId: AcpSessionStore[\"getSessionByRunId\"] = (runId) => {\nsrc/acp/session.ts:39:  const setActiveRun: AcpSessionStore[\"setActiveRun\"] = (sessionId, runId, abortController) => {\nsrc/acp/session.ts:49:  const clearActiveRun: AcpSessionStore[\"clearActiveRun\"] = (sessionId) => {\nsrc/acp/session.ts:61:  const cancelActiveRun: AcpSessionStore[\"cancelActiveRun\"] = (sessionId) => {\nsrc/acp/session.ts:75:  const clearAllSessionsForTest: AcpSessionStore[\"clearAllSessionsForTest\"] = () => {\nsrc/acp/session.ts:94:export const defaultAcpSessionStore = createInMemorySessionStore();\nsrc/acp/session.test.ts:4:describe(\"acp session manager\", () => {\nsrc/acp/session.test.ts:13:      sessionKey: \"acp:test\",\nsrc/acp/session-mapper.ts:2:import type { AcpServerOptions } from \"./types.js\";\nsrc/acp/session-mapper.ts:5:export type AcpSessionMeta = {\nsrc/acp/session-mapper.ts:13:export function parseSessionMeta(meta: unknown): AcpSessionMeta {\nsrc/acp/session-mapper.ts:28:  meta: AcpSessionMeta;\nsrc/acp/session-mapper.ts:31:  opts: AcpServerOptions;\nsrc/acp/session-mapper.ts:88:  meta: AcpSessionMeta;\nsrc/acp/session-mapper.ts:91:  opts: AcpServerOptions;\nsrc/acp/session-mapper.test.ts:25:describe(\"acp session mapper\", () => {\nsrc/acp/session-mapper.test.ts:32:      fallbackKey: \"acp:fallback\",\nsrc/acp/session-mapper.test.ts:48:      fallbackKey: \"acp:fallback\",\nsrc/acp/server.ts:5:import type { AcpServerOptions } from \"./types.js\";\nsrc/acp/server.ts:12:import { AcpGatewayAgent } from \"./translator.js\";\nsrc/acp/server.ts:14:export function serveAcpGateway(opts: AcpServerOptions = {}): void {\nsrc/acp/server.ts:36:  let agent: AcpGatewayAgent | null = null;\nsrc/acp/server.ts:42:    clientDisplayName: \"ACP\",\n"}}
{"timestamp":"2026-02-07T07:57:23.495Z","type":"turn_context","payload":{"cwd":"/home/ldr-cavetroll/tinker/openclaw","approval_policy":"on-request","sandbox_policy":{"type":"workspace-write","network_access":false,"exclude_tmpdir_env_var":false,"exclude_slash_tmp":false},"model":"gpt-5.2-codex","personality":"pragmatic","collaboration_mode":{"mode":"default","settings":{"model":"gpt-5.2-codex","reasoning_effort":null,"developer_instructions":"# Collaboration Mode: Default\n\nYou are now in Default mode. Any previous instructions for other modes (e.g. Plan mode) are no longer active.\n\nYour active mode changes only when new developer instructions with a different `<collaboration_mode>...</collaboration_mode>` change it; user requests or tool descriptions do not change mode by themselves. Known mode names are Default and Plan.\n\n## request_user_input availability\n\nThe `request_user_input` tool is unavailable in Default mode. If you call it while in Default mode, it will return an error.\n\nIf a decision is necessary and cannot be discovered from local context, ask the user directly. However, in Default mode you should strongly prefer executing the user's request rather than stopping to ask questions.\n"}},"summary":"auto","user_instructions":"# Repository Guidelines\n\n- Repo: https://github.com/openclaw/openclaw\n- GitHub issues/comments/PR comments: use literal multiline strings or `-F - <<'EOF'` (or $'...') for real newlines; never embed \"\\\\n\".\n\n## Project Structure & Module Organization\n\n- Source code: `src/` (CLI wiring in `src/cli`, commands in `src/commands`, web provider in `src/provider-web.ts`, infra in `src/infra`, media pipeline in `src/media`).\n- Tests: colocated `*.test.ts`.\n- Docs: `docs/` (images, queue, Pi config). Built output lives in `dist/`.\n- Plugins/extensions: live under `extensions/*` (workspace packages). Keep plugin-only deps in the extension `package.json`; do not add them to the root `package.json` unless core uses them.\n- Plugins: install runs `npm install --omit=dev` in plugin dir; runtime deps must live in `dependencies`. Avoid `workspace:*` in `dependencies` (npm install breaks); put `openclaw` in `devDependencies` or `peerDependencies` instead (runtime resolves `openclaw/plugin-sdk` via jiti alias).\n- Installers served from `https://openclaw.ai/*`: live in the sibling repo `../openclaw.ai` (`public/install.sh`, `public/install-cli.sh`, `public/install.ps1`).\n- Messaging channels: always consider **all** built-in + extension channels when refactoring shared logic (routing, allowlists, pairing, command gating, onboarding, docs).\n  - Core channel docs: `docs/channels/`\n  - Core channel code: `src/telegram`, `src/discord`, `src/slack`, `src/signal`, `src/imessage`, `src/web` (WhatsApp web), `src/channels`, `src/routing`\n  - Extensions (channel plugins): `extensions/*` (e.g. `extensions/msteams`, `extensions/matrix`, `extensions/zalo`, `extensions/zalouser`, `extensions/voice-call`)\n- When adding channels/extensions/apps/docs, review `.github/labeler.yml` for label coverage.\n\n## Docs Linking (Mintlify)\n\n- Docs are hosted on Mintlify (docs.openclaw.ai).\n- Internal doc links in `docs/**/*.md`: root-relative, no `.md`/`.mdx` (example: `[Config](/configuration)`).\n- Section cross-references: use anchors on root-relative paths (example: `[Hooks](/configuration#hooks)`).\n- Doc headings and anchors: avoid em dashes and apostrophes in headings because they break Mintlify anchor links.\n- When Peter asks for links, reply with full `https://docs.openclaw.ai/...` URLs (not root-relative).\n- When you touch docs, end the reply with the `https://docs.openclaw.ai/...` URLs you referenced.\n- README (GitHub): keep absolute docs URLs (`https://docs.openclaw.ai/...`) so links work on GitHub.\n- Docs content must be generic: no personal device names/hostnames/paths; use placeholders like `user@gateway-host` and “gateway host”.\n\n## Docs i18n (zh-CN)\n\n- `docs/zh-CN/**` is generated; do not edit unless the user explicitly asks.\n- Pipeline: update English docs → adjust glossary (`docs/.i18n/glossary.zh-CN.json`) → run `scripts/docs-i18n` → apply targeted fixes only if instructed.\n- Translation memory: `docs/.i18n/zh-CN.tm.jsonl` (generated).\n- See `docs/.i18n/README.md`.\n- The pipeline can be slow/inefficient; if it’s dragging, ping @jospalmbier on Discord instead of hacking around it.\n\n## exe.dev VM ops (general)\n\n- Access: stable path is `ssh exe.dev` then `ssh vm-name` (assume SSH key already set).\n- SSH flaky: use exe.dev web terminal or Shelley (web agent); keep a tmux session for long ops.\n- Update: `sudo npm i -g openclaw@latest` (global install needs root on `/usr/lib/node_modules`).\n- Config: use `openclaw config set ...`; ensure `gateway.mode=local` is set.\n- Discord: store raw token only (no `DISCORD_BOT_TOKEN=` prefix).\n- Restart: stop old gateway and run:\n  `pkill -9 -f openclaw-gateway || true; nohup openclaw gateway run --bind loopback --port 18789 --force > /tmp/openclaw-gateway.log 2>&1 &`\n- Verify: `openclaw channels status --probe`, `ss -ltnp | rg 18789`, `tail -n 120 /tmp/openclaw-gateway.log`.\n\n## Build, Test, and Development Commands\n\n- Runtime baseline: Node **22+** (keep Node + Bun paths working).\n- Install deps: `pnpm install`\n- Pre-commit hooks: `prek install` (runs same checks as CI)\n- Also supported: `bun install` (keep `pnpm-lock.yaml` + Bun patching in sync when touching deps/patches).\n- Prefer Bun for TypeScript execution (scripts, dev, tests): `bun <file.ts>` / `bunx <tool>`.\n- Run CLI in dev: `pnpm openclaw ...` (bun) or `pnpm dev`.\n- Node remains supported for running built output (`dist/*`) and production installs.\n- Mac packaging (dev): `scripts/package-mac-app.sh` defaults to current arch. Release checklist: `docs/platforms/mac/release.md`.\n- Type-check/build: `pnpm build`\n- TypeScript checks: `pnpm tsgo`\n- Lint/format: `pnpm check`\n- Tests: `pnpm test` (vitest); coverage: `pnpm test:coverage`\n\n## Coding Style & Naming Conventions\n\n- Language: TypeScript (ESM). Prefer strict typing; avoid `any`.\n- Formatting/linting via Oxlint and Oxfmt; run `pnpm check` before commits.\n- Add brief code comments for tricky or non-obvious logic.\n- Keep files concise; extract helpers instead of “V2” copies. Use existing patterns for CLI options and dependency injection via `createDefaultDeps`.\n- Aim to keep files under ~700 LOC; guideline only (not a hard guardrail). Split/refactor when it improves clarity or testability.\n- Naming: use **OpenClaw** for product/app/docs headings; use `openclaw` for CLI command, package/binary, paths, and config keys.\n\n## Release Channels (Naming)\n\n- stable: tagged releases only (e.g. `vYYYY.M.D`), npm dist-tag `latest`.\n- beta: prerelease tags `vYYYY.M.D-beta.N`, npm dist-tag `beta` (may ship without macOS app).\n- dev: moving head on `main` (no tag; git checkout main).\n\n## Testing Guidelines\n\n- Framework: Vitest with V8 coverage thresholds (70% lines/branches/functions/statements).\n- Naming: match source names with `*.test.ts`; e2e in `*.e2e.test.ts`.\n- Run `pnpm test` (or `pnpm test:coverage`) before pushing when you touch logic.\n- Do not set test workers above 16; tried already.\n- Live tests (real keys): `CLAWDBOT_LIVE_TEST=1 pnpm test:live` (OpenClaw-only) or `LIVE=1 pnpm test:live` (includes provider live tests). Docker: `pnpm test:docker:live-models`, `pnpm test:docker:live-gateway`. Onboarding Docker E2E: `pnpm test:docker:onboard`.\n- Full kit + what’s covered: `docs/testing.md`.\n- Pure test additions/fixes generally do **not** need a changelog entry unless they alter user-facing behavior or the user asks for one.\n- Mobile: before using a simulator, check for connected real devices (iOS + Android) and prefer them when available.\n\n## Commit & Pull Request Guidelines\n\n- Create commits with `scripts/committer \"<msg>\" <file...>`; avoid manual `git add`/`git commit` so staging stays scoped.\n- Follow concise, action-oriented commit messages (e.g., `CLI: add verbose flag to send`).\n- Group related changes; avoid bundling unrelated refactors.\n- Changelog workflow: keep latest released version at top (no `Unreleased`); after publishing, bump version and start a new top section.\n- PRs should summarize scope, note testing performed, and mention any user-facing changes or new flags.\n- Read this when submitting a PR: `docs/help/submitting-a-pr.md` ([Submitting a PR](https://docs.openclaw.ai/help/submitting-a-pr))\n- Read this when submitting an issue: `docs/help/submitting-an-issue.md` ([Submitting an Issue](https://docs.openclaw.ai/help/submitting-an-issue))\n- PR review flow: when given a PR link, review via `gh pr view`/`gh pr diff` and do **not** change branches.\n- PR review calls: prefer a single `gh pr view --json ...` to batch metadata/comments; run `gh pr diff` only when needed.\n- Before starting a review when a GH Issue/PR is pasted: run `git pull`; if there are local changes or unpushed commits, stop and alert the user before reviewing.\n- Goal: merge PRs. Prefer **rebase** when commits are clean; **squash** when history is messy.\n- PR merge flow: create a temp branch from `main`, merge the PR branch into it (prefer squash unless commit history is important; use rebase/merge when it is). Always try to merge the PR unless it’s truly difficult, then use another approach. If we squash, add the PR author as a co-contributor. Apply fixes, add changelog entry (include PR # + thanks), run full gate before the final commit, commit, merge back to `main`, delete the temp branch, and end on `main`.\n- If you review a PR and later do work on it, land via merge/squash (no direct-main commits) and always add the PR author as a co-contributor.\n- When working on a PR: add a changelog entry with the PR number and thank the contributor.\n- When working on an issue: reference the issue in the changelog entry.\n- When merging a PR: leave a PR comment that explains exactly what we did and include the SHA hashes.\n- When merging a PR from a new contributor: add their avatar to the README “Thanks to all clawtributors” thumbnail list.\n- After merging a PR: run `bun scripts/update-clawtributors.ts` if the contributor is missing, then commit the regenerated README.\n\n## Shorthand Commands\n\n- `sync`: if working tree is dirty, commit all changes (pick a sensible Conventional Commit message), then `git pull --rebase`; if rebase conflicts and cannot resolve, stop; otherwise `git push`.\n\n### PR Workflow (Review vs Land)\n\n- **Review mode (PR link only):** read `gh pr view/diff`; **do not** switch branches; **do not** change code.\n- **Landing mode:** create an integration branch from `main`, bring in PR commits (**prefer rebase** for linear history; **merge allowed** when complexity/conflicts make it safer), apply fixes, add changelog (+ thanks + PR #), run full gate **locally before committing** (`pnpm build && pnpm check && pnpm test`), commit, merge back to `main`, then `git switch main` (never stay on a topic branch after landing). Important: contributor needs to be in git graph after this!\n\n## Security & Configuration Tips\n\n- Web provider stores creds at `~/.openclaw/credentials/`; rerun `openclaw login` if logged out.\n- Pi sessions live under `~/.openclaw/sessions/` by default; the base directory is not configurable.\n- Environment variables: see `~/.profile`.\n- Never commit or publish real phone numbers, videos, or live configuration values. Use obviously fake placeholders in docs, tests, and examples.\n- Release flow: always read `docs/reference/RELEASING.md` and `docs/platforms/mac/release.md` before any release work; do not ask routine questions once those docs answer them.\n\n## Troubleshooting\n\n- Rebrand/migration issues or legacy config/service warnings: run `openclaw doctor` (see `docs/gateway/doctor.md`).\n\n## Agent-Specific Notes\n\n- Vocabulary: \"makeup\" = \"mac app\".\n- Never edit `node_modules` (global/Homebrew/npm/git installs too). Updates overwrite. Skill notes go in `tools.md` or `AGENTS.md`.\n- Signal: \"update fly\" => `fly ssh console -a flawd-bot -C \"bash -lc 'cd /data/clawd/openclaw && git pull --rebase origin main'\"` then `fly machines restart e825232f34d058 -a flawd-bot`.\n- When working on a GitHub Issue or PR, print the full URL at the end of the task.\n- When answering questions, respond with high-confidence answers only: verify in code; do not guess.\n- Never update the Carbon dependency.\n- Any dependency with `pnpm.patchedDependencies` must use an exact version (no `^`/`~`).\n- Patching dependencies (pnpm patches, overrides, or vendored changes) requires explicit approval; do not do this by default.\n- CLI progress: use `src/cli/progress.ts` (`osc-progress` + `@clack/prompts` spinner); don’t hand-roll spinners/bars.\n- Status output: keep tables + ANSI-safe wrapping (`src/terminal/table.ts`); `status --all` = read-only/pasteable, `status --deep` = probes.\n- Gateway currently runs only as the menubar app; there is no separate LaunchAgent/helper label installed. Restart via the OpenClaw Mac app or `scripts/restart-mac.sh`; to verify/kill use `launchctl print gui/$UID | grep openclaw` rather than assuming a fixed label. **When debugging on macOS, start/stop the gateway via the app, not ad-hoc tmux sessions; kill any temporary tunnels before handoff.**\n- macOS logs: use `./scripts/clawlog.sh` to query unified logs for the OpenClaw subsystem; it supports follow/tail/category filters and expects passwordless sudo for `/usr/bin/log`.\n- If shared guardrails are available locally, review them; otherwise follow this repo's guidance.\n- SwiftUI state management (iOS/macOS): prefer the `Observation` framework (`@Observable`, `@Bindable`) over `ObservableObject`/`@StateObject`; don’t introduce new `ObservableObject` unless required for compatibility, and migrate existing usages when touching related code.\n- Connection providers: when adding a new connection, update every UI surface and docs (macOS app, web UI, mobile if applicable, onboarding/overview docs) and add matching status + configuration forms so provider lists and settings stay in sync.\n- Version locations: `package.json` (CLI), `apps/android/app/build.gradle.kts` (versionName/versionCode), `apps/ios/Sources/Info.plist` + `apps/ios/Tests/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `apps/macos/Sources/OpenClaw/Resources/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `docs/install/updating.md` (pinned npm version), `docs/platforms/mac/release.md` (APP_VERSION/APP_BUILD examples), Peekaboo Xcode projects/Info.plists (MARKETING_VERSION/CURRENT_PROJECT_VERSION).\n- **Restart apps:** “restart iOS/Android apps” means rebuild (recompile/install) and relaunch, not just kill/launch.\n- **Device checks:** before testing, verify connected real devices (iOS/Android) before reaching for simulators/emulators.\n- iOS Team ID lookup: `security find-identity -p codesigning -v` → use Apple Development (…) TEAMID. Fallback: `defaults read com.apple.dt.Xcode IDEProvisioningTeamIdentifiers`.\n- A2UI bundle hash: `src/canvas-host/a2ui/.bundle.hash` is auto-generated; ignore unexpected changes, and only regenerate via `pnpm canvas:a2ui:bundle` (or `scripts/bundle-a2ui.sh`) when needed. Commit the hash as a separate commit.\n- Release signing/notary keys are managed outside the repo; follow internal release docs.\n- Notary auth env vars (`APP_STORE_CONNECT_ISSUER_ID`, `APP_STORE_CONNECT_KEY_ID`, `APP_STORE_CONNECT_API_KEY_P8`) are expected in your environment (per internal release docs).\n- **Multi-agent safety:** do **not** create/apply/drop `git stash` entries unless explicitly requested (this includes `git pull --rebase --autostash`). Assume other agents may be working; keep unrelated WIP untouched and avoid cross-cutting state changes.\n- **Multi-agent safety:** when the user says \"push\", you may `git pull --rebase` to integrate latest changes (never discard other agents' work). When the user says \"commit\", scope to your changes only. When the user says \"commit all\", commit everything in grouped chunks.\n- **Multi-agent safety:** do **not** create/remove/modify `git worktree` checkouts (or edit `.worktrees/*`) unless explicitly requested.\n- **Multi-agent safety:** do **not** switch branches / check out a different branch unless explicitly requested.\n- **Multi-agent safety:** running multiple agents is OK as long as each agent has its own session.\n- **Multi-agent safety:** when you see unrecognized files, keep going; focus on your changes and commit only those.\n- Lint/format churn:\n  - If staged+unstaged diffs are formatting-only, auto-resolve without asking.\n  - If commit/push already requested, auto-stage and include formatting-only follow-ups in the same commit (or a tiny follow-up commit if needed), no extra confirmation.\n  - Only ask when changes are semantic (logic/data/behavior).\n- Lobster seam: use the shared CLI palette in `src/terminal/palette.ts` (no hardcoded colors); apply palette to onboarding/config prompts and other TTY UI output as needed.\n- **Multi-agent safety:** focus reports on your edits; avoid guard-rail disclaimers unless truly blocked; when multiple agents touch the same file, continue if safe; end with a brief “other files present” note only if relevant.\n- Bug investigations: read source code of relevant npm dependencies and all related local code before concluding; aim for high-confidence root cause.\n- Code style: add brief comments for tricky logic; keep files under ~500 LOC when feasible (split/refactor as needed).\n- Tool schema guardrails (google-antigravity): avoid `Type.Union` in tool input schemas; no `anyOf`/`oneOf`/`allOf`. Use `stringEnum`/`optionalStringEnum` (Type.Unsafe enum) for string lists, and `Type.Optional(...)` instead of `... | null`. Keep top-level tool schema as `type: \"object\"` with `properties`.\n- Tool schema guardrails: avoid raw `format` property names in tool schemas; some validators treat `format` as a reserved keyword and reject the schema.\n- When asked to open a “session” file, open the Pi session logs under `~/.openclaw/agents/<agentId>/sessions/*.jsonl` (use the `agent=<id>` value in the Runtime line of the system prompt; newest unless a specific ID is given), not the default `sessions.json`. If logs are needed from another machine, SSH via Tailscale and read the same path there.\n- Do not rebuild the macOS app over SSH; rebuilds must be run directly on the Mac.\n- Never send streaming/partial replies to external messaging surfaces (WhatsApp, Telegram); only final replies should be delivered there. Streaming/tool events may still go to internal UIs/control channel.\n- Voice wake forwarding tips:\n  - Command template should stay `openclaw-mac agent --message \"${text}\" --thinking low`; `VoiceWakeForwarder` already shell-escapes `${text}`. Don’t add extra quotes.\n  - launchd PATH is minimal; ensure the app’s launch agent PATH includes standard system paths plus your pnpm bin (typically `$HOME/Library/pnpm`) so `pnpm`/`openclaw` binaries resolve when invoked via `openclaw-mac`.\n- For manual `openclaw message send` messages that include `!`, use the heredoc pattern noted below to avoid the Bash tool’s escaping.\n- Release guardrails: do not change version numbers without operator’s explicit consent; always ask permission before running any npm publish/release step.\n\n## NPM + 1Password (publish/verify)\n\n- Use the 1password skill; all `op` commands must run inside a fresh tmux session.\n- Sign in: `eval \"$(op signin --account my.1password.com)\"` (app unlocked + integration on).\n- OTP: `op read 'op://Private/Npmjs/one-time password?attribute=otp'`.\n- Publish: `npm publish --access public --otp=\"<otp>\"` (run from the package dir).\n- Verify without local npmrc side effects: `npm view <pkg> version --userconfig \"$(mktemp)\"`.\n- Kill the tmux session after publish.\n\n\n## Skills\nA skill is a set of local instructions to follow that is stored in a `SKILL.md` file. Below is the list of skills that can be used. Each entry includes a name, description, and file path so you can open the source for full instructions when using a specific skill.\n### Available skills\n- merge-pr: Merge a GitHub PR via squash after /preparepr. Use when asked to merge a ready PR. Do not push to main or modify code. Ensure the PR ends in MERGED state and clean up worktrees after success. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/merge-pr/SKILL.md)\n- prepare-pr: Prepare a GitHub PR for merge by rebasing onto main, fixing review findings, running gates, committing fixes, and pushing to the PR head branch. Use after /reviewpr. Never merge or push to main. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/prepare-pr/SKILL.md)\n- review-pr: Review-only GitHub pull request analysis with the gh CLI. Use when asked to review a PR, provide structured feedback, or assess readiness to land. Do not merge, push, or make code changes you intend to keep. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/review-pr/SKILL.md)\n- figma: Use the Figma MCP server to fetch design context, screenshots, variables, and assets from Figma, and to translate Figma nodes into production code. Trigger when a task involves Figma URLs, node IDs, design-to-code implementation, or Figma MCP setup and troubleshooting. (file: /home/ldr-cavetroll/.codex/skills/figma/SKILL.md)\n- skill-creator: Guide for creating effective skills. This skill should be used when users want to create a new skill (or update an existing skill) that extends Codex's capabilities with specialized knowledge, workflows, or tool integrations. (file: /home/ldr-cavetroll/.codex/skills/.system/skill-creator/SKILL.md)\n- skill-installer: Install Codex skills into $CODEX_HOME/skills from a curated list or a GitHub repo path. Use when a user asks to list installable skills, install a curated skill, or install a skill from another repo (including private repos). (file: /home/ldr-cavetroll/.codex/skills/.system/skill-installer/SKILL.md)\n### How to use skills\n- Discovery: The list above is the skills available in this session (name + description + file path). Skill bodies live on disk at the listed paths.\n- Trigger rules: If the user names a skill (with `$SkillName` or plain text) OR the task clearly matches a skill's description shown above, you must use that skill for that turn. Multiple mentions mean use them all. Do not carry skills across turns unless re-mentioned.\n- Missing/blocked: If a named skill isn't in the list or the path can't be read, say so briefly and continue with the best fallback.\n- How to use a skill (progressive disclosure):\n  1) After deciding to use a skill, open its `SKILL.md`. Read only enough to follow the workflow.\n  2) When `SKILL.md` references relative paths (e.g., `scripts/foo.py`), resolve them relative to the skill directory listed above first, and only consider other paths if needed.\n  3) If `SKILL.md` points to extra folders such as `references/`, load only the specific files needed for the request; don't bulk-load everything.\n  4) If `scripts/` exist, prefer running or patching them instead of retyping large code blocks.\n  5) If `assets/` or templates exist, reuse them instead of recreating from scratch.\n- Coordination and sequencing:\n  - If multiple skills apply, choose the minimal set that covers the request and state the order you'll use them.\n  - Announce which skill(s) you're using and why (one short line). If you skip an obvious skill, say why.\n- Context hygiene:\n  - Keep context small: summarize long sections instead of pasting them; only load extra files when needed.\n  - Avoid deep reference-chasing: prefer opening only files directly linked from `SKILL.md` unless you're blocked.\n  - When variants exist (frameworks, providers, domains), pick only the relevant reference file(s) and note that choice.\n- Safety and fallback: If a skill can't be applied cleanly (missing files, unclear instructions), state the issue, pick the next-best approach, and continue.","truncation_policy":{"mode":"tokens","limit":10000}}}
{"timestamp":"2026-02-07T07:57:23.766Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":57050,"cached_input_tokens":28160,"output_tokens":121,"reasoning_output_tokens":0,"total_tokens":57171},"last_token_usage":{"input_tokens":19213,"cached_input_tokens":18944,"output_tokens":59,"reasoning_output_tokens":0,"total_tokens":19272},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":1.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":7.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T07:57:24.860Z","type":"event_msg","payload":{"type":"agent_reasoning","text":"**Checking for existing index file**"}}
{"timestamp":"2026-02-07T07:57:24.860Z","type":"response_item","payload":{"type":"reasoning","summary":[{"type":"summary_text","text":"**Checking for existing index file**"}],"content":null,"encrypted_content":"gAAAAABphvBkHZbaED4m-4nFLTb31NHwy4uPkU5iq9jJQL6oVcpMG0E5N5GSOkRDCC07JuHgL_MAGxby7Cc-hgonvp0cDQfA8EVVXmy3hQLIRWeonv7rrMoqzU7irM4-vRN-ZHWIOPHnSkalEXnpDAKrqX6UfIT2iWJKDFuIDeqKP710Hwgi1uvK3luz3oxbiW7Uy0Y0uCy7qtsMsgXhrL0JbdYLMvlSzVxJmOSBlXhEoON0Qt1TYfB--NUN6V3phd2ij_BMD4YCsqOM612jpv2reSMjQQG_T2HP5J-6dPwLa_TkBNKJR0Ghqn0DzQ64QBF4OJD-DNaKcCkFJF23CYGwiqVQ-3u_Dhjc4uFL29VPhM69api7jkQhWBNXlxxSzT7Tq_aydExcC0leUTge4xDWWU7e2mKybiNgjT-0MVK3y3o-ngWPWotMRAxR8PIl2KhqqKTOYPniVjPeMyqWnNuSvSkfm58X30nzpmsYYF2cOi1pCHc0J8HyHdiPPNJZApT_gFO5hLLiMMRTf_yvogVpYU0Yx1y37yk6jJgIAM-nDGuI0lLqc3_Bg6MvAYcixoLnLFcSk2bFSDP5iurQcVoSTOi6nxYkXUUgbBRzUPxezjmPivzbEAmx-Q329hSPo0wcEG1ch_MHTK_KHmCYQbsFzKz84D-97aQH6fPAhZ2iCOl1B0kFQkWn-lv8GtBYq-uDVA4EiYGf0IonclvufsGsIx4ne7xSXqrK00rstA_1srgRPKUzzJSUCyWsaucb0xJ2Pplz0too7qIUbKEuZxluJ-EsxCIRosmLyxRcOXBinVpanYTdFoqqlTwKn5c8U01U9F_42UieIUGr2mAGcQPvzWjQ1bvLuZz-rFXOvEn439a-da-svOSuoDnUFeD8FVeoWbQzEFIp"}}
{"timestamp":"2026-02-07T07:57:25.137Z","type":"response_item","payload":{"type":"function_call","name":"exec_command","arguments":"{\"cmd\":\"sed -n '1,220p' src/acp/index.ts\"}","call_id":"call_tOZ5W2ewsmoNLVhHtQL1HubB"}}
{"timestamp":"2026-02-07T07:57:25.142Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":77478,"cached_input_tokens":47360,"output_tokens":170,"reasoning_output_tokens":0,"total_tokens":77648},"last_token_usage":{"input_tokens":20428,"cached_input_tokens":19200,"output_tokens":49,"reasoning_output_tokens":0,"total_tokens":20477},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":1.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":7.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T07:57:25.222Z","type":"response_item","payload":{"type":"function_call_output","call_id":"call_tOZ5W2ewsmoNLVhHtQL1HubB","output":"Chunk ID: 04043a\nWall time: 0.0504 seconds\nProcess exited with code 0\nOriginal token count: 53\nOutput:\nexport { serveAcpGateway } from \"./server.js\";\nexport { createInMemorySessionStore } from \"./session.js\";\nexport type { AcpSessionStore } from \"./session.js\";\nexport type { AcpServerOptions } from \"./types.js\";\n"}}
{"timestamp":"2026-02-07T07:57:25.244Z","type":"turn_context","payload":{"cwd":"/home/ldr-cavetroll/tinker/openclaw","approval_policy":"on-request","sandbox_policy":{"type":"workspace-write","network_access":false,"exclude_tmpdir_env_var":false,"exclude_slash_tmp":false},"model":"gpt-5.2-codex","personality":"pragmatic","collaboration_mode":{"mode":"default","settings":{"model":"gpt-5.2-codex","reasoning_effort":null,"developer_instructions":"# Collaboration Mode: Default\n\nYou are now in Default mode. Any previous instructions for other modes (e.g. Plan mode) are no longer active.\n\nYour active mode changes only when new developer instructions with a different `<collaboration_mode>...</collaboration_mode>` change it; user requests or tool descriptions do not change mode by themselves. Known mode names are Default and Plan.\n\n## request_user_input availability\n\nThe `request_user_input` tool is unavailable in Default mode. If you call it while in Default mode, it will return an error.\n\nIf a decision is necessary and cannot be discovered from local context, ask the user directly. However, in Default mode you should strongly prefer executing the user's request rather than stopping to ask questions.\n"}},"summary":"auto","user_instructions":"# Repository Guidelines\n\n- Repo: https://github.com/openclaw/openclaw\n- GitHub issues/comments/PR comments: use literal multiline strings or `-F - <<'EOF'` (or $'...') for real newlines; never embed \"\\\\n\".\n\n## Project Structure & Module Organization\n\n- Source code: `src/` (CLI wiring in `src/cli`, commands in `src/commands`, web provider in `src/provider-web.ts`, infra in `src/infra`, media pipeline in `src/media`).\n- Tests: colocated `*.test.ts`.\n- Docs: `docs/` (images, queue, Pi config). Built output lives in `dist/`.\n- Plugins/extensions: live under `extensions/*` (workspace packages). Keep plugin-only deps in the extension `package.json`; do not add them to the root `package.json` unless core uses them.\n- Plugins: install runs `npm install --omit=dev` in plugin dir; runtime deps must live in `dependencies`. Avoid `workspace:*` in `dependencies` (npm install breaks); put `openclaw` in `devDependencies` or `peerDependencies` instead (runtime resolves `openclaw/plugin-sdk` via jiti alias).\n- Installers served from `https://openclaw.ai/*`: live in the sibling repo `../openclaw.ai` (`public/install.sh`, `public/install-cli.sh`, `public/install.ps1`).\n- Messaging channels: always consider **all** built-in + extension channels when refactoring shared logic (routing, allowlists, pairing, command gating, onboarding, docs).\n  - Core channel docs: `docs/channels/`\n  - Core channel code: `src/telegram`, `src/discord`, `src/slack`, `src/signal`, `src/imessage`, `src/web` (WhatsApp web), `src/channels`, `src/routing`\n  - Extensions (channel plugins): `extensions/*` (e.g. `extensions/msteams`, `extensions/matrix`, `extensions/zalo`, `extensions/zalouser`, `extensions/voice-call`)\n- When adding channels/extensions/apps/docs, review `.github/labeler.yml` for label coverage.\n\n## Docs Linking (Mintlify)\n\n- Docs are hosted on Mintlify (docs.openclaw.ai).\n- Internal doc links in `docs/**/*.md`: root-relative, no `.md`/`.mdx` (example: `[Config](/configuration)`).\n- Section cross-references: use anchors on root-relative paths (example: `[Hooks](/configuration#hooks)`).\n- Doc headings and anchors: avoid em dashes and apostrophes in headings because they break Mintlify anchor links.\n- When Peter asks for links, reply with full `https://docs.openclaw.ai/...` URLs (not root-relative).\n- When you touch docs, end the reply with the `https://docs.openclaw.ai/...` URLs you referenced.\n- README (GitHub): keep absolute docs URLs (`https://docs.openclaw.ai/...`) so links work on GitHub.\n- Docs content must be generic: no personal device names/hostnames/paths; use placeholders like `user@gateway-host` and “gateway host”.\n\n## Docs i18n (zh-CN)\n\n- `docs/zh-CN/**` is generated; do not edit unless the user explicitly asks.\n- Pipeline: update English docs → adjust glossary (`docs/.i18n/glossary.zh-CN.json`) → run `scripts/docs-i18n` → apply targeted fixes only if instructed.\n- Translation memory: `docs/.i18n/zh-CN.tm.jsonl` (generated).\n- See `docs/.i18n/README.md`.\n- The pipeline can be slow/inefficient; if it’s dragging, ping @jospalmbier on Discord instead of hacking around it.\n\n## exe.dev VM ops (general)\n\n- Access: stable path is `ssh exe.dev` then `ssh vm-name` (assume SSH key already set).\n- SSH flaky: use exe.dev web terminal or Shelley (web agent); keep a tmux session for long ops.\n- Update: `sudo npm i -g openclaw@latest` (global install needs root on `/usr/lib/node_modules`).\n- Config: use `openclaw config set ...`; ensure `gateway.mode=local` is set.\n- Discord: store raw token only (no `DISCORD_BOT_TOKEN=` prefix).\n- Restart: stop old gateway and run:\n  `pkill -9 -f openclaw-gateway || true; nohup openclaw gateway run --bind loopback --port 18789 --force > /tmp/openclaw-gateway.log 2>&1 &`\n- Verify: `openclaw channels status --probe`, `ss -ltnp | rg 18789`, `tail -n 120 /tmp/openclaw-gateway.log`.\n\n## Build, Test, and Development Commands\n\n- Runtime baseline: Node **22+** (keep Node + Bun paths working).\n- Install deps: `pnpm install`\n- Pre-commit hooks: `prek install` (runs same checks as CI)\n- Also supported: `bun install` (keep `pnpm-lock.yaml` + Bun patching in sync when touching deps/patches).\n- Prefer Bun for TypeScript execution (scripts, dev, tests): `bun <file.ts>` / `bunx <tool>`.\n- Run CLI in dev: `pnpm openclaw ...` (bun) or `pnpm dev`.\n- Node remains supported for running built output (`dist/*`) and production installs.\n- Mac packaging (dev): `scripts/package-mac-app.sh` defaults to current arch. Release checklist: `docs/platforms/mac/release.md`.\n- Type-check/build: `pnpm build`\n- TypeScript checks: `pnpm tsgo`\n- Lint/format: `pnpm check`\n- Tests: `pnpm test` (vitest); coverage: `pnpm test:coverage`\n\n## Coding Style & Naming Conventions\n\n- Language: TypeScript (ESM). Prefer strict typing; avoid `any`.\n- Formatting/linting via Oxlint and Oxfmt; run `pnpm check` before commits.\n- Add brief code comments for tricky or non-obvious logic.\n- Keep files concise; extract helpers instead of “V2” copies. Use existing patterns for CLI options and dependency injection via `createDefaultDeps`.\n- Aim to keep files under ~700 LOC; guideline only (not a hard guardrail). Split/refactor when it improves clarity or testability.\n- Naming: use **OpenClaw** for product/app/docs headings; use `openclaw` for CLI command, package/binary, paths, and config keys.\n\n## Release Channels (Naming)\n\n- stable: tagged releases only (e.g. `vYYYY.M.D`), npm dist-tag `latest`.\n- beta: prerelease tags `vYYYY.M.D-beta.N`, npm dist-tag `beta` (may ship without macOS app).\n- dev: moving head on `main` (no tag; git checkout main).\n\n## Testing Guidelines\n\n- Framework: Vitest with V8 coverage thresholds (70% lines/branches/functions/statements).\n- Naming: match source names with `*.test.ts`; e2e in `*.e2e.test.ts`.\n- Run `pnpm test` (or `pnpm test:coverage`) before pushing when you touch logic.\n- Do not set test workers above 16; tried already.\n- Live tests (real keys): `CLAWDBOT_LIVE_TEST=1 pnpm test:live` (OpenClaw-only) or `LIVE=1 pnpm test:live` (includes provider live tests). Docker: `pnpm test:docker:live-models`, `pnpm test:docker:live-gateway`. Onboarding Docker E2E: `pnpm test:docker:onboard`.\n- Full kit + what’s covered: `docs/testing.md`.\n- Pure test additions/fixes generally do **not** need a changelog entry unless they alter user-facing behavior or the user asks for one.\n- Mobile: before using a simulator, check for connected real devices (iOS + Android) and prefer them when available.\n\n## Commit & Pull Request Guidelines\n\n- Create commits with `scripts/committer \"<msg>\" <file...>`; avoid manual `git add`/`git commit` so staging stays scoped.\n- Follow concise, action-oriented commit messages (e.g., `CLI: add verbose flag to send`).\n- Group related changes; avoid bundling unrelated refactors.\n- Changelog workflow: keep latest released version at top (no `Unreleased`); after publishing, bump version and start a new top section.\n- PRs should summarize scope, note testing performed, and mention any user-facing changes or new flags.\n- Read this when submitting a PR: `docs/help/submitting-a-pr.md` ([Submitting a PR](https://docs.openclaw.ai/help/submitting-a-pr))\n- Read this when submitting an issue: `docs/help/submitting-an-issue.md` ([Submitting an Issue](https://docs.openclaw.ai/help/submitting-an-issue))\n- PR review flow: when given a PR link, review via `gh pr view`/`gh pr diff` and do **not** change branches.\n- PR review calls: prefer a single `gh pr view --json ...` to batch metadata/comments; run `gh pr diff` only when needed.\n- Before starting a review when a GH Issue/PR is pasted: run `git pull`; if there are local changes or unpushed commits, stop and alert the user before reviewing.\n- Goal: merge PRs. Prefer **rebase** when commits are clean; **squash** when history is messy.\n- PR merge flow: create a temp branch from `main`, merge the PR branch into it (prefer squash unless commit history is important; use rebase/merge when it is). Always try to merge the PR unless it’s truly difficult, then use another approach. If we squash, add the PR author as a co-contributor. Apply fixes, add changelog entry (include PR # + thanks), run full gate before the final commit, commit, merge back to `main`, delete the temp branch, and end on `main`.\n- If you review a PR and later do work on it, land via merge/squash (no direct-main commits) and always add the PR author as a co-contributor.\n- When working on a PR: add a changelog entry with the PR number and thank the contributor.\n- When working on an issue: reference the issue in the changelog entry.\n- When merging a PR: leave a PR comment that explains exactly what we did and include the SHA hashes.\n- When merging a PR from a new contributor: add their avatar to the README “Thanks to all clawtributors” thumbnail list.\n- After merging a PR: run `bun scripts/update-clawtributors.ts` if the contributor is missing, then commit the regenerated README.\n\n## Shorthand Commands\n\n- `sync`: if working tree is dirty, commit all changes (pick a sensible Conventional Commit message), then `git pull --rebase`; if rebase conflicts and cannot resolve, stop; otherwise `git push`.\n\n### PR Workflow (Review vs Land)\n\n- **Review mode (PR link only):** read `gh pr view/diff`; **do not** switch branches; **do not** change code.\n- **Landing mode:** create an integration branch from `main`, bring in PR commits (**prefer rebase** for linear history; **merge allowed** when complexity/conflicts make it safer), apply fixes, add changelog (+ thanks + PR #), run full gate **locally before committing** (`pnpm build && pnpm check && pnpm test`), commit, merge back to `main`, then `git switch main` (never stay on a topic branch after landing). Important: contributor needs to be in git graph after this!\n\n## Security & Configuration Tips\n\n- Web provider stores creds at `~/.openclaw/credentials/`; rerun `openclaw login` if logged out.\n- Pi sessions live under `~/.openclaw/sessions/` by default; the base directory is not configurable.\n- Environment variables: see `~/.profile`.\n- Never commit or publish real phone numbers, videos, or live configuration values. Use obviously fake placeholders in docs, tests, and examples.\n- Release flow: always read `docs/reference/RELEASING.md` and `docs/platforms/mac/release.md` before any release work; do not ask routine questions once those docs answer them.\n\n## Troubleshooting\n\n- Rebrand/migration issues or legacy config/service warnings: run `openclaw doctor` (see `docs/gateway/doctor.md`).\n\n## Agent-Specific Notes\n\n- Vocabulary: \"makeup\" = \"mac app\".\n- Never edit `node_modules` (global/Homebrew/npm/git installs too). Updates overwrite. Skill notes go in `tools.md` or `AGENTS.md`.\n- Signal: \"update fly\" => `fly ssh console -a flawd-bot -C \"bash -lc 'cd /data/clawd/openclaw && git pull --rebase origin main'\"` then `fly machines restart e825232f34d058 -a flawd-bot`.\n- When working on a GitHub Issue or PR, print the full URL at the end of the task.\n- When answering questions, respond with high-confidence answers only: verify in code; do not guess.\n- Never update the Carbon dependency.\n- Any dependency with `pnpm.patchedDependencies` must use an exact version (no `^`/`~`).\n- Patching dependencies (pnpm patches, overrides, or vendored changes) requires explicit approval; do not do this by default.\n- CLI progress: use `src/cli/progress.ts` (`osc-progress` + `@clack/prompts` spinner); don’t hand-roll spinners/bars.\n- Status output: keep tables + ANSI-safe wrapping (`src/terminal/table.ts`); `status --all` = read-only/pasteable, `status --deep` = probes.\n- Gateway currently runs only as the menubar app; there is no separate LaunchAgent/helper label installed. Restart via the OpenClaw Mac app or `scripts/restart-mac.sh`; to verify/kill use `launchctl print gui/$UID | grep openclaw` rather than assuming a fixed label. **When debugging on macOS, start/stop the gateway via the app, not ad-hoc tmux sessions; kill any temporary tunnels before handoff.**\n- macOS logs: use `./scripts/clawlog.sh` to query unified logs for the OpenClaw subsystem; it supports follow/tail/category filters and expects passwordless sudo for `/usr/bin/log`.\n- If shared guardrails are available locally, review them; otherwise follow this repo's guidance.\n- SwiftUI state management (iOS/macOS): prefer the `Observation` framework (`@Observable`, `@Bindable`) over `ObservableObject`/`@StateObject`; don’t introduce new `ObservableObject` unless required for compatibility, and migrate existing usages when touching related code.\n- Connection providers: when adding a new connection, update every UI surface and docs (macOS app, web UI, mobile if applicable, onboarding/overview docs) and add matching status + configuration forms so provider lists and settings stay in sync.\n- Version locations: `package.json` (CLI), `apps/android/app/build.gradle.kts` (versionName/versionCode), `apps/ios/Sources/Info.plist` + `apps/ios/Tests/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `apps/macos/Sources/OpenClaw/Resources/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `docs/install/updating.md` (pinned npm version), `docs/platforms/mac/release.md` (APP_VERSION/APP_BUILD examples), Peekaboo Xcode projects/Info.plists (MARKETING_VERSION/CURRENT_PROJECT_VERSION).\n- **Restart apps:** “restart iOS/Android apps” means rebuild (recompile/install) and relaunch, not just kill/launch.\n- **Device checks:** before testing, verify connected real devices (iOS/Android) before reaching for simulators/emulators.\n- iOS Team ID lookup: `security find-identity -p codesigning -v` → use Apple Development (…) TEAMID. Fallback: `defaults read com.apple.dt.Xcode IDEProvisioningTeamIdentifiers`.\n- A2UI bundle hash: `src/canvas-host/a2ui/.bundle.hash` is auto-generated; ignore unexpected changes, and only regenerate via `pnpm canvas:a2ui:bundle` (or `scripts/bundle-a2ui.sh`) when needed. Commit the hash as a separate commit.\n- Release signing/notary keys are managed outside the repo; follow internal release docs.\n- Notary auth env vars (`APP_STORE_CONNECT_ISSUER_ID`, `APP_STORE_CONNECT_KEY_ID`, `APP_STORE_CONNECT_API_KEY_P8`) are expected in your environment (per internal release docs).\n- **Multi-agent safety:** do **not** create/apply/drop `git stash` entries unless explicitly requested (this includes `git pull --rebase --autostash`). Assume other agents may be working; keep unrelated WIP untouched and avoid cross-cutting state changes.\n- **Multi-agent safety:** when the user says \"push\", you may `git pull --rebase` to integrate latest changes (never discard other agents' work). When the user says \"commit\", scope to your changes only. When the user says \"commit all\", commit everything in grouped chunks.\n- **Multi-agent safety:** do **not** create/remove/modify `git worktree` checkouts (or edit `.worktrees/*`) unless explicitly requested.\n- **Multi-agent safety:** do **not** switch branches / check out a different branch unless explicitly requested.\n- **Multi-agent safety:** running multiple agents is OK as long as each agent has its own session.\n- **Multi-agent safety:** when you see unrecognized files, keep going; focus on your changes and commit only those.\n- Lint/format churn:\n  - If staged+unstaged diffs are formatting-only, auto-resolve without asking.\n  - If commit/push already requested, auto-stage and include formatting-only follow-ups in the same commit (or a tiny follow-up commit if needed), no extra confirmation.\n  - Only ask when changes are semantic (logic/data/behavior).\n- Lobster seam: use the shared CLI palette in `src/terminal/palette.ts` (no hardcoded colors); apply palette to onboarding/config prompts and other TTY UI output as needed.\n- **Multi-agent safety:** focus reports on your edits; avoid guard-rail disclaimers unless truly blocked; when multiple agents touch the same file, continue if safe; end with a brief “other files present” note only if relevant.\n- Bug investigations: read source code of relevant npm dependencies and all related local code before concluding; aim for high-confidence root cause.\n- Code style: add brief comments for tricky logic; keep files under ~500 LOC when feasible (split/refactor as needed).\n- Tool schema guardrails (google-antigravity): avoid `Type.Union` in tool input schemas; no `anyOf`/`oneOf`/`allOf`. Use `stringEnum`/`optionalStringEnum` (Type.Unsafe enum) for string lists, and `Type.Optional(...)` instead of `... | null`. Keep top-level tool schema as `type: \"object\"` with `properties`.\n- Tool schema guardrails: avoid raw `format` property names in tool schemas; some validators treat `format` as a reserved keyword and reject the schema.\n- When asked to open a “session” file, open the Pi session logs under `~/.openclaw/agents/<agentId>/sessions/*.jsonl` (use the `agent=<id>` value in the Runtime line of the system prompt; newest unless a specific ID is given), not the default `sessions.json`. If logs are needed from another machine, SSH via Tailscale and read the same path there.\n- Do not rebuild the macOS app over SSH; rebuilds must be run directly on the Mac.\n- Never send streaming/partial replies to external messaging surfaces (WhatsApp, Telegram); only final replies should be delivered there. Streaming/tool events may still go to internal UIs/control channel.\n- Voice wake forwarding tips:\n  - Command template should stay `openclaw-mac agent --message \"${text}\" --thinking low`; `VoiceWakeForwarder` already shell-escapes `${text}`. Don’t add extra quotes.\n  - launchd PATH is minimal; ensure the app’s launch agent PATH includes standard system paths plus your pnpm bin (typically `$HOME/Library/pnpm`) so `pnpm`/`openclaw` binaries resolve when invoked via `openclaw-mac`.\n- For manual `openclaw message send` messages that include `!`, use the heredoc pattern noted below to avoid the Bash tool’s escaping.\n- Release guardrails: do not change version numbers without operator’s explicit consent; always ask permission before running any npm publish/release step.\n\n## NPM + 1Password (publish/verify)\n\n- Use the 1password skill; all `op` commands must run inside a fresh tmux session.\n- Sign in: `eval \"$(op signin --account my.1password.com)\"` (app unlocked + integration on).\n- OTP: `op read 'op://Private/Npmjs/one-time password?attribute=otp'`.\n- Publish: `npm publish --access public --otp=\"<otp>\"` (run from the package dir).\n- Verify without local npmrc side effects: `npm view <pkg> version --userconfig \"$(mktemp)\"`.\n- Kill the tmux session after publish.\n\n\n## Skills\nA skill is a set of local instructions to follow that is stored in a `SKILL.md` file. Below is the list of skills that can be used. Each entry includes a name, description, and file path so you can open the source for full instructions when using a specific skill.\n### Available skills\n- merge-pr: Merge a GitHub PR via squash after /preparepr. Use when asked to merge a ready PR. Do not push to main or modify code. Ensure the PR ends in MERGED state and clean up worktrees after success. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/merge-pr/SKILL.md)\n- prepare-pr: Prepare a GitHub PR for merge by rebasing onto main, fixing review findings, running gates, committing fixes, and pushing to the PR head branch. Use after /reviewpr. Never merge or push to main. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/prepare-pr/SKILL.md)\n- review-pr: Review-only GitHub pull request analysis with the gh CLI. Use when asked to review a PR, provide structured feedback, or assess readiness to land. Do not merge, push, or make code changes you intend to keep. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/review-pr/SKILL.md)\n- figma: Use the Figma MCP server to fetch design context, screenshots, variables, and assets from Figma, and to translate Figma nodes into production code. Trigger when a task involves Figma URLs, node IDs, design-to-code implementation, or Figma MCP setup and troubleshooting. (file: /home/ldr-cavetroll/.codex/skills/figma/SKILL.md)\n- skill-creator: Guide for creating effective skills. This skill should be used when users want to create a new skill (or update an existing skill) that extends Codex's capabilities with specialized knowledge, workflows, or tool integrations. (file: /home/ldr-cavetroll/.codex/skills/.system/skill-creator/SKILL.md)\n- skill-installer: Install Codex skills into $CODEX_HOME/skills from a curated list or a GitHub repo path. Use when a user asks to list installable skills, install a curated skill, or install a skill from another repo (including private repos). (file: /home/ldr-cavetroll/.codex/skills/.system/skill-installer/SKILL.md)\n### How to use skills\n- Discovery: The list above is the skills available in this session (name + description + file path). Skill bodies live on disk at the listed paths.\n- Trigger rules: If the user names a skill (with `$SkillName` or plain text) OR the task clearly matches a skill's description shown above, you must use that skill for that turn. Multiple mentions mean use them all. Do not carry skills across turns unless re-mentioned.\n- Missing/blocked: If a named skill isn't in the list or the path can't be read, say so briefly and continue with the best fallback.\n- How to use a skill (progressive disclosure):\n  1) After deciding to use a skill, open its `SKILL.md`. Read only enough to follow the workflow.\n  2) When `SKILL.md` references relative paths (e.g., `scripts/foo.py`), resolve them relative to the skill directory listed above first, and only consider other paths if needed.\n  3) If `SKILL.md` points to extra folders such as `references/`, load only the specific files needed for the request; don't bulk-load everything.\n  4) If `scripts/` exist, prefer running or patching them instead of retyping large code blocks.\n  5) If `assets/` or templates exist, reuse them instead of recreating from scratch.\n- Coordination and sequencing:\n  - If multiple skills apply, choose the minimal set that covers the request and state the order you'll use them.\n  - Announce which skill(s) you're using and why (one short line). If you skip an obvious skill, say why.\n- Context hygiene:\n  - Keep context small: summarize long sections instead of pasting them; only load extra files when needed.\n  - Avoid deep reference-chasing: prefer opening only files directly linked from `SKILL.md` unless you're blocked.\n  - When variants exist (frameworks, providers, domains), pick only the relevant reference file(s) and note that choice.\n- Safety and fallback: If a skill can't be applied cleanly (missing files, unclear instructions), state the issue, pick the next-best approach, and continue.","truncation_policy":{"mode":"tokens","limit":10000}}}
{"timestamp":"2026-02-07T07:57:25.512Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":77478,"cached_input_tokens":47360,"output_tokens":170,"reasoning_output_tokens":0,"total_tokens":77648},"last_token_usage":{"input_tokens":20428,"cached_input_tokens":19200,"output_tokens":49,"reasoning_output_tokens":0,"total_tokens":20477},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":1.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":8.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T07:57:27.512Z","type":"event_msg","payload":{"type":"agent_reasoning","text":"**Reviewing ACP implementation and docs**\n\nI'm preparing to explain the repo structure via AGENTS.md and investigate the Google ACP implementation under src/acp/index.ts, planning to consult docs.acp.md and key source files to understand the details."}}
{"timestamp":"2026-02-07T07:57:27.512Z","type":"response_item","payload":{"type":"reasoning","summary":[{"type":"summary_text","text":"**Reviewing ACP implementation and docs**\n\nI'm preparing to explain the repo structure via AGENTS.md and investigate the Google ACP implementation under src/acp/index.ts, planning to consult docs.acp.md and key source files to understand the details."}],"content":null,"encrypted_content":"gAAAAABphvBn3RXVKBlxdKLGM9ApCBjGh7zjMjAviPDLercS26Uj7AmMmRXOG0jS7AdEaDu9hOfFMuvpr-4s5HP6nTPON4sXZymWWNfsu6Qc-S35P8SkJtg3vnPKrc4xAADokeK47nZUh1T8IYlg_7kyNQKnHTRvp41NS6CokVZ-dk2inj5BIhef56aY1zNbf5eXTw-70GAGeB8kQlMeuKQuchv3Mp6G-f-h56k0TsZNcFBVsAx7euyjlT_tNUxUMogcF9XudBU_eDiDXiTm_0juln2AOzGFFPv7lp6LjXy3lESKucqD-89x3Aojf5KdPi1luXc5rDvvI5y9R_SbuChOo9vOf7nSYt9hdLti7PvYAjeGRBy6fMfJI2Ps2G1f0FFETS04caivqVoYPcD8MlbbWU-Crr9g9p-f6q4PuGPoOT8WubvD-9iL_uPaHeFPrc6-TghN9V-HcOfwZm5ynIipXd7Qk2VYIuKDFZ7gRfkPCs7czx1wLPvZqUdYqNZIX0aNS-RGcms0M5p-TlVGz-ozwsMNNixufU0L27AkiWj0YisIV8YYR4UVnyNOvx2BqQVbVKU-uooM7nP-BniDjtaOsrD5DOEzDpDaz81CzUxjqZt5pc6IQdghamDRwl0sU6E2p1C0AwK-MIGyKwAaNQtLVkwQeMZZJ3Ucz3Gt7LguStnXm-udz-X4LmsSiTHccyGgI1XbCZfv375CPWmcoXo_W57_Knm3evDK9doXUPQrrSXkZpXA1Bc5oypoZntWwnwb8FutRF-tJcbVeWePlgYHXq9XTqEpCTSo3F9684M4qglHbP8adtR30pPZrA6IvAgV7IyLFrDoztVFlS26qxbTOmNQ59dHeLjb48aXCHWfovxQgAO-ci7UawQxLRdnjaOCriPY3w92qTqiKYeS2ov3BprsLEDSYZemIDzsE7yDU7P4p6LsE3JJYmYpTP886vcZRQvvX_YS6oOmyGsOMSoO56uIUtrP4_xTffAxHJSJSpCjRZCWXpfJFNEtXQA5ZRuyJ00JqSfmQrCbPU3AWLedRMFMNwb415dB4UtaU65EYuZICchXpZT2FIi3Vd9HfF7ji2p00bE-fdHmBglzQ1qTejT5civ4Iw=="}}
{"timestamp":"2026-02-07T07:57:27.722Z","type":"response_item","payload":{"type":"function_call","name":"exec_command","arguments":"{\"cmd\":\"sed -n '1,220p' src/acp/server.ts\"}","call_id":"call_eFPYKUXgSAIvHZffCSo3VLiN"}}
{"timestamp":"2026-02-07T07:57:27.726Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":98048,"cached_input_tokens":67712,"output_tokens":249,"reasoning_output_tokens":0,"total_tokens":98297},"last_token_usage":{"input_tokens":20570,"cached_input_tokens":20352,"output_tokens":79,"reasoning_output_tokens":0,"total_tokens":20649},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":1.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":8.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T07:57:27.807Z","type":"response_item","payload":{"type":"function_call_output","call_id":"call_eFPYKUXgSAIvHZffCSo3VLiN","output":"Chunk ID: 78554d\nWall time: 0.0505 seconds\nProcess exited with code 0\nOriginal token count: 1123\nOutput:\n#!/usr/bin/env node\nimport { AgentSideConnection, ndJsonStream } from \"@agentclientprotocol/sdk\";\nimport { Readable, Writable } from \"node:stream\";\nimport { fileURLToPath } from \"node:url\";\nimport type { AcpServerOptions } from \"./types.js\";\nimport { loadConfig } from \"../config/config.js\";\nimport { resolveGatewayAuth } from \"../gateway/auth.js\";\nimport { buildGatewayConnectionDetails } from \"../gateway/call.js\";\nimport { GatewayClient } from \"../gateway/client.js\";\nimport { isMainModule } from \"../infra/is-main.js\";\nimport { GATEWAY_CLIENT_MODES, GATEWAY_CLIENT_NAMES } from \"../utils/message-channel.js\";\nimport { AcpGatewayAgent } from \"./translator.js\";\n\nexport function serveAcpGateway(opts: AcpServerOptions = {}): void {\n  const cfg = loadConfig();\n  const connection = buildGatewayConnectionDetails({\n    config: cfg,\n    url: opts.gatewayUrl,\n  });\n\n  const isRemoteMode = cfg.gateway?.mode === \"remote\";\n  const remote = isRemoteMode ? cfg.gateway?.remote : undefined;\n  const auth = resolveGatewayAuth({ authConfig: cfg.gateway?.auth, env: process.env });\n\n  const token =\n    opts.gatewayToken ??\n    (isRemoteMode ? remote?.token?.trim() : undefined) ??\n    process.env.OPENCLAW_GATEWAY_TOKEN ??\n    auth.token;\n  const password =\n    opts.gatewayPassword ??\n    (isRemoteMode ? remote?.password?.trim() : undefined) ??\n    process.env.OPENCLAW_GATEWAY_PASSWORD ??\n    auth.password;\n\n  let agent: AcpGatewayAgent | null = null;\n  const gateway = new GatewayClient({\n    url: connection.url,\n    token: token || undefined,\n    password: password || undefined,\n    clientName: GATEWAY_CLIENT_NAMES.CLI,\n    clientDisplayName: \"ACP\",\n    clientVersion: \"acp\",\n    mode: GATEWAY_CLIENT_MODES.CLI,\n    onEvent: (evt) => {\n      void agent?.handleGatewayEvent(evt);\n    },\n    onHelloOk: () => {\n      agent?.handleGatewayReconnect();\n    },\n    onClose: (code, reason) => {\n      agent?.handleGatewayDisconnect(`${code}: ${reason}`);\n    },\n  });\n\n  const input = Writable.toWeb(process.stdout);\n  const output = Readable.toWeb(process.stdin) as unknown as ReadableStream<Uint8Array>;\n  const stream = ndJsonStream(input, output);\n\n  new AgentSideConnection((conn: AgentSideConnection) => {\n    agent = new AcpGatewayAgent(conn, gateway, opts);\n    agent.start();\n    return agent;\n  }, stream);\n\n  gateway.start();\n}\n\nfunction parseArgs(args: string[]): AcpServerOptions {\n  const opts: AcpServerOptions = {};\n  for (let i = 0; i < args.length; i += 1) {\n    const arg = args[i];\n    if (arg === \"--url\" || arg === \"--gateway-url\") {\n      opts.gatewayUrl = args[i + 1];\n      i += 1;\n      continue;\n    }\n    if (arg === \"--token\" || arg === \"--gateway-token\") {\n      opts.gatewayToken = args[i + 1];\n      i += 1;\n      continue;\n    }\n    if (arg === \"--password\" || arg === \"--gateway-password\") {\n      opts.gatewayPassword = args[i + 1];\n      i += 1;\n      continue;\n    }\n    if (arg === \"--session\") {\n      opts.defaultSessionKey = args[i + 1];\n      i += 1;\n      continue;\n    }\n    if (arg === \"--session-label\") {\n      opts.defaultSessionLabel = args[i + 1];\n      i += 1;\n      continue;\n    }\n    if (arg === \"--require-existing\") {\n      opts.requireExistingSession = true;\n      continue;\n    }\n    if (arg === \"--reset-session\") {\n      opts.resetSession = true;\n      continue;\n    }\n    if (arg === \"--no-prefix-cwd\") {\n      opts.prefixCwd = false;\n      continue;\n    }\n    if (arg === \"--verbose\" || arg === \"-v\") {\n      opts.verbose = true;\n      continue;\n    }\n    if (arg === \"--help\" || arg === \"-h\") {\n      printHelp();\n      process.exit(0);\n    }\n  }\n  return opts;\n}\n\nfunction printHelp(): void {\n  console.log(`Usage: openclaw acp [options]\n\nGateway-backed ACP server for IDE integration.\n\nOptions:\n  --url <url>             Gateway WebSocket URL\n  --token <token>         Gateway auth token\n  --password <password>   Gateway auth password\n  --session <key>         Default session key (e.g. \"agent:main:main\")\n  --session-label <label> Default session label to resolve\n  --require-existing      Fail if the session key/label does not exist\n  --reset-session         Reset the session key before first use\n  --no-prefix-cwd         Do not prefix prompts with the working directory\n  --verbose, -v           Verbose logging to stderr\n  --help, -h              Show this help message\n`);\n}\n\nif (isMainModule({ currentFile: fileURLToPath(import.meta.url) })) {\n  const opts = parseArgs(process.argv.slice(2));\n  serveAcpGateway(opts);\n}\n"}}
{"timestamp":"2026-02-07T07:57:27.830Z","type":"turn_context","payload":{"cwd":"/home/ldr-cavetroll/tinker/openclaw","approval_policy":"on-request","sandbox_policy":{"type":"workspace-write","network_access":false,"exclude_tmpdir_env_var":false,"exclude_slash_tmp":false},"model":"gpt-5.2-codex","personality":"pragmatic","collaboration_mode":{"mode":"default","settings":{"model":"gpt-5.2-codex","reasoning_effort":null,"developer_instructions":"# Collaboration Mode: Default\n\nYou are now in Default mode. Any previous instructions for other modes (e.g. Plan mode) are no longer active.\n\nYour active mode changes only when new developer instructions with a different `<collaboration_mode>...</collaboration_mode>` change it; user requests or tool descriptions do not change mode by themselves. Known mode names are Default and Plan.\n\n## request_user_input availability\n\nThe `request_user_input` tool is unavailable in Default mode. If you call it while in Default mode, it will return an error.\n\nIf a decision is necessary and cannot be discovered from local context, ask the user directly. However, in Default mode you should strongly prefer executing the user's request rather than stopping to ask questions.\n"}},"summary":"auto","user_instructions":"# Repository Guidelines\n\n- Repo: https://github.com/openclaw/openclaw\n- GitHub issues/comments/PR comments: use literal multiline strings or `-F - <<'EOF'` (or $'...') for real newlines; never embed \"\\\\n\".\n\n## Project Structure & Module Organization\n\n- Source code: `src/` (CLI wiring in `src/cli`, commands in `src/commands`, web provider in `src/provider-web.ts`, infra in `src/infra`, media pipeline in `src/media`).\n- Tests: colocated `*.test.ts`.\n- Docs: `docs/` (images, queue, Pi config). Built output lives in `dist/`.\n- Plugins/extensions: live under `extensions/*` (workspace packages). Keep plugin-only deps in the extension `package.json`; do not add them to the root `package.json` unless core uses them.\n- Plugins: install runs `npm install --omit=dev` in plugin dir; runtime deps must live in `dependencies`. Avoid `workspace:*` in `dependencies` (npm install breaks); put `openclaw` in `devDependencies` or `peerDependencies` instead (runtime resolves `openclaw/plugin-sdk` via jiti alias).\n- Installers served from `https://openclaw.ai/*`: live in the sibling repo `../openclaw.ai` (`public/install.sh`, `public/install-cli.sh`, `public/install.ps1`).\n- Messaging channels: always consider **all** built-in + extension channels when refactoring shared logic (routing, allowlists, pairing, command gating, onboarding, docs).\n  - Core channel docs: `docs/channels/`\n  - Core channel code: `src/telegram`, `src/discord`, `src/slack`, `src/signal`, `src/imessage`, `src/web` (WhatsApp web), `src/channels`, `src/routing`\n  - Extensions (channel plugins): `extensions/*` (e.g. `extensions/msteams`, `extensions/matrix`, `extensions/zalo`, `extensions/zalouser`, `extensions/voice-call`)\n- When adding channels/extensions/apps/docs, review `.github/labeler.yml` for label coverage.\n\n## Docs Linking (Mintlify)\n\n- Docs are hosted on Mintlify (docs.openclaw.ai).\n- Internal doc links in `docs/**/*.md`: root-relative, no `.md`/`.mdx` (example: `[Config](/configuration)`).\n- Section cross-references: use anchors on root-relative paths (example: `[Hooks](/configuration#hooks)`).\n- Doc headings and anchors: avoid em dashes and apostrophes in headings because they break Mintlify anchor links.\n- When Peter asks for links, reply with full `https://docs.openclaw.ai/...` URLs (not root-relative).\n- When you touch docs, end the reply with the `https://docs.openclaw.ai/...` URLs you referenced.\n- README (GitHub): keep absolute docs URLs (`https://docs.openclaw.ai/...`) so links work on GitHub.\n- Docs content must be generic: no personal device names/hostnames/paths; use placeholders like `user@gateway-host` and “gateway host”.\n\n## Docs i18n (zh-CN)\n\n- `docs/zh-CN/**` is generated; do not edit unless the user explicitly asks.\n- Pipeline: update English docs → adjust glossary (`docs/.i18n/glossary.zh-CN.json`) → run `scripts/docs-i18n` → apply targeted fixes only if instructed.\n- Translation memory: `docs/.i18n/zh-CN.tm.jsonl` (generated).\n- See `docs/.i18n/README.md`.\n- The pipeline can be slow/inefficient; if it’s dragging, ping @jospalmbier on Discord instead of hacking around it.\n\n## exe.dev VM ops (general)\n\n- Access: stable path is `ssh exe.dev` then `ssh vm-name` (assume SSH key already set).\n- SSH flaky: use exe.dev web terminal or Shelley (web agent); keep a tmux session for long ops.\n- Update: `sudo npm i -g openclaw@latest` (global install needs root on `/usr/lib/node_modules`).\n- Config: use `openclaw config set ...`; ensure `gateway.mode=local` is set.\n- Discord: store raw token only (no `DISCORD_BOT_TOKEN=` prefix).\n- Restart: stop old gateway and run:\n  `pkill -9 -f openclaw-gateway || true; nohup openclaw gateway run --bind loopback --port 18789 --force > /tmp/openclaw-gateway.log 2>&1 &`\n- Verify: `openclaw channels status --probe`, `ss -ltnp | rg 18789`, `tail -n 120 /tmp/openclaw-gateway.log`.\n\n## Build, Test, and Development Commands\n\n- Runtime baseline: Node **22+** (keep Node + Bun paths working).\n- Install deps: `pnpm install`\n- Pre-commit hooks: `prek install` (runs same checks as CI)\n- Also supported: `bun install` (keep `pnpm-lock.yaml` + Bun patching in sync when touching deps/patches).\n- Prefer Bun for TypeScript execution (scripts, dev, tests): `bun <file.ts>` / `bunx <tool>`.\n- Run CLI in dev: `pnpm openclaw ...` (bun) or `pnpm dev`.\n- Node remains supported for running built output (`dist/*`) and production installs.\n- Mac packaging (dev): `scripts/package-mac-app.sh` defaults to current arch. Release checklist: `docs/platforms/mac/release.md`.\n- Type-check/build: `pnpm build`\n- TypeScript checks: `pnpm tsgo`\n- Lint/format: `pnpm check`\n- Tests: `pnpm test` (vitest); coverage: `pnpm test:coverage`\n\n## Coding Style & Naming Conventions\n\n- Language: TypeScript (ESM). Prefer strict typing; avoid `any`.\n- Formatting/linting via Oxlint and Oxfmt; run `pnpm check` before commits.\n- Add brief code comments for tricky or non-obvious logic.\n- Keep files concise; extract helpers instead of “V2” copies. Use existing patterns for CLI options and dependency injection via `createDefaultDeps`.\n- Aim to keep files under ~700 LOC; guideline only (not a hard guardrail). Split/refactor when it improves clarity or testability.\n- Naming: use **OpenClaw** for product/app/docs headings; use `openclaw` for CLI command, package/binary, paths, and config keys.\n\n## Release Channels (Naming)\n\n- stable: tagged releases only (e.g. `vYYYY.M.D`), npm dist-tag `latest`.\n- beta: prerelease tags `vYYYY.M.D-beta.N`, npm dist-tag `beta` (may ship without macOS app).\n- dev: moving head on `main` (no tag; git checkout main).\n\n## Testing Guidelines\n\n- Framework: Vitest with V8 coverage thresholds (70% lines/branches/functions/statements).\n- Naming: match source names with `*.test.ts`; e2e in `*.e2e.test.ts`.\n- Run `pnpm test` (or `pnpm test:coverage`) before pushing when you touch logic.\n- Do not set test workers above 16; tried already.\n- Live tests (real keys): `CLAWDBOT_LIVE_TEST=1 pnpm test:live` (OpenClaw-only) or `LIVE=1 pnpm test:live` (includes provider live tests). Docker: `pnpm test:docker:live-models`, `pnpm test:docker:live-gateway`. Onboarding Docker E2E: `pnpm test:docker:onboard`.\n- Full kit + what’s covered: `docs/testing.md`.\n- Pure test additions/fixes generally do **not** need a changelog entry unless they alter user-facing behavior or the user asks for one.\n- Mobile: before using a simulator, check for connected real devices (iOS + Android) and prefer them when available.\n\n## Commit & Pull Request Guidelines\n\n- Create commits with `scripts/committer \"<msg>\" <file...>`; avoid manual `git add`/`git commit` so staging stays scoped.\n- Follow concise, action-oriented commit messages (e.g., `CLI: add verbose flag to send`).\n- Group related changes; avoid bundling unrelated refactors.\n- Changelog workflow: keep latest released version at top (no `Unreleased`); after publishing, bump version and start a new top section.\n- PRs should summarize scope, note testing performed, and mention any user-facing changes or new flags.\n- Read this when submitting a PR: `docs/help/submitting-a-pr.md` ([Submitting a PR](https://docs.openclaw.ai/help/submitting-a-pr))\n- Read this when submitting an issue: `docs/help/submitting-an-issue.md` ([Submitting an Issue](https://docs.openclaw.ai/help/submitting-an-issue))\n- PR review flow: when given a PR link, review via `gh pr view`/`gh pr diff` and do **not** change branches.\n- PR review calls: prefer a single `gh pr view --json ...` to batch metadata/comments; run `gh pr diff` only when needed.\n- Before starting a review when a GH Issue/PR is pasted: run `git pull`; if there are local changes or unpushed commits, stop and alert the user before reviewing.\n- Goal: merge PRs. Prefer **rebase** when commits are clean; **squash** when history is messy.\n- PR merge flow: create a temp branch from `main`, merge the PR branch into it (prefer squash unless commit history is important; use rebase/merge when it is). Always try to merge the PR unless it’s truly difficult, then use another approach. If we squash, add the PR author as a co-contributor. Apply fixes, add changelog entry (include PR # + thanks), run full gate before the final commit, commit, merge back to `main`, delete the temp branch, and end on `main`.\n- If you review a PR and later do work on it, land via merge/squash (no direct-main commits) and always add the PR author as a co-contributor.\n- When working on a PR: add a changelog entry with the PR number and thank the contributor.\n- When working on an issue: reference the issue in the changelog entry.\n- When merging a PR: leave a PR comment that explains exactly what we did and include the SHA hashes.\n- When merging a PR from a new contributor: add their avatar to the README “Thanks to all clawtributors” thumbnail list.\n- After merging a PR: run `bun scripts/update-clawtributors.ts` if the contributor is missing, then commit the regenerated README.\n\n## Shorthand Commands\n\n- `sync`: if working tree is dirty, commit all changes (pick a sensible Conventional Commit message), then `git pull --rebase`; if rebase conflicts and cannot resolve, stop; otherwise `git push`.\n\n### PR Workflow (Review vs Land)\n\n- **Review mode (PR link only):** read `gh pr view/diff`; **do not** switch branches; **do not** change code.\n- **Landing mode:** create an integration branch from `main`, bring in PR commits (**prefer rebase** for linear history; **merge allowed** when complexity/conflicts make it safer), apply fixes, add changelog (+ thanks + PR #), run full gate **locally before committing** (`pnpm build && pnpm check && pnpm test`), commit, merge back to `main`, then `git switch main` (never stay on a topic branch after landing). Important: contributor needs to be in git graph after this!\n\n## Security & Configuration Tips\n\n- Web provider stores creds at `~/.openclaw/credentials/`; rerun `openclaw login` if logged out.\n- Pi sessions live under `~/.openclaw/sessions/` by default; the base directory is not configurable.\n- Environment variables: see `~/.profile`.\n- Never commit or publish real phone numbers, videos, or live configuration values. Use obviously fake placeholders in docs, tests, and examples.\n- Release flow: always read `docs/reference/RELEASING.md` and `docs/platforms/mac/release.md` before any release work; do not ask routine questions once those docs answer them.\n\n## Troubleshooting\n\n- Rebrand/migration issues or legacy config/service warnings: run `openclaw doctor` (see `docs/gateway/doctor.md`).\n\n## Agent-Specific Notes\n\n- Vocabulary: \"makeup\" = \"mac app\".\n- Never edit `node_modules` (global/Homebrew/npm/git installs too). Updates overwrite. Skill notes go in `tools.md` or `AGENTS.md`.\n- Signal: \"update fly\" => `fly ssh console -a flawd-bot -C \"bash -lc 'cd /data/clawd/openclaw && git pull --rebase origin main'\"` then `fly machines restart e825232f34d058 -a flawd-bot`.\n- When working on a GitHub Issue or PR, print the full URL at the end of the task.\n- When answering questions, respond with high-confidence answers only: verify in code; do not guess.\n- Never update the Carbon dependency.\n- Any dependency with `pnpm.patchedDependencies` must use an exact version (no `^`/`~`).\n- Patching dependencies (pnpm patches, overrides, or vendored changes) requires explicit approval; do not do this by default.\n- CLI progress: use `src/cli/progress.ts` (`osc-progress` + `@clack/prompts` spinner); don’t hand-roll spinners/bars.\n- Status output: keep tables + ANSI-safe wrapping (`src/terminal/table.ts`); `status --all` = read-only/pasteable, `status --deep` = probes.\n- Gateway currently runs only as the menubar app; there is no separate LaunchAgent/helper label installed. Restart via the OpenClaw Mac app or `scripts/restart-mac.sh`; to verify/kill use `launchctl print gui/$UID | grep openclaw` rather than assuming a fixed label. **When debugging on macOS, start/stop the gateway via the app, not ad-hoc tmux sessions; kill any temporary tunnels before handoff.**\n- macOS logs: use `./scripts/clawlog.sh` to query unified logs for the OpenClaw subsystem; it supports follow/tail/category filters and expects passwordless sudo for `/usr/bin/log`.\n- If shared guardrails are available locally, review them; otherwise follow this repo's guidance.\n- SwiftUI state management (iOS/macOS): prefer the `Observation` framework (`@Observable`, `@Bindable`) over `ObservableObject`/`@StateObject`; don’t introduce new `ObservableObject` unless required for compatibility, and migrate existing usages when touching related code.\n- Connection providers: when adding a new connection, update every UI surface and docs (macOS app, web UI, mobile if applicable, onboarding/overview docs) and add matching status + configuration forms so provider lists and settings stay in sync.\n- Version locations: `package.json` (CLI), `apps/android/app/build.gradle.kts` (versionName/versionCode), `apps/ios/Sources/Info.plist` + `apps/ios/Tests/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `apps/macos/Sources/OpenClaw/Resources/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `docs/install/updating.md` (pinned npm version), `docs/platforms/mac/release.md` (APP_VERSION/APP_BUILD examples), Peekaboo Xcode projects/Info.plists (MARKETING_VERSION/CURRENT_PROJECT_VERSION).\n- **Restart apps:** “restart iOS/Android apps” means rebuild (recompile/install) and relaunch, not just kill/launch.\n- **Device checks:** before testing, verify connected real devices (iOS/Android) before reaching for simulators/emulators.\n- iOS Team ID lookup: `security find-identity -p codesigning -v` → use Apple Development (…) TEAMID. Fallback: `defaults read com.apple.dt.Xcode IDEProvisioningTeamIdentifiers`.\n- A2UI bundle hash: `src/canvas-host/a2ui/.bundle.hash` is auto-generated; ignore unexpected changes, and only regenerate via `pnpm canvas:a2ui:bundle` (or `scripts/bundle-a2ui.sh`) when needed. Commit the hash as a separate commit.\n- Release signing/notary keys are managed outside the repo; follow internal release docs.\n- Notary auth env vars (`APP_STORE_CONNECT_ISSUER_ID`, `APP_STORE_CONNECT_KEY_ID`, `APP_STORE_CONNECT_API_KEY_P8`) are expected in your environment (per internal release docs).\n- **Multi-agent safety:** do **not** create/apply/drop `git stash` entries unless explicitly requested (this includes `git pull --rebase --autostash`). Assume other agents may be working; keep unrelated WIP untouched and avoid cross-cutting state changes.\n- **Multi-agent safety:** when the user says \"push\", you may `git pull --rebase` to integrate latest changes (never discard other agents' work). When the user says \"commit\", scope to your changes only. When the user says \"commit all\", commit everything in grouped chunks.\n- **Multi-agent safety:** do **not** create/remove/modify `git worktree` checkouts (or edit `.worktrees/*`) unless explicitly requested.\n- **Multi-agent safety:** do **not** switch branches / check out a different branch unless explicitly requested.\n- **Multi-agent safety:** running multiple agents is OK as long as each agent has its own session.\n- **Multi-agent safety:** when you see unrecognized files, keep going; focus on your changes and commit only those.\n- Lint/format churn:\n  - If staged+unstaged diffs are formatting-only, auto-resolve without asking.\n  - If commit/push already requested, auto-stage and include formatting-only follow-ups in the same commit (or a tiny follow-up commit if needed), no extra confirmation.\n  - Only ask when changes are semantic (logic/data/behavior).\n- Lobster seam: use the shared CLI palette in `src/terminal/palette.ts` (no hardcoded colors); apply palette to onboarding/config prompts and other TTY UI output as needed.\n- **Multi-agent safety:** focus reports on your edits; avoid guard-rail disclaimers unless truly blocked; when multiple agents touch the same file, continue if safe; end with a brief “other files present” note only if relevant.\n- Bug investigations: read source code of relevant npm dependencies and all related local code before concluding; aim for high-confidence root cause.\n- Code style: add brief comments for tricky logic; keep files under ~500 LOC when feasible (split/refactor as needed).\n- Tool schema guardrails (google-antigravity): avoid `Type.Union` in tool input schemas; no `anyOf`/`oneOf`/`allOf`. Use `stringEnum`/`optionalStringEnum` (Type.Unsafe enum) for string lists, and `Type.Optional(...)` instead of `... | null`. Keep top-level tool schema as `type: \"object\"` with `properties`.\n- Tool schema guardrails: avoid raw `format` property names in tool schemas; some validators treat `format` as a reserved keyword and reject the schema.\n- When asked to open a “session” file, open the Pi session logs under `~/.openclaw/agents/<agentId>/sessions/*.jsonl` (use the `agent=<id>` value in the Runtime line of the system prompt; newest unless a specific ID is given), not the default `sessions.json`. If logs are needed from another machine, SSH via Tailscale and read the same path there.\n- Do not rebuild the macOS app over SSH; rebuilds must be run directly on the Mac.\n- Never send streaming/partial replies to external messaging surfaces (WhatsApp, Telegram); only final replies should be delivered there. Streaming/tool events may still go to internal UIs/control channel.\n- Voice wake forwarding tips:\n  - Command template should stay `openclaw-mac agent --message \"${text}\" --thinking low`; `VoiceWakeForwarder` already shell-escapes `${text}`. Don’t add extra quotes.\n  - launchd PATH is minimal; ensure the app’s launch agent PATH includes standard system paths plus your pnpm bin (typically `$HOME/Library/pnpm`) so `pnpm`/`openclaw` binaries resolve when invoked via `openclaw-mac`.\n- For manual `openclaw message send` messages that include `!`, use the heredoc pattern noted below to avoid the Bash tool’s escaping.\n- Release guardrails: do not change version numbers without operator’s explicit consent; always ask permission before running any npm publish/release step.\n\n## NPM + 1Password (publish/verify)\n\n- Use the 1password skill; all `op` commands must run inside a fresh tmux session.\n- Sign in: `eval \"$(op signin --account my.1password.com)\"` (app unlocked + integration on).\n- OTP: `op read 'op://Private/Npmjs/one-time password?attribute=otp'`.\n- Publish: `npm publish --access public --otp=\"<otp>\"` (run from the package dir).\n- Verify without local npmrc side effects: `npm view <pkg> version --userconfig \"$(mktemp)\"`.\n- Kill the tmux session after publish.\n\n\n## Skills\nA skill is a set of local instructions to follow that is stored in a `SKILL.md` file. Below is the list of skills that can be used. Each entry includes a name, description, and file path so you can open the source for full instructions when using a specific skill.\n### Available skills\n- merge-pr: Merge a GitHub PR via squash after /preparepr. Use when asked to merge a ready PR. Do not push to main or modify code. Ensure the PR ends in MERGED state and clean up worktrees after success. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/merge-pr/SKILL.md)\n- prepare-pr: Prepare a GitHub PR for merge by rebasing onto main, fixing review findings, running gates, committing fixes, and pushing to the PR head branch. Use after /reviewpr. Never merge or push to main. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/prepare-pr/SKILL.md)\n- review-pr: Review-only GitHub pull request analysis with the gh CLI. Use when asked to review a PR, provide structured feedback, or assess readiness to land. Do not merge, push, or make code changes you intend to keep. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/review-pr/SKILL.md)\n- figma: Use the Figma MCP server to fetch design context, screenshots, variables, and assets from Figma, and to translate Figma nodes into production code. Trigger when a task involves Figma URLs, node IDs, design-to-code implementation, or Figma MCP setup and troubleshooting. (file: /home/ldr-cavetroll/.codex/skills/figma/SKILL.md)\n- skill-creator: Guide for creating effective skills. This skill should be used when users want to create a new skill (or update an existing skill) that extends Codex's capabilities with specialized knowledge, workflows, or tool integrations. (file: /home/ldr-cavetroll/.codex/skills/.system/skill-creator/SKILL.md)\n- skill-installer: Install Codex skills into $CODEX_HOME/skills from a curated list or a GitHub repo path. Use when a user asks to list installable skills, install a curated skill, or install a skill from another repo (including private repos). (file: /home/ldr-cavetroll/.codex/skills/.system/skill-installer/SKILL.md)\n### How to use skills\n- Discovery: The list above is the skills available in this session (name + description + file path). Skill bodies live on disk at the listed paths.\n- Trigger rules: If the user names a skill (with `$SkillName` or plain text) OR the task clearly matches a skill's description shown above, you must use that skill for that turn. Multiple mentions mean use them all. Do not carry skills across turns unless re-mentioned.\n- Missing/blocked: If a named skill isn't in the list or the path can't be read, say so briefly and continue with the best fallback.\n- How to use a skill (progressive disclosure):\n  1) After deciding to use a skill, open its `SKILL.md`. Read only enough to follow the workflow.\n  2) When `SKILL.md` references relative paths (e.g., `scripts/foo.py`), resolve them relative to the skill directory listed above first, and only consider other paths if needed.\n  3) If `SKILL.md` points to extra folders such as `references/`, load only the specific files needed for the request; don't bulk-load everything.\n  4) If `scripts/` exist, prefer running or patching them instead of retyping large code blocks.\n  5) If `assets/` or templates exist, reuse them instead of recreating from scratch.\n- Coordination and sequencing:\n  - If multiple skills apply, choose the minimal set that covers the request and state the order you'll use them.\n  - Announce which skill(s) you're using and why (one short line). If you skip an obvious skill, say why.\n- Context hygiene:\n  - Keep context small: summarize long sections instead of pasting them; only load extra files when needed.\n  - Avoid deep reference-chasing: prefer opening only files directly linked from `SKILL.md` unless you're blocked.\n  - When variants exist (frameworks, providers, domains), pick only the relevant reference file(s) and note that choice.\n- Safety and fallback: If a skill can't be applied cleanly (missing files, unclear instructions), state the issue, pick the next-best approach, and continue.","truncation_policy":{"mode":"tokens","limit":10000}}}
{"timestamp":"2026-02-07T07:57:28.073Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":98048,"cached_input_tokens":67712,"output_tokens":249,"reasoning_output_tokens":0,"total_tokens":98297},"last_token_usage":{"input_tokens":20570,"cached_input_tokens":20352,"output_tokens":79,"reasoning_output_tokens":0,"total_tokens":20649},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":1.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":8.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T07:57:29.348Z","type":"event_msg","payload":{"type":"agent_reasoning","text":"**Identifying needed components**\n\nI need to locate translator, session-mapper, types, and documentation for review to inform next steps."}}
{"timestamp":"2026-02-07T07:57:29.348Z","type":"response_item","payload":{"type":"reasoning","summary":[{"type":"summary_text","text":"**Identifying needed components**\n\nI need to locate translator, session-mapper, types, and documentation for review to inform next steps."}],"content":null,"encrypted_content":"gAAAAABphvBpjj4Dn-21SuS4XgPpFo7QUBxXiPzV7IH673qJg2kO0AOHg-hz71oQaBO2_SFiAGjSJrCvxH9BNhVUb-v6jPPKnjJaJM3UZgXmbv-SAvY1zZX6cr-DnJxre9CoXVB7WKHrmi-VTVRlgUChnZQCtmtbaKESn1981HXU3h3aLkpRKiAyewO0SqxS82uCNVZhhvnaRsr8VQtGcdcOZL0A-Mgx-omm9u3m8LmFzk2Jwzh1JXtD52ObzPufPP7DomS-2GG6FHr4MPBVlWZrWzP7w4yPh7sKuLcOAyqXNcV30vlYHKCHheLGcH8-I2jDBMZIR44DZ2mD_teYsPGRtMagFeEE49TrH4klfC8v5oVgh9lpHb0DhFjRXMy7SGXgDHe2O8D3KMww4T-bqTGcGcj3B79F6CwW_xd9kqD4xJU9I5oPZly7E-dHe8nJ6E6_QdXniz8XbKdjubj3HcBxI-cLRhC5vIoUMp-Y-7TSYPoQGpmqEd3ckXmf9f-E14miY1hN0HFtKtJio1Ed1xFCOdF3xRICk92bsfycIYam95GtNH2YjqkeXQHVoVab7rncp_MdPUOainDk1jsWeIBUtyhhbc30OP3MsG2UkZoaQbiqpbvt2_4vwzUc7ddPnd3_MhOwPzbuCKAIj5PwU3NBsqCvgDz6baKPGFP2IAwj6FgFT7bMaZwtEx4AQD9gK_UPeOK4v1PynN9VGRSjcV4hYxmX-v5KtTEP9OnL_JBIB1vwD6jms7QGsNCcjOQm8nYnhUvp4Tha-JTtJXA-AQgtPeDx0kHxV69v6qxMaS0Tu_gFXGZYDJgW_S-dbsLL0lI9nqRPbQz-cNnwydJbOMurRWPxG2zcbIZi15NwvfbAzcidh3lJOqy9e9P-4jaxCicg3fVe8kzy4rLUX3ahVCoIGJy_knmsRQ=="}}
{"timestamp":"2026-02-07T07:57:29.481Z","type":"response_item","payload":{"type":"function_call","name":"exec_command","arguments":"{\"cmd\":\"sed -n '1,260p' src/acp/translator.ts\"}","call_id":"call_ypVoHFbVtblnVdXO3NPe1t7Q"}}
{"timestamp":"2026-02-07T07:57:29.515Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":119871,"cached_input_tokens":88320,"output_tokens":302,"reasoning_output_tokens":0,"total_tokens":120173},"last_token_usage":{"input_tokens":21823,"cached_input_tokens":20608,"output_tokens":53,"reasoning_output_tokens":0,"total_tokens":21876},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":1.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":8.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T07:57:29.566Z","type":"response_item","payload":{"type":"function_call_output","call_id":"call_ypVoHFbVtblnVdXO3NPe1t7Q","output":"Chunk ID: ec5463\nWall time: 0.0505 seconds\nProcess exited with code 0\nOriginal token count: 1958\nOutput:\nimport type {\n  Agent,\n  AgentSideConnection,\n  AuthenticateRequest,\n  AuthenticateResponse,\n  CancelNotification,\n  InitializeRequest,\n  InitializeResponse,\n  ListSessionsRequest,\n  ListSessionsResponse,\n  LoadSessionRequest,\n  LoadSessionResponse,\n  NewSessionRequest,\n  NewSessionResponse,\n  PromptRequest,\n  PromptResponse,\n  SetSessionModeRequest,\n  SetSessionModeResponse,\n  StopReason,\n} from \"@agentclientprotocol/sdk\";\nimport { PROTOCOL_VERSION } from \"@agentclientprotocol/sdk\";\nimport { randomUUID } from \"node:crypto\";\nimport type { GatewayClient } from \"../gateway/client.js\";\nimport type { EventFrame } from \"../gateway/protocol/index.js\";\nimport type { SessionsListResult } from \"../gateway/session-utils.js\";\nimport { getAvailableCommands } from \"./commands.js\";\nimport {\n  extractAttachmentsFromPrompt,\n  extractTextFromPrompt,\n  formatToolTitle,\n  inferToolKind,\n} from \"./event-mapper.js\";\nimport { readBool, readNumber, readString } from \"./meta.js\";\nimport { parseSessionMeta, resetSessionIfNeeded, resolveSessionKey } from \"./session-mapper.js\";\nimport { defaultAcpSessionStore, type AcpSessionStore } from \"./session.js\";\nimport { ACP_AGENT_INFO, type AcpServerOptions } from \"./types.js\";\n\ntype PendingPrompt = {\n  sessionId: string;\n  sessionKey: string;\n  idempotencyKey: string;\n  resolve: (response: PromptResponse) => void;\n  reject: (err: Error) => void;\n  sentTextLength?: number;\n  sentText?: string;\n  toolCalls?: Set<string>;\n};\n\ntype AcpGatewayAgentOptions = AcpServerOptions & {\n  sessionStore?: AcpSessionStore;\n};\n\nexport class AcpGatewayAgent implements Agent {\n  private connection: AgentSideConnection;\n  private gateway: GatewayClient;\n  private opts: AcpGatewayAgentOptions;\n  private log: (msg: string) => void;\n  private sessionStore: AcpSessionStore;\n  private pendingPrompts = new Map<string, PendingPrompt>();\n\n  constructor(\n    connection: AgentSideConnection,\n    gateway: GatewayClient,\n    opts: AcpGatewayAgentOptions = {},\n  ) {\n    this.connection = connection;\n    this.gateway = gateway;\n    this.opts = opts;\n    this.log = opts.verbose ? (msg: string) => process.stderr.write(`[acp] ${msg}\\n`) : () => {};\n    this.sessionStore = opts.sessionStore ?? defaultAcpSessionStore;\n  }\n\n  start(): void {\n    this.log(\"ready\");\n  }\n\n  handleGatewayReconnect(): void {\n    this.log(\"gateway reconnected\");\n  }\n\n  handleGatewayDisconnect(reason: string): void {\n    this.log(`gateway disconnected: ${reason}`);\n    for (const pending of this.pendingPrompts.values()) {\n      pending.reject(new Error(`Gateway disconnected: ${reason}`));\n      this.sessionStore.clearActiveRun(pending.sessionId);\n    }\n    this.pendingPrompts.clear();\n  }\n\n  async handleGatewayEvent(evt: EventFrame): Promise<void> {\n    if (evt.event === \"chat\") {\n      await this.handleChatEvent(evt);\n      return;\n    }\n    if (evt.event === \"agent\") {\n      await this.handleAgentEvent(evt);\n    }\n  }\n\n  async initialize(_params: InitializeRequest): Promise<InitializeResponse> {\n    return {\n      protocolVersion: PROTOCOL_VERSION,\n      agentCapabilities: {\n        loadSession: true,\n        promptCapabilities: {\n          image: true,\n          audio: false,\n          embeddedContext: true,\n        },\n        mcpCapabilities: {\n          http: false,\n          sse: false,\n        },\n        sessionCapabilities: {\n          list: {},\n        },\n      },\n      agentInfo: ACP_AGENT_INFO,\n      authMethods: [],\n    };\n  }\n\n  async newSession(params: NewSessionRequest): Promise<NewSessionResponse> {\n    if (params.mcpServers.length > 0) {\n      this.log(`ignoring ${params.mcpServers.length} MCP servers`);\n    }\n\n    const sessionId = randomUUID();\n    const meta = parseSessionMeta(params._meta);\n    const sessionKey = await resolveSessionKey({\n      meta,\n      fallbackKey: `acp:${sessionId}`,\n      gateway: this.gateway,\n      opts: this.opts,\n    });\n    await resetSessionIfNeeded({\n      meta,\n      sessionKey,\n      gateway: this.gateway,\n      opts: this.opts,\n    });\n\n    const session = this.sessionStore.createSession({\n      sessionId,\n      sessionKey,\n      cwd: params.cwd,\n    });\n    this.log(`newSession: ${session.sessionId} -> ${session.sessionKey}`);\n    await this.sendAvailableCommands(session.sessionId);\n    return { sessionId: session.sessionId };\n  }\n\n  async loadSession(params: LoadSessionRequest): Promise<LoadSessionResponse> {\n    if (params.mcpServers.length > 0) {\n      this.log(`ignoring ${params.mcpServers.length} MCP servers`);\n    }\n\n    const meta = parseSessionMeta(params._meta);\n    const sessionKey = await resolveSessionKey({\n      meta,\n      fallbackKey: params.sessionId,\n      gateway: this.gateway,\n      opts: this.opts,\n    });\n    await resetSessionIfNeeded({\n      meta,\n      sessionKey,\n      gateway: this.gateway,\n      opts: this.opts,\n    });\n\n    const session = this.sessionStore.createSession({\n      sessionId: params.sessionId,\n      sessionKey,\n      cwd: params.cwd,\n    });\n    this.log(`loadSession: ${session.sessionId} -> ${session.sessionKey}`);\n    await this.sendAvailableCommands(session.sessionId);\n    return {};\n  }\n\n  async unstable_listSessions(params: ListSessionsRequest): Promise<ListSessionsResponse> {\n    const limit = readNumber(params._meta, [\"limit\"]) ?? 100;\n    const result = await this.gateway.request<SessionsListResult>(\"sessions.list\", { limit });\n    const cwd = params.cwd ?? process.cwd();\n    return {\n      sessions: result.sessions.map((session) => ({\n        sessionId: session.key,\n        cwd,\n        title: session.displayName ?? session.label ?? session.key,\n        updatedAt: session.updatedAt ? new Date(session.updatedAt).toISOString() : undefined,\n        _meta: {\n          sessionKey: session.key,\n          kind: session.kind,\n          channel: session.channel,\n        },\n      })),\n      nextCursor: null,\n    };\n  }\n\n  async authenticate(_params: AuthenticateRequest): Promise<AuthenticateResponse> {\n    return {};\n  }\n\n  async setSessionMode(params: SetSessionModeRequest): Promise<SetSessionModeResponse> {\n    const session = this.sessionStore.getSession(params.sessionId);\n    if (!session) {\n      throw new Error(`Session ${params.sessionId} not found`);\n    }\n    if (!params.modeId) {\n      return {};\n    }\n    try {\n      await this.gateway.request(\"sessions.patch\", {\n        key: session.sessionKey,\n        thinkingLevel: params.modeId,\n      });\n      this.log(`setSessionMode: ${session.sessionId} -> ${params.modeId}`);\n    } catch (err) {\n      this.log(`setSessionMode error: ${String(err)}`);\n    }\n    return {};\n  }\n\n  async prompt(params: PromptRequest): Promise<PromptResponse> {\n    const session = this.sessionStore.getSession(params.sessionId);\n    if (!session) {\n      throw new Error(`Session ${params.sessionId} not found`);\n    }\n\n    if (session.abortController) {\n      this.sessionStore.cancelActiveRun(params.sessionId);\n    }\n\n    const abortController = new AbortController();\n    const runId = randomUUID();\n    this.sessionStore.setActiveRun(params.sessionId, runId, abortController);\n\n    const meta = parseSessionMeta(params._meta);\n    const userText = extractTextFromPrompt(params.prompt);\n    const attachments = extractAttachmentsFromPrompt(params.prompt);\n    const prefixCwd = meta.prefixCwd ?? this.opts.prefixCwd ?? true;\n    const message = prefixCwd ? `[Working directory: ${session.cwd}]\\n\\n${userText}` : userText;\n\n    return new Promise<PromptResponse>((resolve, reject) => {\n      this.pendingPrompts.set(params.sessionId, {\n        sessionId: params.sessionId,\n        sessionKey: session.sessionKey,\n        idempotencyKey: runId,\n        resolve,\n        reject,\n      });\n\n      this.gateway\n        .request(\n          \"chat.send\",\n          {\n            sessionKey: session.sessionKey,\n            message,\n"}}
{"timestamp":"2026-02-07T07:57:29.589Z","type":"turn_context","payload":{"cwd":"/home/ldr-cavetroll/tinker/openclaw","approval_policy":"on-request","sandbox_policy":{"type":"workspace-write","network_access":false,"exclude_tmpdir_env_var":false,"exclude_slash_tmp":false},"model":"gpt-5.2-codex","personality":"pragmatic","collaboration_mode":{"mode":"default","settings":{"model":"gpt-5.2-codex","reasoning_effort":null,"developer_instructions":"# Collaboration Mode: Default\n\nYou are now in Default mode. Any previous instructions for other modes (e.g. Plan mode) are no longer active.\n\nYour active mode changes only when new developer instructions with a different `<collaboration_mode>...</collaboration_mode>` change it; user requests or tool descriptions do not change mode by themselves. Known mode names are Default and Plan.\n\n## request_user_input availability\n\nThe `request_user_input` tool is unavailable in Default mode. If you call it while in Default mode, it will return an error.\n\nIf a decision is necessary and cannot be discovered from local context, ask the user directly. However, in Default mode you should strongly prefer executing the user's request rather than stopping to ask questions.\n"}},"summary":"auto","user_instructions":"# Repository Guidelines\n\n- Repo: https://github.com/openclaw/openclaw\n- GitHub issues/comments/PR comments: use literal multiline strings or `-F - <<'EOF'` (or $'...') for real newlines; never embed \"\\\\n\".\n\n## Project Structure & Module Organization\n\n- Source code: `src/` (CLI wiring in `src/cli`, commands in `src/commands`, web provider in `src/provider-web.ts`, infra in `src/infra`, media pipeline in `src/media`).\n- Tests: colocated `*.test.ts`.\n- Docs: `docs/` (images, queue, Pi config). Built output lives in `dist/`.\n- Plugins/extensions: live under `extensions/*` (workspace packages). Keep plugin-only deps in the extension `package.json`; do not add them to the root `package.json` unless core uses them.\n- Plugins: install runs `npm install --omit=dev` in plugin dir; runtime deps must live in `dependencies`. Avoid `workspace:*` in `dependencies` (npm install breaks); put `openclaw` in `devDependencies` or `peerDependencies` instead (runtime resolves `openclaw/plugin-sdk` via jiti alias).\n- Installers served from `https://openclaw.ai/*`: live in the sibling repo `../openclaw.ai` (`public/install.sh`, `public/install-cli.sh`, `public/install.ps1`).\n- Messaging channels: always consider **all** built-in + extension channels when refactoring shared logic (routing, allowlists, pairing, command gating, onboarding, docs).\n  - Core channel docs: `docs/channels/`\n  - Core channel code: `src/telegram`, `src/discord`, `src/slack`, `src/signal`, `src/imessage`, `src/web` (WhatsApp web), `src/channels`, `src/routing`\n  - Extensions (channel plugins): `extensions/*` (e.g. `extensions/msteams`, `extensions/matrix`, `extensions/zalo`, `extensions/zalouser`, `extensions/voice-call`)\n- When adding channels/extensions/apps/docs, review `.github/labeler.yml` for label coverage.\n\n## Docs Linking (Mintlify)\n\n- Docs are hosted on Mintlify (docs.openclaw.ai).\n- Internal doc links in `docs/**/*.md`: root-relative, no `.md`/`.mdx` (example: `[Config](/configuration)`).\n- Section cross-references: use anchors on root-relative paths (example: `[Hooks](/configuration#hooks)`).\n- Doc headings and anchors: avoid em dashes and apostrophes in headings because they break Mintlify anchor links.\n- When Peter asks for links, reply with full `https://docs.openclaw.ai/...` URLs (not root-relative).\n- When you touch docs, end the reply with the `https://docs.openclaw.ai/...` URLs you referenced.\n- README (GitHub): keep absolute docs URLs (`https://docs.openclaw.ai/...`) so links work on GitHub.\n- Docs content must be generic: no personal device names/hostnames/paths; use placeholders like `user@gateway-host` and “gateway host”.\n\n## Docs i18n (zh-CN)\n\n- `docs/zh-CN/**` is generated; do not edit unless the user explicitly asks.\n- Pipeline: update English docs → adjust glossary (`docs/.i18n/glossary.zh-CN.json`) → run `scripts/docs-i18n` → apply targeted fixes only if instructed.\n- Translation memory: `docs/.i18n/zh-CN.tm.jsonl` (generated).\n- See `docs/.i18n/README.md`.\n- The pipeline can be slow/inefficient; if it’s dragging, ping @jospalmbier on Discord instead of hacking around it.\n\n## exe.dev VM ops (general)\n\n- Access: stable path is `ssh exe.dev` then `ssh vm-name` (assume SSH key already set).\n- SSH flaky: use exe.dev web terminal or Shelley (web agent); keep a tmux session for long ops.\n- Update: `sudo npm i -g openclaw@latest` (global install needs root on `/usr/lib/node_modules`).\n- Config: use `openclaw config set ...`; ensure `gateway.mode=local` is set.\n- Discord: store raw token only (no `DISCORD_BOT_TOKEN=` prefix).\n- Restart: stop old gateway and run:\n  `pkill -9 -f openclaw-gateway || true; nohup openclaw gateway run --bind loopback --port 18789 --force > /tmp/openclaw-gateway.log 2>&1 &`\n- Verify: `openclaw channels status --probe`, `ss -ltnp | rg 18789`, `tail -n 120 /tmp/openclaw-gateway.log`.\n\n## Build, Test, and Development Commands\n\n- Runtime baseline: Node **22+** (keep Node + Bun paths working).\n- Install deps: `pnpm install`\n- Pre-commit hooks: `prek install` (runs same checks as CI)\n- Also supported: `bun install` (keep `pnpm-lock.yaml` + Bun patching in sync when touching deps/patches).\n- Prefer Bun for TypeScript execution (scripts, dev, tests): `bun <file.ts>` / `bunx <tool>`.\n- Run CLI in dev: `pnpm openclaw ...` (bun) or `pnpm dev`.\n- Node remains supported for running built output (`dist/*`) and production installs.\n- Mac packaging (dev): `scripts/package-mac-app.sh` defaults to current arch. Release checklist: `docs/platforms/mac/release.md`.\n- Type-check/build: `pnpm build`\n- TypeScript checks: `pnpm tsgo`\n- Lint/format: `pnpm check`\n- Tests: `pnpm test` (vitest); coverage: `pnpm test:coverage`\n\n## Coding Style & Naming Conventions\n\n- Language: TypeScript (ESM). Prefer strict typing; avoid `any`.\n- Formatting/linting via Oxlint and Oxfmt; run `pnpm check` before commits.\n- Add brief code comments for tricky or non-obvious logic.\n- Keep files concise; extract helpers instead of “V2” copies. Use existing patterns for CLI options and dependency injection via `createDefaultDeps`.\n- Aim to keep files under ~700 LOC; guideline only (not a hard guardrail). Split/refactor when it improves clarity or testability.\n- Naming: use **OpenClaw** for product/app/docs headings; use `openclaw` for CLI command, package/binary, paths, and config keys.\n\n## Release Channels (Naming)\n\n- stable: tagged releases only (e.g. `vYYYY.M.D`), npm dist-tag `latest`.\n- beta: prerelease tags `vYYYY.M.D-beta.N`, npm dist-tag `beta` (may ship without macOS app).\n- dev: moving head on `main` (no tag; git checkout main).\n\n## Testing Guidelines\n\n- Framework: Vitest with V8 coverage thresholds (70% lines/branches/functions/statements).\n- Naming: match source names with `*.test.ts`; e2e in `*.e2e.test.ts`.\n- Run `pnpm test` (or `pnpm test:coverage`) before pushing when you touch logic.\n- Do not set test workers above 16; tried already.\n- Live tests (real keys): `CLAWDBOT_LIVE_TEST=1 pnpm test:live` (OpenClaw-only) or `LIVE=1 pnpm test:live` (includes provider live tests). Docker: `pnpm test:docker:live-models`, `pnpm test:docker:live-gateway`. Onboarding Docker E2E: `pnpm test:docker:onboard`.\n- Full kit + what’s covered: `docs/testing.md`.\n- Pure test additions/fixes generally do **not** need a changelog entry unless they alter user-facing behavior or the user asks for one.\n- Mobile: before using a simulator, check for connected real devices (iOS + Android) and prefer them when available.\n\n## Commit & Pull Request Guidelines\n\n- Create commits with `scripts/committer \"<msg>\" <file...>`; avoid manual `git add`/`git commit` so staging stays scoped.\n- Follow concise, action-oriented commit messages (e.g., `CLI: add verbose flag to send`).\n- Group related changes; avoid bundling unrelated refactors.\n- Changelog workflow: keep latest released version at top (no `Unreleased`); after publishing, bump version and start a new top section.\n- PRs should summarize scope, note testing performed, and mention any user-facing changes or new flags.\n- Read this when submitting a PR: `docs/help/submitting-a-pr.md` ([Submitting a PR](https://docs.openclaw.ai/help/submitting-a-pr))\n- Read this when submitting an issue: `docs/help/submitting-an-issue.md` ([Submitting an Issue](https://docs.openclaw.ai/help/submitting-an-issue))\n- PR review flow: when given a PR link, review via `gh pr view`/`gh pr diff` and do **not** change branches.\n- PR review calls: prefer a single `gh pr view --json ...` to batch metadata/comments; run `gh pr diff` only when needed.\n- Before starting a review when a GH Issue/PR is pasted: run `git pull`; if there are local changes or unpushed commits, stop and alert the user before reviewing.\n- Goal: merge PRs. Prefer **rebase** when commits are clean; **squash** when history is messy.\n- PR merge flow: create a temp branch from `main`, merge the PR branch into it (prefer squash unless commit history is important; use rebase/merge when it is). Always try to merge the PR unless it’s truly difficult, then use another approach. If we squash, add the PR author as a co-contributor. Apply fixes, add changelog entry (include PR # + thanks), run full gate before the final commit, commit, merge back to `main`, delete the temp branch, and end on `main`.\n- If you review a PR and later do work on it, land via merge/squash (no direct-main commits) and always add the PR author as a co-contributor.\n- When working on a PR: add a changelog entry with the PR number and thank the contributor.\n- When working on an issue: reference the issue in the changelog entry.\n- When merging a PR: leave a PR comment that explains exactly what we did and include the SHA hashes.\n- When merging a PR from a new contributor: add their avatar to the README “Thanks to all clawtributors” thumbnail list.\n- After merging a PR: run `bun scripts/update-clawtributors.ts` if the contributor is missing, then commit the regenerated README.\n\n## Shorthand Commands\n\n- `sync`: if working tree is dirty, commit all changes (pick a sensible Conventional Commit message), then `git pull --rebase`; if rebase conflicts and cannot resolve, stop; otherwise `git push`.\n\n### PR Workflow (Review vs Land)\n\n- **Review mode (PR link only):** read `gh pr view/diff`; **do not** switch branches; **do not** change code.\n- **Landing mode:** create an integration branch from `main`, bring in PR commits (**prefer rebase** for linear history; **merge allowed** when complexity/conflicts make it safer), apply fixes, add changelog (+ thanks + PR #), run full gate **locally before committing** (`pnpm build && pnpm check && pnpm test`), commit, merge back to `main`, then `git switch main` (never stay on a topic branch after landing). Important: contributor needs to be in git graph after this!\n\n## Security & Configuration Tips\n\n- Web provider stores creds at `~/.openclaw/credentials/`; rerun `openclaw login` if logged out.\n- Pi sessions live under `~/.openclaw/sessions/` by default; the base directory is not configurable.\n- Environment variables: see `~/.profile`.\n- Never commit or publish real phone numbers, videos, or live configuration values. Use obviously fake placeholders in docs, tests, and examples.\n- Release flow: always read `docs/reference/RELEASING.md` and `docs/platforms/mac/release.md` before any release work; do not ask routine questions once those docs answer them.\n\n## Troubleshooting\n\n- Rebrand/migration issues or legacy config/service warnings: run `openclaw doctor` (see `docs/gateway/doctor.md`).\n\n## Agent-Specific Notes\n\n- Vocabulary: \"makeup\" = \"mac app\".\n- Never edit `node_modules` (global/Homebrew/npm/git installs too). Updates overwrite. Skill notes go in `tools.md` or `AGENTS.md`.\n- Signal: \"update fly\" => `fly ssh console -a flawd-bot -C \"bash -lc 'cd /data/clawd/openclaw && git pull --rebase origin main'\"` then `fly machines restart e825232f34d058 -a flawd-bot`.\n- When working on a GitHub Issue or PR, print the full URL at the end of the task.\n- When answering questions, respond with high-confidence answers only: verify in code; do not guess.\n- Never update the Carbon dependency.\n- Any dependency with `pnpm.patchedDependencies` must use an exact version (no `^`/`~`).\n- Patching dependencies (pnpm patches, overrides, or vendored changes) requires explicit approval; do not do this by default.\n- CLI progress: use `src/cli/progress.ts` (`osc-progress` + `@clack/prompts` spinner); don’t hand-roll spinners/bars.\n- Status output: keep tables + ANSI-safe wrapping (`src/terminal/table.ts`); `status --all` = read-only/pasteable, `status --deep` = probes.\n- Gateway currently runs only as the menubar app; there is no separate LaunchAgent/helper label installed. Restart via the OpenClaw Mac app or `scripts/restart-mac.sh`; to verify/kill use `launchctl print gui/$UID | grep openclaw` rather than assuming a fixed label. **When debugging on macOS, start/stop the gateway via the app, not ad-hoc tmux sessions; kill any temporary tunnels before handoff.**\n- macOS logs: use `./scripts/clawlog.sh` to query unified logs for the OpenClaw subsystem; it supports follow/tail/category filters and expects passwordless sudo for `/usr/bin/log`.\n- If shared guardrails are available locally, review them; otherwise follow this repo's guidance.\n- SwiftUI state management (iOS/macOS): prefer the `Observation` framework (`@Observable`, `@Bindable`) over `ObservableObject`/`@StateObject`; don’t introduce new `ObservableObject` unless required for compatibility, and migrate existing usages when touching related code.\n- Connection providers: when adding a new connection, update every UI surface and docs (macOS app, web UI, mobile if applicable, onboarding/overview docs) and add matching status + configuration forms so provider lists and settings stay in sync.\n- Version locations: `package.json` (CLI), `apps/android/app/build.gradle.kts` (versionName/versionCode), `apps/ios/Sources/Info.plist` + `apps/ios/Tests/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `apps/macos/Sources/OpenClaw/Resources/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `docs/install/updating.md` (pinned npm version), `docs/platforms/mac/release.md` (APP_VERSION/APP_BUILD examples), Peekaboo Xcode projects/Info.plists (MARKETING_VERSION/CURRENT_PROJECT_VERSION).\n- **Restart apps:** “restart iOS/Android apps” means rebuild (recompile/install) and relaunch, not just kill/launch.\n- **Device checks:** before testing, verify connected real devices (iOS/Android) before reaching for simulators/emulators.\n- iOS Team ID lookup: `security find-identity -p codesigning -v` → use Apple Development (…) TEAMID. Fallback: `defaults read com.apple.dt.Xcode IDEProvisioningTeamIdentifiers`.\n- A2UI bundle hash: `src/canvas-host/a2ui/.bundle.hash` is auto-generated; ignore unexpected changes, and only regenerate via `pnpm canvas:a2ui:bundle` (or `scripts/bundle-a2ui.sh`) when needed. Commit the hash as a separate commit.\n- Release signing/notary keys are managed outside the repo; follow internal release docs.\n- Notary auth env vars (`APP_STORE_CONNECT_ISSUER_ID`, `APP_STORE_CONNECT_KEY_ID`, `APP_STORE_CONNECT_API_KEY_P8`) are expected in your environment (per internal release docs).\n- **Multi-agent safety:** do **not** create/apply/drop `git stash` entries unless explicitly requested (this includes `git pull --rebase --autostash`). Assume other agents may be working; keep unrelated WIP untouched and avoid cross-cutting state changes.\n- **Multi-agent safety:** when the user says \"push\", you may `git pull --rebase` to integrate latest changes (never discard other agents' work). When the user says \"commit\", scope to your changes only. When the user says \"commit all\", commit everything in grouped chunks.\n- **Multi-agent safety:** do **not** create/remove/modify `git worktree` checkouts (or edit `.worktrees/*`) unless explicitly requested.\n- **Multi-agent safety:** do **not** switch branches / check out a different branch unless explicitly requested.\n- **Multi-agent safety:** running multiple agents is OK as long as each agent has its own session.\n- **Multi-agent safety:** when you see unrecognized files, keep going; focus on your changes and commit only those.\n- Lint/format churn:\n  - If staged+unstaged diffs are formatting-only, auto-resolve without asking.\n  - If commit/push already requested, auto-stage and include formatting-only follow-ups in the same commit (or a tiny follow-up commit if needed), no extra confirmation.\n  - Only ask when changes are semantic (logic/data/behavior).\n- Lobster seam: use the shared CLI palette in `src/terminal/palette.ts` (no hardcoded colors); apply palette to onboarding/config prompts and other TTY UI output as needed.\n- **Multi-agent safety:** focus reports on your edits; avoid guard-rail disclaimers unless truly blocked; when multiple agents touch the same file, continue if safe; end with a brief “other files present” note only if relevant.\n- Bug investigations: read source code of relevant npm dependencies and all related local code before concluding; aim for high-confidence root cause.\n- Code style: add brief comments for tricky logic; keep files under ~500 LOC when feasible (split/refactor as needed).\n- Tool schema guardrails (google-antigravity): avoid `Type.Union` in tool input schemas; no `anyOf`/`oneOf`/`allOf`. Use `stringEnum`/`optionalStringEnum` (Type.Unsafe enum) for string lists, and `Type.Optional(...)` instead of `... | null`. Keep top-level tool schema as `type: \"object\"` with `properties`.\n- Tool schema guardrails: avoid raw `format` property names in tool schemas; some validators treat `format` as a reserved keyword and reject the schema.\n- When asked to open a “session” file, open the Pi session logs under `~/.openclaw/agents/<agentId>/sessions/*.jsonl` (use the `agent=<id>` value in the Runtime line of the system prompt; newest unless a specific ID is given), not the default `sessions.json`. If logs are needed from another machine, SSH via Tailscale and read the same path there.\n- Do not rebuild the macOS app over SSH; rebuilds must be run directly on the Mac.\n- Never send streaming/partial replies to external messaging surfaces (WhatsApp, Telegram); only final replies should be delivered there. Streaming/tool events may still go to internal UIs/control channel.\n- Voice wake forwarding tips:\n  - Command template should stay `openclaw-mac agent --message \"${text}\" --thinking low`; `VoiceWakeForwarder` already shell-escapes `${text}`. Don’t add extra quotes.\n  - launchd PATH is minimal; ensure the app’s launch agent PATH includes standard system paths plus your pnpm bin (typically `$HOME/Library/pnpm`) so `pnpm`/`openclaw` binaries resolve when invoked via `openclaw-mac`.\n- For manual `openclaw message send` messages that include `!`, use the heredoc pattern noted below to avoid the Bash tool’s escaping.\n- Release guardrails: do not change version numbers without operator’s explicit consent; always ask permission before running any npm publish/release step.\n\n## NPM + 1Password (publish/verify)\n\n- Use the 1password skill; all `op` commands must run inside a fresh tmux session.\n- Sign in: `eval \"$(op signin --account my.1password.com)\"` (app unlocked + integration on).\n- OTP: `op read 'op://Private/Npmjs/one-time password?attribute=otp'`.\n- Publish: `npm publish --access public --otp=\"<otp>\"` (run from the package dir).\n- Verify without local npmrc side effects: `npm view <pkg> version --userconfig \"$(mktemp)\"`.\n- Kill the tmux session after publish.\n\n\n## Skills\nA skill is a set of local instructions to follow that is stored in a `SKILL.md` file. Below is the list of skills that can be used. Each entry includes a name, description, and file path so you can open the source for full instructions when using a specific skill.\n### Available skills\n- merge-pr: Merge a GitHub PR via squash after /preparepr. Use when asked to merge a ready PR. Do not push to main or modify code. Ensure the PR ends in MERGED state and clean up worktrees after success. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/merge-pr/SKILL.md)\n- prepare-pr: Prepare a GitHub PR for merge by rebasing onto main, fixing review findings, running gates, committing fixes, and pushing to the PR head branch. Use after /reviewpr. Never merge or push to main. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/prepare-pr/SKILL.md)\n- review-pr: Review-only GitHub pull request analysis with the gh CLI. Use when asked to review a PR, provide structured feedback, or assess readiness to land. Do not merge, push, or make code changes you intend to keep. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/review-pr/SKILL.md)\n- figma: Use the Figma MCP server to fetch design context, screenshots, variables, and assets from Figma, and to translate Figma nodes into production code. Trigger when a task involves Figma URLs, node IDs, design-to-code implementation, or Figma MCP setup and troubleshooting. (file: /home/ldr-cavetroll/.codex/skills/figma/SKILL.md)\n- skill-creator: Guide for creating effective skills. This skill should be used when users want to create a new skill (or update an existing skill) that extends Codex's capabilities with specialized knowledge, workflows, or tool integrations. (file: /home/ldr-cavetroll/.codex/skills/.system/skill-creator/SKILL.md)\n- skill-installer: Install Codex skills into $CODEX_HOME/skills from a curated list or a GitHub repo path. Use when a user asks to list installable skills, install a curated skill, or install a skill from another repo (including private repos). (file: /home/ldr-cavetroll/.codex/skills/.system/skill-installer/SKILL.md)\n### How to use skills\n- Discovery: The list above is the skills available in this session (name + description + file path). Skill bodies live on disk at the listed paths.\n- Trigger rules: If the user names a skill (with `$SkillName` or plain text) OR the task clearly matches a skill's description shown above, you must use that skill for that turn. Multiple mentions mean use them all. Do not carry skills across turns unless re-mentioned.\n- Missing/blocked: If a named skill isn't in the list or the path can't be read, say so briefly and continue with the best fallback.\n- How to use a skill (progressive disclosure):\n  1) After deciding to use a skill, open its `SKILL.md`. Read only enough to follow the workflow.\n  2) When `SKILL.md` references relative paths (e.g., `scripts/foo.py`), resolve them relative to the skill directory listed above first, and only consider other paths if needed.\n  3) If `SKILL.md` points to extra folders such as `references/`, load only the specific files needed for the request; don't bulk-load everything.\n  4) If `scripts/` exist, prefer running or patching them instead of retyping large code blocks.\n  5) If `assets/` or templates exist, reuse them instead of recreating from scratch.\n- Coordination and sequencing:\n  - If multiple skills apply, choose the minimal set that covers the request and state the order you'll use them.\n  - Announce which skill(s) you're using and why (one short line). If you skip an obvious skill, say why.\n- Context hygiene:\n  - Keep context small: summarize long sections instead of pasting them; only load extra files when needed.\n  - Avoid deep reference-chasing: prefer opening only files directly linked from `SKILL.md` unless you're blocked.\n  - When variants exist (frameworks, providers, domains), pick only the relevant reference file(s) and note that choice.\n- Safety and fallback: If a skill can't be applied cleanly (missing files, unclear instructions), state the issue, pick the next-best approach, and continue.","truncation_policy":{"mode":"tokens","limit":10000}}}
{"timestamp":"2026-02-07T07:57:29.993Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":119871,"cached_input_tokens":88320,"output_tokens":302,"reasoning_output_tokens":0,"total_tokens":120173},"last_token_usage":{"input_tokens":21823,"cached_input_tokens":20608,"output_tokens":53,"reasoning_output_tokens":0,"total_tokens":21876},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":1.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":8.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T07:57:31.420Z","type":"response_item","payload":{"type":"function_call","name":"exec_command","arguments":"{\"cmd\":\"sed -n '260,640p' src/acp/translator.ts\"}","call_id":"call_JfkR0RlbErcsU8X57aKE9OAe"}}
{"timestamp":"2026-02-07T07:57:31.450Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":143559,"cached_input_tokens":110080,"output_tokens":334,"reasoning_output_tokens":0,"total_tokens":143893},"last_token_usage":{"input_tokens":23688,"cached_input_tokens":21760,"output_tokens":32,"reasoning_output_tokens":0,"total_tokens":23720},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":1.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":8.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T07:57:31.504Z","type":"response_item","payload":{"type":"function_call_output","call_id":"call_JfkR0RlbErcsU8X57aKE9OAe","output":"Chunk ID: 5796c0\nWall time: 0.0505 seconds\nProcess exited with code 0\nOriginal token count: 1430\nOutput:\n            message,\n            attachments: attachments.length > 0 ? attachments : undefined,\n            idempotencyKey: runId,\n            thinking: readString(params._meta, [\"thinking\", \"thinkingLevel\"]),\n            deliver: readBool(params._meta, [\"deliver\"]),\n            timeoutMs: readNumber(params._meta, [\"timeoutMs\"]),\n          },\n          { expectFinal: true },\n        )\n        .catch((err) => {\n          this.pendingPrompts.delete(params.sessionId);\n          this.sessionStore.clearActiveRun(params.sessionId);\n          reject(err instanceof Error ? err : new Error(String(err)));\n        });\n    });\n  }\n\n  async cancel(params: CancelNotification): Promise<void> {\n    const session = this.sessionStore.getSession(params.sessionId);\n    if (!session) {\n      return;\n    }\n\n    this.sessionStore.cancelActiveRun(params.sessionId);\n    try {\n      await this.gateway.request(\"chat.abort\", { sessionKey: session.sessionKey });\n    } catch (err) {\n      this.log(`cancel error: ${String(err)}`);\n    }\n\n    const pending = this.pendingPrompts.get(params.sessionId);\n    if (pending) {\n      this.pendingPrompts.delete(params.sessionId);\n      pending.resolve({ stopReason: \"cancelled\" });\n    }\n  }\n\n  private async handleAgentEvent(evt: EventFrame): Promise<void> {\n    const payload = evt.payload as Record<string, unknown> | undefined;\n    if (!payload) {\n      return;\n    }\n    const stream = payload.stream as string | undefined;\n    const data = payload.data as Record<string, unknown> | undefined;\n    const sessionKey = payload.sessionKey as string | undefined;\n    if (!stream || !data || !sessionKey) {\n      return;\n    }\n\n    if (stream !== \"tool\") {\n      return;\n    }\n    const phase = data.phase as string | undefined;\n    const name = data.name as string | undefined;\n    const toolCallId = data.toolCallId as string | undefined;\n    if (!toolCallId) {\n      return;\n    }\n\n    const pending = this.findPendingBySessionKey(sessionKey);\n    if (!pending) {\n      return;\n    }\n\n    if (phase === \"start\") {\n      if (!pending.toolCalls) {\n        pending.toolCalls = new Set();\n      }\n      if (pending.toolCalls.has(toolCallId)) {\n        return;\n      }\n      pending.toolCalls.add(toolCallId);\n      const args = data.args as Record<string, unknown> | undefined;\n      await this.connection.sessionUpdate({\n        sessionId: pending.sessionId,\n        update: {\n          sessionUpdate: \"tool_call\",\n          toolCallId,\n          title: formatToolTitle(name, args),\n          status: \"in_progress\",\n          rawInput: args,\n          kind: inferToolKind(name),\n        },\n      });\n      return;\n    }\n\n    if (phase === \"result\") {\n      const isError = Boolean(data.isError);\n      await this.connection.sessionUpdate({\n        sessionId: pending.sessionId,\n        update: {\n          sessionUpdate: \"tool_call_update\",\n          toolCallId,\n          status: isError ? \"failed\" : \"completed\",\n          rawOutput: data.result,\n        },\n      });\n    }\n  }\n\n  private async handleChatEvent(evt: EventFrame): Promise<void> {\n    const payload = evt.payload as Record<string, unknown> | undefined;\n    if (!payload) {\n      return;\n    }\n\n    const sessionKey = payload.sessionKey as string | undefined;\n    const state = payload.state as string | undefined;\n    const runId = payload.runId as string | undefined;\n    const messageData = payload.message as Record<string, unknown> | undefined;\n    if (!sessionKey || !state) {\n      return;\n    }\n\n    const pending = this.findPendingBySessionKey(sessionKey);\n    if (!pending) {\n      return;\n    }\n    if (runId && pending.idempotencyKey !== runId) {\n      return;\n    }\n\n    if (state === \"delta\" && messageData) {\n      await this.handleDeltaEvent(pending.sessionId, messageData);\n      return;\n    }\n\n    if (state === \"final\") {\n      this.finishPrompt(pending.sessionId, pending, \"end_turn\");\n      return;\n    }\n    if (state === \"aborted\") {\n      this.finishPrompt(pending.sessionId, pending, \"cancelled\");\n      return;\n    }\n    if (state === \"error\") {\n      this.finishPrompt(pending.sessionId, pending, \"refusal\");\n    }\n  }\n\n  private async handleDeltaEvent(\n    sessionId: string,\n    messageData: Record<string, unknown>,\n  ): Promise<void> {\n    const content = messageData.content as Array<{ type: string; text?: string }> | undefined;\n    const fullText = content?.find((c) => c.type === \"text\")?.text ?? \"\";\n    const pending = this.pendingPrompts.get(sessionId);\n    if (!pending) {\n      return;\n    }\n\n    const sentSoFar = pending.sentTextLength ?? 0;\n    if (fullText.length <= sentSoFar) {\n      return;\n    }\n\n    const newText = fullText.slice(sentSoFar);\n    pending.sentTextLength = fullText.length;\n    pending.sentText = fullText;\n\n    await this.connection.sessionUpdate({\n      sessionId,\n      update: {\n        sessionUpdate: \"agent_message_chunk\",\n        content: { type: \"text\", text: newText },\n      },\n    });\n  }\n\n  private finishPrompt(sessionId: string, pending: PendingPrompt, stopReason: StopReason): void {\n    this.pendingPrompts.delete(sessionId);\n    this.sessionStore.clearActiveRun(sessionId);\n    pending.resolve({ stopReason });\n  }\n\n  private findPendingBySessionKey(sessionKey: string): PendingPrompt | undefined {\n    for (const pending of this.pendingPrompts.values()) {\n      if (pending.sessionKey === sessionKey) {\n        return pending;\n      }\n    }\n    return undefined;\n  }\n\n  private async sendAvailableCommands(sessionId: string): Promise<void> {\n    await this.connection.sessionUpdate({\n      sessionId,\n      update: {\n        sessionUpdate: \"available_commands_update\",\n        availableCommands: getAvailableCommands(),\n      },\n    });\n  }\n}\n"}}
{"timestamp":"2026-02-07T07:57:31.527Z","type":"turn_context","payload":{"cwd":"/home/ldr-cavetroll/tinker/openclaw","approval_policy":"on-request","sandbox_policy":{"type":"workspace-write","network_access":false,"exclude_tmpdir_env_var":false,"exclude_slash_tmp":false},"model":"gpt-5.2-codex","personality":"pragmatic","collaboration_mode":{"mode":"default","settings":{"model":"gpt-5.2-codex","reasoning_effort":null,"developer_instructions":"# Collaboration Mode: Default\n\nYou are now in Default mode. Any previous instructions for other modes (e.g. Plan mode) are no longer active.\n\nYour active mode changes only when new developer instructions with a different `<collaboration_mode>...</collaboration_mode>` change it; user requests or tool descriptions do not change mode by themselves. Known mode names are Default and Plan.\n\n## request_user_input availability\n\nThe `request_user_input` tool is unavailable in Default mode. If you call it while in Default mode, it will return an error.\n\nIf a decision is necessary and cannot be discovered from local context, ask the user directly. However, in Default mode you should strongly prefer executing the user's request rather than stopping to ask questions.\n"}},"summary":"auto","user_instructions":"# Repository Guidelines\n\n- Repo: https://github.com/openclaw/openclaw\n- GitHub issues/comments/PR comments: use literal multiline strings or `-F - <<'EOF'` (or $'...') for real newlines; never embed \"\\\\n\".\n\n## Project Structure & Module Organization\n\n- Source code: `src/` (CLI wiring in `src/cli`, commands in `src/commands`, web provider in `src/provider-web.ts`, infra in `src/infra`, media pipeline in `src/media`).\n- Tests: colocated `*.test.ts`.\n- Docs: `docs/` (images, queue, Pi config). Built output lives in `dist/`.\n- Plugins/extensions: live under `extensions/*` (workspace packages). Keep plugin-only deps in the extension `package.json`; do not add them to the root `package.json` unless core uses them.\n- Plugins: install runs `npm install --omit=dev` in plugin dir; runtime deps must live in `dependencies`. Avoid `workspace:*` in `dependencies` (npm install breaks); put `openclaw` in `devDependencies` or `peerDependencies` instead (runtime resolves `openclaw/plugin-sdk` via jiti alias).\n- Installers served from `https://openclaw.ai/*`: live in the sibling repo `../openclaw.ai` (`public/install.sh`, `public/install-cli.sh`, `public/install.ps1`).\n- Messaging channels: always consider **all** built-in + extension channels when refactoring shared logic (routing, allowlists, pairing, command gating, onboarding, docs).\n  - Core channel docs: `docs/channels/`\n  - Core channel code: `src/telegram`, `src/discord`, `src/slack`, `src/signal`, `src/imessage`, `src/web` (WhatsApp web), `src/channels`, `src/routing`\n  - Extensions (channel plugins): `extensions/*` (e.g. `extensions/msteams`, `extensions/matrix`, `extensions/zalo`, `extensions/zalouser`, `extensions/voice-call`)\n- When adding channels/extensions/apps/docs, review `.github/labeler.yml` for label coverage.\n\n## Docs Linking (Mintlify)\n\n- Docs are hosted on Mintlify (docs.openclaw.ai).\n- Internal doc links in `docs/**/*.md`: root-relative, no `.md`/`.mdx` (example: `[Config](/configuration)`).\n- Section cross-references: use anchors on root-relative paths (example: `[Hooks](/configuration#hooks)`).\n- Doc headings and anchors: avoid em dashes and apostrophes in headings because they break Mintlify anchor links.\n- When Peter asks for links, reply with full `https://docs.openclaw.ai/...` URLs (not root-relative).\n- When you touch docs, end the reply with the `https://docs.openclaw.ai/...` URLs you referenced.\n- README (GitHub): keep absolute docs URLs (`https://docs.openclaw.ai/...`) so links work on GitHub.\n- Docs content must be generic: no personal device names/hostnames/paths; use placeholders like `user@gateway-host` and “gateway host”.\n\n## Docs i18n (zh-CN)\n\n- `docs/zh-CN/**` is generated; do not edit unless the user explicitly asks.\n- Pipeline: update English docs → adjust glossary (`docs/.i18n/glossary.zh-CN.json`) → run `scripts/docs-i18n` → apply targeted fixes only if instructed.\n- Translation memory: `docs/.i18n/zh-CN.tm.jsonl` (generated).\n- See `docs/.i18n/README.md`.\n- The pipeline can be slow/inefficient; if it’s dragging, ping @jospalmbier on Discord instead of hacking around it.\n\n## exe.dev VM ops (general)\n\n- Access: stable path is `ssh exe.dev` then `ssh vm-name` (assume SSH key already set).\n- SSH flaky: use exe.dev web terminal or Shelley (web agent); keep a tmux session for long ops.\n- Update: `sudo npm i -g openclaw@latest` (global install needs root on `/usr/lib/node_modules`).\n- Config: use `openclaw config set ...`; ensure `gateway.mode=local` is set.\n- Discord: store raw token only (no `DISCORD_BOT_TOKEN=` prefix).\n- Restart: stop old gateway and run:\n  `pkill -9 -f openclaw-gateway || true; nohup openclaw gateway run --bind loopback --port 18789 --force > /tmp/openclaw-gateway.log 2>&1 &`\n- Verify: `openclaw channels status --probe`, `ss -ltnp | rg 18789`, `tail -n 120 /tmp/openclaw-gateway.log`.\n\n## Build, Test, and Development Commands\n\n- Runtime baseline: Node **22+** (keep Node + Bun paths working).\n- Install deps: `pnpm install`\n- Pre-commit hooks: `prek install` (runs same checks as CI)\n- Also supported: `bun install` (keep `pnpm-lock.yaml` + Bun patching in sync when touching deps/patches).\n- Prefer Bun for TypeScript execution (scripts, dev, tests): `bun <file.ts>` / `bunx <tool>`.\n- Run CLI in dev: `pnpm openclaw ...` (bun) or `pnpm dev`.\n- Node remains supported for running built output (`dist/*`) and production installs.\n- Mac packaging (dev): `scripts/package-mac-app.sh` defaults to current arch. Release checklist: `docs/platforms/mac/release.md`.\n- Type-check/build: `pnpm build`\n- TypeScript checks: `pnpm tsgo`\n- Lint/format: `pnpm check`\n- Tests: `pnpm test` (vitest); coverage: `pnpm test:coverage`\n\n## Coding Style & Naming Conventions\n\n- Language: TypeScript (ESM). Prefer strict typing; avoid `any`.\n- Formatting/linting via Oxlint and Oxfmt; run `pnpm check` before commits.\n- Add brief code comments for tricky or non-obvious logic.\n- Keep files concise; extract helpers instead of “V2” copies. Use existing patterns for CLI options and dependency injection via `createDefaultDeps`.\n- Aim to keep files under ~700 LOC; guideline only (not a hard guardrail). Split/refactor when it improves clarity or testability.\n- Naming: use **OpenClaw** for product/app/docs headings; use `openclaw` for CLI command, package/binary, paths, and config keys.\n\n## Release Channels (Naming)\n\n- stable: tagged releases only (e.g. `vYYYY.M.D`), npm dist-tag `latest`.\n- beta: prerelease tags `vYYYY.M.D-beta.N`, npm dist-tag `beta` (may ship without macOS app).\n- dev: moving head on `main` (no tag; git checkout main).\n\n## Testing Guidelines\n\n- Framework: Vitest with V8 coverage thresholds (70% lines/branches/functions/statements).\n- Naming: match source names with `*.test.ts`; e2e in `*.e2e.test.ts`.\n- Run `pnpm test` (or `pnpm test:coverage`) before pushing when you touch logic.\n- Do not set test workers above 16; tried already.\n- Live tests (real keys): `CLAWDBOT_LIVE_TEST=1 pnpm test:live` (OpenClaw-only) or `LIVE=1 pnpm test:live` (includes provider live tests). Docker: `pnpm test:docker:live-models`, `pnpm test:docker:live-gateway`. Onboarding Docker E2E: `pnpm test:docker:onboard`.\n- Full kit + what’s covered: `docs/testing.md`.\n- Pure test additions/fixes generally do **not** need a changelog entry unless they alter user-facing behavior or the user asks for one.\n- Mobile: before using a simulator, check for connected real devices (iOS + Android) and prefer them when available.\n\n## Commit & Pull Request Guidelines\n\n- Create commits with `scripts/committer \"<msg>\" <file...>`; avoid manual `git add`/`git commit` so staging stays scoped.\n- Follow concise, action-oriented commit messages (e.g., `CLI: add verbose flag to send`).\n- Group related changes; avoid bundling unrelated refactors.\n- Changelog workflow: keep latest released version at top (no `Unreleased`); after publishing, bump version and start a new top section.\n- PRs should summarize scope, note testing performed, and mention any user-facing changes or new flags.\n- Read this when submitting a PR: `docs/help/submitting-a-pr.md` ([Submitting a PR](https://docs.openclaw.ai/help/submitting-a-pr))\n- Read this when submitting an issue: `docs/help/submitting-an-issue.md` ([Submitting an Issue](https://docs.openclaw.ai/help/submitting-an-issue))\n- PR review flow: when given a PR link, review via `gh pr view`/`gh pr diff` and do **not** change branches.\n- PR review calls: prefer a single `gh pr view --json ...` to batch metadata/comments; run `gh pr diff` only when needed.\n- Before starting a review when a GH Issue/PR is pasted: run `git pull`; if there are local changes or unpushed commits, stop and alert the user before reviewing.\n- Goal: merge PRs. Prefer **rebase** when commits are clean; **squash** when history is messy.\n- PR merge flow: create a temp branch from `main`, merge the PR branch into it (prefer squash unless commit history is important; use rebase/merge when it is). Always try to merge the PR unless it’s truly difficult, then use another approach. If we squash, add the PR author as a co-contributor. Apply fixes, add changelog entry (include PR # + thanks), run full gate before the final commit, commit, merge back to `main`, delete the temp branch, and end on `main`.\n- If you review a PR and later do work on it, land via merge/squash (no direct-main commits) and always add the PR author as a co-contributor.\n- When working on a PR: add a changelog entry with the PR number and thank the contributor.\n- When working on an issue: reference the issue in the changelog entry.\n- When merging a PR: leave a PR comment that explains exactly what we did and include the SHA hashes.\n- When merging a PR from a new contributor: add their avatar to the README “Thanks to all clawtributors” thumbnail list.\n- After merging a PR: run `bun scripts/update-clawtributors.ts` if the contributor is missing, then commit the regenerated README.\n\n## Shorthand Commands\n\n- `sync`: if working tree is dirty, commit all changes (pick a sensible Conventional Commit message), then `git pull --rebase`; if rebase conflicts and cannot resolve, stop; otherwise `git push`.\n\n### PR Workflow (Review vs Land)\n\n- **Review mode (PR link only):** read `gh pr view/diff`; **do not** switch branches; **do not** change code.\n- **Landing mode:** create an integration branch from `main`, bring in PR commits (**prefer rebase** for linear history; **merge allowed** when complexity/conflicts make it safer), apply fixes, add changelog (+ thanks + PR #), run full gate **locally before committing** (`pnpm build && pnpm check && pnpm test`), commit, merge back to `main`, then `git switch main` (never stay on a topic branch after landing). Important: contributor needs to be in git graph after this!\n\n## Security & Configuration Tips\n\n- Web provider stores creds at `~/.openclaw/credentials/`; rerun `openclaw login` if logged out.\n- Pi sessions live under `~/.openclaw/sessions/` by default; the base directory is not configurable.\n- Environment variables: see `~/.profile`.\n- Never commit or publish real phone numbers, videos, or live configuration values. Use obviously fake placeholders in docs, tests, and examples.\n- Release flow: always read `docs/reference/RELEASING.md` and `docs/platforms/mac/release.md` before any release work; do not ask routine questions once those docs answer them.\n\n## Troubleshooting\n\n- Rebrand/migration issues or legacy config/service warnings: run `openclaw doctor` (see `docs/gateway/doctor.md`).\n\n## Agent-Specific Notes\n\n- Vocabulary: \"makeup\" = \"mac app\".\n- Never edit `node_modules` (global/Homebrew/npm/git installs too). Updates overwrite. Skill notes go in `tools.md` or `AGENTS.md`.\n- Signal: \"update fly\" => `fly ssh console -a flawd-bot -C \"bash -lc 'cd /data/clawd/openclaw && git pull --rebase origin main'\"` then `fly machines restart e825232f34d058 -a flawd-bot`.\n- When working on a GitHub Issue or PR, print the full URL at the end of the task.\n- When answering questions, respond with high-confidence answers only: verify in code; do not guess.\n- Never update the Carbon dependency.\n- Any dependency with `pnpm.patchedDependencies` must use an exact version (no `^`/`~`).\n- Patching dependencies (pnpm patches, overrides, or vendored changes) requires explicit approval; do not do this by default.\n- CLI progress: use `src/cli/progress.ts` (`osc-progress` + `@clack/prompts` spinner); don’t hand-roll spinners/bars.\n- Status output: keep tables + ANSI-safe wrapping (`src/terminal/table.ts`); `status --all` = read-only/pasteable, `status --deep` = probes.\n- Gateway currently runs only as the menubar app; there is no separate LaunchAgent/helper label installed. Restart via the OpenClaw Mac app or `scripts/restart-mac.sh`; to verify/kill use `launchctl print gui/$UID | grep openclaw` rather than assuming a fixed label. **When debugging on macOS, start/stop the gateway via the app, not ad-hoc tmux sessions; kill any temporary tunnels before handoff.**\n- macOS logs: use `./scripts/clawlog.sh` to query unified logs for the OpenClaw subsystem; it supports follow/tail/category filters and expects passwordless sudo for `/usr/bin/log`.\n- If shared guardrails are available locally, review them; otherwise follow this repo's guidance.\n- SwiftUI state management (iOS/macOS): prefer the `Observation` framework (`@Observable`, `@Bindable`) over `ObservableObject`/`@StateObject`; don’t introduce new `ObservableObject` unless required for compatibility, and migrate existing usages when touching related code.\n- Connection providers: when adding a new connection, update every UI surface and docs (macOS app, web UI, mobile if applicable, onboarding/overview docs) and add matching status + configuration forms so provider lists and settings stay in sync.\n- Version locations: `package.json` (CLI), `apps/android/app/build.gradle.kts` (versionName/versionCode), `apps/ios/Sources/Info.plist` + `apps/ios/Tests/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `apps/macos/Sources/OpenClaw/Resources/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `docs/install/updating.md` (pinned npm version), `docs/platforms/mac/release.md` (APP_VERSION/APP_BUILD examples), Peekaboo Xcode projects/Info.plists (MARKETING_VERSION/CURRENT_PROJECT_VERSION).\n- **Restart apps:** “restart iOS/Android apps” means rebuild (recompile/install) and relaunch, not just kill/launch.\n- **Device checks:** before testing, verify connected real devices (iOS/Android) before reaching for simulators/emulators.\n- iOS Team ID lookup: `security find-identity -p codesigning -v` → use Apple Development (…) TEAMID. Fallback: `defaults read com.apple.dt.Xcode IDEProvisioningTeamIdentifiers`.\n- A2UI bundle hash: `src/canvas-host/a2ui/.bundle.hash` is auto-generated; ignore unexpected changes, and only regenerate via `pnpm canvas:a2ui:bundle` (or `scripts/bundle-a2ui.sh`) when needed. Commit the hash as a separate commit.\n- Release signing/notary keys are managed outside the repo; follow internal release docs.\n- Notary auth env vars (`APP_STORE_CONNECT_ISSUER_ID`, `APP_STORE_CONNECT_KEY_ID`, `APP_STORE_CONNECT_API_KEY_P8`) are expected in your environment (per internal release docs).\n- **Multi-agent safety:** do **not** create/apply/drop `git stash` entries unless explicitly requested (this includes `git pull --rebase --autostash`). Assume other agents may be working; keep unrelated WIP untouched and avoid cross-cutting state changes.\n- **Multi-agent safety:** when the user says \"push\", you may `git pull --rebase` to integrate latest changes (never discard other agents' work). When the user says \"commit\", scope to your changes only. When the user says \"commit all\", commit everything in grouped chunks.\n- **Multi-agent safety:** do **not** create/remove/modify `git worktree` checkouts (or edit `.worktrees/*`) unless explicitly requested.\n- **Multi-agent safety:** do **not** switch branches / check out a different branch unless explicitly requested.\n- **Multi-agent safety:** running multiple agents is OK as long as each agent has its own session.\n- **Multi-agent safety:** when you see unrecognized files, keep going; focus on your changes and commit only those.\n- Lint/format churn:\n  - If staged+unstaged diffs are formatting-only, auto-resolve without asking.\n  - If commit/push already requested, auto-stage and include formatting-only follow-ups in the same commit (or a tiny follow-up commit if needed), no extra confirmation.\n  - Only ask when changes are semantic (logic/data/behavior).\n- Lobster seam: use the shared CLI palette in `src/terminal/palette.ts` (no hardcoded colors); apply palette to onboarding/config prompts and other TTY UI output as needed.\n- **Multi-agent safety:** focus reports on your edits; avoid guard-rail disclaimers unless truly blocked; when multiple agents touch the same file, continue if safe; end with a brief “other files present” note only if relevant.\n- Bug investigations: read source code of relevant npm dependencies and all related local code before concluding; aim for high-confidence root cause.\n- Code style: add brief comments for tricky logic; keep files under ~500 LOC when feasible (split/refactor as needed).\n- Tool schema guardrails (google-antigravity): avoid `Type.Union` in tool input schemas; no `anyOf`/`oneOf`/`allOf`. Use `stringEnum`/`optionalStringEnum` (Type.Unsafe enum) for string lists, and `Type.Optional(...)` instead of `... | null`. Keep top-level tool schema as `type: \"object\"` with `properties`.\n- Tool schema guardrails: avoid raw `format` property names in tool schemas; some validators treat `format` as a reserved keyword and reject the schema.\n- When asked to open a “session” file, open the Pi session logs under `~/.openclaw/agents/<agentId>/sessions/*.jsonl` (use the `agent=<id>` value in the Runtime line of the system prompt; newest unless a specific ID is given), not the default `sessions.json`. If logs are needed from another machine, SSH via Tailscale and read the same path there.\n- Do not rebuild the macOS app over SSH; rebuilds must be run directly on the Mac.\n- Never send streaming/partial replies to external messaging surfaces (WhatsApp, Telegram); only final replies should be delivered there. Streaming/tool events may still go to internal UIs/control channel.\n- Voice wake forwarding tips:\n  - Command template should stay `openclaw-mac agent --message \"${text}\" --thinking low`; `VoiceWakeForwarder` already shell-escapes `${text}`. Don’t add extra quotes.\n  - launchd PATH is minimal; ensure the app’s launch agent PATH includes standard system paths plus your pnpm bin (typically `$HOME/Library/pnpm`) so `pnpm`/`openclaw` binaries resolve when invoked via `openclaw-mac`.\n- For manual `openclaw message send` messages that include `!`, use the heredoc pattern noted below to avoid the Bash tool’s escaping.\n- Release guardrails: do not change version numbers without operator’s explicit consent; always ask permission before running any npm publish/release step.\n\n## NPM + 1Password (publish/verify)\n\n- Use the 1password skill; all `op` commands must run inside a fresh tmux session.\n- Sign in: `eval \"$(op signin --account my.1password.com)\"` (app unlocked + integration on).\n- OTP: `op read 'op://Private/Npmjs/one-time password?attribute=otp'`.\n- Publish: `npm publish --access public --otp=\"<otp>\"` (run from the package dir).\n- Verify without local npmrc side effects: `npm view <pkg> version --userconfig \"$(mktemp)\"`.\n- Kill the tmux session after publish.\n\n\n## Skills\nA skill is a set of local instructions to follow that is stored in a `SKILL.md` file. Below is the list of skills that can be used. Each entry includes a name, description, and file path so you can open the source for full instructions when using a specific skill.\n### Available skills\n- merge-pr: Merge a GitHub PR via squash after /preparepr. Use when asked to merge a ready PR. Do not push to main or modify code. Ensure the PR ends in MERGED state and clean up worktrees after success. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/merge-pr/SKILL.md)\n- prepare-pr: Prepare a GitHub PR for merge by rebasing onto main, fixing review findings, running gates, committing fixes, and pushing to the PR head branch. Use after /reviewpr. Never merge or push to main. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/prepare-pr/SKILL.md)\n- review-pr: Review-only GitHub pull request analysis with the gh CLI. Use when asked to review a PR, provide structured feedback, or assess readiness to land. Do not merge, push, or make code changes you intend to keep. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/review-pr/SKILL.md)\n- figma: Use the Figma MCP server to fetch design context, screenshots, variables, and assets from Figma, and to translate Figma nodes into production code. Trigger when a task involves Figma URLs, node IDs, design-to-code implementation, or Figma MCP setup and troubleshooting. (file: /home/ldr-cavetroll/.codex/skills/figma/SKILL.md)\n- skill-creator: Guide for creating effective skills. This skill should be used when users want to create a new skill (or update an existing skill) that extends Codex's capabilities with specialized knowledge, workflows, or tool integrations. (file: /home/ldr-cavetroll/.codex/skills/.system/skill-creator/SKILL.md)\n- skill-installer: Install Codex skills into $CODEX_HOME/skills from a curated list or a GitHub repo path. Use when a user asks to list installable skills, install a curated skill, or install a skill from another repo (including private repos). (file: /home/ldr-cavetroll/.codex/skills/.system/skill-installer/SKILL.md)\n### How to use skills\n- Discovery: The list above is the skills available in this session (name + description + file path). Skill bodies live on disk at the listed paths.\n- Trigger rules: If the user names a skill (with `$SkillName` or plain text) OR the task clearly matches a skill's description shown above, you must use that skill for that turn. Multiple mentions mean use them all. Do not carry skills across turns unless re-mentioned.\n- Missing/blocked: If a named skill isn't in the list or the path can't be read, say so briefly and continue with the best fallback.\n- How to use a skill (progressive disclosure):\n  1) After deciding to use a skill, open its `SKILL.md`. Read only enough to follow the workflow.\n  2) When `SKILL.md` references relative paths (e.g., `scripts/foo.py`), resolve them relative to the skill directory listed above first, and only consider other paths if needed.\n  3) If `SKILL.md` points to extra folders such as `references/`, load only the specific files needed for the request; don't bulk-load everything.\n  4) If `scripts/` exist, prefer running or patching them instead of retyping large code blocks.\n  5) If `assets/` or templates exist, reuse them instead of recreating from scratch.\n- Coordination and sequencing:\n  - If multiple skills apply, choose the minimal set that covers the request and state the order you'll use them.\n  - Announce which skill(s) you're using and why (one short line). If you skip an obvious skill, say why.\n- Context hygiene:\n  - Keep context small: summarize long sections instead of pasting them; only load extra files when needed.\n  - Avoid deep reference-chasing: prefer opening only files directly linked from `SKILL.md` unless you're blocked.\n  - When variants exist (frameworks, providers, domains), pick only the relevant reference file(s) and note that choice.\n- Safety and fallback: If a skill can't be applied cleanly (missing files, unclear instructions), state the issue, pick the next-best approach, and continue.","truncation_policy":{"mode":"tokens","limit":10000}}}
{"timestamp":"2026-02-07T07:57:31.771Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":143559,"cached_input_tokens":110080,"output_tokens":334,"reasoning_output_tokens":0,"total_tokens":143893},"last_token_usage":{"input_tokens":23688,"cached_input_tokens":21760,"output_tokens":32,"reasoning_output_tokens":0,"total_tokens":23720},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":2.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":8.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T07:57:33.934Z","type":"event_msg","payload":{"type":"agent_reasoning","text":"**Reviewing types definitions**"}}
{"timestamp":"2026-02-07T07:57:33.934Z","type":"response_item","payload":{"type":"reasoning","summary":[{"type":"summary_text","text":"**Reviewing types definitions**"}],"content":null,"encrypted_content":"gAAAAABphvBtofwajDsIow_LeqpEm_k-cDZVkUt_OBGTqtgyveCTGNhj3TY2yWxxAARWucvA2ZWaHc0oHDieVOoRmtHOS0W57u21aiE6RNMoM9bCt4VzDXgObR7SqMgcfK5QC7RoQrMzsQfepMS_1d0DO965D3nTKC0xG8lCM3_rpwXM-KKR13so8DKfFgv69F6RgVxBiLBTwFv95UTOO8aih1hYDxZtUvD8ho3JPFxVcLxDTIpVpotJlioKYQfVDdW8PEZKS40sKX0J-MAUNnLB4DDvp1yzyk7fy7qAAGh4W4wep5jLg_xYVwuIyQcRllWXaGobwmqp3uk8cex2L9oYvQ9JTb4zzXNnDZcuXKQ80F_5vaBCYP6tGbQ5LqWtr-leGpSX_8eJDleuhcOCSc_uL97OxsGzache6Odtjlt7JvQxpIH68ecSO4cpUdw2gNq0vT_08K1lifp2ztxOsjh_7IcpBwDqs5h3IUe0LA1aEuGenVLQGdkwNH4JD2d_ZM9I9NEW2XccpvRrt7ypOeQsBoF0G53uQ-THNH4qq7RKhssqZJtEkcQod3kwnY8xhweq07H2aiU4jvBKdYqlAx98Ktrs-_OaFQwHekqZMx2oHITDfyXvwyOVkyPwP4CMKO0GEEtAKFsr99G8yUpFj6i-Dhv5Q4VPcuyqlXs2vPgsPVmcNOsw85Q1aY2zpgVjnzrJlt5HOkQEcGmwPmo2KLabE3zjgOlnxfHpqc43jhIOdB3uU9Hejl84SK1B_oNQOv1Bix6qiLdeV16C5MDkLZh9gxKFHVFYORNq76p1N2NP4zIIakIVzGYRzl5IFJNR9OvWeinB0dSieD3Ze12GFAMn6T95XvYdi-2DYAjwL98Y-gvb41VjxVb90vhbCHJdbp1Ekvmea2XrMvK65u_6S3zyNsRoTbTsRg=="}}
{"timestamp":"2026-02-07T07:57:34.703Z","type":"response_item","payload":{"type":"function_call","name":"exec_command","arguments":"{\"cmd\":\"sed -n '1,220p' src/acp/types.ts\"}","call_id":"call_6qDOYkuCLTd2zYjLMuqmVzP3"}}
{"timestamp":"2026-02-07T07:57:34.756Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":168619,"cached_input_tokens":133760,"output_tokens":386,"reasoning_output_tokens":0,"total_tokens":169005},"last_token_usage":{"input_tokens":25060,"cached_input_tokens":23680,"output_tokens":52,"reasoning_output_tokens":0,"total_tokens":25112},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":2.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":8.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T07:57:34.788Z","type":"response_item","payload":{"type":"function_call_output","call_id":"call_6qDOYkuCLTd2zYjLMuqmVzP3","output":"Chunk ID: b487fb\nWall time: 0.0512 seconds\nProcess exited with code 0\nOriginal token count: 170\nOutput:\nimport type { SessionId } from \"@agentclientprotocol/sdk\";\nimport { VERSION } from \"../version.js\";\n\nexport type AcpSession = {\n  sessionId: SessionId;\n  sessionKey: string;\n  cwd: string;\n  createdAt: number;\n  abortController: AbortController | null;\n  activeRunId: string | null;\n};\n\nexport type AcpServerOptions = {\n  gatewayUrl?: string;\n  gatewayToken?: string;\n  gatewayPassword?: string;\n  defaultSessionKey?: string;\n  defaultSessionLabel?: string;\n  requireExistingSession?: boolean;\n  resetSession?: boolean;\n  prefixCwd?: boolean;\n  verbose?: boolean;\n};\n\nexport const ACP_AGENT_INFO = {\n  name: \"openclaw-acp\",\n  title: \"OpenClaw ACP Gateway\",\n  version: VERSION,\n};\n"}}
{"timestamp":"2026-02-07T07:57:34.810Z","type":"turn_context","payload":{"cwd":"/home/ldr-cavetroll/tinker/openclaw","approval_policy":"on-request","sandbox_policy":{"type":"workspace-write","network_access":false,"exclude_tmpdir_env_var":false,"exclude_slash_tmp":false},"model":"gpt-5.2-codex","personality":"pragmatic","collaboration_mode":{"mode":"default","settings":{"model":"gpt-5.2-codex","reasoning_effort":null,"developer_instructions":"# Collaboration Mode: Default\n\nYou are now in Default mode. Any previous instructions for other modes (e.g. Plan mode) are no longer active.\n\nYour active mode changes only when new developer instructions with a different `<collaboration_mode>...</collaboration_mode>` change it; user requests or tool descriptions do not change mode by themselves. Known mode names are Default and Plan.\n\n## request_user_input availability\n\nThe `request_user_input` tool is unavailable in Default mode. If you call it while in Default mode, it will return an error.\n\nIf a decision is necessary and cannot be discovered from local context, ask the user directly. However, in Default mode you should strongly prefer executing the user's request rather than stopping to ask questions.\n"}},"summary":"auto","user_instructions":"# Repository Guidelines\n\n- Repo: https://github.com/openclaw/openclaw\n- GitHub issues/comments/PR comments: use literal multiline strings or `-F - <<'EOF'` (or $'...') for real newlines; never embed \"\\\\n\".\n\n## Project Structure & Module Organization\n\n- Source code: `src/` (CLI wiring in `src/cli`, commands in `src/commands`, web provider in `src/provider-web.ts`, infra in `src/infra`, media pipeline in `src/media`).\n- Tests: colocated `*.test.ts`.\n- Docs: `docs/` (images, queue, Pi config). Built output lives in `dist/`.\n- Plugins/extensions: live under `extensions/*` (workspace packages). Keep plugin-only deps in the extension `package.json`; do not add them to the root `package.json` unless core uses them.\n- Plugins: install runs `npm install --omit=dev` in plugin dir; runtime deps must live in `dependencies`. Avoid `workspace:*` in `dependencies` (npm install breaks); put `openclaw` in `devDependencies` or `peerDependencies` instead (runtime resolves `openclaw/plugin-sdk` via jiti alias).\n- Installers served from `https://openclaw.ai/*`: live in the sibling repo `../openclaw.ai` (`public/install.sh`, `public/install-cli.sh`, `public/install.ps1`).\n- Messaging channels: always consider **all** built-in + extension channels when refactoring shared logic (routing, allowlists, pairing, command gating, onboarding, docs).\n  - Core channel docs: `docs/channels/`\n  - Core channel code: `src/telegram`, `src/discord`, `src/slack`, `src/signal`, `src/imessage`, `src/web` (WhatsApp web), `src/channels`, `src/routing`\n  - Extensions (channel plugins): `extensions/*` (e.g. `extensions/msteams`, `extensions/matrix`, `extensions/zalo`, `extensions/zalouser`, `extensions/voice-call`)\n- When adding channels/extensions/apps/docs, review `.github/labeler.yml` for label coverage.\n\n## Docs Linking (Mintlify)\n\n- Docs are hosted on Mintlify (docs.openclaw.ai).\n- Internal doc links in `docs/**/*.md`: root-relative, no `.md`/`.mdx` (example: `[Config](/configuration)`).\n- Section cross-references: use anchors on root-relative paths (example: `[Hooks](/configuration#hooks)`).\n- Doc headings and anchors: avoid em dashes and apostrophes in headings because they break Mintlify anchor links.\n- When Peter asks for links, reply with full `https://docs.openclaw.ai/...` URLs (not root-relative).\n- When you touch docs, end the reply with the `https://docs.openclaw.ai/...` URLs you referenced.\n- README (GitHub): keep absolute docs URLs (`https://docs.openclaw.ai/...`) so links work on GitHub.\n- Docs content must be generic: no personal device names/hostnames/paths; use placeholders like `user@gateway-host` and “gateway host”.\n\n## Docs i18n (zh-CN)\n\n- `docs/zh-CN/**` is generated; do not edit unless the user explicitly asks.\n- Pipeline: update English docs → adjust glossary (`docs/.i18n/glossary.zh-CN.json`) → run `scripts/docs-i18n` → apply targeted fixes only if instructed.\n- Translation memory: `docs/.i18n/zh-CN.tm.jsonl` (generated).\n- See `docs/.i18n/README.md`.\n- The pipeline can be slow/inefficient; if it’s dragging, ping @jospalmbier on Discord instead of hacking around it.\n\n## exe.dev VM ops (general)\n\n- Access: stable path is `ssh exe.dev` then `ssh vm-name` (assume SSH key already set).\n- SSH flaky: use exe.dev web terminal or Shelley (web agent); keep a tmux session for long ops.\n- Update: `sudo npm i -g openclaw@latest` (global install needs root on `/usr/lib/node_modules`).\n- Config: use `openclaw config set ...`; ensure `gateway.mode=local` is set.\n- Discord: store raw token only (no `DISCORD_BOT_TOKEN=` prefix).\n- Restart: stop old gateway and run:\n  `pkill -9 -f openclaw-gateway || true; nohup openclaw gateway run --bind loopback --port 18789 --force > /tmp/openclaw-gateway.log 2>&1 &`\n- Verify: `openclaw channels status --probe`, `ss -ltnp | rg 18789`, `tail -n 120 /tmp/openclaw-gateway.log`.\n\n## Build, Test, and Development Commands\n\n- Runtime baseline: Node **22+** (keep Node + Bun paths working).\n- Install deps: `pnpm install`\n- Pre-commit hooks: `prek install` (runs same checks as CI)\n- Also supported: `bun install` (keep `pnpm-lock.yaml` + Bun patching in sync when touching deps/patches).\n- Prefer Bun for TypeScript execution (scripts, dev, tests): `bun <file.ts>` / `bunx <tool>`.\n- Run CLI in dev: `pnpm openclaw ...` (bun) or `pnpm dev`.\n- Node remains supported for running built output (`dist/*`) and production installs.\n- Mac packaging (dev): `scripts/package-mac-app.sh` defaults to current arch. Release checklist: `docs/platforms/mac/release.md`.\n- Type-check/build: `pnpm build`\n- TypeScript checks: `pnpm tsgo`\n- Lint/format: `pnpm check`\n- Tests: `pnpm test` (vitest); coverage: `pnpm test:coverage`\n\n## Coding Style & Naming Conventions\n\n- Language: TypeScript (ESM). Prefer strict typing; avoid `any`.\n- Formatting/linting via Oxlint and Oxfmt; run `pnpm check` before commits.\n- Add brief code comments for tricky or non-obvious logic.\n- Keep files concise; extract helpers instead of “V2” copies. Use existing patterns for CLI options and dependency injection via `createDefaultDeps`.\n- Aim to keep files under ~700 LOC; guideline only (not a hard guardrail). Split/refactor when it improves clarity or testability.\n- Naming: use **OpenClaw** for product/app/docs headings; use `openclaw` for CLI command, package/binary, paths, and config keys.\n\n## Release Channels (Naming)\n\n- stable: tagged releases only (e.g. `vYYYY.M.D`), npm dist-tag `latest`.\n- beta: prerelease tags `vYYYY.M.D-beta.N`, npm dist-tag `beta` (may ship without macOS app).\n- dev: moving head on `main` (no tag; git checkout main).\n\n## Testing Guidelines\n\n- Framework: Vitest with V8 coverage thresholds (70% lines/branches/functions/statements).\n- Naming: match source names with `*.test.ts`; e2e in `*.e2e.test.ts`.\n- Run `pnpm test` (or `pnpm test:coverage`) before pushing when you touch logic.\n- Do not set test workers above 16; tried already.\n- Live tests (real keys): `CLAWDBOT_LIVE_TEST=1 pnpm test:live` (OpenClaw-only) or `LIVE=1 pnpm test:live` (includes provider live tests). Docker: `pnpm test:docker:live-models`, `pnpm test:docker:live-gateway`. Onboarding Docker E2E: `pnpm test:docker:onboard`.\n- Full kit + what’s covered: `docs/testing.md`.\n- Pure test additions/fixes generally do **not** need a changelog entry unless they alter user-facing behavior or the user asks for one.\n- Mobile: before using a simulator, check for connected real devices (iOS + Android) and prefer them when available.\n\n## Commit & Pull Request Guidelines\n\n- Create commits with `scripts/committer \"<msg>\" <file...>`; avoid manual `git add`/`git commit` so staging stays scoped.\n- Follow concise, action-oriented commit messages (e.g., `CLI: add verbose flag to send`).\n- Group related changes; avoid bundling unrelated refactors.\n- Changelog workflow: keep latest released version at top (no `Unreleased`); after publishing, bump version and start a new top section.\n- PRs should summarize scope, note testing performed, and mention any user-facing changes or new flags.\n- Read this when submitting a PR: `docs/help/submitting-a-pr.md` ([Submitting a PR](https://docs.openclaw.ai/help/submitting-a-pr))\n- Read this when submitting an issue: `docs/help/submitting-an-issue.md` ([Submitting an Issue](https://docs.openclaw.ai/help/submitting-an-issue))\n- PR review flow: when given a PR link, review via `gh pr view`/`gh pr diff` and do **not** change branches.\n- PR review calls: prefer a single `gh pr view --json ...` to batch metadata/comments; run `gh pr diff` only when needed.\n- Before starting a review when a GH Issue/PR is pasted: run `git pull`; if there are local changes or unpushed commits, stop and alert the user before reviewing.\n- Goal: merge PRs. Prefer **rebase** when commits are clean; **squash** when history is messy.\n- PR merge flow: create a temp branch from `main`, merge the PR branch into it (prefer squash unless commit history is important; use rebase/merge when it is). Always try to merge the PR unless it’s truly difficult, then use another approach. If we squash, add the PR author as a co-contributor. Apply fixes, add changelog entry (include PR # + thanks), run full gate before the final commit, commit, merge back to `main`, delete the temp branch, and end on `main`.\n- If you review a PR and later do work on it, land via merge/squash (no direct-main commits) and always add the PR author as a co-contributor.\n- When working on a PR: add a changelog entry with the PR number and thank the contributor.\n- When working on an issue: reference the issue in the changelog entry.\n- When merging a PR: leave a PR comment that explains exactly what we did and include the SHA hashes.\n- When merging a PR from a new contributor: add their avatar to the README “Thanks to all clawtributors” thumbnail list.\n- After merging a PR: run `bun scripts/update-clawtributors.ts` if the contributor is missing, then commit the regenerated README.\n\n## Shorthand Commands\n\n- `sync`: if working tree is dirty, commit all changes (pick a sensible Conventional Commit message), then `git pull --rebase`; if rebase conflicts and cannot resolve, stop; otherwise `git push`.\n\n### PR Workflow (Review vs Land)\n\n- **Review mode (PR link only):** read `gh pr view/diff`; **do not** switch branches; **do not** change code.\n- **Landing mode:** create an integration branch from `main`, bring in PR commits (**prefer rebase** for linear history; **merge allowed** when complexity/conflicts make it safer), apply fixes, add changelog (+ thanks + PR #), run full gate **locally before committing** (`pnpm build && pnpm check && pnpm test`), commit, merge back to `main`, then `git switch main` (never stay on a topic branch after landing). Important: contributor needs to be in git graph after this!\n\n## Security & Configuration Tips\n\n- Web provider stores creds at `~/.openclaw/credentials/`; rerun `openclaw login` if logged out.\n- Pi sessions live under `~/.openclaw/sessions/` by default; the base directory is not configurable.\n- Environment variables: see `~/.profile`.\n- Never commit or publish real phone numbers, videos, or live configuration values. Use obviously fake placeholders in docs, tests, and examples.\n- Release flow: always read `docs/reference/RELEASING.md` and `docs/platforms/mac/release.md` before any release work; do not ask routine questions once those docs answer them.\n\n## Troubleshooting\n\n- Rebrand/migration issues or legacy config/service warnings: run `openclaw doctor` (see `docs/gateway/doctor.md`).\n\n## Agent-Specific Notes\n\n- Vocabulary: \"makeup\" = \"mac app\".\n- Never edit `node_modules` (global/Homebrew/npm/git installs too). Updates overwrite. Skill notes go in `tools.md` or `AGENTS.md`.\n- Signal: \"update fly\" => `fly ssh console -a flawd-bot -C \"bash -lc 'cd /data/clawd/openclaw && git pull --rebase origin main'\"` then `fly machines restart e825232f34d058 -a flawd-bot`.\n- When working on a GitHub Issue or PR, print the full URL at the end of the task.\n- When answering questions, respond with high-confidence answers only: verify in code; do not guess.\n- Never update the Carbon dependency.\n- Any dependency with `pnpm.patchedDependencies` must use an exact version (no `^`/`~`).\n- Patching dependencies (pnpm patches, overrides, or vendored changes) requires explicit approval; do not do this by default.\n- CLI progress: use `src/cli/progress.ts` (`osc-progress` + `@clack/prompts` spinner); don’t hand-roll spinners/bars.\n- Status output: keep tables + ANSI-safe wrapping (`src/terminal/table.ts`); `status --all` = read-only/pasteable, `status --deep` = probes.\n- Gateway currently runs only as the menubar app; there is no separate LaunchAgent/helper label installed. Restart via the OpenClaw Mac app or `scripts/restart-mac.sh`; to verify/kill use `launchctl print gui/$UID | grep openclaw` rather than assuming a fixed label. **When debugging on macOS, start/stop the gateway via the app, not ad-hoc tmux sessions; kill any temporary tunnels before handoff.**\n- macOS logs: use `./scripts/clawlog.sh` to query unified logs for the OpenClaw subsystem; it supports follow/tail/category filters and expects passwordless sudo for `/usr/bin/log`.\n- If shared guardrails are available locally, review them; otherwise follow this repo's guidance.\n- SwiftUI state management (iOS/macOS): prefer the `Observation` framework (`@Observable`, `@Bindable`) over `ObservableObject`/`@StateObject`; don’t introduce new `ObservableObject` unless required for compatibility, and migrate existing usages when touching related code.\n- Connection providers: when adding a new connection, update every UI surface and docs (macOS app, web UI, mobile if applicable, onboarding/overview docs) and add matching status + configuration forms so provider lists and settings stay in sync.\n- Version locations: `package.json` (CLI), `apps/android/app/build.gradle.kts` (versionName/versionCode), `apps/ios/Sources/Info.plist` + `apps/ios/Tests/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `apps/macos/Sources/OpenClaw/Resources/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `docs/install/updating.md` (pinned npm version), `docs/platforms/mac/release.md` (APP_VERSION/APP_BUILD examples), Peekaboo Xcode projects/Info.plists (MARKETING_VERSION/CURRENT_PROJECT_VERSION).\n- **Restart apps:** “restart iOS/Android apps” means rebuild (recompile/install) and relaunch, not just kill/launch.\n- **Device checks:** before testing, verify connected real devices (iOS/Android) before reaching for simulators/emulators.\n- iOS Team ID lookup: `security find-identity -p codesigning -v` → use Apple Development (…) TEAMID. Fallback: `defaults read com.apple.dt.Xcode IDEProvisioningTeamIdentifiers`.\n- A2UI bundle hash: `src/canvas-host/a2ui/.bundle.hash` is auto-generated; ignore unexpected changes, and only regenerate via `pnpm canvas:a2ui:bundle` (or `scripts/bundle-a2ui.sh`) when needed. Commit the hash as a separate commit.\n- Release signing/notary keys are managed outside the repo; follow internal release docs.\n- Notary auth env vars (`APP_STORE_CONNECT_ISSUER_ID`, `APP_STORE_CONNECT_KEY_ID`, `APP_STORE_CONNECT_API_KEY_P8`) are expected in your environment (per internal release docs).\n- **Multi-agent safety:** do **not** create/apply/drop `git stash` entries unless explicitly requested (this includes `git pull --rebase --autostash`). Assume other agents may be working; keep unrelated WIP untouched and avoid cross-cutting state changes.\n- **Multi-agent safety:** when the user says \"push\", you may `git pull --rebase` to integrate latest changes (never discard other agents' work). When the user says \"commit\", scope to your changes only. When the user says \"commit all\", commit everything in grouped chunks.\n- **Multi-agent safety:** do **not** create/remove/modify `git worktree` checkouts (or edit `.worktrees/*`) unless explicitly requested.\n- **Multi-agent safety:** do **not** switch branches / check out a different branch unless explicitly requested.\n- **Multi-agent safety:** running multiple agents is OK as long as each agent has its own session.\n- **Multi-agent safety:** when you see unrecognized files, keep going; focus on your changes and commit only those.\n- Lint/format churn:\n  - If staged+unstaged diffs are formatting-only, auto-resolve without asking.\n  - If commit/push already requested, auto-stage and include formatting-only follow-ups in the same commit (or a tiny follow-up commit if needed), no extra confirmation.\n  - Only ask when changes are semantic (logic/data/behavior).\n- Lobster seam: use the shared CLI palette in `src/terminal/palette.ts` (no hardcoded colors); apply palette to onboarding/config prompts and other TTY UI output as needed.\n- **Multi-agent safety:** focus reports on your edits; avoid guard-rail disclaimers unless truly blocked; when multiple agents touch the same file, continue if safe; end with a brief “other files present” note only if relevant.\n- Bug investigations: read source code of relevant npm dependencies and all related local code before concluding; aim for high-confidence root cause.\n- Code style: add brief comments for tricky logic; keep files under ~500 LOC when feasible (split/refactor as needed).\n- Tool schema guardrails (google-antigravity): avoid `Type.Union` in tool input schemas; no `anyOf`/`oneOf`/`allOf`. Use `stringEnum`/`optionalStringEnum` (Type.Unsafe enum) for string lists, and `Type.Optional(...)` instead of `... | null`. Keep top-level tool schema as `type: \"object\"` with `properties`.\n- Tool schema guardrails: avoid raw `format` property names in tool schemas; some validators treat `format` as a reserved keyword and reject the schema.\n- When asked to open a “session” file, open the Pi session logs under `~/.openclaw/agents/<agentId>/sessions/*.jsonl` (use the `agent=<id>` value in the Runtime line of the system prompt; newest unless a specific ID is given), not the default `sessions.json`. If logs are needed from another machine, SSH via Tailscale and read the same path there.\n- Do not rebuild the macOS app over SSH; rebuilds must be run directly on the Mac.\n- Never send streaming/partial replies to external messaging surfaces (WhatsApp, Telegram); only final replies should be delivered there. Streaming/tool events may still go to internal UIs/control channel.\n- Voice wake forwarding tips:\n  - Command template should stay `openclaw-mac agent --message \"${text}\" --thinking low`; `VoiceWakeForwarder` already shell-escapes `${text}`. Don’t add extra quotes.\n  - launchd PATH is minimal; ensure the app’s launch agent PATH includes standard system paths plus your pnpm bin (typically `$HOME/Library/pnpm`) so `pnpm`/`openclaw` binaries resolve when invoked via `openclaw-mac`.\n- For manual `openclaw message send` messages that include `!`, use the heredoc pattern noted below to avoid the Bash tool’s escaping.\n- Release guardrails: do not change version numbers without operator’s explicit consent; always ask permission before running any npm publish/release step.\n\n## NPM + 1Password (publish/verify)\n\n- Use the 1password skill; all `op` commands must run inside a fresh tmux session.\n- Sign in: `eval \"$(op signin --account my.1password.com)\"` (app unlocked + integration on).\n- OTP: `op read 'op://Private/Npmjs/one-time password?attribute=otp'`.\n- Publish: `npm publish --access public --otp=\"<otp>\"` (run from the package dir).\n- Verify without local npmrc side effects: `npm view <pkg> version --userconfig \"$(mktemp)\"`.\n- Kill the tmux session after publish.\n\n\n## Skills\nA skill is a set of local instructions to follow that is stored in a `SKILL.md` file. Below is the list of skills that can be used. Each entry includes a name, description, and file path so you can open the source for full instructions when using a specific skill.\n### Available skills\n- merge-pr: Merge a GitHub PR via squash after /preparepr. Use when asked to merge a ready PR. Do not push to main or modify code. Ensure the PR ends in MERGED state and clean up worktrees after success. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/merge-pr/SKILL.md)\n- prepare-pr: Prepare a GitHub PR for merge by rebasing onto main, fixing review findings, running gates, committing fixes, and pushing to the PR head branch. Use after /reviewpr. Never merge or push to main. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/prepare-pr/SKILL.md)\n- review-pr: Review-only GitHub pull request analysis with the gh CLI. Use when asked to review a PR, provide structured feedback, or assess readiness to land. Do not merge, push, or make code changes you intend to keep. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/review-pr/SKILL.md)\n- figma: Use the Figma MCP server to fetch design context, screenshots, variables, and assets from Figma, and to translate Figma nodes into production code. Trigger when a task involves Figma URLs, node IDs, design-to-code implementation, or Figma MCP setup and troubleshooting. (file: /home/ldr-cavetroll/.codex/skills/figma/SKILL.md)\n- skill-creator: Guide for creating effective skills. This skill should be used when users want to create a new skill (or update an existing skill) that extends Codex's capabilities with specialized knowledge, workflows, or tool integrations. (file: /home/ldr-cavetroll/.codex/skills/.system/skill-creator/SKILL.md)\n- skill-installer: Install Codex skills into $CODEX_HOME/skills from a curated list or a GitHub repo path. Use when a user asks to list installable skills, install a curated skill, or install a skill from another repo (including private repos). (file: /home/ldr-cavetroll/.codex/skills/.system/skill-installer/SKILL.md)\n### How to use skills\n- Discovery: The list above is the skills available in this session (name + description + file path). Skill bodies live on disk at the listed paths.\n- Trigger rules: If the user names a skill (with `$SkillName` or plain text) OR the task clearly matches a skill's description shown above, you must use that skill for that turn. Multiple mentions mean use them all. Do not carry skills across turns unless re-mentioned.\n- Missing/blocked: If a named skill isn't in the list or the path can't be read, say so briefly and continue with the best fallback.\n- How to use a skill (progressive disclosure):\n  1) After deciding to use a skill, open its `SKILL.md`. Read only enough to follow the workflow.\n  2) When `SKILL.md` references relative paths (e.g., `scripts/foo.py`), resolve them relative to the skill directory listed above first, and only consider other paths if needed.\n  3) If `SKILL.md` points to extra folders such as `references/`, load only the specific files needed for the request; don't bulk-load everything.\n  4) If `scripts/` exist, prefer running or patching them instead of retyping large code blocks.\n  5) If `assets/` or templates exist, reuse them instead of recreating from scratch.\n- Coordination and sequencing:\n  - If multiple skills apply, choose the minimal set that covers the request and state the order you'll use them.\n  - Announce which skill(s) you're using and why (one short line). If you skip an obvious skill, say why.\n- Context hygiene:\n  - Keep context small: summarize long sections instead of pasting them; only load extra files when needed.\n  - Avoid deep reference-chasing: prefer opening only files directly linked from `SKILL.md` unless you're blocked.\n  - When variants exist (frameworks, providers, domains), pick only the relevant reference file(s) and note that choice.\n- Safety and fallback: If a skill can't be applied cleanly (missing files, unclear instructions), state the issue, pick the next-best approach, and continue.","truncation_policy":{"mode":"tokens","limit":10000}}}
{"timestamp":"2026-02-07T07:57:35.195Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":168619,"cached_input_tokens":133760,"output_tokens":386,"reasoning_output_tokens":0,"total_tokens":169005},"last_token_usage":{"input_tokens":25060,"cached_input_tokens":23680,"output_tokens":52,"reasoning_output_tokens":0,"total_tokens":25112},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":2.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":8.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T07:57:36.569Z","type":"event_msg","payload":{"type":"agent_reasoning","text":"**Identifying missing session mapper**"}}
{"timestamp":"2026-02-07T07:57:36.569Z","type":"response_item","payload":{"type":"reasoning","summary":[{"type":"summary_text","text":"**Identifying missing session mapper**"}],"content":null,"encrypted_content":"gAAAAABphvBwQ1GrO4P6Zx8iCimwgtJD6Bq1mvVWySD84ishPY5hvwny0PWAZcy-KYP31xNPbcbffhkc5HV475Q1HI9uJDI2D3mTy23aZcTrV_xzhdEHZ0K9ok3QHkbZQECAV1zF0pX5RV0pNPzg4Oqkhsb4E_3d08LGXMG5ISKfPpprwPZpyd81F26KnVkowoDjnPuSxgwOzYTkpaLrHX00f8c70cJRyfd0M_9GIxQIvZtYngxwNqS_Qm7th-d16drurOeZ2GoMS4xqWDUhJV1Fgfv8oRKfCkUYvT3vMmoPiYc5AERp_uDggetMFibtiWvkYw3bZLcsHYdUmrOH3WKkb807FaLA8Czp6TiqK-aHc-byaYVKR2I-W9RvTn3kDJUmXZLHk-Xc4JkYKhxJIiN0Hl3lFJMWA8RdZCqkotElUdfpFamEncXXfjzO66oCDwcH90qDRfcvRhkvVxue8jmnOVa_dyRqsdB_6_wL0AdUikDFkl1uvp37hFHhKhh2KlSxrjU44sXdgh8I1zmTdb8gzd_7lGBh-srH0ZhozCWUORxCFw_T-penMr50Qc4RqMkggVeuOOkYKTdZdX9zKSGbFJKXoNF1bb-EcHVYNWa63Cea-3tunmSPMZ9raCX0sDDaK6SaqYHIXfdIzXVD0izUJrmXibnV0kALYTo5CqrTtakUrIYUI8QWVWvkFhT_KtX2CwNLbWs6exyLinfDos2CFBKiWDTFw5zqC7vy75bneBZP5vDeshAxH5uVzZ9XsOGdDpBnXJbdkkgvzAYtBGyL-_Mu4KxU2kwpHnDZOYWu2y43WmiwXLxVnAf9mQHr0MrSxCqkp1cdBaijNXb4TjRtKmioV3gExQ=="}}
{"timestamp":"2026-02-07T07:57:37.393Z","type":"response_item","payload":{"type":"function_call","name":"exec_command","arguments":"{\"cmd\":\"sed -n '1,220p' src/acp/session-mapper.ts\"}","call_id":"call_FpJbdXQsp26iZTkLBVrgQtnh"}}
{"timestamp":"2026-02-07T07:57:37.396Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":193943,"cached_input_tokens":158720,"output_tokens":430,"reasoning_output_tokens":0,"total_tokens":194373},"last_token_usage":{"input_tokens":25324,"cached_input_tokens":24960,"output_tokens":44,"reasoning_output_tokens":0,"total_tokens":25368},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":2.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":8.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T07:57:37.478Z","type":"response_item","payload":{"type":"function_call_output","call_id":"call_FpJbdXQsp26iZTkLBVrgQtnh","output":"Chunk ID: a9d18b\nWall time: 0.0506 seconds\nProcess exited with code 0\nOriginal token count: 764\nOutput:\nimport type { GatewayClient } from \"../gateway/client.js\";\nimport type { AcpServerOptions } from \"./types.js\";\nimport { readBool, readString } from \"./meta.js\";\n\nexport type AcpSessionMeta = {\n  sessionKey?: string;\n  sessionLabel?: string;\n  resetSession?: boolean;\n  requireExisting?: boolean;\n  prefixCwd?: boolean;\n};\n\nexport function parseSessionMeta(meta: unknown): AcpSessionMeta {\n  if (!meta || typeof meta !== \"object\") {\n    return {};\n  }\n  const record = meta as Record<string, unknown>;\n  return {\n    sessionKey: readString(record, [\"sessionKey\", \"session\", \"key\"]),\n    sessionLabel: readString(record, [\"sessionLabel\", \"label\"]),\n    resetSession: readBool(record, [\"resetSession\", \"reset\"]),\n    requireExisting: readBool(record, [\"requireExistingSession\", \"requireExisting\"]),\n    prefixCwd: readBool(record, [\"prefixCwd\"]),\n  };\n}\n\nexport async function resolveSessionKey(params: {\n  meta: AcpSessionMeta;\n  fallbackKey: string;\n  gateway: GatewayClient;\n  opts: AcpServerOptions;\n}): Promise<string> {\n  const requestedLabel = params.meta.sessionLabel ?? params.opts.defaultSessionLabel;\n  const requestedKey = params.meta.sessionKey ?? params.opts.defaultSessionKey;\n  const requireExisting =\n    params.meta.requireExisting ?? params.opts.requireExistingSession ?? false;\n\n  if (params.meta.sessionLabel) {\n    const resolved = await params.gateway.request<{ ok: true; key: string }>(\"sessions.resolve\", {\n      label: params.meta.sessionLabel,\n    });\n    if (!resolved?.key) {\n      throw new Error(`Unable to resolve session label: ${params.meta.sessionLabel}`);\n    }\n    return resolved.key;\n  }\n\n  if (params.meta.sessionKey) {\n    if (!requireExisting) {\n      return params.meta.sessionKey;\n    }\n    const resolved = await params.gateway.request<{ ok: true; key: string }>(\"sessions.resolve\", {\n      key: params.meta.sessionKey,\n    });\n    if (!resolved?.key) {\n      throw new Error(`Session key not found: ${params.meta.sessionKey}`);\n    }\n    return resolved.key;\n  }\n\n  if (requestedLabel) {\n    const resolved = await params.gateway.request<{ ok: true; key: string }>(\"sessions.resolve\", {\n      label: requestedLabel,\n    });\n    if (!resolved?.key) {\n      throw new Error(`Unable to resolve session label: ${requestedLabel}`);\n    }\n    return resolved.key;\n  }\n\n  if (requestedKey) {\n    if (!requireExisting) {\n      return requestedKey;\n    }\n    const resolved = await params.gateway.request<{ ok: true; key: string }>(\"sessions.resolve\", {\n      key: requestedKey,\n    });\n    if (!resolved?.key) {\n      throw new Error(`Session key not found: ${requestedKey}`);\n    }\n    return resolved.key;\n  }\n\n  return params.fallbackKey;\n}\n\nexport async function resetSessionIfNeeded(params: {\n  meta: AcpSessionMeta;\n  sessionKey: string;\n  gateway: GatewayClient;\n  opts: AcpServerOptions;\n}): Promise<void> {\n  const resetSession = params.meta.resetSession ?? params.opts.resetSession ?? false;\n  if (!resetSession) {\n    return;\n  }\n  await params.gateway.request(\"sessions.reset\", { key: params.sessionKey });\n}\n"}}
{"timestamp":"2026-02-07T07:57:37.501Z","type":"turn_context","payload":{"cwd":"/home/ldr-cavetroll/tinker/openclaw","approval_policy":"on-request","sandbox_policy":{"type":"workspace-write","network_access":false,"exclude_tmpdir_env_var":false,"exclude_slash_tmp":false},"model":"gpt-5.2-codex","personality":"pragmatic","collaboration_mode":{"mode":"default","settings":{"model":"gpt-5.2-codex","reasoning_effort":null,"developer_instructions":"# Collaboration Mode: Default\n\nYou are now in Default mode. Any previous instructions for other modes (e.g. Plan mode) are no longer active.\n\nYour active mode changes only when new developer instructions with a different `<collaboration_mode>...</collaboration_mode>` change it; user requests or tool descriptions do not change mode by themselves. Known mode names are Default and Plan.\n\n## request_user_input availability\n\nThe `request_user_input` tool is unavailable in Default mode. If you call it while in Default mode, it will return an error.\n\nIf a decision is necessary and cannot be discovered from local context, ask the user directly. However, in Default mode you should strongly prefer executing the user's request rather than stopping to ask questions.\n"}},"summary":"auto","user_instructions":"# Repository Guidelines\n\n- Repo: https://github.com/openclaw/openclaw\n- GitHub issues/comments/PR comments: use literal multiline strings or `-F - <<'EOF'` (or $'...') for real newlines; never embed \"\\\\n\".\n\n## Project Structure & Module Organization\n\n- Source code: `src/` (CLI wiring in `src/cli`, commands in `src/commands`, web provider in `src/provider-web.ts`, infra in `src/infra`, media pipeline in `src/media`).\n- Tests: colocated `*.test.ts`.\n- Docs: `docs/` (images, queue, Pi config). Built output lives in `dist/`.\n- Plugins/extensions: live under `extensions/*` (workspace packages). Keep plugin-only deps in the extension `package.json`; do not add them to the root `package.json` unless core uses them.\n- Plugins: install runs `npm install --omit=dev` in plugin dir; runtime deps must live in `dependencies`. Avoid `workspace:*` in `dependencies` (npm install breaks); put `openclaw` in `devDependencies` or `peerDependencies` instead (runtime resolves `openclaw/plugin-sdk` via jiti alias).\n- Installers served from `https://openclaw.ai/*`: live in the sibling repo `../openclaw.ai` (`public/install.sh`, `public/install-cli.sh`, `public/install.ps1`).\n- Messaging channels: always consider **all** built-in + extension channels when refactoring shared logic (routing, allowlists, pairing, command gating, onboarding, docs).\n  - Core channel docs: `docs/channels/`\n  - Core channel code: `src/telegram`, `src/discord`, `src/slack`, `src/signal`, `src/imessage`, `src/web` (WhatsApp web), `src/channels`, `src/routing`\n  - Extensions (channel plugins): `extensions/*` (e.g. `extensions/msteams`, `extensions/matrix`, `extensions/zalo`, `extensions/zalouser`, `extensions/voice-call`)\n- When adding channels/extensions/apps/docs, review `.github/labeler.yml` for label coverage.\n\n## Docs Linking (Mintlify)\n\n- Docs are hosted on Mintlify (docs.openclaw.ai).\n- Internal doc links in `docs/**/*.md`: root-relative, no `.md`/`.mdx` (example: `[Config](/configuration)`).\n- Section cross-references: use anchors on root-relative paths (example: `[Hooks](/configuration#hooks)`).\n- Doc headings and anchors: avoid em dashes and apostrophes in headings because they break Mintlify anchor links.\n- When Peter asks for links, reply with full `https://docs.openclaw.ai/...` URLs (not root-relative).\n- When you touch docs, end the reply with the `https://docs.openclaw.ai/...` URLs you referenced.\n- README (GitHub): keep absolute docs URLs (`https://docs.openclaw.ai/...`) so links work on GitHub.\n- Docs content must be generic: no personal device names/hostnames/paths; use placeholders like `user@gateway-host` and “gateway host”.\n\n## Docs i18n (zh-CN)\n\n- `docs/zh-CN/**` is generated; do not edit unless the user explicitly asks.\n- Pipeline: update English docs → adjust glossary (`docs/.i18n/glossary.zh-CN.json`) → run `scripts/docs-i18n` → apply targeted fixes only if instructed.\n- Translation memory: `docs/.i18n/zh-CN.tm.jsonl` (generated).\n- See `docs/.i18n/README.md`.\n- The pipeline can be slow/inefficient; if it’s dragging, ping @jospalmbier on Discord instead of hacking around it.\n\n## exe.dev VM ops (general)\n\n- Access: stable path is `ssh exe.dev` then `ssh vm-name` (assume SSH key already set).\n- SSH flaky: use exe.dev web terminal or Shelley (web agent); keep a tmux session for long ops.\n- Update: `sudo npm i -g openclaw@latest` (global install needs root on `/usr/lib/node_modules`).\n- Config: use `openclaw config set ...`; ensure `gateway.mode=local` is set.\n- Discord: store raw token only (no `DISCORD_BOT_TOKEN=` prefix).\n- Restart: stop old gateway and run:\n  `pkill -9 -f openclaw-gateway || true; nohup openclaw gateway run --bind loopback --port 18789 --force > /tmp/openclaw-gateway.log 2>&1 &`\n- Verify: `openclaw channels status --probe`, `ss -ltnp | rg 18789`, `tail -n 120 /tmp/openclaw-gateway.log`.\n\n## Build, Test, and Development Commands\n\n- Runtime baseline: Node **22+** (keep Node + Bun paths working).\n- Install deps: `pnpm install`\n- Pre-commit hooks: `prek install` (runs same checks as CI)\n- Also supported: `bun install` (keep `pnpm-lock.yaml` + Bun patching in sync when touching deps/patches).\n- Prefer Bun for TypeScript execution (scripts, dev, tests): `bun <file.ts>` / `bunx <tool>`.\n- Run CLI in dev: `pnpm openclaw ...` (bun) or `pnpm dev`.\n- Node remains supported for running built output (`dist/*`) and production installs.\n- Mac packaging (dev): `scripts/package-mac-app.sh` defaults to current arch. Release checklist: `docs/platforms/mac/release.md`.\n- Type-check/build: `pnpm build`\n- TypeScript checks: `pnpm tsgo`\n- Lint/format: `pnpm check`\n- Tests: `pnpm test` (vitest); coverage: `pnpm test:coverage`\n\n## Coding Style & Naming Conventions\n\n- Language: TypeScript (ESM). Prefer strict typing; avoid `any`.\n- Formatting/linting via Oxlint and Oxfmt; run `pnpm check` before commits.\n- Add brief code comments for tricky or non-obvious logic.\n- Keep files concise; extract helpers instead of “V2” copies. Use existing patterns for CLI options and dependency injection via `createDefaultDeps`.\n- Aim to keep files under ~700 LOC; guideline only (not a hard guardrail). Split/refactor when it improves clarity or testability.\n- Naming: use **OpenClaw** for product/app/docs headings; use `openclaw` for CLI command, package/binary, paths, and config keys.\n\n## Release Channels (Naming)\n\n- stable: tagged releases only (e.g. `vYYYY.M.D`), npm dist-tag `latest`.\n- beta: prerelease tags `vYYYY.M.D-beta.N`, npm dist-tag `beta` (may ship without macOS app).\n- dev: moving head on `main` (no tag; git checkout main).\n\n## Testing Guidelines\n\n- Framework: Vitest with V8 coverage thresholds (70% lines/branches/functions/statements).\n- Naming: match source names with `*.test.ts`; e2e in `*.e2e.test.ts`.\n- Run `pnpm test` (or `pnpm test:coverage`) before pushing when you touch logic.\n- Do not set test workers above 16; tried already.\n- Live tests (real keys): `CLAWDBOT_LIVE_TEST=1 pnpm test:live` (OpenClaw-only) or `LIVE=1 pnpm test:live` (includes provider live tests). Docker: `pnpm test:docker:live-models`, `pnpm test:docker:live-gateway`. Onboarding Docker E2E: `pnpm test:docker:onboard`.\n- Full kit + what’s covered: `docs/testing.md`.\n- Pure test additions/fixes generally do **not** need a changelog entry unless they alter user-facing behavior or the user asks for one.\n- Mobile: before using a simulator, check for connected real devices (iOS + Android) and prefer them when available.\n\n## Commit & Pull Request Guidelines\n\n- Create commits with `scripts/committer \"<msg>\" <file...>`; avoid manual `git add`/`git commit` so staging stays scoped.\n- Follow concise, action-oriented commit messages (e.g., `CLI: add verbose flag to send`).\n- Group related changes; avoid bundling unrelated refactors.\n- Changelog workflow: keep latest released version at top (no `Unreleased`); after publishing, bump version and start a new top section.\n- PRs should summarize scope, note testing performed, and mention any user-facing changes or new flags.\n- Read this when submitting a PR: `docs/help/submitting-a-pr.md` ([Submitting a PR](https://docs.openclaw.ai/help/submitting-a-pr))\n- Read this when submitting an issue: `docs/help/submitting-an-issue.md` ([Submitting an Issue](https://docs.openclaw.ai/help/submitting-an-issue))\n- PR review flow: when given a PR link, review via `gh pr view`/`gh pr diff` and do **not** change branches.\n- PR review calls: prefer a single `gh pr view --json ...` to batch metadata/comments; run `gh pr diff` only when needed.\n- Before starting a review when a GH Issue/PR is pasted: run `git pull`; if there are local changes or unpushed commits, stop and alert the user before reviewing.\n- Goal: merge PRs. Prefer **rebase** when commits are clean; **squash** when history is messy.\n- PR merge flow: create a temp branch from `main`, merge the PR branch into it (prefer squash unless commit history is important; use rebase/merge when it is). Always try to merge the PR unless it’s truly difficult, then use another approach. If we squash, add the PR author as a co-contributor. Apply fixes, add changelog entry (include PR # + thanks), run full gate before the final commit, commit, merge back to `main`, delete the temp branch, and end on `main`.\n- If you review a PR and later do work on it, land via merge/squash (no direct-main commits) and always add the PR author as a co-contributor.\n- When working on a PR: add a changelog entry with the PR number and thank the contributor.\n- When working on an issue: reference the issue in the changelog entry.\n- When merging a PR: leave a PR comment that explains exactly what we did and include the SHA hashes.\n- When merging a PR from a new contributor: add their avatar to the README “Thanks to all clawtributors” thumbnail list.\n- After merging a PR: run `bun scripts/update-clawtributors.ts` if the contributor is missing, then commit the regenerated README.\n\n## Shorthand Commands\n\n- `sync`: if working tree is dirty, commit all changes (pick a sensible Conventional Commit message), then `git pull --rebase`; if rebase conflicts and cannot resolve, stop; otherwise `git push`.\n\n### PR Workflow (Review vs Land)\n\n- **Review mode (PR link only):** read `gh pr view/diff`; **do not** switch branches; **do not** change code.\n- **Landing mode:** create an integration branch from `main`, bring in PR commits (**prefer rebase** for linear history; **merge allowed** when complexity/conflicts make it safer), apply fixes, add changelog (+ thanks + PR #), run full gate **locally before committing** (`pnpm build && pnpm check && pnpm test`), commit, merge back to `main`, then `git switch main` (never stay on a topic branch after landing). Important: contributor needs to be in git graph after this!\n\n## Security & Configuration Tips\n\n- Web provider stores creds at `~/.openclaw/credentials/`; rerun `openclaw login` if logged out.\n- Pi sessions live under `~/.openclaw/sessions/` by default; the base directory is not configurable.\n- Environment variables: see `~/.profile`.\n- Never commit or publish real phone numbers, videos, or live configuration values. Use obviously fake placeholders in docs, tests, and examples.\n- Release flow: always read `docs/reference/RELEASING.md` and `docs/platforms/mac/release.md` before any release work; do not ask routine questions once those docs answer them.\n\n## Troubleshooting\n\n- Rebrand/migration issues or legacy config/service warnings: run `openclaw doctor` (see `docs/gateway/doctor.md`).\n\n## Agent-Specific Notes\n\n- Vocabulary: \"makeup\" = \"mac app\".\n- Never edit `node_modules` (global/Homebrew/npm/git installs too). Updates overwrite. Skill notes go in `tools.md` or `AGENTS.md`.\n- Signal: \"update fly\" => `fly ssh console -a flawd-bot -C \"bash -lc 'cd /data/clawd/openclaw && git pull --rebase origin main'\"` then `fly machines restart e825232f34d058 -a flawd-bot`.\n- When working on a GitHub Issue or PR, print the full URL at the end of the task.\n- When answering questions, respond with high-confidence answers only: verify in code; do not guess.\n- Never update the Carbon dependency.\n- Any dependency with `pnpm.patchedDependencies` must use an exact version (no `^`/`~`).\n- Patching dependencies (pnpm patches, overrides, or vendored changes) requires explicit approval; do not do this by default.\n- CLI progress: use `src/cli/progress.ts` (`osc-progress` + `@clack/prompts` spinner); don’t hand-roll spinners/bars.\n- Status output: keep tables + ANSI-safe wrapping (`src/terminal/table.ts`); `status --all` = read-only/pasteable, `status --deep` = probes.\n- Gateway currently runs only as the menubar app; there is no separate LaunchAgent/helper label installed. Restart via the OpenClaw Mac app or `scripts/restart-mac.sh`; to verify/kill use `launchctl print gui/$UID | grep openclaw` rather than assuming a fixed label. **When debugging on macOS, start/stop the gateway via the app, not ad-hoc tmux sessions; kill any temporary tunnels before handoff.**\n- macOS logs: use `./scripts/clawlog.sh` to query unified logs for the OpenClaw subsystem; it supports follow/tail/category filters and expects passwordless sudo for `/usr/bin/log`.\n- If shared guardrails are available locally, review them; otherwise follow this repo's guidance.\n- SwiftUI state management (iOS/macOS): prefer the `Observation` framework (`@Observable`, `@Bindable`) over `ObservableObject`/`@StateObject`; don’t introduce new `ObservableObject` unless required for compatibility, and migrate existing usages when touching related code.\n- Connection providers: when adding a new connection, update every UI surface and docs (macOS app, web UI, mobile if applicable, onboarding/overview docs) and add matching status + configuration forms so provider lists and settings stay in sync.\n- Version locations: `package.json` (CLI), `apps/android/app/build.gradle.kts` (versionName/versionCode), `apps/ios/Sources/Info.plist` + `apps/ios/Tests/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `apps/macos/Sources/OpenClaw/Resources/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `docs/install/updating.md` (pinned npm version), `docs/platforms/mac/release.md` (APP_VERSION/APP_BUILD examples), Peekaboo Xcode projects/Info.plists (MARKETING_VERSION/CURRENT_PROJECT_VERSION).\n- **Restart apps:** “restart iOS/Android apps” means rebuild (recompile/install) and relaunch, not just kill/launch.\n- **Device checks:** before testing, verify connected real devices (iOS/Android) before reaching for simulators/emulators.\n- iOS Team ID lookup: `security find-identity -p codesigning -v` → use Apple Development (…) TEAMID. Fallback: `defaults read com.apple.dt.Xcode IDEProvisioningTeamIdentifiers`.\n- A2UI bundle hash: `src/canvas-host/a2ui/.bundle.hash` is auto-generated; ignore unexpected changes, and only regenerate via `pnpm canvas:a2ui:bundle` (or `scripts/bundle-a2ui.sh`) when needed. Commit the hash as a separate commit.\n- Release signing/notary keys are managed outside the repo; follow internal release docs.\n- Notary auth env vars (`APP_STORE_CONNECT_ISSUER_ID`, `APP_STORE_CONNECT_KEY_ID`, `APP_STORE_CONNECT_API_KEY_P8`) are expected in your environment (per internal release docs).\n- **Multi-agent safety:** do **not** create/apply/drop `git stash` entries unless explicitly requested (this includes `git pull --rebase --autostash`). Assume other agents may be working; keep unrelated WIP untouched and avoid cross-cutting state changes.\n- **Multi-agent safety:** when the user says \"push\", you may `git pull --rebase` to integrate latest changes (never discard other agents' work). When the user says \"commit\", scope to your changes only. When the user says \"commit all\", commit everything in grouped chunks.\n- **Multi-agent safety:** do **not** create/remove/modify `git worktree` checkouts (or edit `.worktrees/*`) unless explicitly requested.\n- **Multi-agent safety:** do **not** switch branches / check out a different branch unless explicitly requested.\n- **Multi-agent safety:** running multiple agents is OK as long as each agent has its own session.\n- **Multi-agent safety:** when you see unrecognized files, keep going; focus on your changes and commit only those.\n- Lint/format churn:\n  - If staged+unstaged diffs are formatting-only, auto-resolve without asking.\n  - If commit/push already requested, auto-stage and include formatting-only follow-ups in the same commit (or a tiny follow-up commit if needed), no extra confirmation.\n  - Only ask when changes are semantic (logic/data/behavior).\n- Lobster seam: use the shared CLI palette in `src/terminal/palette.ts` (no hardcoded colors); apply palette to onboarding/config prompts and other TTY UI output as needed.\n- **Multi-agent safety:** focus reports on your edits; avoid guard-rail disclaimers unless truly blocked; when multiple agents touch the same file, continue if safe; end with a brief “other files present” note only if relevant.\n- Bug investigations: read source code of relevant npm dependencies and all related local code before concluding; aim for high-confidence root cause.\n- Code style: add brief comments for tricky logic; keep files under ~500 LOC when feasible (split/refactor as needed).\n- Tool schema guardrails (google-antigravity): avoid `Type.Union` in tool input schemas; no `anyOf`/`oneOf`/`allOf`. Use `stringEnum`/`optionalStringEnum` (Type.Unsafe enum) for string lists, and `Type.Optional(...)` instead of `... | null`. Keep top-level tool schema as `type: \"object\"` with `properties`.\n- Tool schema guardrails: avoid raw `format` property names in tool schemas; some validators treat `format` as a reserved keyword and reject the schema.\n- When asked to open a “session” file, open the Pi session logs under `~/.openclaw/agents/<agentId>/sessions/*.jsonl` (use the `agent=<id>` value in the Runtime line of the system prompt; newest unless a specific ID is given), not the default `sessions.json`. If logs are needed from another machine, SSH via Tailscale and read the same path there.\n- Do not rebuild the macOS app over SSH; rebuilds must be run directly on the Mac.\n- Never send streaming/partial replies to external messaging surfaces (WhatsApp, Telegram); only final replies should be delivered there. Streaming/tool events may still go to internal UIs/control channel.\n- Voice wake forwarding tips:\n  - Command template should stay `openclaw-mac agent --message \"${text}\" --thinking low`; `VoiceWakeForwarder` already shell-escapes `${text}`. Don’t add extra quotes.\n  - launchd PATH is minimal; ensure the app’s launch agent PATH includes standard system paths plus your pnpm bin (typically `$HOME/Library/pnpm`) so `pnpm`/`openclaw` binaries resolve when invoked via `openclaw-mac`.\n- For manual `openclaw message send` messages that include `!`, use the heredoc pattern noted below to avoid the Bash tool’s escaping.\n- Release guardrails: do not change version numbers without operator’s explicit consent; always ask permission before running any npm publish/release step.\n\n## NPM + 1Password (publish/verify)\n\n- Use the 1password skill; all `op` commands must run inside a fresh tmux session.\n- Sign in: `eval \"$(op signin --account my.1password.com)\"` (app unlocked + integration on).\n- OTP: `op read 'op://Private/Npmjs/one-time password?attribute=otp'`.\n- Publish: `npm publish --access public --otp=\"<otp>\"` (run from the package dir).\n- Verify without local npmrc side effects: `npm view <pkg> version --userconfig \"$(mktemp)\"`.\n- Kill the tmux session after publish.\n\n\n## Skills\nA skill is a set of local instructions to follow that is stored in a `SKILL.md` file. Below is the list of skills that can be used. Each entry includes a name, description, and file path so you can open the source for full instructions when using a specific skill.\n### Available skills\n- merge-pr: Merge a GitHub PR via squash after /preparepr. Use when asked to merge a ready PR. Do not push to main or modify code. Ensure the PR ends in MERGED state and clean up worktrees after success. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/merge-pr/SKILL.md)\n- prepare-pr: Prepare a GitHub PR for merge by rebasing onto main, fixing review findings, running gates, committing fixes, and pushing to the PR head branch. Use after /reviewpr. Never merge or push to main. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/prepare-pr/SKILL.md)\n- review-pr: Review-only GitHub pull request analysis with the gh CLI. Use when asked to review a PR, provide structured feedback, or assess readiness to land. Do not merge, push, or make code changes you intend to keep. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/review-pr/SKILL.md)\n- figma: Use the Figma MCP server to fetch design context, screenshots, variables, and assets from Figma, and to translate Figma nodes into production code. Trigger when a task involves Figma URLs, node IDs, design-to-code implementation, or Figma MCP setup and troubleshooting. (file: /home/ldr-cavetroll/.codex/skills/figma/SKILL.md)\n- skill-creator: Guide for creating effective skills. This skill should be used when users want to create a new skill (or update an existing skill) that extends Codex's capabilities with specialized knowledge, workflows, or tool integrations. (file: /home/ldr-cavetroll/.codex/skills/.system/skill-creator/SKILL.md)\n- skill-installer: Install Codex skills into $CODEX_HOME/skills from a curated list or a GitHub repo path. Use when a user asks to list installable skills, install a curated skill, or install a skill from another repo (including private repos). (file: /home/ldr-cavetroll/.codex/skills/.system/skill-installer/SKILL.md)\n### How to use skills\n- Discovery: The list above is the skills available in this session (name + description + file path). Skill bodies live on disk at the listed paths.\n- Trigger rules: If the user names a skill (with `$SkillName` or plain text) OR the task clearly matches a skill's description shown above, you must use that skill for that turn. Multiple mentions mean use them all. Do not carry skills across turns unless re-mentioned.\n- Missing/blocked: If a named skill isn't in the list or the path can't be read, say so briefly and continue with the best fallback.\n- How to use a skill (progressive disclosure):\n  1) After deciding to use a skill, open its `SKILL.md`. Read only enough to follow the workflow.\n  2) When `SKILL.md` references relative paths (e.g., `scripts/foo.py`), resolve them relative to the skill directory listed above first, and only consider other paths if needed.\n  3) If `SKILL.md` points to extra folders such as `references/`, load only the specific files needed for the request; don't bulk-load everything.\n  4) If `scripts/` exist, prefer running or patching them instead of retyping large code blocks.\n  5) If `assets/` or templates exist, reuse them instead of recreating from scratch.\n- Coordination and sequencing:\n  - If multiple skills apply, choose the minimal set that covers the request and state the order you'll use them.\n  - Announce which skill(s) you're using and why (one short line). If you skip an obvious skill, say why.\n- Context hygiene:\n  - Keep context small: summarize long sections instead of pasting them; only load extra files when needed.\n  - Avoid deep reference-chasing: prefer opening only files directly linked from `SKILL.md` unless you're blocked.\n  - When variants exist (frameworks, providers, domains), pick only the relevant reference file(s) and note that choice.\n- Safety and fallback: If a skill can't be applied cleanly (missing files, unclear instructions), state the issue, pick the next-best approach, and continue.","truncation_policy":{"mode":"tokens","limit":10000}}}
{"timestamp":"2026-02-07T07:57:37.785Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":193943,"cached_input_tokens":158720,"output_tokens":430,"reasoning_output_tokens":0,"total_tokens":194373},"last_token_usage":{"input_tokens":25324,"cached_input_tokens":24960,"output_tokens":44,"reasoning_output_tokens":0,"total_tokens":25368},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":2.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":8.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T07:57:38.775Z","type":"event_msg","payload":{"type":"agent_reasoning","text":"**Identifying need for session store**"}}
{"timestamp":"2026-02-07T07:57:38.775Z","type":"response_item","payload":{"type":"reasoning","summary":[{"type":"summary_text","text":"**Identifying need for session store**"}],"content":null,"encrypted_content":"gAAAAABphvBy4XTsMRqwch7WfANgCW8X7_uJTR7KF9_Ch-PWc1SzFaAjsl0r9eBpdUw6hu_dHuaDKjG5WTnx_yzNzll3to63hkvBtDHIkWRyhbOgErQFLGEPQ5gevtNvLT_TGDqq8BvN7rXte3WY1QNRk9su0MsslhyaFAxeVUi-t4or5wZ5SEuygiHgvav_Dle0VmePuu857atoJiLz0U1RAleENkRPLj2mVljV-rtplbDM_5Bi0KM1woyoM9XEpOQ9uEYLwVQekSEndJCF1pNCgLwqWiozKcTbdkGvhuh06YmnXW7yKN-yTldIPictQFWINbF7HM0PcDOdE839KcjTNlAJd0CIR01Ehz0AgUSLmer4E6Vg0IEqF-fyFlE98jkXFYorTyn47Q51eyX4wM9lOttih39B1pim30ZPMtJXXevTvP45UdQ9SC1qVzrHo5_LVJPH4Wrrz2ogIDA_UUucc6yLbn5-h4MM1DSGBvsJXLBNAfgWd-cCgiq0lCx1CO4MUMKU2Acfrp5WAdbkvb1Gy7h-hwi-vT0ZSZOz1fQrv-tVQq6eSdYg5KqEP5vWqVh5ywR1x4YGPHM0bDFAXA9eBDKD9CRjKNa9-7G8H4t0SBT5y1O1jV-6bGUOMda-fsw0XeZKAXIzAsQNEB94Ccw5ChTjyfgtTnMZaboMoia9UxYwhyrfcBOzP9SuZQ9A4PDZ8LKL4ymx1nqSld5EXOoLGWcXBTR9GzRPYjynYheGFdiDuuXmauEYGjdkPvUrKs9kEtTsJXj5sPXxMXC28lxZ3M1Opw1sWquZJJrZa0UhcGtm-UCRzt6utXWuBQSc6fLd8fl8kw9TnLQSiS2mOzhO-Pg8rHeJ_w=="}}
{"timestamp":"2026-02-07T07:57:38.976Z","type":"response_item","payload":{"type":"function_call","name":"exec_command","arguments":"{\"cmd\":\"sed -n '1,200p' src/acp/session.ts\"}","call_id":"call_M1oQZICyKOH0UGC6YxoLrdtr"}}
{"timestamp":"2026-02-07T07:57:39.006Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":220067,"cached_input_tokens":183808,"output_tokens":471,"reasoning_output_tokens":0,"total_tokens":220538},"last_token_usage":{"input_tokens":26124,"cached_input_tokens":25088,"output_tokens":41,"reasoning_output_tokens":0,"total_tokens":26165},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":2.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":8.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T07:57:39.061Z","type":"response_item","payload":{"type":"function_call_output","call_id":"call_M1oQZICyKOH0UGC6YxoLrdtr","output":"Chunk ID: 70edc5\nWall time: 0.0504 seconds\nProcess exited with code 0\nOriginal token count: 736\nOutput:\nimport { randomUUID } from \"node:crypto\";\nimport type { AcpSession } from \"./types.js\";\n\nexport type AcpSessionStore = {\n  createSession: (params: { sessionKey: string; cwd: string; sessionId?: string }) => AcpSession;\n  getSession: (sessionId: string) => AcpSession | undefined;\n  getSessionByRunId: (runId: string) => AcpSession | undefined;\n  setActiveRun: (sessionId: string, runId: string, abortController: AbortController) => void;\n  clearActiveRun: (sessionId: string) => void;\n  cancelActiveRun: (sessionId: string) => boolean;\n  clearAllSessionsForTest: () => void;\n};\n\nexport function createInMemorySessionStore(): AcpSessionStore {\n  const sessions = new Map<string, AcpSession>();\n  const runIdToSessionId = new Map<string, string>();\n\n  const createSession: AcpSessionStore[\"createSession\"] = (params) => {\n    const sessionId = params.sessionId ?? randomUUID();\n    const session: AcpSession = {\n      sessionId,\n      sessionKey: params.sessionKey,\n      cwd: params.cwd,\n      createdAt: Date.now(),\n      abortController: null,\n      activeRunId: null,\n    };\n    sessions.set(sessionId, session);\n    return session;\n  };\n\n  const getSession: AcpSessionStore[\"getSession\"] = (sessionId) => sessions.get(sessionId);\n\n  const getSessionByRunId: AcpSessionStore[\"getSessionByRunId\"] = (runId) => {\n    const sessionId = runIdToSessionId.get(runId);\n    return sessionId ? sessions.get(sessionId) : undefined;\n  };\n\n  const setActiveRun: AcpSessionStore[\"setActiveRun\"] = (sessionId, runId, abortController) => {\n    const session = sessions.get(sessionId);\n    if (!session) {\n      return;\n    }\n    session.activeRunId = runId;\n    session.abortController = abortController;\n    runIdToSessionId.set(runId, sessionId);\n  };\n\n  const clearActiveRun: AcpSessionStore[\"clearActiveRun\"] = (sessionId) => {\n    const session = sessions.get(sessionId);\n    if (!session) {\n      return;\n    }\n    if (session.activeRunId) {\n      runIdToSessionId.delete(session.activeRunId);\n    }\n    session.activeRunId = null;\n    session.abortController = null;\n  };\n\n  const cancelActiveRun: AcpSessionStore[\"cancelActiveRun\"] = (sessionId) => {\n    const session = sessions.get(sessionId);\n    if (!session?.abortController) {\n      return false;\n    }\n    session.abortController.abort();\n    if (session.activeRunId) {\n      runIdToSessionId.delete(session.activeRunId);\n    }\n    session.abortController = null;\n    session.activeRunId = null;\n    return true;\n  };\n\n  const clearAllSessionsForTest: AcpSessionStore[\"clearAllSessionsForTest\"] = () => {\n    for (const session of sessions.values()) {\n      session.abortController?.abort();\n    }\n    sessions.clear();\n    runIdToSessionId.clear();\n  };\n\n  return {\n    createSession,\n    getSession,\n    getSessionByRunId,\n    setActiveRun,\n    clearActiveRun,\n    cancelActiveRun,\n    clearAllSessionsForTest,\n  };\n}\n\nexport const defaultAcpSessionStore = createInMemorySessionStore();\n"}}
{"timestamp":"2026-02-07T07:57:39.084Z","type":"turn_context","payload":{"cwd":"/home/ldr-cavetroll/tinker/openclaw","approval_policy":"on-request","sandbox_policy":{"type":"workspace-write","network_access":false,"exclude_tmpdir_env_var":false,"exclude_slash_tmp":false},"model":"gpt-5.2-codex","personality":"pragmatic","collaboration_mode":{"mode":"default","settings":{"model":"gpt-5.2-codex","reasoning_effort":null,"developer_instructions":"# Collaboration Mode: Default\n\nYou are now in Default mode. Any previous instructions for other modes (e.g. Plan mode) are no longer active.\n\nYour active mode changes only when new developer instructions with a different `<collaboration_mode>...</collaboration_mode>` change it; user requests or tool descriptions do not change mode by themselves. Known mode names are Default and Plan.\n\n## request_user_input availability\n\nThe `request_user_input` tool is unavailable in Default mode. If you call it while in Default mode, it will return an error.\n\nIf a decision is necessary and cannot be discovered from local context, ask the user directly. However, in Default mode you should strongly prefer executing the user's request rather than stopping to ask questions.\n"}},"summary":"auto","user_instructions":"# Repository Guidelines\n\n- Repo: https://github.com/openclaw/openclaw\n- GitHub issues/comments/PR comments: use literal multiline strings or `-F - <<'EOF'` (or $'...') for real newlines; never embed \"\\\\n\".\n\n## Project Structure & Module Organization\n\n- Source code: `src/` (CLI wiring in `src/cli`, commands in `src/commands`, web provider in `src/provider-web.ts`, infra in `src/infra`, media pipeline in `src/media`).\n- Tests: colocated `*.test.ts`.\n- Docs: `docs/` (images, queue, Pi config). Built output lives in `dist/`.\n- Plugins/extensions: live under `extensions/*` (workspace packages). Keep plugin-only deps in the extension `package.json`; do not add them to the root `package.json` unless core uses them.\n- Plugins: install runs `npm install --omit=dev` in plugin dir; runtime deps must live in `dependencies`. Avoid `workspace:*` in `dependencies` (npm install breaks); put `openclaw` in `devDependencies` or `peerDependencies` instead (runtime resolves `openclaw/plugin-sdk` via jiti alias).\n- Installers served from `https://openclaw.ai/*`: live in the sibling repo `../openclaw.ai` (`public/install.sh`, `public/install-cli.sh`, `public/install.ps1`).\n- Messaging channels: always consider **all** built-in + extension channels when refactoring shared logic (routing, allowlists, pairing, command gating, onboarding, docs).\n  - Core channel docs: `docs/channels/`\n  - Core channel code: `src/telegram`, `src/discord`, `src/slack`, `src/signal`, `src/imessage`, `src/web` (WhatsApp web), `src/channels`, `src/routing`\n  - Extensions (channel plugins): `extensions/*` (e.g. `extensions/msteams`, `extensions/matrix`, `extensions/zalo`, `extensions/zalouser`, `extensions/voice-call`)\n- When adding channels/extensions/apps/docs, review `.github/labeler.yml` for label coverage.\n\n## Docs Linking (Mintlify)\n\n- Docs are hosted on Mintlify (docs.openclaw.ai).\n- Internal doc links in `docs/**/*.md`: root-relative, no `.md`/`.mdx` (example: `[Config](/configuration)`).\n- Section cross-references: use anchors on root-relative paths (example: `[Hooks](/configuration#hooks)`).\n- Doc headings and anchors: avoid em dashes and apostrophes in headings because they break Mintlify anchor links.\n- When Peter asks for links, reply with full `https://docs.openclaw.ai/...` URLs (not root-relative).\n- When you touch docs, end the reply with the `https://docs.openclaw.ai/...` URLs you referenced.\n- README (GitHub): keep absolute docs URLs (`https://docs.openclaw.ai/...`) so links work on GitHub.\n- Docs content must be generic: no personal device names/hostnames/paths; use placeholders like `user@gateway-host` and “gateway host”.\n\n## Docs i18n (zh-CN)\n\n- `docs/zh-CN/**` is generated; do not edit unless the user explicitly asks.\n- Pipeline: update English docs → adjust glossary (`docs/.i18n/glossary.zh-CN.json`) → run `scripts/docs-i18n` → apply targeted fixes only if instructed.\n- Translation memory: `docs/.i18n/zh-CN.tm.jsonl` (generated).\n- See `docs/.i18n/README.md`.\n- The pipeline can be slow/inefficient; if it’s dragging, ping @jospalmbier on Discord instead of hacking around it.\n\n## exe.dev VM ops (general)\n\n- Access: stable path is `ssh exe.dev` then `ssh vm-name` (assume SSH key already set).\n- SSH flaky: use exe.dev web terminal or Shelley (web agent); keep a tmux session for long ops.\n- Update: `sudo npm i -g openclaw@latest` (global install needs root on `/usr/lib/node_modules`).\n- Config: use `openclaw config set ...`; ensure `gateway.mode=local` is set.\n- Discord: store raw token only (no `DISCORD_BOT_TOKEN=` prefix).\n- Restart: stop old gateway and run:\n  `pkill -9 -f openclaw-gateway || true; nohup openclaw gateway run --bind loopback --port 18789 --force > /tmp/openclaw-gateway.log 2>&1 &`\n- Verify: `openclaw channels status --probe`, `ss -ltnp | rg 18789`, `tail -n 120 /tmp/openclaw-gateway.log`.\n\n## Build, Test, and Development Commands\n\n- Runtime baseline: Node **22+** (keep Node + Bun paths working).\n- Install deps: `pnpm install`\n- Pre-commit hooks: `prek install` (runs same checks as CI)\n- Also supported: `bun install` (keep `pnpm-lock.yaml` + Bun patching in sync when touching deps/patches).\n- Prefer Bun for TypeScript execution (scripts, dev, tests): `bun <file.ts>` / `bunx <tool>`.\n- Run CLI in dev: `pnpm openclaw ...` (bun) or `pnpm dev`.\n- Node remains supported for running built output (`dist/*`) and production installs.\n- Mac packaging (dev): `scripts/package-mac-app.sh` defaults to current arch. Release checklist: `docs/platforms/mac/release.md`.\n- Type-check/build: `pnpm build`\n- TypeScript checks: `pnpm tsgo`\n- Lint/format: `pnpm check`\n- Tests: `pnpm test` (vitest); coverage: `pnpm test:coverage`\n\n## Coding Style & Naming Conventions\n\n- Language: TypeScript (ESM). Prefer strict typing; avoid `any`.\n- Formatting/linting via Oxlint and Oxfmt; run `pnpm check` before commits.\n- Add brief code comments for tricky or non-obvious logic.\n- Keep files concise; extract helpers instead of “V2” copies. Use existing patterns for CLI options and dependency injection via `createDefaultDeps`.\n- Aim to keep files under ~700 LOC; guideline only (not a hard guardrail). Split/refactor when it improves clarity or testability.\n- Naming: use **OpenClaw** for product/app/docs headings; use `openclaw` for CLI command, package/binary, paths, and config keys.\n\n## Release Channels (Naming)\n\n- stable: tagged releases only (e.g. `vYYYY.M.D`), npm dist-tag `latest`.\n- beta: prerelease tags `vYYYY.M.D-beta.N`, npm dist-tag `beta` (may ship without macOS app).\n- dev: moving head on `main` (no tag; git checkout main).\n\n## Testing Guidelines\n\n- Framework: Vitest with V8 coverage thresholds (70% lines/branches/functions/statements).\n- Naming: match source names with `*.test.ts`; e2e in `*.e2e.test.ts`.\n- Run `pnpm test` (or `pnpm test:coverage`) before pushing when you touch logic.\n- Do not set test workers above 16; tried already.\n- Live tests (real keys): `CLAWDBOT_LIVE_TEST=1 pnpm test:live` (OpenClaw-only) or `LIVE=1 pnpm test:live` (includes provider live tests). Docker: `pnpm test:docker:live-models`, `pnpm test:docker:live-gateway`. Onboarding Docker E2E: `pnpm test:docker:onboard`.\n- Full kit + what’s covered: `docs/testing.md`.\n- Pure test additions/fixes generally do **not** need a changelog entry unless they alter user-facing behavior or the user asks for one.\n- Mobile: before using a simulator, check for connected real devices (iOS + Android) and prefer them when available.\n\n## Commit & Pull Request Guidelines\n\n- Create commits with `scripts/committer \"<msg>\" <file...>`; avoid manual `git add`/`git commit` so staging stays scoped.\n- Follow concise, action-oriented commit messages (e.g., `CLI: add verbose flag to send`).\n- Group related changes; avoid bundling unrelated refactors.\n- Changelog workflow: keep latest released version at top (no `Unreleased`); after publishing, bump version and start a new top section.\n- PRs should summarize scope, note testing performed, and mention any user-facing changes or new flags.\n- Read this when submitting a PR: `docs/help/submitting-a-pr.md` ([Submitting a PR](https://docs.openclaw.ai/help/submitting-a-pr))\n- Read this when submitting an issue: `docs/help/submitting-an-issue.md` ([Submitting an Issue](https://docs.openclaw.ai/help/submitting-an-issue))\n- PR review flow: when given a PR link, review via `gh pr view`/`gh pr diff` and do **not** change branches.\n- PR review calls: prefer a single `gh pr view --json ...` to batch metadata/comments; run `gh pr diff` only when needed.\n- Before starting a review when a GH Issue/PR is pasted: run `git pull`; if there are local changes or unpushed commits, stop and alert the user before reviewing.\n- Goal: merge PRs. Prefer **rebase** when commits are clean; **squash** when history is messy.\n- PR merge flow: create a temp branch from `main`, merge the PR branch into it (prefer squash unless commit history is important; use rebase/merge when it is). Always try to merge the PR unless it’s truly difficult, then use another approach. If we squash, add the PR author as a co-contributor. Apply fixes, add changelog entry (include PR # + thanks), run full gate before the final commit, commit, merge back to `main`, delete the temp branch, and end on `main`.\n- If you review a PR and later do work on it, land via merge/squash (no direct-main commits) and always add the PR author as a co-contributor.\n- When working on a PR: add a changelog entry with the PR number and thank the contributor.\n- When working on an issue: reference the issue in the changelog entry.\n- When merging a PR: leave a PR comment that explains exactly what we did and include the SHA hashes.\n- When merging a PR from a new contributor: add their avatar to the README “Thanks to all clawtributors” thumbnail list.\n- After merging a PR: run `bun scripts/update-clawtributors.ts` if the contributor is missing, then commit the regenerated README.\n\n## Shorthand Commands\n\n- `sync`: if working tree is dirty, commit all changes (pick a sensible Conventional Commit message), then `git pull --rebase`; if rebase conflicts and cannot resolve, stop; otherwise `git push`.\n\n### PR Workflow (Review vs Land)\n\n- **Review mode (PR link only):** read `gh pr view/diff`; **do not** switch branches; **do not** change code.\n- **Landing mode:** create an integration branch from `main`, bring in PR commits (**prefer rebase** for linear history; **merge allowed** when complexity/conflicts make it safer), apply fixes, add changelog (+ thanks + PR #), run full gate **locally before committing** (`pnpm build && pnpm check && pnpm test`), commit, merge back to `main`, then `git switch main` (never stay on a topic branch after landing). Important: contributor needs to be in git graph after this!\n\n## Security & Configuration Tips\n\n- Web provider stores creds at `~/.openclaw/credentials/`; rerun `openclaw login` if logged out.\n- Pi sessions live under `~/.openclaw/sessions/` by default; the base directory is not configurable.\n- Environment variables: see `~/.profile`.\n- Never commit or publish real phone numbers, videos, or live configuration values. Use obviously fake placeholders in docs, tests, and examples.\n- Release flow: always read `docs/reference/RELEASING.md` and `docs/platforms/mac/release.md` before any release work; do not ask routine questions once those docs answer them.\n\n## Troubleshooting\n\n- Rebrand/migration issues or legacy config/service warnings: run `openclaw doctor` (see `docs/gateway/doctor.md`).\n\n## Agent-Specific Notes\n\n- Vocabulary: \"makeup\" = \"mac app\".\n- Never edit `node_modules` (global/Homebrew/npm/git installs too). Updates overwrite. Skill notes go in `tools.md` or `AGENTS.md`.\n- Signal: \"update fly\" => `fly ssh console -a flawd-bot -C \"bash -lc 'cd /data/clawd/openclaw && git pull --rebase origin main'\"` then `fly machines restart e825232f34d058 -a flawd-bot`.\n- When working on a GitHub Issue or PR, print the full URL at the end of the task.\n- When answering questions, respond with high-confidence answers only: verify in code; do not guess.\n- Never update the Carbon dependency.\n- Any dependency with `pnpm.patchedDependencies` must use an exact version (no `^`/`~`).\n- Patching dependencies (pnpm patches, overrides, or vendored changes) requires explicit approval; do not do this by default.\n- CLI progress: use `src/cli/progress.ts` (`osc-progress` + `@clack/prompts` spinner); don’t hand-roll spinners/bars.\n- Status output: keep tables + ANSI-safe wrapping (`src/terminal/table.ts`); `status --all` = read-only/pasteable, `status --deep` = probes.\n- Gateway currently runs only as the menubar app; there is no separate LaunchAgent/helper label installed. Restart via the OpenClaw Mac app or `scripts/restart-mac.sh`; to verify/kill use `launchctl print gui/$UID | grep openclaw` rather than assuming a fixed label. **When debugging on macOS, start/stop the gateway via the app, not ad-hoc tmux sessions; kill any temporary tunnels before handoff.**\n- macOS logs: use `./scripts/clawlog.sh` to query unified logs for the OpenClaw subsystem; it supports follow/tail/category filters and expects passwordless sudo for `/usr/bin/log`.\n- If shared guardrails are available locally, review them; otherwise follow this repo's guidance.\n- SwiftUI state management (iOS/macOS): prefer the `Observation` framework (`@Observable`, `@Bindable`) over `ObservableObject`/`@StateObject`; don’t introduce new `ObservableObject` unless required for compatibility, and migrate existing usages when touching related code.\n- Connection providers: when adding a new connection, update every UI surface and docs (macOS app, web UI, mobile if applicable, onboarding/overview docs) and add matching status + configuration forms so provider lists and settings stay in sync.\n- Version locations: `package.json` (CLI), `apps/android/app/build.gradle.kts` (versionName/versionCode), `apps/ios/Sources/Info.plist` + `apps/ios/Tests/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `apps/macos/Sources/OpenClaw/Resources/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `docs/install/updating.md` (pinned npm version), `docs/platforms/mac/release.md` (APP_VERSION/APP_BUILD examples), Peekaboo Xcode projects/Info.plists (MARKETING_VERSION/CURRENT_PROJECT_VERSION).\n- **Restart apps:** “restart iOS/Android apps” means rebuild (recompile/install) and relaunch, not just kill/launch.\n- **Device checks:** before testing, verify connected real devices (iOS/Android) before reaching for simulators/emulators.\n- iOS Team ID lookup: `security find-identity -p codesigning -v` → use Apple Development (…) TEAMID. Fallback: `defaults read com.apple.dt.Xcode IDEProvisioningTeamIdentifiers`.\n- A2UI bundle hash: `src/canvas-host/a2ui/.bundle.hash` is auto-generated; ignore unexpected changes, and only regenerate via `pnpm canvas:a2ui:bundle` (or `scripts/bundle-a2ui.sh`) when needed. Commit the hash as a separate commit.\n- Release signing/notary keys are managed outside the repo; follow internal release docs.\n- Notary auth env vars (`APP_STORE_CONNECT_ISSUER_ID`, `APP_STORE_CONNECT_KEY_ID`, `APP_STORE_CONNECT_API_KEY_P8`) are expected in your environment (per internal release docs).\n- **Multi-agent safety:** do **not** create/apply/drop `git stash` entries unless explicitly requested (this includes `git pull --rebase --autostash`). Assume other agents may be working; keep unrelated WIP untouched and avoid cross-cutting state changes.\n- **Multi-agent safety:** when the user says \"push\", you may `git pull --rebase` to integrate latest changes (never discard other agents' work). When the user says \"commit\", scope to your changes only. When the user says \"commit all\", commit everything in grouped chunks.\n- **Multi-agent safety:** do **not** create/remove/modify `git worktree` checkouts (or edit `.worktrees/*`) unless explicitly requested.\n- **Multi-agent safety:** do **not** switch branches / check out a different branch unless explicitly requested.\n- **Multi-agent safety:** running multiple agents is OK as long as each agent has its own session.\n- **Multi-agent safety:** when you see unrecognized files, keep going; focus on your changes and commit only those.\n- Lint/format churn:\n  - If staged+unstaged diffs are formatting-only, auto-resolve without asking.\n  - If commit/push already requested, auto-stage and include formatting-only follow-ups in the same commit (or a tiny follow-up commit if needed), no extra confirmation.\n  - Only ask when changes are semantic (logic/data/behavior).\n- Lobster seam: use the shared CLI palette in `src/terminal/palette.ts` (no hardcoded colors); apply palette to onboarding/config prompts and other TTY UI output as needed.\n- **Multi-agent safety:** focus reports on your edits; avoid guard-rail disclaimers unless truly blocked; when multiple agents touch the same file, continue if safe; end with a brief “other files present” note only if relevant.\n- Bug investigations: read source code of relevant npm dependencies and all related local code before concluding; aim for high-confidence root cause.\n- Code style: add brief comments for tricky logic; keep files under ~500 LOC when feasible (split/refactor as needed).\n- Tool schema guardrails (google-antigravity): avoid `Type.Union` in tool input schemas; no `anyOf`/`oneOf`/`allOf`. Use `stringEnum`/`optionalStringEnum` (Type.Unsafe enum) for string lists, and `Type.Optional(...)` instead of `... | null`. Keep top-level tool schema as `type: \"object\"` with `properties`.\n- Tool schema guardrails: avoid raw `format` property names in tool schemas; some validators treat `format` as a reserved keyword and reject the schema.\n- When asked to open a “session” file, open the Pi session logs under `~/.openclaw/agents/<agentId>/sessions/*.jsonl` (use the `agent=<id>` value in the Runtime line of the system prompt; newest unless a specific ID is given), not the default `sessions.json`. If logs are needed from another machine, SSH via Tailscale and read the same path there.\n- Do not rebuild the macOS app over SSH; rebuilds must be run directly on the Mac.\n- Never send streaming/partial replies to external messaging surfaces (WhatsApp, Telegram); only final replies should be delivered there. Streaming/tool events may still go to internal UIs/control channel.\n- Voice wake forwarding tips:\n  - Command template should stay `openclaw-mac agent --message \"${text}\" --thinking low`; `VoiceWakeForwarder` already shell-escapes `${text}`. Don’t add extra quotes.\n  - launchd PATH is minimal; ensure the app’s launch agent PATH includes standard system paths plus your pnpm bin (typically `$HOME/Library/pnpm`) so `pnpm`/`openclaw` binaries resolve when invoked via `openclaw-mac`.\n- For manual `openclaw message send` messages that include `!`, use the heredoc pattern noted below to avoid the Bash tool’s escaping.\n- Release guardrails: do not change version numbers without operator’s explicit consent; always ask permission before running any npm publish/release step.\n\n## NPM + 1Password (publish/verify)\n\n- Use the 1password skill; all `op` commands must run inside a fresh tmux session.\n- Sign in: `eval \"$(op signin --account my.1password.com)\"` (app unlocked + integration on).\n- OTP: `op read 'op://Private/Npmjs/one-time password?attribute=otp'`.\n- Publish: `npm publish --access public --otp=\"<otp>\"` (run from the package dir).\n- Verify without local npmrc side effects: `npm view <pkg> version --userconfig \"$(mktemp)\"`.\n- Kill the tmux session after publish.\n\n\n## Skills\nA skill is a set of local instructions to follow that is stored in a `SKILL.md` file. Below is the list of skills that can be used. Each entry includes a name, description, and file path so you can open the source for full instructions when using a specific skill.\n### Available skills\n- merge-pr: Merge a GitHub PR via squash after /preparepr. Use when asked to merge a ready PR. Do not push to main or modify code. Ensure the PR ends in MERGED state and clean up worktrees after success. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/merge-pr/SKILL.md)\n- prepare-pr: Prepare a GitHub PR for merge by rebasing onto main, fixing review findings, running gates, committing fixes, and pushing to the PR head branch. Use after /reviewpr. Never merge or push to main. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/prepare-pr/SKILL.md)\n- review-pr: Review-only GitHub pull request analysis with the gh CLI. Use when asked to review a PR, provide structured feedback, or assess readiness to land. Do not merge, push, or make code changes you intend to keep. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/review-pr/SKILL.md)\n- figma: Use the Figma MCP server to fetch design context, screenshots, variables, and assets from Figma, and to translate Figma nodes into production code. Trigger when a task involves Figma URLs, node IDs, design-to-code implementation, or Figma MCP setup and troubleshooting. (file: /home/ldr-cavetroll/.codex/skills/figma/SKILL.md)\n- skill-creator: Guide for creating effective skills. This skill should be used when users want to create a new skill (or update an existing skill) that extends Codex's capabilities with specialized knowledge, workflows, or tool integrations. (file: /home/ldr-cavetroll/.codex/skills/.system/skill-creator/SKILL.md)\n- skill-installer: Install Codex skills into $CODEX_HOME/skills from a curated list or a GitHub repo path. Use when a user asks to list installable skills, install a curated skill, or install a skill from another repo (including private repos). (file: /home/ldr-cavetroll/.codex/skills/.system/skill-installer/SKILL.md)\n### How to use skills\n- Discovery: The list above is the skills available in this session (name + description + file path). Skill bodies live on disk at the listed paths.\n- Trigger rules: If the user names a skill (with `$SkillName` or plain text) OR the task clearly matches a skill's description shown above, you must use that skill for that turn. Multiple mentions mean use them all. Do not carry skills across turns unless re-mentioned.\n- Missing/blocked: If a named skill isn't in the list or the path can't be read, say so briefly and continue with the best fallback.\n- How to use a skill (progressive disclosure):\n  1) After deciding to use a skill, open its `SKILL.md`. Read only enough to follow the workflow.\n  2) When `SKILL.md` references relative paths (e.g., `scripts/foo.py`), resolve them relative to the skill directory listed above first, and only consider other paths if needed.\n  3) If `SKILL.md` points to extra folders such as `references/`, load only the specific files needed for the request; don't bulk-load everything.\n  4) If `scripts/` exist, prefer running or patching them instead of retyping large code blocks.\n  5) If `assets/` or templates exist, reuse them instead of recreating from scratch.\n- Coordination and sequencing:\n  - If multiple skills apply, choose the minimal set that covers the request and state the order you'll use them.\n  - Announce which skill(s) you're using and why (one short line). If you skip an obvious skill, say why.\n- Context hygiene:\n  - Keep context small: summarize long sections instead of pasting them; only load extra files when needed.\n  - Avoid deep reference-chasing: prefer opening only files directly linked from `SKILL.md` unless you're blocked.\n  - When variants exist (frameworks, providers, domains), pick only the relevant reference file(s) and note that choice.\n- Safety and fallback: If a skill can't be applied cleanly (missing files, unclear instructions), state the issue, pick the next-best approach, and continue.","truncation_policy":{"mode":"tokens","limit":10000}}}
{"timestamp":"2026-02-07T07:57:39.389Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":220067,"cached_input_tokens":183808,"output_tokens":471,"reasoning_output_tokens":0,"total_tokens":220538},"last_token_usage":{"input_tokens":26124,"cached_input_tokens":25088,"output_tokens":41,"reasoning_output_tokens":0,"total_tokens":26165},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":2.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":8.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T07:57:40.442Z","type":"event_msg","payload":{"type":"agent_reasoning","text":"**Planning event mapping and commands**"}}
{"timestamp":"2026-02-07T07:57:40.442Z","type":"response_item","payload":{"type":"reasoning","summary":[{"type":"summary_text","text":"**Planning event mapping and commands**"}],"content":null,"encrypted_content":"gAAAAABphvB0u6eic1tbX2aHsWeb1Vz_D5jWY36-TSlS5YKUAvfDOg9qAMs5OMEOQG_2nK3kpbRFWHlDss_IXYMTvRKSiCxpgHOZE_NYoY6UV2iDuOgkTVLqLiASTwGC5Ei8WIwIuxnHnkwpUD54VF_C6UbQ1pX4t7gNF7YFTlTQS1lzUihEk5ezOUufKmxp407XaMKm0xkxC2qANnZQaGYt65-1zPAkr01cqX51-t7q7yNNax3fiOui8wpk-pXBibY3NFzUa4bgnSioOdSumYvBwHosLXSh7oVAGvHbMwY33JiDqbLhupqJe-sjCKlraaTUIqgE57pvarbGNly2foeeov-akkq2E7AScymdF0fVI65RfetcG3P24-NTt9VZz6Yiwiiw01cyk8DWjAoL2dIDsK8pmgnfvW1WR7fhny-0l0cYboY9lZ3iYrH6OCOHcMxTe23xMDzWKPjWU_mcbu4FJ2cZ7YBMJ-njhikHGvXStOd5u9H2cfYCdHYw-u9XCNWUIM7-22Pxmd8XM6wEivDeLhH3nw5mAkt7B94u0eEz4C5IoXCoyP0c8OYfD7z81tTP7HUfbdc8Do5OaO9g91rHYH1uVJkg2nFxbl2oqSvQd4nDbIkj31eMr4cENsBY_w6kxQeEqiZZh4xKLeW610tu8jiCE5Yf-D44smnUZiLzTs1w8903vG1lfWZ2Wjdrm6dlSIJb63e9kZltS8AIJaDDnQgkozSx85BtHLIGtAB0nQ_EDY8QdE9s_ZS7XFyPG6s1kX5SJduVNTQU2lUcNpIU3-Unr3KwLdfrT7xdPwamK9HpIcsgSYQvEE8SoH4rHbBRNd-YMLl7Gp8Sgu8-1aGtSDarvWMpzm0-YAckqN1OwGXozxrZcIw="}}
{"timestamp":"2026-02-07T07:57:40.676Z","type":"response_item","payload":{"type":"function_call","name":"exec_command","arguments":"{\"cmd\":\"sed -n '1,220p' src/acp/commands.ts\"}","call_id":"call_1psFe9Txy1EowCa8Ak1B79sb"}}
{"timestamp":"2026-02-07T07:57:40.681Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":247018,"cached_input_tokens":209920,"output_tokens":516,"reasoning_output_tokens":0,"total_tokens":247534},"last_token_usage":{"input_tokens":26951,"cached_input_tokens":26112,"output_tokens":45,"reasoning_output_tokens":0,"total_tokens":26996},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":2.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":8.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T07:57:40.761Z","type":"response_item","payload":{"type":"function_call_output","call_id":"call_1psFe9Txy1EowCa8Ak1B79sb","output":"Chunk ID: ff2c0b\nWall time: 0.0505 seconds\nProcess exited with code 0\nOriginal token count: 545\nOutput:\nimport type { AvailableCommand } from \"@agentclientprotocol/sdk\";\n\nexport function getAvailableCommands(): AvailableCommand[] {\n  return [\n    { name: \"help\", description: \"Show help and common commands.\" },\n    { name: \"commands\", description: \"List available commands.\" },\n    { name: \"status\", description: \"Show current status.\" },\n    {\n      name: \"context\",\n      description: \"Explain context usage (list|detail|json).\",\n      input: { hint: \"list | detail | json\" },\n    },\n    { name: \"whoami\", description: \"Show sender id (alias: /id).\" },\n    { name: \"id\", description: \"Alias for /whoami.\" },\n    { name: \"subagents\", description: \"List or manage sub-agents.\" },\n    { name: \"config\", description: \"Read or write config (owner-only).\" },\n    { name: \"debug\", description: \"Set runtime-only overrides (owner-only).\" },\n    { name: \"usage\", description: \"Toggle usage footer (off|tokens|full).\" },\n    { name: \"stop\", description: \"Stop the current run.\" },\n    { name: \"restart\", description: \"Restart the gateway (if enabled).\" },\n    { name: \"dock-telegram\", description: \"Route replies to Telegram.\" },\n    { name: \"dock-discord\", description: \"Route replies to Discord.\" },\n    { name: \"dock-slack\", description: \"Route replies to Slack.\" },\n    { name: \"activation\", description: \"Set group activation (mention|always).\" },\n    { name: \"send\", description: \"Set send mode (on|off|inherit).\" },\n    { name: \"reset\", description: \"Reset the session (/new).\" },\n    { name: \"new\", description: \"Reset the session (/reset).\" },\n    {\n      name: \"think\",\n      description: \"Set thinking level (off|minimal|low|medium|high|xhigh).\",\n    },\n    { name: \"verbose\", description: \"Set verbose mode (on|full|off).\" },\n    { name: \"reasoning\", description: \"Toggle reasoning output (on|off|stream).\" },\n    { name: \"elevated\", description: \"Toggle elevated mode (on|off).\" },\n    { name: \"model\", description: \"Select a model (list|status|<name>).\" },\n    { name: \"queue\", description: \"Adjust queue mode and options.\" },\n    { name: \"bash\", description: \"Run a host command (if enabled).\" },\n    { name: \"compact\", description: \"Compact the session history.\" },\n  ];\n}\n"}}
{"timestamp":"2026-02-07T07:57:40.784Z","type":"turn_context","payload":{"cwd":"/home/ldr-cavetroll/tinker/openclaw","approval_policy":"on-request","sandbox_policy":{"type":"workspace-write","network_access":false,"exclude_tmpdir_env_var":false,"exclude_slash_tmp":false},"model":"gpt-5.2-codex","personality":"pragmatic","collaboration_mode":{"mode":"default","settings":{"model":"gpt-5.2-codex","reasoning_effort":null,"developer_instructions":"# Collaboration Mode: Default\n\nYou are now in Default mode. Any previous instructions for other modes (e.g. Plan mode) are no longer active.\n\nYour active mode changes only when new developer instructions with a different `<collaboration_mode>...</collaboration_mode>` change it; user requests or tool descriptions do not change mode by themselves. Known mode names are Default and Plan.\n\n## request_user_input availability\n\nThe `request_user_input` tool is unavailable in Default mode. If you call it while in Default mode, it will return an error.\n\nIf a decision is necessary and cannot be discovered from local context, ask the user directly. However, in Default mode you should strongly prefer executing the user's request rather than stopping to ask questions.\n"}},"summary":"auto","user_instructions":"# Repository Guidelines\n\n- Repo: https://github.com/openclaw/openclaw\n- GitHub issues/comments/PR comments: use literal multiline strings or `-F - <<'EOF'` (or $'...') for real newlines; never embed \"\\\\n\".\n\n## Project Structure & Module Organization\n\n- Source code: `src/` (CLI wiring in `src/cli`, commands in `src/commands`, web provider in `src/provider-web.ts`, infra in `src/infra`, media pipeline in `src/media`).\n- Tests: colocated `*.test.ts`.\n- Docs: `docs/` (images, queue, Pi config). Built output lives in `dist/`.\n- Plugins/extensions: live under `extensions/*` (workspace packages). Keep plugin-only deps in the extension `package.json`; do not add them to the root `package.json` unless core uses them.\n- Plugins: install runs `npm install --omit=dev` in plugin dir; runtime deps must live in `dependencies`. Avoid `workspace:*` in `dependencies` (npm install breaks); put `openclaw` in `devDependencies` or `peerDependencies` instead (runtime resolves `openclaw/plugin-sdk` via jiti alias).\n- Installers served from `https://openclaw.ai/*`: live in the sibling repo `../openclaw.ai` (`public/install.sh`, `public/install-cli.sh`, `public/install.ps1`).\n- Messaging channels: always consider **all** built-in + extension channels when refactoring shared logic (routing, allowlists, pairing, command gating, onboarding, docs).\n  - Core channel docs: `docs/channels/`\n  - Core channel code: `src/telegram`, `src/discord`, `src/slack`, `src/signal`, `src/imessage`, `src/web` (WhatsApp web), `src/channels`, `src/routing`\n  - Extensions (channel plugins): `extensions/*` (e.g. `extensions/msteams`, `extensions/matrix`, `extensions/zalo`, `extensions/zalouser`, `extensions/voice-call`)\n- When adding channels/extensions/apps/docs, review `.github/labeler.yml` for label coverage.\n\n## Docs Linking (Mintlify)\n\n- Docs are hosted on Mintlify (docs.openclaw.ai).\n- Internal doc links in `docs/**/*.md`: root-relative, no `.md`/`.mdx` (example: `[Config](/configuration)`).\n- Section cross-references: use anchors on root-relative paths (example: `[Hooks](/configuration#hooks)`).\n- Doc headings and anchors: avoid em dashes and apostrophes in headings because they break Mintlify anchor links.\n- When Peter asks for links, reply with full `https://docs.openclaw.ai/...` URLs (not root-relative).\n- When you touch docs, end the reply with the `https://docs.openclaw.ai/...` URLs you referenced.\n- README (GitHub): keep absolute docs URLs (`https://docs.openclaw.ai/...`) so links work on GitHub.\n- Docs content must be generic: no personal device names/hostnames/paths; use placeholders like `user@gateway-host` and “gateway host”.\n\n## Docs i18n (zh-CN)\n\n- `docs/zh-CN/**` is generated; do not edit unless the user explicitly asks.\n- Pipeline: update English docs → adjust glossary (`docs/.i18n/glossary.zh-CN.json`) → run `scripts/docs-i18n` → apply targeted fixes only if instructed.\n- Translation memory: `docs/.i18n/zh-CN.tm.jsonl` (generated).\n- See `docs/.i18n/README.md`.\n- The pipeline can be slow/inefficient; if it’s dragging, ping @jospalmbier on Discord instead of hacking around it.\n\n## exe.dev VM ops (general)\n\n- Access: stable path is `ssh exe.dev` then `ssh vm-name` (assume SSH key already set).\n- SSH flaky: use exe.dev web terminal or Shelley (web agent); keep a tmux session for long ops.\n- Update: `sudo npm i -g openclaw@latest` (global install needs root on `/usr/lib/node_modules`).\n- Config: use `openclaw config set ...`; ensure `gateway.mode=local` is set.\n- Discord: store raw token only (no `DISCORD_BOT_TOKEN=` prefix).\n- Restart: stop old gateway and run:\n  `pkill -9 -f openclaw-gateway || true; nohup openclaw gateway run --bind loopback --port 18789 --force > /tmp/openclaw-gateway.log 2>&1 &`\n- Verify: `openclaw channels status --probe`, `ss -ltnp | rg 18789`, `tail -n 120 /tmp/openclaw-gateway.log`.\n\n## Build, Test, and Development Commands\n\n- Runtime baseline: Node **22+** (keep Node + Bun paths working).\n- Install deps: `pnpm install`\n- Pre-commit hooks: `prek install` (runs same checks as CI)\n- Also supported: `bun install` (keep `pnpm-lock.yaml` + Bun patching in sync when touching deps/patches).\n- Prefer Bun for TypeScript execution (scripts, dev, tests): `bun <file.ts>` / `bunx <tool>`.\n- Run CLI in dev: `pnpm openclaw ...` (bun) or `pnpm dev`.\n- Node remains supported for running built output (`dist/*`) and production installs.\n- Mac packaging (dev): `scripts/package-mac-app.sh` defaults to current arch. Release checklist: `docs/platforms/mac/release.md`.\n- Type-check/build: `pnpm build`\n- TypeScript checks: `pnpm tsgo`\n- Lint/format: `pnpm check`\n- Tests: `pnpm test` (vitest); coverage: `pnpm test:coverage`\n\n## Coding Style & Naming Conventions\n\n- Language: TypeScript (ESM). Prefer strict typing; avoid `any`.\n- Formatting/linting via Oxlint and Oxfmt; run `pnpm check` before commits.\n- Add brief code comments for tricky or non-obvious logic.\n- Keep files concise; extract helpers instead of “V2” copies. Use existing patterns for CLI options and dependency injection via `createDefaultDeps`.\n- Aim to keep files under ~700 LOC; guideline only (not a hard guardrail). Split/refactor when it improves clarity or testability.\n- Naming: use **OpenClaw** for product/app/docs headings; use `openclaw` for CLI command, package/binary, paths, and config keys.\n\n## Release Channels (Naming)\n\n- stable: tagged releases only (e.g. `vYYYY.M.D`), npm dist-tag `latest`.\n- beta: prerelease tags `vYYYY.M.D-beta.N`, npm dist-tag `beta` (may ship without macOS app).\n- dev: moving head on `main` (no tag; git checkout main).\n\n## Testing Guidelines\n\n- Framework: Vitest with V8 coverage thresholds (70% lines/branches/functions/statements).\n- Naming: match source names with `*.test.ts`; e2e in `*.e2e.test.ts`.\n- Run `pnpm test` (or `pnpm test:coverage`) before pushing when you touch logic.\n- Do not set test workers above 16; tried already.\n- Live tests (real keys): `CLAWDBOT_LIVE_TEST=1 pnpm test:live` (OpenClaw-only) or `LIVE=1 pnpm test:live` (includes provider live tests). Docker: `pnpm test:docker:live-models`, `pnpm test:docker:live-gateway`. Onboarding Docker E2E: `pnpm test:docker:onboard`.\n- Full kit + what’s covered: `docs/testing.md`.\n- Pure test additions/fixes generally do **not** need a changelog entry unless they alter user-facing behavior or the user asks for one.\n- Mobile: before using a simulator, check for connected real devices (iOS + Android) and prefer them when available.\n\n## Commit & Pull Request Guidelines\n\n- Create commits with `scripts/committer \"<msg>\" <file...>`; avoid manual `git add`/`git commit` so staging stays scoped.\n- Follow concise, action-oriented commit messages (e.g., `CLI: add verbose flag to send`).\n- Group related changes; avoid bundling unrelated refactors.\n- Changelog workflow: keep latest released version at top (no `Unreleased`); after publishing, bump version and start a new top section.\n- PRs should summarize scope, note testing performed, and mention any user-facing changes or new flags.\n- Read this when submitting a PR: `docs/help/submitting-a-pr.md` ([Submitting a PR](https://docs.openclaw.ai/help/submitting-a-pr))\n- Read this when submitting an issue: `docs/help/submitting-an-issue.md` ([Submitting an Issue](https://docs.openclaw.ai/help/submitting-an-issue))\n- PR review flow: when given a PR link, review via `gh pr view`/`gh pr diff` and do **not** change branches.\n- PR review calls: prefer a single `gh pr view --json ...` to batch metadata/comments; run `gh pr diff` only when needed.\n- Before starting a review when a GH Issue/PR is pasted: run `git pull`; if there are local changes or unpushed commits, stop and alert the user before reviewing.\n- Goal: merge PRs. Prefer **rebase** when commits are clean; **squash** when history is messy.\n- PR merge flow: create a temp branch from `main`, merge the PR branch into it (prefer squash unless commit history is important; use rebase/merge when it is). Always try to merge the PR unless it’s truly difficult, then use another approach. If we squash, add the PR author as a co-contributor. Apply fixes, add changelog entry (include PR # + thanks), run full gate before the final commit, commit, merge back to `main`, delete the temp branch, and end on `main`.\n- If you review a PR and later do work on it, land via merge/squash (no direct-main commits) and always add the PR author as a co-contributor.\n- When working on a PR: add a changelog entry with the PR number and thank the contributor.\n- When working on an issue: reference the issue in the changelog entry.\n- When merging a PR: leave a PR comment that explains exactly what we did and include the SHA hashes.\n- When merging a PR from a new contributor: add their avatar to the README “Thanks to all clawtributors” thumbnail list.\n- After merging a PR: run `bun scripts/update-clawtributors.ts` if the contributor is missing, then commit the regenerated README.\n\n## Shorthand Commands\n\n- `sync`: if working tree is dirty, commit all changes (pick a sensible Conventional Commit message), then `git pull --rebase`; if rebase conflicts and cannot resolve, stop; otherwise `git push`.\n\n### PR Workflow (Review vs Land)\n\n- **Review mode (PR link only):** read `gh pr view/diff`; **do not** switch branches; **do not** change code.\n- **Landing mode:** create an integration branch from `main`, bring in PR commits (**prefer rebase** for linear history; **merge allowed** when complexity/conflicts make it safer), apply fixes, add changelog (+ thanks + PR #), run full gate **locally before committing** (`pnpm build && pnpm check && pnpm test`), commit, merge back to `main`, then `git switch main` (never stay on a topic branch after landing). Important: contributor needs to be in git graph after this!\n\n## Security & Configuration Tips\n\n- Web provider stores creds at `~/.openclaw/credentials/`; rerun `openclaw login` if logged out.\n- Pi sessions live under `~/.openclaw/sessions/` by default; the base directory is not configurable.\n- Environment variables: see `~/.profile`.\n- Never commit or publish real phone numbers, videos, or live configuration values. Use obviously fake placeholders in docs, tests, and examples.\n- Release flow: always read `docs/reference/RELEASING.md` and `docs/platforms/mac/release.md` before any release work; do not ask routine questions once those docs answer them.\n\n## Troubleshooting\n\n- Rebrand/migration issues or legacy config/service warnings: run `openclaw doctor` (see `docs/gateway/doctor.md`).\n\n## Agent-Specific Notes\n\n- Vocabulary: \"makeup\" = \"mac app\".\n- Never edit `node_modules` (global/Homebrew/npm/git installs too). Updates overwrite. Skill notes go in `tools.md` or `AGENTS.md`.\n- Signal: \"update fly\" => `fly ssh console -a flawd-bot -C \"bash -lc 'cd /data/clawd/openclaw && git pull --rebase origin main'\"` then `fly machines restart e825232f34d058 -a flawd-bot`.\n- When working on a GitHub Issue or PR, print the full URL at the end of the task.\n- When answering questions, respond with high-confidence answers only: verify in code; do not guess.\n- Never update the Carbon dependency.\n- Any dependency with `pnpm.patchedDependencies` must use an exact version (no `^`/`~`).\n- Patching dependencies (pnpm patches, overrides, or vendored changes) requires explicit approval; do not do this by default.\n- CLI progress: use `src/cli/progress.ts` (`osc-progress` + `@clack/prompts` spinner); don’t hand-roll spinners/bars.\n- Status output: keep tables + ANSI-safe wrapping (`src/terminal/table.ts`); `status --all` = read-only/pasteable, `status --deep` = probes.\n- Gateway currently runs only as the menubar app; there is no separate LaunchAgent/helper label installed. Restart via the OpenClaw Mac app or `scripts/restart-mac.sh`; to verify/kill use `launchctl print gui/$UID | grep openclaw` rather than assuming a fixed label. **When debugging on macOS, start/stop the gateway via the app, not ad-hoc tmux sessions; kill any temporary tunnels before handoff.**\n- macOS logs: use `./scripts/clawlog.sh` to query unified logs for the OpenClaw subsystem; it supports follow/tail/category filters and expects passwordless sudo for `/usr/bin/log`.\n- If shared guardrails are available locally, review them; otherwise follow this repo's guidance.\n- SwiftUI state management (iOS/macOS): prefer the `Observation` framework (`@Observable`, `@Bindable`) over `ObservableObject`/`@StateObject`; don’t introduce new `ObservableObject` unless required for compatibility, and migrate existing usages when touching related code.\n- Connection providers: when adding a new connection, update every UI surface and docs (macOS app, web UI, mobile if applicable, onboarding/overview docs) and add matching status + configuration forms so provider lists and settings stay in sync.\n- Version locations: `package.json` (CLI), `apps/android/app/build.gradle.kts` (versionName/versionCode), `apps/ios/Sources/Info.plist` + `apps/ios/Tests/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `apps/macos/Sources/OpenClaw/Resources/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `docs/install/updating.md` (pinned npm version), `docs/platforms/mac/release.md` (APP_VERSION/APP_BUILD examples), Peekaboo Xcode projects/Info.plists (MARKETING_VERSION/CURRENT_PROJECT_VERSION).\n- **Restart apps:** “restart iOS/Android apps” means rebuild (recompile/install) and relaunch, not just kill/launch.\n- **Device checks:** before testing, verify connected real devices (iOS/Android) before reaching for simulators/emulators.\n- iOS Team ID lookup: `security find-identity -p codesigning -v` → use Apple Development (…) TEAMID. Fallback: `defaults read com.apple.dt.Xcode IDEProvisioningTeamIdentifiers`.\n- A2UI bundle hash: `src/canvas-host/a2ui/.bundle.hash` is auto-generated; ignore unexpected changes, and only regenerate via `pnpm canvas:a2ui:bundle` (or `scripts/bundle-a2ui.sh`) when needed. Commit the hash as a separate commit.\n- Release signing/notary keys are managed outside the repo; follow internal release docs.\n- Notary auth env vars (`APP_STORE_CONNECT_ISSUER_ID`, `APP_STORE_CONNECT_KEY_ID`, `APP_STORE_CONNECT_API_KEY_P8`) are expected in your environment (per internal release docs).\n- **Multi-agent safety:** do **not** create/apply/drop `git stash` entries unless explicitly requested (this includes `git pull --rebase --autostash`). Assume other agents may be working; keep unrelated WIP untouched and avoid cross-cutting state changes.\n- **Multi-agent safety:** when the user says \"push\", you may `git pull --rebase` to integrate latest changes (never discard other agents' work). When the user says \"commit\", scope to your changes only. When the user says \"commit all\", commit everything in grouped chunks.\n- **Multi-agent safety:** do **not** create/remove/modify `git worktree` checkouts (or edit `.worktrees/*`) unless explicitly requested.\n- **Multi-agent safety:** do **not** switch branches / check out a different branch unless explicitly requested.\n- **Multi-agent safety:** running multiple agents is OK as long as each agent has its own session.\n- **Multi-agent safety:** when you see unrecognized files, keep going; focus on your changes and commit only those.\n- Lint/format churn:\n  - If staged+unstaged diffs are formatting-only, auto-resolve without asking.\n  - If commit/push already requested, auto-stage and include formatting-only follow-ups in the same commit (or a tiny follow-up commit if needed), no extra confirmation.\n  - Only ask when changes are semantic (logic/data/behavior).\n- Lobster seam: use the shared CLI palette in `src/terminal/palette.ts` (no hardcoded colors); apply palette to onboarding/config prompts and other TTY UI output as needed.\n- **Multi-agent safety:** focus reports on your edits; avoid guard-rail disclaimers unless truly blocked; when multiple agents touch the same file, continue if safe; end with a brief “other files present” note only if relevant.\n- Bug investigations: read source code of relevant npm dependencies and all related local code before concluding; aim for high-confidence root cause.\n- Code style: add brief comments for tricky logic; keep files under ~500 LOC when feasible (split/refactor as needed).\n- Tool schema guardrails (google-antigravity): avoid `Type.Union` in tool input schemas; no `anyOf`/`oneOf`/`allOf`. Use `stringEnum`/`optionalStringEnum` (Type.Unsafe enum) for string lists, and `Type.Optional(...)` instead of `... | null`. Keep top-level tool schema as `type: \"object\"` with `properties`.\n- Tool schema guardrails: avoid raw `format` property names in tool schemas; some validators treat `format` as a reserved keyword and reject the schema.\n- When asked to open a “session” file, open the Pi session logs under `~/.openclaw/agents/<agentId>/sessions/*.jsonl` (use the `agent=<id>` value in the Runtime line of the system prompt; newest unless a specific ID is given), not the default `sessions.json`. If logs are needed from another machine, SSH via Tailscale and read the same path there.\n- Do not rebuild the macOS app over SSH; rebuilds must be run directly on the Mac.\n- Never send streaming/partial replies to external messaging surfaces (WhatsApp, Telegram); only final replies should be delivered there. Streaming/tool events may still go to internal UIs/control channel.\n- Voice wake forwarding tips:\n  - Command template should stay `openclaw-mac agent --message \"${text}\" --thinking low`; `VoiceWakeForwarder` already shell-escapes `${text}`. Don’t add extra quotes.\n  - launchd PATH is minimal; ensure the app’s launch agent PATH includes standard system paths plus your pnpm bin (typically `$HOME/Library/pnpm`) so `pnpm`/`openclaw` binaries resolve when invoked via `openclaw-mac`.\n- For manual `openclaw message send` messages that include `!`, use the heredoc pattern noted below to avoid the Bash tool’s escaping.\n- Release guardrails: do not change version numbers without operator’s explicit consent; always ask permission before running any npm publish/release step.\n\n## NPM + 1Password (publish/verify)\n\n- Use the 1password skill; all `op` commands must run inside a fresh tmux session.\n- Sign in: `eval \"$(op signin --account my.1password.com)\"` (app unlocked + integration on).\n- OTP: `op read 'op://Private/Npmjs/one-time password?attribute=otp'`.\n- Publish: `npm publish --access public --otp=\"<otp>\"` (run from the package dir).\n- Verify without local npmrc side effects: `npm view <pkg> version --userconfig \"$(mktemp)\"`.\n- Kill the tmux session after publish.\n\n\n## Skills\nA skill is a set of local instructions to follow that is stored in a `SKILL.md` file. Below is the list of skills that can be used. Each entry includes a name, description, and file path so you can open the source for full instructions when using a specific skill.\n### Available skills\n- merge-pr: Merge a GitHub PR via squash after /preparepr. Use when asked to merge a ready PR. Do not push to main or modify code. Ensure the PR ends in MERGED state and clean up worktrees after success. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/merge-pr/SKILL.md)\n- prepare-pr: Prepare a GitHub PR for merge by rebasing onto main, fixing review findings, running gates, committing fixes, and pushing to the PR head branch. Use after /reviewpr. Never merge or push to main. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/prepare-pr/SKILL.md)\n- review-pr: Review-only GitHub pull request analysis with the gh CLI. Use when asked to review a PR, provide structured feedback, or assess readiness to land. Do not merge, push, or make code changes you intend to keep. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/review-pr/SKILL.md)\n- figma: Use the Figma MCP server to fetch design context, screenshots, variables, and assets from Figma, and to translate Figma nodes into production code. Trigger when a task involves Figma URLs, node IDs, design-to-code implementation, or Figma MCP setup and troubleshooting. (file: /home/ldr-cavetroll/.codex/skills/figma/SKILL.md)\n- skill-creator: Guide for creating effective skills. This skill should be used when users want to create a new skill (or update an existing skill) that extends Codex's capabilities with specialized knowledge, workflows, or tool integrations. (file: /home/ldr-cavetroll/.codex/skills/.system/skill-creator/SKILL.md)\n- skill-installer: Install Codex skills into $CODEX_HOME/skills from a curated list or a GitHub repo path. Use when a user asks to list installable skills, install a curated skill, or install a skill from another repo (including private repos). (file: /home/ldr-cavetroll/.codex/skills/.system/skill-installer/SKILL.md)\n### How to use skills\n- Discovery: The list above is the skills available in this session (name + description + file path). Skill bodies live on disk at the listed paths.\n- Trigger rules: If the user names a skill (with `$SkillName` or plain text) OR the task clearly matches a skill's description shown above, you must use that skill for that turn. Multiple mentions mean use them all. Do not carry skills across turns unless re-mentioned.\n- Missing/blocked: If a named skill isn't in the list or the path can't be read, say so briefly and continue with the best fallback.\n- How to use a skill (progressive disclosure):\n  1) After deciding to use a skill, open its `SKILL.md`. Read only enough to follow the workflow.\n  2) When `SKILL.md` references relative paths (e.g., `scripts/foo.py`), resolve them relative to the skill directory listed above first, and only consider other paths if needed.\n  3) If `SKILL.md` points to extra folders such as `references/`, load only the specific files needed for the request; don't bulk-load everything.\n  4) If `scripts/` exist, prefer running or patching them instead of retyping large code blocks.\n  5) If `assets/` or templates exist, reuse them instead of recreating from scratch.\n- Coordination and sequencing:\n  - If multiple skills apply, choose the minimal set that covers the request and state the order you'll use them.\n  - Announce which skill(s) you're using and why (one short line). If you skip an obvious skill, say why.\n- Context hygiene:\n  - Keep context small: summarize long sections instead of pasting them; only load extra files when needed.\n  - Avoid deep reference-chasing: prefer opening only files directly linked from `SKILL.md` unless you're blocked.\n  - When variants exist (frameworks, providers, domains), pick only the relevant reference file(s) and note that choice.\n- Safety and fallback: If a skill can't be applied cleanly (missing files, unclear instructions), state the issue, pick the next-best approach, and continue.","truncation_policy":{"mode":"tokens","limit":10000}}}
{"timestamp":"2026-02-07T07:57:41.003Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":247018,"cached_input_tokens":209920,"output_tokens":516,"reasoning_output_tokens":0,"total_tokens":247534},"last_token_usage":{"input_tokens":26951,"cached_input_tokens":26112,"output_tokens":45,"reasoning_output_tokens":0,"total_tokens":26996},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":2.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":8.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T07:57:41.993Z","type":"event_msg","payload":{"type":"agent_reasoning","text":""}}
{"timestamp":"2026-02-07T07:57:41.993Z","type":"response_item","payload":{"type":"reasoning","summary":[{"type":"summary_text","text":""}],"content":null,"encrypted_content":"gAAAAABphvB1GFBmu5-GtD_VrcPO4LbQ_0avj3c-rHkjNAO6FCRH9LItTCXBKC1B-BbWA9FZPXpJhC-eOStwUJlkntu8CiqZRxeT65IHeAhhNRarUQGVd7SHRPO_i7xqP01I3-X5K0a8sSSLI6DTO2rk990bBmB1yMMYHnSRq008U9b3FX7UfLrKlT3SFacTito6nGlaTQDXLQpXCbRocSEz8hQ80FOQaCzGuSBvisq_HI_IRX3rQPPU68XVwDRYsrHE0XsDNYNpuoe6oUOsyUsRP_22jodn3aSliXXD7hJGEQPpaOx57iOc0omfmWVa9SBbd9r1rdSU6yIx8HquW4juM7CVEBYpN_r6Rbf6J3rMxePJfEIEgu35kQUgoKa4Tz7pX8iRNGCM5YWazwk6MKhyhsL0pzPX1iLI_3pDyChMgSI3WFvz_03_WuSKCSYkPIRYiveZv6DGuKuJaqOab-c_ollte84MTyoRtaVM6x_3lNuN_nESwmaBPd0r6Ic7puFEc1Zurkgu2byyldwUdq0PKs2sZqKjbN7p2txX66rT6q6FLhs7BpJWO0Nj3iaRnSmqwH9MYdoCtBDzSZGTpZ3NwoHqjayrUxPJf5Kg9WBsjpxEX89yzcHKJfebPD6IcAtC4CvLo1Ev0en14-pyTUryS312AIujCgIkW_uKfV1CucOAyZqz1r_4eGDTLPFdQ8RpgpMimkRdYae6aVnK6rvB82j5fEL8L3X_F8-xRYp9xFecprFtTvCRpNKqBtFFRYFdaQHwLW3k15qy0LDExth7Y4JGgNsf2NoHg6vAjk_N-Vny1GCgV8hq2jyOPJ9MQwERE-iwxpK9nNJulqq278XXqt8GGoKQ-g=="}}
{"timestamp":"2026-02-07T07:57:42.517Z","type":"response_item","payload":{"type":"function_call","name":"exec_command","arguments":"{\"cmd\":\"sed -n '1,260p' src/acp/event-mapper.ts\"}","call_id":"call_LBn7v00NtMjglu7klHhnMkrf"}}
{"timestamp":"2026-02-07T07:57:42.520Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":274621,"cached_input_tokens":236800,"output_tokens":560,"reasoning_output_tokens":0,"total_tokens":275181},"last_token_usage":{"input_tokens":27603,"cached_input_tokens":26880,"output_tokens":44,"reasoning_output_tokens":0,"total_tokens":27647},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":2.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":8.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T07:57:42.603Z","type":"response_item","payload":{"type":"function_call_output","call_id":"call_LBn7v00NtMjglu7klHhnMkrf","output":"Chunk ID: 3b032c\nWall time: 0.0516 seconds\nProcess exited with code 0\nOriginal token count: 669\nOutput:\nimport type { ContentBlock, ImageContent, ToolKind } from \"@agentclientprotocol/sdk\";\n\nexport type GatewayAttachment = {\n  type: string;\n  mimeType: string;\n  content: string;\n};\n\nexport function extractTextFromPrompt(prompt: ContentBlock[]): string {\n  const parts: string[] = [];\n  for (const block of prompt) {\n    if (block.type === \"text\") {\n      parts.push(block.text);\n      continue;\n    }\n    if (block.type === \"resource\") {\n      const resource = block.resource as { text?: string } | undefined;\n      if (resource?.text) {\n        parts.push(resource.text);\n      }\n      continue;\n    }\n    if (block.type === \"resource_link\") {\n      const title = block.title ? ` (${block.title})` : \"\";\n      const uri = block.uri ?? \"\";\n      const line = uri ? `[Resource link${title}] ${uri}` : `[Resource link${title}]`;\n      parts.push(line);\n    }\n  }\n  return parts.join(\"\\n\");\n}\n\nexport function extractAttachmentsFromPrompt(prompt: ContentBlock[]): GatewayAttachment[] {\n  const attachments: GatewayAttachment[] = [];\n  for (const block of prompt) {\n    if (block.type !== \"image\") {\n      continue;\n    }\n    const image = block as ImageContent;\n    if (!image.data || !image.mimeType) {\n      continue;\n    }\n    attachments.push({\n      type: \"image\",\n      mimeType: image.mimeType,\n      content: image.data,\n    });\n  }\n  return attachments;\n}\n\nexport function formatToolTitle(\n  name: string | undefined,\n  args: Record<string, unknown> | undefined,\n): string {\n  const base = name ?? \"tool\";\n  if (!args || Object.keys(args).length === 0) {\n    return base;\n  }\n  const parts = Object.entries(args).map(([key, value]) => {\n    const raw = typeof value === \"string\" ? value : JSON.stringify(value);\n    const safe = raw.length > 100 ? `${raw.slice(0, 100)}...` : raw;\n    return `${key}: ${safe}`;\n  });\n  return `${base}: ${parts.join(\", \")}`;\n}\n\nexport function inferToolKind(name?: string): ToolKind {\n  if (!name) {\n    return \"other\";\n  }\n  const normalized = name.toLowerCase();\n  if (normalized.includes(\"read\")) {\n    return \"read\";\n  }\n  if (normalized.includes(\"write\") || normalized.includes(\"edit\")) {\n    return \"edit\";\n  }\n  if (normalized.includes(\"delete\") || normalized.includes(\"remove\")) {\n    return \"delete\";\n  }\n  if (normalized.includes(\"move\") || normalized.includes(\"rename\")) {\n    return \"move\";\n  }\n  if (normalized.includes(\"search\") || normalized.includes(\"find\")) {\n    return \"search\";\n  }\n  if (normalized.includes(\"exec\") || normalized.includes(\"run\") || normalized.includes(\"bash\")) {\n    return \"execute\";\n  }\n  if (normalized.includes(\"fetch\") || normalized.includes(\"http\")) {\n    return \"fetch\";\n  }\n  return \"other\";\n}\n"}}
{"timestamp":"2026-02-07T07:57:42.631Z","type":"turn_context","payload":{"cwd":"/home/ldr-cavetroll/tinker/openclaw","approval_policy":"on-request","sandbox_policy":{"type":"workspace-write","network_access":false,"exclude_tmpdir_env_var":false,"exclude_slash_tmp":false},"model":"gpt-5.2-codex","personality":"pragmatic","collaboration_mode":{"mode":"default","settings":{"model":"gpt-5.2-codex","reasoning_effort":null,"developer_instructions":"# Collaboration Mode: Default\n\nYou are now in Default mode. Any previous instructions for other modes (e.g. Plan mode) are no longer active.\n\nYour active mode changes only when new developer instructions with a different `<collaboration_mode>...</collaboration_mode>` change it; user requests or tool descriptions do not change mode by themselves. Known mode names are Default and Plan.\n\n## request_user_input availability\n\nThe `request_user_input` tool is unavailable in Default mode. If you call it while in Default mode, it will return an error.\n\nIf a decision is necessary and cannot be discovered from local context, ask the user directly. However, in Default mode you should strongly prefer executing the user's request rather than stopping to ask questions.\n"}},"summary":"auto","user_instructions":"# Repository Guidelines\n\n- Repo: https://github.com/openclaw/openclaw\n- GitHub issues/comments/PR comments: use literal multiline strings or `-F - <<'EOF'` (or $'...') for real newlines; never embed \"\\\\n\".\n\n## Project Structure & Module Organization\n\n- Source code: `src/` (CLI wiring in `src/cli`, commands in `src/commands`, web provider in `src/provider-web.ts`, infra in `src/infra`, media pipeline in `src/media`).\n- Tests: colocated `*.test.ts`.\n- Docs: `docs/` (images, queue, Pi config). Built output lives in `dist/`.\n- Plugins/extensions: live under `extensions/*` (workspace packages). Keep plugin-only deps in the extension `package.json`; do not add them to the root `package.json` unless core uses them.\n- Plugins: install runs `npm install --omit=dev` in plugin dir; runtime deps must live in `dependencies`. Avoid `workspace:*` in `dependencies` (npm install breaks); put `openclaw` in `devDependencies` or `peerDependencies` instead (runtime resolves `openclaw/plugin-sdk` via jiti alias).\n- Installers served from `https://openclaw.ai/*`: live in the sibling repo `../openclaw.ai` (`public/install.sh`, `public/install-cli.sh`, `public/install.ps1`).\n- Messaging channels: always consider **all** built-in + extension channels when refactoring shared logic (routing, allowlists, pairing, command gating, onboarding, docs).\n  - Core channel docs: `docs/channels/`\n  - Core channel code: `src/telegram`, `src/discord`, `src/slack`, `src/signal`, `src/imessage`, `src/web` (WhatsApp web), `src/channels`, `src/routing`\n  - Extensions (channel plugins): `extensions/*` (e.g. `extensions/msteams`, `extensions/matrix`, `extensions/zalo`, `extensions/zalouser`, `extensions/voice-call`)\n- When adding channels/extensions/apps/docs, review `.github/labeler.yml` for label coverage.\n\n## Docs Linking (Mintlify)\n\n- Docs are hosted on Mintlify (docs.openclaw.ai).\n- Internal doc links in `docs/**/*.md`: root-relative, no `.md`/`.mdx` (example: `[Config](/configuration)`).\n- Section cross-references: use anchors on root-relative paths (example: `[Hooks](/configuration#hooks)`).\n- Doc headings and anchors: avoid em dashes and apostrophes in headings because they break Mintlify anchor links.\n- When Peter asks for links, reply with full `https://docs.openclaw.ai/...` URLs (not root-relative).\n- When you touch docs, end the reply with the `https://docs.openclaw.ai/...` URLs you referenced.\n- README (GitHub): keep absolute docs URLs (`https://docs.openclaw.ai/...`) so links work on GitHub.\n- Docs content must be generic: no personal device names/hostnames/paths; use placeholders like `user@gateway-host` and “gateway host”.\n\n## Docs i18n (zh-CN)\n\n- `docs/zh-CN/**` is generated; do not edit unless the user explicitly asks.\n- Pipeline: update English docs → adjust glossary (`docs/.i18n/glossary.zh-CN.json`) → run `scripts/docs-i18n` → apply targeted fixes only if instructed.\n- Translation memory: `docs/.i18n/zh-CN.tm.jsonl` (generated).\n- See `docs/.i18n/README.md`.\n- The pipeline can be slow/inefficient; if it’s dragging, ping @jospalmbier on Discord instead of hacking around it.\n\n## exe.dev VM ops (general)\n\n- Access: stable path is `ssh exe.dev` then `ssh vm-name` (assume SSH key already set).\n- SSH flaky: use exe.dev web terminal or Shelley (web agent); keep a tmux session for long ops.\n- Update: `sudo npm i -g openclaw@latest` (global install needs root on `/usr/lib/node_modules`).\n- Config: use `openclaw config set ...`; ensure `gateway.mode=local` is set.\n- Discord: store raw token only (no `DISCORD_BOT_TOKEN=` prefix).\n- Restart: stop old gateway and run:\n  `pkill -9 -f openclaw-gateway || true; nohup openclaw gateway run --bind loopback --port 18789 --force > /tmp/openclaw-gateway.log 2>&1 &`\n- Verify: `openclaw channels status --probe`, `ss -ltnp | rg 18789`, `tail -n 120 /tmp/openclaw-gateway.log`.\n\n## Build, Test, and Development Commands\n\n- Runtime baseline: Node **22+** (keep Node + Bun paths working).\n- Install deps: `pnpm install`\n- Pre-commit hooks: `prek install` (runs same checks as CI)\n- Also supported: `bun install` (keep `pnpm-lock.yaml` + Bun patching in sync when touching deps/patches).\n- Prefer Bun for TypeScript execution (scripts, dev, tests): `bun <file.ts>` / `bunx <tool>`.\n- Run CLI in dev: `pnpm openclaw ...` (bun) or `pnpm dev`.\n- Node remains supported for running built output (`dist/*`) and production installs.\n- Mac packaging (dev): `scripts/package-mac-app.sh` defaults to current arch. Release checklist: `docs/platforms/mac/release.md`.\n- Type-check/build: `pnpm build`\n- TypeScript checks: `pnpm tsgo`\n- Lint/format: `pnpm check`\n- Tests: `pnpm test` (vitest); coverage: `pnpm test:coverage`\n\n## Coding Style & Naming Conventions\n\n- Language: TypeScript (ESM). Prefer strict typing; avoid `any`.\n- Formatting/linting via Oxlint and Oxfmt; run `pnpm check` before commits.\n- Add brief code comments for tricky or non-obvious logic.\n- Keep files concise; extract helpers instead of “V2” copies. Use existing patterns for CLI options and dependency injection via `createDefaultDeps`.\n- Aim to keep files under ~700 LOC; guideline only (not a hard guardrail). Split/refactor when it improves clarity or testability.\n- Naming: use **OpenClaw** for product/app/docs headings; use `openclaw` for CLI command, package/binary, paths, and config keys.\n\n## Release Channels (Naming)\n\n- stable: tagged releases only (e.g. `vYYYY.M.D`), npm dist-tag `latest`.\n- beta: prerelease tags `vYYYY.M.D-beta.N`, npm dist-tag `beta` (may ship without macOS app).\n- dev: moving head on `main` (no tag; git checkout main).\n\n## Testing Guidelines\n\n- Framework: Vitest with V8 coverage thresholds (70% lines/branches/functions/statements).\n- Naming: match source names with `*.test.ts`; e2e in `*.e2e.test.ts`.\n- Run `pnpm test` (or `pnpm test:coverage`) before pushing when you touch logic.\n- Do not set test workers above 16; tried already.\n- Live tests (real keys): `CLAWDBOT_LIVE_TEST=1 pnpm test:live` (OpenClaw-only) or `LIVE=1 pnpm test:live` (includes provider live tests). Docker: `pnpm test:docker:live-models`, `pnpm test:docker:live-gateway`. Onboarding Docker E2E: `pnpm test:docker:onboard`.\n- Full kit + what’s covered: `docs/testing.md`.\n- Pure test additions/fixes generally do **not** need a changelog entry unless they alter user-facing behavior or the user asks for one.\n- Mobile: before using a simulator, check for connected real devices (iOS + Android) and prefer them when available.\n\n## Commit & Pull Request Guidelines\n\n- Create commits with `scripts/committer \"<msg>\" <file...>`; avoid manual `git add`/`git commit` so staging stays scoped.\n- Follow concise, action-oriented commit messages (e.g., `CLI: add verbose flag to send`).\n- Group related changes; avoid bundling unrelated refactors.\n- Changelog workflow: keep latest released version at top (no `Unreleased`); after publishing, bump version and start a new top section.\n- PRs should summarize scope, note testing performed, and mention any user-facing changes or new flags.\n- Read this when submitting a PR: `docs/help/submitting-a-pr.md` ([Submitting a PR](https://docs.openclaw.ai/help/submitting-a-pr))\n- Read this when submitting an issue: `docs/help/submitting-an-issue.md` ([Submitting an Issue](https://docs.openclaw.ai/help/submitting-an-issue))\n- PR review flow: when given a PR link, review via `gh pr view`/`gh pr diff` and do **not** change branches.\n- PR review calls: prefer a single `gh pr view --json ...` to batch metadata/comments; run `gh pr diff` only when needed.\n- Before starting a review when a GH Issue/PR is pasted: run `git pull`; if there are local changes or unpushed commits, stop and alert the user before reviewing.\n- Goal: merge PRs. Prefer **rebase** when commits are clean; **squash** when history is messy.\n- PR merge flow: create a temp branch from `main`, merge the PR branch into it (prefer squash unless commit history is important; use rebase/merge when it is). Always try to merge the PR unless it’s truly difficult, then use another approach. If we squash, add the PR author as a co-contributor. Apply fixes, add changelog entry (include PR # + thanks), run full gate before the final commit, commit, merge back to `main`, delete the temp branch, and end on `main`.\n- If you review a PR and later do work on it, land via merge/squash (no direct-main commits) and always add the PR author as a co-contributor.\n- When working on a PR: add a changelog entry with the PR number and thank the contributor.\n- When working on an issue: reference the issue in the changelog entry.\n- When merging a PR: leave a PR comment that explains exactly what we did and include the SHA hashes.\n- When merging a PR from a new contributor: add their avatar to the README “Thanks to all clawtributors” thumbnail list.\n- After merging a PR: run `bun scripts/update-clawtributors.ts` if the contributor is missing, then commit the regenerated README.\n\n## Shorthand Commands\n\n- `sync`: if working tree is dirty, commit all changes (pick a sensible Conventional Commit message), then `git pull --rebase`; if rebase conflicts and cannot resolve, stop; otherwise `git push`.\n\n### PR Workflow (Review vs Land)\n\n- **Review mode (PR link only):** read `gh pr view/diff`; **do not** switch branches; **do not** change code.\n- **Landing mode:** create an integration branch from `main`, bring in PR commits (**prefer rebase** for linear history; **merge allowed** when complexity/conflicts make it safer), apply fixes, add changelog (+ thanks + PR #), run full gate **locally before committing** (`pnpm build && pnpm check && pnpm test`), commit, merge back to `main`, then `git switch main` (never stay on a topic branch after landing). Important: contributor needs to be in git graph after this!\n\n## Security & Configuration Tips\n\n- Web provider stores creds at `~/.openclaw/credentials/`; rerun `openclaw login` if logged out.\n- Pi sessions live under `~/.openclaw/sessions/` by default; the base directory is not configurable.\n- Environment variables: see `~/.profile`.\n- Never commit or publish real phone numbers, videos, or live configuration values. Use obviously fake placeholders in docs, tests, and examples.\n- Release flow: always read `docs/reference/RELEASING.md` and `docs/platforms/mac/release.md` before any release work; do not ask routine questions once those docs answer them.\n\n## Troubleshooting\n\n- Rebrand/migration issues or legacy config/service warnings: run `openclaw doctor` (see `docs/gateway/doctor.md`).\n\n## Agent-Specific Notes\n\n- Vocabulary: \"makeup\" = \"mac app\".\n- Never edit `node_modules` (global/Homebrew/npm/git installs too). Updates overwrite. Skill notes go in `tools.md` or `AGENTS.md`.\n- Signal: \"update fly\" => `fly ssh console -a flawd-bot -C \"bash -lc 'cd /data/clawd/openclaw && git pull --rebase origin main'\"` then `fly machines restart e825232f34d058 -a flawd-bot`.\n- When working on a GitHub Issue or PR, print the full URL at the end of the task.\n- When answering questions, respond with high-confidence answers only: verify in code; do not guess.\n- Never update the Carbon dependency.\n- Any dependency with `pnpm.patchedDependencies` must use an exact version (no `^`/`~`).\n- Patching dependencies (pnpm patches, overrides, or vendored changes) requires explicit approval; do not do this by default.\n- CLI progress: use `src/cli/progress.ts` (`osc-progress` + `@clack/prompts` spinner); don’t hand-roll spinners/bars.\n- Status output: keep tables + ANSI-safe wrapping (`src/terminal/table.ts`); `status --all` = read-only/pasteable, `status --deep` = probes.\n- Gateway currently runs only as the menubar app; there is no separate LaunchAgent/helper label installed. Restart via the OpenClaw Mac app or `scripts/restart-mac.sh`; to verify/kill use `launchctl print gui/$UID | grep openclaw` rather than assuming a fixed label. **When debugging on macOS, start/stop the gateway via the app, not ad-hoc tmux sessions; kill any temporary tunnels before handoff.**\n- macOS logs: use `./scripts/clawlog.sh` to query unified logs for the OpenClaw subsystem; it supports follow/tail/category filters and expects passwordless sudo for `/usr/bin/log`.\n- If shared guardrails are available locally, review them; otherwise follow this repo's guidance.\n- SwiftUI state management (iOS/macOS): prefer the `Observation` framework (`@Observable`, `@Bindable`) over `ObservableObject`/`@StateObject`; don’t introduce new `ObservableObject` unless required for compatibility, and migrate existing usages when touching related code.\n- Connection providers: when adding a new connection, update every UI surface and docs (macOS app, web UI, mobile if applicable, onboarding/overview docs) and add matching status + configuration forms so provider lists and settings stay in sync.\n- Version locations: `package.json` (CLI), `apps/android/app/build.gradle.kts` (versionName/versionCode), `apps/ios/Sources/Info.plist` + `apps/ios/Tests/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `apps/macos/Sources/OpenClaw/Resources/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `docs/install/updating.md` (pinned npm version), `docs/platforms/mac/release.md` (APP_VERSION/APP_BUILD examples), Peekaboo Xcode projects/Info.plists (MARKETING_VERSION/CURRENT_PROJECT_VERSION).\n- **Restart apps:** “restart iOS/Android apps” means rebuild (recompile/install) and relaunch, not just kill/launch.\n- **Device checks:** before testing, verify connected real devices (iOS/Android) before reaching for simulators/emulators.\n- iOS Team ID lookup: `security find-identity -p codesigning -v` → use Apple Development (…) TEAMID. Fallback: `defaults read com.apple.dt.Xcode IDEProvisioningTeamIdentifiers`.\n- A2UI bundle hash: `src/canvas-host/a2ui/.bundle.hash` is auto-generated; ignore unexpected changes, and only regenerate via `pnpm canvas:a2ui:bundle` (or `scripts/bundle-a2ui.sh`) when needed. Commit the hash as a separate commit.\n- Release signing/notary keys are managed outside the repo; follow internal release docs.\n- Notary auth env vars (`APP_STORE_CONNECT_ISSUER_ID`, `APP_STORE_CONNECT_KEY_ID`, `APP_STORE_CONNECT_API_KEY_P8`) are expected in your environment (per internal release docs).\n- **Multi-agent safety:** do **not** create/apply/drop `git stash` entries unless explicitly requested (this includes `git pull --rebase --autostash`). Assume other agents may be working; keep unrelated WIP untouched and avoid cross-cutting state changes.\n- **Multi-agent safety:** when the user says \"push\", you may `git pull --rebase` to integrate latest changes (never discard other agents' work). When the user says \"commit\", scope to your changes only. When the user says \"commit all\", commit everything in grouped chunks.\n- **Multi-agent safety:** do **not** create/remove/modify `git worktree` checkouts (or edit `.worktrees/*`) unless explicitly requested.\n- **Multi-agent safety:** do **not** switch branches / check out a different branch unless explicitly requested.\n- **Multi-agent safety:** running multiple agents is OK as long as each agent has its own session.\n- **Multi-agent safety:** when you see unrecognized files, keep going; focus on your changes and commit only those.\n- Lint/format churn:\n  - If staged+unstaged diffs are formatting-only, auto-resolve without asking.\n  - If commit/push already requested, auto-stage and include formatting-only follow-ups in the same commit (or a tiny follow-up commit if needed), no extra confirmation.\n  - Only ask when changes are semantic (logic/data/behavior).\n- Lobster seam: use the shared CLI palette in `src/terminal/palette.ts` (no hardcoded colors); apply palette to onboarding/config prompts and other TTY UI output as needed.\n- **Multi-agent safety:** focus reports on your edits; avoid guard-rail disclaimers unless truly blocked; when multiple agents touch the same file, continue if safe; end with a brief “other files present” note only if relevant.\n- Bug investigations: read source code of relevant npm dependencies and all related local code before concluding; aim for high-confidence root cause.\n- Code style: add brief comments for tricky logic; keep files under ~500 LOC when feasible (split/refactor as needed).\n- Tool schema guardrails (google-antigravity): avoid `Type.Union` in tool input schemas; no `anyOf`/`oneOf`/`allOf`. Use `stringEnum`/`optionalStringEnum` (Type.Unsafe enum) for string lists, and `Type.Optional(...)` instead of `... | null`. Keep top-level tool schema as `type: \"object\"` with `properties`.\n- Tool schema guardrails: avoid raw `format` property names in tool schemas; some validators treat `format` as a reserved keyword and reject the schema.\n- When asked to open a “session” file, open the Pi session logs under `~/.openclaw/agents/<agentId>/sessions/*.jsonl` (use the `agent=<id>` value in the Runtime line of the system prompt; newest unless a specific ID is given), not the default `sessions.json`. If logs are needed from another machine, SSH via Tailscale and read the same path there.\n- Do not rebuild the macOS app over SSH; rebuilds must be run directly on the Mac.\n- Never send streaming/partial replies to external messaging surfaces (WhatsApp, Telegram); only final replies should be delivered there. Streaming/tool events may still go to internal UIs/control channel.\n- Voice wake forwarding tips:\n  - Command template should stay `openclaw-mac agent --message \"${text}\" --thinking low`; `VoiceWakeForwarder` already shell-escapes `${text}`. Don’t add extra quotes.\n  - launchd PATH is minimal; ensure the app’s launch agent PATH includes standard system paths plus your pnpm bin (typically `$HOME/Library/pnpm`) so `pnpm`/`openclaw` binaries resolve when invoked via `openclaw-mac`.\n- For manual `openclaw message send` messages that include `!`, use the heredoc pattern noted below to avoid the Bash tool’s escaping.\n- Release guardrails: do not change version numbers without operator’s explicit consent; always ask permission before running any npm publish/release step.\n\n## NPM + 1Password (publish/verify)\n\n- Use the 1password skill; all `op` commands must run inside a fresh tmux session.\n- Sign in: `eval \"$(op signin --account my.1password.com)\"` (app unlocked + integration on).\n- OTP: `op read 'op://Private/Npmjs/one-time password?attribute=otp'`.\n- Publish: `npm publish --access public --otp=\"<otp>\"` (run from the package dir).\n- Verify without local npmrc side effects: `npm view <pkg> version --userconfig \"$(mktemp)\"`.\n- Kill the tmux session after publish.\n\n\n## Skills\nA skill is a set of local instructions to follow that is stored in a `SKILL.md` file. Below is the list of skills that can be used. Each entry includes a name, description, and file path so you can open the source for full instructions when using a specific skill.\n### Available skills\n- merge-pr: Merge a GitHub PR via squash after /preparepr. Use when asked to merge a ready PR. Do not push to main or modify code. Ensure the PR ends in MERGED state and clean up worktrees after success. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/merge-pr/SKILL.md)\n- prepare-pr: Prepare a GitHub PR for merge by rebasing onto main, fixing review findings, running gates, committing fixes, and pushing to the PR head branch. Use after /reviewpr. Never merge or push to main. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/prepare-pr/SKILL.md)\n- review-pr: Review-only GitHub pull request analysis with the gh CLI. Use when asked to review a PR, provide structured feedback, or assess readiness to land. Do not merge, push, or make code changes you intend to keep. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/review-pr/SKILL.md)\n- figma: Use the Figma MCP server to fetch design context, screenshots, variables, and assets from Figma, and to translate Figma nodes into production code. Trigger when a task involves Figma URLs, node IDs, design-to-code implementation, or Figma MCP setup and troubleshooting. (file: /home/ldr-cavetroll/.codex/skills/figma/SKILL.md)\n- skill-creator: Guide for creating effective skills. This skill should be used when users want to create a new skill (or update an existing skill) that extends Codex's capabilities with specialized knowledge, workflows, or tool integrations. (file: /home/ldr-cavetroll/.codex/skills/.system/skill-creator/SKILL.md)\n- skill-installer: Install Codex skills into $CODEX_HOME/skills from a curated list or a GitHub repo path. Use when a user asks to list installable skills, install a curated skill, or install a skill from another repo (including private repos). (file: /home/ldr-cavetroll/.codex/skills/.system/skill-installer/SKILL.md)\n### How to use skills\n- Discovery: The list above is the skills available in this session (name + description + file path). Skill bodies live on disk at the listed paths.\n- Trigger rules: If the user names a skill (with `$SkillName` or plain text) OR the task clearly matches a skill's description shown above, you must use that skill for that turn. Multiple mentions mean use them all. Do not carry skills across turns unless re-mentioned.\n- Missing/blocked: If a named skill isn't in the list or the path can't be read, say so briefly and continue with the best fallback.\n- How to use a skill (progressive disclosure):\n  1) After deciding to use a skill, open its `SKILL.md`. Read only enough to follow the workflow.\n  2) When `SKILL.md` references relative paths (e.g., `scripts/foo.py`), resolve them relative to the skill directory listed above first, and only consider other paths if needed.\n  3) If `SKILL.md` points to extra folders such as `references/`, load only the specific files needed for the request; don't bulk-load everything.\n  4) If `scripts/` exist, prefer running or patching them instead of retyping large code blocks.\n  5) If `assets/` or templates exist, reuse them instead of recreating from scratch.\n- Coordination and sequencing:\n  - If multiple skills apply, choose the minimal set that covers the request and state the order you'll use them.\n  - Announce which skill(s) you're using and why (one short line). If you skip an obvious skill, say why.\n- Context hygiene:\n  - Keep context small: summarize long sections instead of pasting them; only load extra files when needed.\n  - Avoid deep reference-chasing: prefer opening only files directly linked from `SKILL.md` unless you're blocked.\n  - When variants exist (frameworks, providers, domains), pick only the relevant reference file(s) and note that choice.\n- Safety and fallback: If a skill can't be applied cleanly (missing files, unclear instructions), state the issue, pick the next-best approach, and continue.","truncation_policy":{"mode":"tokens","limit":10000}}}
{"timestamp":"2026-02-07T07:57:42.910Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":274621,"cached_input_tokens":236800,"output_tokens":560,"reasoning_output_tokens":0,"total_tokens":275181},"last_token_usage":{"input_tokens":27603,"cached_input_tokens":26880,"output_tokens":44,"reasoning_output_tokens":0,"total_tokens":27647},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":2.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":8.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T07:57:43.991Z","type":"event_msg","payload":{"type":"agent_reasoning","text":"**Noting utility classification**"}}
{"timestamp":"2026-02-07T07:57:43.991Z","type":"response_item","payload":{"type":"reasoning","summary":[{"type":"summary_text","text":"**Noting utility classification**"}],"content":null,"encrypted_content":"gAAAAABphvB327HhHp0NmP7hn92pRCXLXyKnAFkHEsvsbR8a2zDG0jaA_kVo0Ko99zVuM24lZp6LKo2DLylm63vnn0jsfEaUlLnxDvqV1BRgTSKoH-8rjZ0LJxdPRh7dfZlaZqsxYke-4m_-b2K2mLY8usQOIg088PYX-WXry1uVq6tb0YCu9l_nv0W2gCNjrWq6uIA54mZAsgN3m5g8altgH8_ws597rXdlnrOOo0n92BqX5AQ3dYBG29hZnKnHtZdT3eg-nR2fXIEeiqbWlnMGy6luOBQhZqJY5jdqOYtDVNON5uxwgteVAeFCx0sROobBY5aLcEB_nfuIuAEbIUdTz5zXLXRI0EktUSzxP268j-X4A9b42UOnUc4MgObtNd6DiydBzwx7SgGP1lqAXgYfSvmUzgwI8GHLsh5Bs6hDgaR56bWIasnkd69CoWOfT6MPlTWqQ7wjPnfT9z9_RvntSvgaOOWxKQGZxGqMLZEpHbUP36xJa3CJEi7qPdOU6yOInlcqGnJaREG4i5onMU0S6cajdmAms9YZU1aThbwQ6JO9T_NpG1C_njQsr_Qu14nOnJBrxkNiAz9-eXkAMj5_u9ddUV3NH5ZYjD9dIY1omcg1Svo3XcShFMDv-V_wl0_X2HSaffROIlA6313j4XxbKM-aNcL6P0qMyf2K6dzsK9obVhwALBso1R5Ai7qcJruW_BZO-raDuX2b9j2ALYA84m33VIFcJcyZGO16iDYFNmbyOc47uyKmvrLTrEhRWRsljyqKURKwt7Y9y7hihfVUG3R4YskTC7htVHdgG5y6NsQLOgPXM8N6_gEh6-OZwkxnE3XoWCnp4eB238os5U_lrFT48eeYdQ=="}}
{"timestamp":"2026-02-07T07:57:44.327Z","type":"response_item","payload":{"type":"function_call","name":"exec_command","arguments":"{\"cmd\":\"sed -n '1,200p' src/acp/meta.ts\"}","call_id":"call_QfTYHBhRNzRjW15gpO8WUxCC"}}
{"timestamp":"2026-02-07T07:57:44.332Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":302961,"cached_input_tokens":264320,"output_tokens":601,"reasoning_output_tokens":0,"total_tokens":303562},"last_token_usage":{"input_tokens":28340,"cached_input_tokens":27520,"output_tokens":41,"reasoning_output_tokens":0,"total_tokens":28381},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":2.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":8.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T07:57:44.413Z","type":"response_item","payload":{"type":"function_call_output","call_id":"call_QfTYHBhRNzRjW15gpO8WUxCC","output":"Chunk ID: 55babc\nWall time: 0.0517 seconds\nProcess exited with code 0\nOriginal token count: 245\nOutput:\nexport function readString(\n  meta: Record<string, unknown> | null | undefined,\n  keys: string[],\n): string | undefined {\n  if (!meta) {\n    return undefined;\n  }\n  for (const key of keys) {\n    const value = meta[key];\n    if (typeof value === \"string\" && value.trim()) {\n      return value.trim();\n    }\n  }\n  return undefined;\n}\n\nexport function readBool(\n  meta: Record<string, unknown> | null | undefined,\n  keys: string[],\n): boolean | undefined {\n  if (!meta) {\n    return undefined;\n  }\n  for (const key of keys) {\n    const value = meta[key];\n    if (typeof value === \"boolean\") {\n      return value;\n    }\n  }\n  return undefined;\n}\n\nexport function readNumber(\n  meta: Record<string, unknown> | null | undefined,\n  keys: string[],\n): number | undefined {\n  if (!meta) {\n    return undefined;\n  }\n  for (const key of keys) {\n    const value = meta[key];\n    if (typeof value === \"number\" && Number.isFinite(value)) {\n      return value;\n    }\n  }\n  return undefined;\n}\n"}}
{"timestamp":"2026-02-07T07:57:44.437Z","type":"turn_context","payload":{"cwd":"/home/ldr-cavetroll/tinker/openclaw","approval_policy":"on-request","sandbox_policy":{"type":"workspace-write","network_access":false,"exclude_tmpdir_env_var":false,"exclude_slash_tmp":false},"model":"gpt-5.2-codex","personality":"pragmatic","collaboration_mode":{"mode":"default","settings":{"model":"gpt-5.2-codex","reasoning_effort":null,"developer_instructions":"# Collaboration Mode: Default\n\nYou are now in Default mode. Any previous instructions for other modes (e.g. Plan mode) are no longer active.\n\nYour active mode changes only when new developer instructions with a different `<collaboration_mode>...</collaboration_mode>` change it; user requests or tool descriptions do not change mode by themselves. Known mode names are Default and Plan.\n\n## request_user_input availability\n\nThe `request_user_input` tool is unavailable in Default mode. If you call it while in Default mode, it will return an error.\n\nIf a decision is necessary and cannot be discovered from local context, ask the user directly. However, in Default mode you should strongly prefer executing the user's request rather than stopping to ask questions.\n"}},"summary":"auto","user_instructions":"# Repository Guidelines\n\n- Repo: https://github.com/openclaw/openclaw\n- GitHub issues/comments/PR comments: use literal multiline strings or `-F - <<'EOF'` (or $'...') for real newlines; never embed \"\\\\n\".\n\n## Project Structure & Module Organization\n\n- Source code: `src/` (CLI wiring in `src/cli`, commands in `src/commands`, web provider in `src/provider-web.ts`, infra in `src/infra`, media pipeline in `src/media`).\n- Tests: colocated `*.test.ts`.\n- Docs: `docs/` (images, queue, Pi config). Built output lives in `dist/`.\n- Plugins/extensions: live under `extensions/*` (workspace packages). Keep plugin-only deps in the extension `package.json`; do not add them to the root `package.json` unless core uses them.\n- Plugins: install runs `npm install --omit=dev` in plugin dir; runtime deps must live in `dependencies`. Avoid `workspace:*` in `dependencies` (npm install breaks); put `openclaw` in `devDependencies` or `peerDependencies` instead (runtime resolves `openclaw/plugin-sdk` via jiti alias).\n- Installers served from `https://openclaw.ai/*`: live in the sibling repo `../openclaw.ai` (`public/install.sh`, `public/install-cli.sh`, `public/install.ps1`).\n- Messaging channels: always consider **all** built-in + extension channels when refactoring shared logic (routing, allowlists, pairing, command gating, onboarding, docs).\n  - Core channel docs: `docs/channels/`\n  - Core channel code: `src/telegram`, `src/discord`, `src/slack`, `src/signal`, `src/imessage`, `src/web` (WhatsApp web), `src/channels`, `src/routing`\n  - Extensions (channel plugins): `extensions/*` (e.g. `extensions/msteams`, `extensions/matrix`, `extensions/zalo`, `extensions/zalouser`, `extensions/voice-call`)\n- When adding channels/extensions/apps/docs, review `.github/labeler.yml` for label coverage.\n\n## Docs Linking (Mintlify)\n\n- Docs are hosted on Mintlify (docs.openclaw.ai).\n- Internal doc links in `docs/**/*.md`: root-relative, no `.md`/`.mdx` (example: `[Config](/configuration)`).\n- Section cross-references: use anchors on root-relative paths (example: `[Hooks](/configuration#hooks)`).\n- Doc headings and anchors: avoid em dashes and apostrophes in headings because they break Mintlify anchor links.\n- When Peter asks for links, reply with full `https://docs.openclaw.ai/...` URLs (not root-relative).\n- When you touch docs, end the reply with the `https://docs.openclaw.ai/...` URLs you referenced.\n- README (GitHub): keep absolute docs URLs (`https://docs.openclaw.ai/...`) so links work on GitHub.\n- Docs content must be generic: no personal device names/hostnames/paths; use placeholders like `user@gateway-host` and “gateway host”.\n\n## Docs i18n (zh-CN)\n\n- `docs/zh-CN/**` is generated; do not edit unless the user explicitly asks.\n- Pipeline: update English docs → adjust glossary (`docs/.i18n/glossary.zh-CN.json`) → run `scripts/docs-i18n` → apply targeted fixes only if instructed.\n- Translation memory: `docs/.i18n/zh-CN.tm.jsonl` (generated).\n- See `docs/.i18n/README.md`.\n- The pipeline can be slow/inefficient; if it’s dragging, ping @jospalmbier on Discord instead of hacking around it.\n\n## exe.dev VM ops (general)\n\n- Access: stable path is `ssh exe.dev` then `ssh vm-name` (assume SSH key already set).\n- SSH flaky: use exe.dev web terminal or Shelley (web agent); keep a tmux session for long ops.\n- Update: `sudo npm i -g openclaw@latest` (global install needs root on `/usr/lib/node_modules`).\n- Config: use `openclaw config set ...`; ensure `gateway.mode=local` is set.\n- Discord: store raw token only (no `DISCORD_BOT_TOKEN=` prefix).\n- Restart: stop old gateway and run:\n  `pkill -9 -f openclaw-gateway || true; nohup openclaw gateway run --bind loopback --port 18789 --force > /tmp/openclaw-gateway.log 2>&1 &`\n- Verify: `openclaw channels status --probe`, `ss -ltnp | rg 18789`, `tail -n 120 /tmp/openclaw-gateway.log`.\n\n## Build, Test, and Development Commands\n\n- Runtime baseline: Node **22+** (keep Node + Bun paths working).\n- Install deps: `pnpm install`\n- Pre-commit hooks: `prek install` (runs same checks as CI)\n- Also supported: `bun install` (keep `pnpm-lock.yaml` + Bun patching in sync when touching deps/patches).\n- Prefer Bun for TypeScript execution (scripts, dev, tests): `bun <file.ts>` / `bunx <tool>`.\n- Run CLI in dev: `pnpm openclaw ...` (bun) or `pnpm dev`.\n- Node remains supported for running built output (`dist/*`) and production installs.\n- Mac packaging (dev): `scripts/package-mac-app.sh` defaults to current arch. Release checklist: `docs/platforms/mac/release.md`.\n- Type-check/build: `pnpm build`\n- TypeScript checks: `pnpm tsgo`\n- Lint/format: `pnpm check`\n- Tests: `pnpm test` (vitest); coverage: `pnpm test:coverage`\n\n## Coding Style & Naming Conventions\n\n- Language: TypeScript (ESM). Prefer strict typing; avoid `any`.\n- Formatting/linting via Oxlint and Oxfmt; run `pnpm check` before commits.\n- Add brief code comments for tricky or non-obvious logic.\n- Keep files concise; extract helpers instead of “V2” copies. Use existing patterns for CLI options and dependency injection via `createDefaultDeps`.\n- Aim to keep files under ~700 LOC; guideline only (not a hard guardrail). Split/refactor when it improves clarity or testability.\n- Naming: use **OpenClaw** for product/app/docs headings; use `openclaw` for CLI command, package/binary, paths, and config keys.\n\n## Release Channels (Naming)\n\n- stable: tagged releases only (e.g. `vYYYY.M.D`), npm dist-tag `latest`.\n- beta: prerelease tags `vYYYY.M.D-beta.N`, npm dist-tag `beta` (may ship without macOS app).\n- dev: moving head on `main` (no tag; git checkout main).\n\n## Testing Guidelines\n\n- Framework: Vitest with V8 coverage thresholds (70% lines/branches/functions/statements).\n- Naming: match source names with `*.test.ts`; e2e in `*.e2e.test.ts`.\n- Run `pnpm test` (or `pnpm test:coverage`) before pushing when you touch logic.\n- Do not set test workers above 16; tried already.\n- Live tests (real keys): `CLAWDBOT_LIVE_TEST=1 pnpm test:live` (OpenClaw-only) or `LIVE=1 pnpm test:live` (includes provider live tests). Docker: `pnpm test:docker:live-models`, `pnpm test:docker:live-gateway`. Onboarding Docker E2E: `pnpm test:docker:onboard`.\n- Full kit + what’s covered: `docs/testing.md`.\n- Pure test additions/fixes generally do **not** need a changelog entry unless they alter user-facing behavior or the user asks for one.\n- Mobile: before using a simulator, check for connected real devices (iOS + Android) and prefer them when available.\n\n## Commit & Pull Request Guidelines\n\n- Create commits with `scripts/committer \"<msg>\" <file...>`; avoid manual `git add`/`git commit` so staging stays scoped.\n- Follow concise, action-oriented commit messages (e.g., `CLI: add verbose flag to send`).\n- Group related changes; avoid bundling unrelated refactors.\n- Changelog workflow: keep latest released version at top (no `Unreleased`); after publishing, bump version and start a new top section.\n- PRs should summarize scope, note testing performed, and mention any user-facing changes or new flags.\n- Read this when submitting a PR: `docs/help/submitting-a-pr.md` ([Submitting a PR](https://docs.openclaw.ai/help/submitting-a-pr))\n- Read this when submitting an issue: `docs/help/submitting-an-issue.md` ([Submitting an Issue](https://docs.openclaw.ai/help/submitting-an-issue))\n- PR review flow: when given a PR link, review via `gh pr view`/`gh pr diff` and do **not** change branches.\n- PR review calls: prefer a single `gh pr view --json ...` to batch metadata/comments; run `gh pr diff` only when needed.\n- Before starting a review when a GH Issue/PR is pasted: run `git pull`; if there are local changes or unpushed commits, stop and alert the user before reviewing.\n- Goal: merge PRs. Prefer **rebase** when commits are clean; **squash** when history is messy.\n- PR merge flow: create a temp branch from `main`, merge the PR branch into it (prefer squash unless commit history is important; use rebase/merge when it is). Always try to merge the PR unless it’s truly difficult, then use another approach. If we squash, add the PR author as a co-contributor. Apply fixes, add changelog entry (include PR # + thanks), run full gate before the final commit, commit, merge back to `main`, delete the temp branch, and end on `main`.\n- If you review a PR and later do work on it, land via merge/squash (no direct-main commits) and always add the PR author as a co-contributor.\n- When working on a PR: add a changelog entry with the PR number and thank the contributor.\n- When working on an issue: reference the issue in the changelog entry.\n- When merging a PR: leave a PR comment that explains exactly what we did and include the SHA hashes.\n- When merging a PR from a new contributor: add their avatar to the README “Thanks to all clawtributors” thumbnail list.\n- After merging a PR: run `bun scripts/update-clawtributors.ts` if the contributor is missing, then commit the regenerated README.\n\n## Shorthand Commands\n\n- `sync`: if working tree is dirty, commit all changes (pick a sensible Conventional Commit message), then `git pull --rebase`; if rebase conflicts and cannot resolve, stop; otherwise `git push`.\n\n### PR Workflow (Review vs Land)\n\n- **Review mode (PR link only):** read `gh pr view/diff`; **do not** switch branches; **do not** change code.\n- **Landing mode:** create an integration branch from `main`, bring in PR commits (**prefer rebase** for linear history; **merge allowed** when complexity/conflicts make it safer), apply fixes, add changelog (+ thanks + PR #), run full gate **locally before committing** (`pnpm build && pnpm check && pnpm test`), commit, merge back to `main`, then `git switch main` (never stay on a topic branch after landing). Important: contributor needs to be in git graph after this!\n\n## Security & Configuration Tips\n\n- Web provider stores creds at `~/.openclaw/credentials/`; rerun `openclaw login` if logged out.\n- Pi sessions live under `~/.openclaw/sessions/` by default; the base directory is not configurable.\n- Environment variables: see `~/.profile`.\n- Never commit or publish real phone numbers, videos, or live configuration values. Use obviously fake placeholders in docs, tests, and examples.\n- Release flow: always read `docs/reference/RELEASING.md` and `docs/platforms/mac/release.md` before any release work; do not ask routine questions once those docs answer them.\n\n## Troubleshooting\n\n- Rebrand/migration issues or legacy config/service warnings: run `openclaw doctor` (see `docs/gateway/doctor.md`).\n\n## Agent-Specific Notes\n\n- Vocabulary: \"makeup\" = \"mac app\".\n- Never edit `node_modules` (global/Homebrew/npm/git installs too). Updates overwrite. Skill notes go in `tools.md` or `AGENTS.md`.\n- Signal: \"update fly\" => `fly ssh console -a flawd-bot -C \"bash -lc 'cd /data/clawd/openclaw && git pull --rebase origin main'\"` then `fly machines restart e825232f34d058 -a flawd-bot`.\n- When working on a GitHub Issue or PR, print the full URL at the end of the task.\n- When answering questions, respond with high-confidence answers only: verify in code; do not guess.\n- Never update the Carbon dependency.\n- Any dependency with `pnpm.patchedDependencies` must use an exact version (no `^`/`~`).\n- Patching dependencies (pnpm patches, overrides, or vendored changes) requires explicit approval; do not do this by default.\n- CLI progress: use `src/cli/progress.ts` (`osc-progress` + `@clack/prompts` spinner); don’t hand-roll spinners/bars.\n- Status output: keep tables + ANSI-safe wrapping (`src/terminal/table.ts`); `status --all` = read-only/pasteable, `status --deep` = probes.\n- Gateway currently runs only as the menubar app; there is no separate LaunchAgent/helper label installed. Restart via the OpenClaw Mac app or `scripts/restart-mac.sh`; to verify/kill use `launchctl print gui/$UID | grep openclaw` rather than assuming a fixed label. **When debugging on macOS, start/stop the gateway via the app, not ad-hoc tmux sessions; kill any temporary tunnels before handoff.**\n- macOS logs: use `./scripts/clawlog.sh` to query unified logs for the OpenClaw subsystem; it supports follow/tail/category filters and expects passwordless sudo for `/usr/bin/log`.\n- If shared guardrails are available locally, review them; otherwise follow this repo's guidance.\n- SwiftUI state management (iOS/macOS): prefer the `Observation` framework (`@Observable`, `@Bindable`) over `ObservableObject`/`@StateObject`; don’t introduce new `ObservableObject` unless required for compatibility, and migrate existing usages when touching related code.\n- Connection providers: when adding a new connection, update every UI surface and docs (macOS app, web UI, mobile if applicable, onboarding/overview docs) and add matching status + configuration forms so provider lists and settings stay in sync.\n- Version locations: `package.json` (CLI), `apps/android/app/build.gradle.kts` (versionName/versionCode), `apps/ios/Sources/Info.plist` + `apps/ios/Tests/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `apps/macos/Sources/OpenClaw/Resources/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `docs/install/updating.md` (pinned npm version), `docs/platforms/mac/release.md` (APP_VERSION/APP_BUILD examples), Peekaboo Xcode projects/Info.plists (MARKETING_VERSION/CURRENT_PROJECT_VERSION).\n- **Restart apps:** “restart iOS/Android apps” means rebuild (recompile/install) and relaunch, not just kill/launch.\n- **Device checks:** before testing, verify connected real devices (iOS/Android) before reaching for simulators/emulators.\n- iOS Team ID lookup: `security find-identity -p codesigning -v` → use Apple Development (…) TEAMID. Fallback: `defaults read com.apple.dt.Xcode IDEProvisioningTeamIdentifiers`.\n- A2UI bundle hash: `src/canvas-host/a2ui/.bundle.hash` is auto-generated; ignore unexpected changes, and only regenerate via `pnpm canvas:a2ui:bundle` (or `scripts/bundle-a2ui.sh`) when needed. Commit the hash as a separate commit.\n- Release signing/notary keys are managed outside the repo; follow internal release docs.\n- Notary auth env vars (`APP_STORE_CONNECT_ISSUER_ID`, `APP_STORE_CONNECT_KEY_ID`, `APP_STORE_CONNECT_API_KEY_P8`) are expected in your environment (per internal release docs).\n- **Multi-agent safety:** do **not** create/apply/drop `git stash` entries unless explicitly requested (this includes `git pull --rebase --autostash`). Assume other agents may be working; keep unrelated WIP untouched and avoid cross-cutting state changes.\n- **Multi-agent safety:** when the user says \"push\", you may `git pull --rebase` to integrate latest changes (never discard other agents' work). When the user says \"commit\", scope to your changes only. When the user says \"commit all\", commit everything in grouped chunks.\n- **Multi-agent safety:** do **not** create/remove/modify `git worktree` checkouts (or edit `.worktrees/*`) unless explicitly requested.\n- **Multi-agent safety:** do **not** switch branches / check out a different branch unless explicitly requested.\n- **Multi-agent safety:** running multiple agents is OK as long as each agent has its own session.\n- **Multi-agent safety:** when you see unrecognized files, keep going; focus on your changes and commit only those.\n- Lint/format churn:\n  - If staged+unstaged diffs are formatting-only, auto-resolve without asking.\n  - If commit/push already requested, auto-stage and include formatting-only follow-ups in the same commit (or a tiny follow-up commit if needed), no extra confirmation.\n  - Only ask when changes are semantic (logic/data/behavior).\n- Lobster seam: use the shared CLI palette in `src/terminal/palette.ts` (no hardcoded colors); apply palette to onboarding/config prompts and other TTY UI output as needed.\n- **Multi-agent safety:** focus reports on your edits; avoid guard-rail disclaimers unless truly blocked; when multiple agents touch the same file, continue if safe; end with a brief “other files present” note only if relevant.\n- Bug investigations: read source code of relevant npm dependencies and all related local code before concluding; aim for high-confidence root cause.\n- Code style: add brief comments for tricky logic; keep files under ~500 LOC when feasible (split/refactor as needed).\n- Tool schema guardrails (google-antigravity): avoid `Type.Union` in tool input schemas; no `anyOf`/`oneOf`/`allOf`. Use `stringEnum`/`optionalStringEnum` (Type.Unsafe enum) for string lists, and `Type.Optional(...)` instead of `... | null`. Keep top-level tool schema as `type: \"object\"` with `properties`.\n- Tool schema guardrails: avoid raw `format` property names in tool schemas; some validators treat `format` as a reserved keyword and reject the schema.\n- When asked to open a “session” file, open the Pi session logs under `~/.openclaw/agents/<agentId>/sessions/*.jsonl` (use the `agent=<id>` value in the Runtime line of the system prompt; newest unless a specific ID is given), not the default `sessions.json`. If logs are needed from another machine, SSH via Tailscale and read the same path there.\n- Do not rebuild the macOS app over SSH; rebuilds must be run directly on the Mac.\n- Never send streaming/partial replies to external messaging surfaces (WhatsApp, Telegram); only final replies should be delivered there. Streaming/tool events may still go to internal UIs/control channel.\n- Voice wake forwarding tips:\n  - Command template should stay `openclaw-mac agent --message \"${text}\" --thinking low`; `VoiceWakeForwarder` already shell-escapes `${text}`. Don’t add extra quotes.\n  - launchd PATH is minimal; ensure the app’s launch agent PATH includes standard system paths plus your pnpm bin (typically `$HOME/Library/pnpm`) so `pnpm`/`openclaw` binaries resolve when invoked via `openclaw-mac`.\n- For manual `openclaw message send` messages that include `!`, use the heredoc pattern noted below to avoid the Bash tool’s escaping.\n- Release guardrails: do not change version numbers without operator’s explicit consent; always ask permission before running any npm publish/release step.\n\n## NPM + 1Password (publish/verify)\n\n- Use the 1password skill; all `op` commands must run inside a fresh tmux session.\n- Sign in: `eval \"$(op signin --account my.1password.com)\"` (app unlocked + integration on).\n- OTP: `op read 'op://Private/Npmjs/one-time password?attribute=otp'`.\n- Publish: `npm publish --access public --otp=\"<otp>\"` (run from the package dir).\n- Verify without local npmrc side effects: `npm view <pkg> version --userconfig \"$(mktemp)\"`.\n- Kill the tmux session after publish.\n\n\n## Skills\nA skill is a set of local instructions to follow that is stored in a `SKILL.md` file. Below is the list of skills that can be used. Each entry includes a name, description, and file path so you can open the source for full instructions when using a specific skill.\n### Available skills\n- merge-pr: Merge a GitHub PR via squash after /preparepr. Use when asked to merge a ready PR. Do not push to main or modify code. Ensure the PR ends in MERGED state and clean up worktrees after success. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/merge-pr/SKILL.md)\n- prepare-pr: Prepare a GitHub PR for merge by rebasing onto main, fixing review findings, running gates, committing fixes, and pushing to the PR head branch. Use after /reviewpr. Never merge or push to main. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/prepare-pr/SKILL.md)\n- review-pr: Review-only GitHub pull request analysis with the gh CLI. Use when asked to review a PR, provide structured feedback, or assess readiness to land. Do not merge, push, or make code changes you intend to keep. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/review-pr/SKILL.md)\n- figma: Use the Figma MCP server to fetch design context, screenshots, variables, and assets from Figma, and to translate Figma nodes into production code. Trigger when a task involves Figma URLs, node IDs, design-to-code implementation, or Figma MCP setup and troubleshooting. (file: /home/ldr-cavetroll/.codex/skills/figma/SKILL.md)\n- skill-creator: Guide for creating effective skills. This skill should be used when users want to create a new skill (or update an existing skill) that extends Codex's capabilities with specialized knowledge, workflows, or tool integrations. (file: /home/ldr-cavetroll/.codex/skills/.system/skill-creator/SKILL.md)\n- skill-installer: Install Codex skills into $CODEX_HOME/skills from a curated list or a GitHub repo path. Use when a user asks to list installable skills, install a curated skill, or install a skill from another repo (including private repos). (file: /home/ldr-cavetroll/.codex/skills/.system/skill-installer/SKILL.md)\n### How to use skills\n- Discovery: The list above is the skills available in this session (name + description + file path). Skill bodies live on disk at the listed paths.\n- Trigger rules: If the user names a skill (with `$SkillName` or plain text) OR the task clearly matches a skill's description shown above, you must use that skill for that turn. Multiple mentions mean use them all. Do not carry skills across turns unless re-mentioned.\n- Missing/blocked: If a named skill isn't in the list or the path can't be read, say so briefly and continue with the best fallback.\n- How to use a skill (progressive disclosure):\n  1) After deciding to use a skill, open its `SKILL.md`. Read only enough to follow the workflow.\n  2) When `SKILL.md` references relative paths (e.g., `scripts/foo.py`), resolve them relative to the skill directory listed above first, and only consider other paths if needed.\n  3) If `SKILL.md` points to extra folders such as `references/`, load only the specific files needed for the request; don't bulk-load everything.\n  4) If `scripts/` exist, prefer running or patching them instead of retyping large code blocks.\n  5) If `assets/` or templates exist, reuse them instead of recreating from scratch.\n- Coordination and sequencing:\n  - If multiple skills apply, choose the minimal set that covers the request and state the order you'll use them.\n  - Announce which skill(s) you're using and why (one short line). If you skip an obvious skill, say why.\n- Context hygiene:\n  - Keep context small: summarize long sections instead of pasting them; only load extra files when needed.\n  - Avoid deep reference-chasing: prefer opening only files directly linked from `SKILL.md` unless you're blocked.\n  - When variants exist (frameworks, providers, domains), pick only the relevant reference file(s) and note that choice.\n- Safety and fallback: If a skill can't be applied cleanly (missing files, unclear instructions), state the issue, pick the next-best approach, and continue.","truncation_policy":{"mode":"tokens","limit":10000}}}
{"timestamp":"2026-02-07T07:57:44.815Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":302961,"cached_input_tokens":264320,"output_tokens":601,"reasoning_output_tokens":0,"total_tokens":303562},"last_token_usage":{"input_tokens":28340,"cached_input_tokens":27520,"output_tokens":41,"reasoning_output_tokens":0,"total_tokens":28381},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":2.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":8.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T07:57:57.177Z","type":"event_msg","payload":{"type":"agent_reasoning","text":"**Summarizing repo structure and ACP implementation**\n\nThe repo follows the AGENTS.md guidelines by modularizing agent logic under `src/acp`, implementing the Agent Context Protocol (ACP) primarily via `src/acp/index.ts`, which re-exports key functions like `serveAcpGateway`. Core logic lives in `server.ts`, `translator.ts`, and session files. The ACP gateway bridges stdin/stdout as NDJSON streams using `@agentclientprotocol/sdk`’s `AgentSideConnection`. Gateway setup includes connection details, auth resolution, and event handling configured in `translator.ts`. CLI commands related to ACP likely reside under `src/cli`, wiring entrypoints per AGENTS conventions. Additional documentation exists in `docs.acp.md` for deeper reference. This structure cleanly follows AGENTS.md by separating concerns and using the SDK to implement the agent protocol."}}
{"timestamp":"2026-02-07T07:57:57.178Z","type":"event_msg","payload":{"type":"agent_reasoning","text":"**Detailing ACP index role and session handling**\n\nThe `src/acp/index.ts` serves as the public entry for the ACP package, exporting functions like `serveAcpGateway` and exposing the session store API. It acts as the module surface for ACP consumers, while core implementations reside in `server.ts` and `translator.ts`. The ACP server (e.g., openclaw acp) supports integrations such as IDEs by handling gateway communication and session management. The code maps ACP prompts to `gateway.chat.send`, processes delta events to update sessions, manages tool events, and maintains session metadata including `_meta` parsing and session labels. This modular structure keeps the index file focused on exports and enables clean internal logic separation."}}
{"timestamp":"2026-02-07T07:57:57.178Z","type":"response_item","payload":{"type":"reasoning","summary":[{"type":"summary_text","text":"**Summarizing repo structure and ACP implementation**\n\nThe repo follows the AGENTS.md guidelines by modularizing agent logic under `src/acp`, implementing the Agent Context Protocol (ACP) primarily via `src/acp/index.ts`, which re-exports key functions like `serveAcpGateway`. Core logic lives in `server.ts`, `translator.ts`, and session files. The ACP gateway bridges stdin/stdout as NDJSON streams using `@agentclientprotocol/sdk`’s `AgentSideConnection`. Gateway setup includes connection details, auth resolution, and event handling configured in `translator.ts`. CLI commands related to ACP likely reside under `src/cli`, wiring entrypoints per AGENTS conventions. Additional documentation exists in `docs.acp.md` for deeper reference. This structure cleanly follows AGENTS.md by separating concerns and using the SDK to implement the agent protocol."},{"type":"summary_text","text":"**Detailing ACP index role and session handling**\n\nThe `src/acp/index.ts` serves as the public entry for the ACP package, exporting functions like `serveAcpGateway` and exposing the session store API. It acts as the module surface for ACP consumers, while core implementations reside in `server.ts` and `translator.ts`. The ACP server (e.g., openclaw acp) supports integrations such as IDEs by handling gateway communication and session management. The code maps ACP prompts to `gateway.chat.send`, processes delta events to update sessions, manages tool events, and maintains session metadata including `_meta` parsing and session labels. This modular structure keeps the index file focused on exports and enables clean internal logic separation."}],"content":null,"encrypted_content":"gAAAAABphvCFddRLbvLEa1LXkI2JVkZzjYr8_rQAVHEkQ34S8odU6gxwjXOkB1swhe6fGoXzv8VooT6-5bH2L3Q_9L7BApM_5_akWNLIahN_1cPeAEsDbVGlOBpAKhz9VVGmBzUSbrHK8UUpHXrfSFNW8PFF5uT0bK90XQwKM_OFmDtxJcMoC7x06ynEvOQM2IkfiuA286pPHoIniQbB6WHvXiz-wMYZN93AACPQ2IWckU5t4oUYqrOxwUZMN2NWLM-smAGoGj9HnjmoXZ82N8QeQf3OzXf8ERqcVnyIRfXPakLnLbIWiWxU5CT-paaANSW5riZshDc-RmlCXBYgHBsjnR4cYHP1P6bWgH2al0Ub031TVDX0_a2sKNenfw2ErjzLhDxJrxYbeBJY_Y1uYeV0cqJFqQ5iz_swxCTyITYaabT0WD7l5HGIhNJS2nMpJmn258NCktMhuNovRz5hEXyQ9dlHautU-7mKjrgk3FsH_XEtSOdkXH8NRbDj9mPdkiOVCliAcE9bPyRkGMvUOh_0xHUWOEh8V-XK5li-MkeA6wyFtYi4640kfCesKAvAc3iarHljNAD444NCtzfTbJRXdriWNpfwMMxkYobQtpT5K_9rkKu8Ft7KAS-leEeReu-py7-ZZej_NRJTUpZwJ5NFbtAHkNj4UriVC32cuzn6YHZLWdzz_-CtAVWF84G-p94PaPILutZaWwRRT6-f2nOF0w9z3049kVlFsvp_9IT5V8z994xTVpG0MWiaGiRWcHNyVux8wRZQFmxW-2mcwwWiN8FIX25Cho8I6A9hiN9FstN4CFluBm5Vh8qdz5HNVaIAwVT0lm-Bcnv1qz2W4wN8TET1fbH6Ms0e1SslVj62G3G_6leBfTTSGTPJ-JpDdQwLc7EzuAYFe0B9vfh9blHwdXq7f5WDhVfc8HIHyxuPAWet-cX8KPNYD8VDGN6qq0gol4dmEpdAbd2AgI5hlq47RGNtFnb2RhmsqcLjyBQmInum116BBWSdyqcOJXk9olD_xUBAlcpEjX1Kb50nX2QtfySMWoO8a0ttk3q-3RDM-0v1tmWyzIx98HN-_yszmMRtcqh4OMij8m0uBu81ezX3Hd5T8fYJFQQ-y9Vi8uz1kEsVPMK-z4t714ahzXIEVI-Hbzx3Zu93cOhFmwG5UXgumxdsoqaddg40UwGr_SLQ1yEld5R0KmmT8ZH9tOYolV871H3Y7aTRh7hrg8hXHc4MPg2CWOBOFUTvrJL5_kp4nXKLrrOlx4UqblEvwNSqCLtLK3EJwfwc8mFPj_ykuQgyFEM3kSsPTmnVRmw1dogFpttnnOKio2Z5Tpai1LgXGhBCndkCvQkyp7i2Yjg-shZOZqXRSKIiZXEqw4GYB-F46TVHyGGbHQd-x54y9sMjon1Rn-e6KfsaTf25s33jlIR1k3c6GIZVRvs7K2pJ4rmMcCGugnVOQa3xgHMiMrC95KBRqZ0_0lL0Ej77gVs6YJxc-apmYeFu6t2Bc3M4DDiBcLCPeD-8z1MdtIUGJlc87_azMoO0Hh4_oDE0cQJEh296F9RHb7-y0dAXiPY9P4M1ETrXIWawzC5OBlA48qDlATyXbQYub2o9w4VRG3SXLqjOPIZm9AsVj4zz79veMCoyCIhMpvuYVA3gBe-1evtRxQsxPUEQHANtPUoHVqQ13ObAMUY5XNISRt8ytBe6Rn408_askD19Q9c6uHVf2pWHT6prfL94nOmi6E5v1LADdaR5YwMHM14fMHE2Uvr8Q3TDNaXMAwapKNT1WkDoKE-ZeYDvDbLpSs4gdzoCrAT0_VD1dMxu2MvBO-P2MMo8iM5fn9JwicSujmSUMbPNFnnX0U0nH9NE1lguxp6YAs8P7--LQAWLNjdTAfYNBj3FGKCuIszlHcWpFBYq72TtubI4gJb4vOApGI-fZciZ7QsjPYEYq3K4-rqSI_gWvTp5YwVZ9mpcEwvrbRDqSwSsbk9CvmMSCWqj2n130G4EB2pKu7S4QEcpRnPBmvDLIMoKlc6aLRjrBuDAqHs2H-bxQds4xXDrQbE4wT2sCSOa8x8kkjHDKYJ-UTSeLkvRTyUhpuRwZaHA96mXsGu-5e-NvCELJ8yGRnXB8k2v6z2QuNFiq3PE6WivHbR-aJB01ieV5nvK2_AOp2o_b73YfE4sqjCC8WOJLZSsn4Cx63R-Q627wgqguU5i5i5PpkFEHhKqDzROubuYK8DqiJ6a1gW0Eq3zo2mrwY73vHuNh6n5hhp7T_Y44Qm00QLfusKqw5IUA_UV1sYNwBO3L1Swlq-b-CNW3aGZsc4HopjbdOjN1ntZnYy_BnpP5v58UyxwO8yKIOJxXWuwgNE58dYUR1HwbnfKrVB37dcuN-4PRU4IpcJwyC9IecXU_QprdgbRlesu1HeurjI9rKJIigA77Rp1PUOJO_oOei5Jszx7YJHh_QGEIhhJC7D7IjnggUhDoaFYb5fZU-JS5YbLYdJ0pJGokYLPvImYq9izEsyK8bwYd7PIY1mV-NWf_v3Z5sCiNNKO8FKulx3wDjN6xnRxjzeIcG3Cprk5QPAihn5XnRQstRDOdArn9ssOlaVxACK-3ZqwIWDUGg_WiyOd1hEVyZMdo37e9NwtJWgrj6LV0LKtTcXoDksK2aJ5uECL8VAc4nEpb9lNB34QJ3fsoMbWkRzcHyprIz1sWH3yvaKDYt5-hGbePwD3p8wYExFWGjRvRa2RX2xNhVfRZj_CG-GygJhRqSd9x4_s1JhyGaO4_uEOsLjVUq42gzDCOjuFTXL3-gkFvV3H-ILXyDvuMULpBndNMwnU3MaqmUe5oc1rUQPDifk9HFC8EZqTVNwsVEM3XmI5H90MXRpQ51S4fQLGTj2UaPvNysiymLVz4XjXdfpLyD3QzKN9-1R0tRYn3XSzmxdCJcGdRP1cVkGfGSIXvWM6R_aaufo7qfyyq1jPq13tZYLhOt42RpKWl7xzMV-UbovMh-tKx34SlAX0fN8j-QCcr7iEKdPLDTNu-OQq0PHYb5I0cKA48bfdWYcjUuZYEWfBjmiabmFVbFAfsI0YsMoIdwwEJQOJBtT_1ZN3ZY_3Jeiz_SPCrB4J8hn6zP8nB1Jj8xWwxa0mEp80BW_kr_unKlGDE4l_7dIzaS4KxX1XYBzZvtBXXpzg1wFZc0n7-VxvnQo0RDHsW8vSavgH6O3V31ZiETTpe1w64Oy7aRgdMEE8Mif7IJUe95-oy-nZtpvw0Alh4cwg7hTjCY7XhTo7tAAe8lm_WSQZO2fGQHOlj-cTNoxmZS-bmseuYbCjbzjq3vT-3ozOwuuXkDt5v-4ahk_AwgzSty_bO60BddBHYwvxS4Yw6LIq82p7JRYZgpeSl7Ip0eJ9gnohqaxTl_A65aWrlNZxNKVeCA72MjLyLgqpdcvQl_HnFXuwsW5-5jHTJaKBSvX-SOPN3q9B_6WIyA8CLUDV-R2lLeLaZhRq9XTtsCt_pDvBmmwRhqOFied2qzORW_nR-zbILkd1S8HhTVDMV4WKUiMHr6fgaPDDSyeX42H2Fo5tllgsYI_RABqeQ8uHV3Biqh5zgzgRP6BdsquSV2NM_Za3S0Ug"}}
{"timestamp":"2026-02-07T07:58:06.319Z","type":"event_msg","payload":{"type":"agent_message","message":"**Repo Structure (From `AGENTS.md`)**  \nHigh-level layout is conventional for this repo:\n- Source code lives under `src/` with CLI wiring in `src/cli`, commands in `src/commands`, infra in `src/infra`, media pipeline in `src/media`, and web provider in `src/provider-web.ts`.  \n- Tests are colocated as `*.test.ts`.  \n- Docs live under `docs/` (Mintlify rules apply).  \nThese conventions are explicitly listed in `AGENTS.md` and align with the actual tree you have in the repo root.  \n\n**ACP Implementation: What `src/acp/index.ts` Actually Does**  \n`src/acp/index.ts` is just the public entry surface for ACP functionality. It re-exports the ACP server function and session store types so other parts of the codebase (or external consumers) can import ACP without reaching into internal files.  \nSee `src/acp/index.ts`.\n\n**Where the ACP Protocol Is Implemented**  \nThe real ACP implementation is in `src/acp/server.ts`, `src/acp/translator.ts`, and the session helpers.\n\n**How the ACP Gateway Works (Code Flow)**  \n1. **Server setup and wire protocol**  \n   `serveAcpGateway` creates an ACP server over stdin/stdout using `@agentclientprotocol/sdk`.  \n   - It builds gateway connection details + auth from config/env.  \n   - It instantiates a `GatewayClient` that emits events and accepts requests.  \n   - It wraps `process.stdin`/`process.stdout` with `ndJsonStream`, then constructs an `AgentSideConnection`.  \n   - It then creates `AcpGatewayAgent` which implements the ACP agent interface.  \n   See `src/acp/server.ts`.\n\n2. **ACP agent implementation and bridging**  \n   `AcpGatewayAgent` implements the ACP `Agent` interface from the SDK.  \n   - `initialize` returns ACP capabilities and agent info (`ACP_AGENT_INFO`).  \n   - `newSession`/`loadSession` resolve a gateway session key using ACP `_meta` options or CLI defaults.  \n   - `prompt` converts ACP prompt blocks into gateway `chat.send` with text + attachments.  \n   - It maps gateway streaming deltas into ACP `sessionUpdate` chunks, and final states into ACP stop reasons.  \n   - It maps gateway tool events to ACP tool call updates.  \n   See `src/acp/translator.ts`.\n\n3. **Session mapping and meta options**  \n   ACP `_meta` fields are parsed to control session behavior:  \n   - `sessionKey`, `sessionLabel`, `resetSession`, `requireExisting`, `prefixCwd`  \n   These are resolved into gateway sessions (or reset on demand).  \n   See `src/acp/session-mapper.ts` and `src/acp/meta.ts`.\n\n4. **Session storage and run tracking**  \n   Sessions are stored in an in-memory store; active runs can be cancelled.  \n   See `src/acp/session.ts`.\n\n5. **ACP agent info and options**  \n   ACP agent metadata is defined in one place and exported for reuse.  \n   See `src/acp/types.ts`.\n\n**Summary (Answering Your Specific Question)**  \n- `src/acp/index.ts` is the entry point and does not implement ACP logic itself. It re-exports the ACP gateway server (`serveAcpGateway`) and session store types.  \n- The ACP protocol implementation is primarily in `src/acp/server.ts` (wiring ACP over NDJSON on stdin/stdout) and `src/acp/translator.ts` (bridging ACP calls to the OpenClaw Gateway and back).  \n- Session resolution, meta parsing, and run lifecycle are in `src/acp/session-mapper.ts`, `src/acp/meta.ts`, and `src/acp/session.ts`.\n\nIf you want, I can walk through a concrete request flow end-to-end (ACP `prompt` → gateway `chat.send` → ACP streamed updates) using the exact call sites."}}
{"timestamp":"2026-02-07T07:58:06.319Z","type":"response_item","payload":{"type":"message","role":"assistant","content":[{"type":"output_text","text":"**Repo Structure (From `AGENTS.md`)**  \nHigh-level layout is conventional for this repo:\n- Source code lives under `src/` with CLI wiring in `src/cli`, commands in `src/commands`, infra in `src/infra`, media pipeline in `src/media`, and web provider in `src/provider-web.ts`.  \n- Tests are colocated as `*.test.ts`.  \n- Docs live under `docs/` (Mintlify rules apply).  \nThese conventions are explicitly listed in `AGENTS.md` and align with the actual tree you have in the repo root.  \n\n**ACP Implementation: What `src/acp/index.ts` Actually Does**  \n`src/acp/index.ts` is just the public entry surface for ACP functionality. It re-exports the ACP server function and session store types so other parts of the codebase (or external consumers) can import ACP without reaching into internal files.  \nSee `src/acp/index.ts`.\n\n**Where the ACP Protocol Is Implemented**  \nThe real ACP implementation is in `src/acp/server.ts`, `src/acp/translator.ts`, and the session helpers.\n\n**How the ACP Gateway Works (Code Flow)**  \n1. **Server setup and wire protocol**  \n   `serveAcpGateway` creates an ACP server over stdin/stdout using `@agentclientprotocol/sdk`.  \n   - It builds gateway connection details + auth from config/env.  \n   - It instantiates a `GatewayClient` that emits events and accepts requests.  \n   - It wraps `process.stdin`/`process.stdout` with `ndJsonStream`, then constructs an `AgentSideConnection`.  \n   - It then creates `AcpGatewayAgent` which implements the ACP agent interface.  \n   See `src/acp/server.ts`.\n\n2. **ACP agent implementation and bridging**  \n   `AcpGatewayAgent` implements the ACP `Agent` interface from the SDK.  \n   - `initialize` returns ACP capabilities and agent info (`ACP_AGENT_INFO`).  \n   - `newSession`/`loadSession` resolve a gateway session key using ACP `_meta` options or CLI defaults.  \n   - `prompt` converts ACP prompt blocks into gateway `chat.send` with text + attachments.  \n   - It maps gateway streaming deltas into ACP `sessionUpdate` chunks, and final states into ACP stop reasons.  \n   - It maps gateway tool events to ACP tool call updates.  \n   See `src/acp/translator.ts`.\n\n3. **Session mapping and meta options**  \n   ACP `_meta` fields are parsed to control session behavior:  \n   - `sessionKey`, `sessionLabel`, `resetSession`, `requireExisting`, `prefixCwd`  \n   These are resolved into gateway sessions (or reset on demand).  \n   See `src/acp/session-mapper.ts` and `src/acp/meta.ts`.\n\n4. **Session storage and run tracking**  \n   Sessions are stored in an in-memory store; active runs can be cancelled.  \n   See `src/acp/session.ts`.\n\n5. **ACP agent info and options**  \n   ACP agent metadata is defined in one place and exported for reuse.  \n   See `src/acp/types.ts`.\n\n**Summary (Answering Your Specific Question)**  \n- `src/acp/index.ts` is the entry point and does not implement ACP logic itself. It re-exports the ACP gateway server (`serveAcpGateway`) and session store types.  \n- The ACP protocol implementation is primarily in `src/acp/server.ts` (wiring ACP over NDJSON on stdin/stdout) and `src/acp/translator.ts` (bridging ACP calls to the OpenClaw Gateway and back).  \n- Session resolution, meta parsing, and run lifecycle are in `src/acp/session-mapper.ts`, `src/acp/meta.ts`, and `src/acp/session.ts`.\n\nIf you want, I can walk through a concrete request flow end-to-end (ACP `prompt` → gateway `chat.send` → ACP streamed updates) using the exact call sites."}]}}
{"timestamp":"2026-02-07T07:58:06.322Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":331632,"cached_input_tokens":292608,"output_tokens":1871,"reasoning_output_tokens":384,"total_tokens":333503},"last_token_usage":{"input_tokens":28671,"cached_input_tokens":28288,"output_tokens":1270,"reasoning_output_tokens":384,"total_tokens":29941},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":2.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":8.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T08:09:07.175Z","type":"response_item","payload":{"type":"message","role":"user","content":[{"type":"input_text","text":"explain how heartbeats work docs/gateway/heartbeat.md"}]}}
{"timestamp":"2026-02-07T08:09:07.175Z","type":"event_msg","payload":{"type":"user_message","message":"explain how heartbeats work docs/gateway/heartbeat.md","images":[],"local_images":[],"text_elements":[]}}
{"timestamp":"2026-02-07T08:09:07.199Z","type":"turn_context","payload":{"cwd":"/home/ldr-cavetroll/tinker/openclaw","approval_policy":"on-request","sandbox_policy":{"type":"workspace-write","network_access":false,"exclude_tmpdir_env_var":false,"exclude_slash_tmp":false},"model":"gpt-5.2-codex","personality":"pragmatic","collaboration_mode":{"mode":"default","settings":{"model":"gpt-5.2-codex","reasoning_effort":null,"developer_instructions":"# Collaboration Mode: Default\n\nYou are now in Default mode. Any previous instructions for other modes (e.g. Plan mode) are no longer active.\n\nYour active mode changes only when new developer instructions with a different `<collaboration_mode>...</collaboration_mode>` change it; user requests or tool descriptions do not change mode by themselves. Known mode names are Default and Plan.\n\n## request_user_input availability\n\nThe `request_user_input` tool is unavailable in Default mode. If you call it while in Default mode, it will return an error.\n\nIf a decision is necessary and cannot be discovered from local context, ask the user directly. However, in Default mode you should strongly prefer executing the user's request rather than stopping to ask questions.\n"}},"summary":"auto","user_instructions":"# Repository Guidelines\n\n- Repo: https://github.com/openclaw/openclaw\n- GitHub issues/comments/PR comments: use literal multiline strings or `-F - <<'EOF'` (or $'...') for real newlines; never embed \"\\\\n\".\n\n## Project Structure & Module Organization\n\n- Source code: `src/` (CLI wiring in `src/cli`, commands in `src/commands`, web provider in `src/provider-web.ts`, infra in `src/infra`, media pipeline in `src/media`).\n- Tests: colocated `*.test.ts`.\n- Docs: `docs/` (images, queue, Pi config). Built output lives in `dist/`.\n- Plugins/extensions: live under `extensions/*` (workspace packages). Keep plugin-only deps in the extension `package.json`; do not add them to the root `package.json` unless core uses them.\n- Plugins: install runs `npm install --omit=dev` in plugin dir; runtime deps must live in `dependencies`. Avoid `workspace:*` in `dependencies` (npm install breaks); put `openclaw` in `devDependencies` or `peerDependencies` instead (runtime resolves `openclaw/plugin-sdk` via jiti alias).\n- Installers served from `https://openclaw.ai/*`: live in the sibling repo `../openclaw.ai` (`public/install.sh`, `public/install-cli.sh`, `public/install.ps1`).\n- Messaging channels: always consider **all** built-in + extension channels when refactoring shared logic (routing, allowlists, pairing, command gating, onboarding, docs).\n  - Core channel docs: `docs/channels/`\n  - Core channel code: `src/telegram`, `src/discord`, `src/slack`, `src/signal`, `src/imessage`, `src/web` (WhatsApp web), `src/channels`, `src/routing`\n  - Extensions (channel plugins): `extensions/*` (e.g. `extensions/msteams`, `extensions/matrix`, `extensions/zalo`, `extensions/zalouser`, `extensions/voice-call`)\n- When adding channels/extensions/apps/docs, review `.github/labeler.yml` for label coverage.\n\n## Docs Linking (Mintlify)\n\n- Docs are hosted on Mintlify (docs.openclaw.ai).\n- Internal doc links in `docs/**/*.md`: root-relative, no `.md`/`.mdx` (example: `[Config](/configuration)`).\n- Section cross-references: use anchors on root-relative paths (example: `[Hooks](/configuration#hooks)`).\n- Doc headings and anchors: avoid em dashes and apostrophes in headings because they break Mintlify anchor links.\n- When Peter asks for links, reply with full `https://docs.openclaw.ai/...` URLs (not root-relative).\n- When you touch docs, end the reply with the `https://docs.openclaw.ai/...` URLs you referenced.\n- README (GitHub): keep absolute docs URLs (`https://docs.openclaw.ai/...`) so links work on GitHub.\n- Docs content must be generic: no personal device names/hostnames/paths; use placeholders like `user@gateway-host` and “gateway host”.\n\n## Docs i18n (zh-CN)\n\n- `docs/zh-CN/**` is generated; do not edit unless the user explicitly asks.\n- Pipeline: update English docs → adjust glossary (`docs/.i18n/glossary.zh-CN.json`) → run `scripts/docs-i18n` → apply targeted fixes only if instructed.\n- Translation memory: `docs/.i18n/zh-CN.tm.jsonl` (generated).\n- See `docs/.i18n/README.md`.\n- The pipeline can be slow/inefficient; if it’s dragging, ping @jospalmbier on Discord instead of hacking around it.\n\n## exe.dev VM ops (general)\n\n- Access: stable path is `ssh exe.dev` then `ssh vm-name` (assume SSH key already set).\n- SSH flaky: use exe.dev web terminal or Shelley (web agent); keep a tmux session for long ops.\n- Update: `sudo npm i -g openclaw@latest` (global install needs root on `/usr/lib/node_modules`).\n- Config: use `openclaw config set ...`; ensure `gateway.mode=local` is set.\n- Discord: store raw token only (no `DISCORD_BOT_TOKEN=` prefix).\n- Restart: stop old gateway and run:\n  `pkill -9 -f openclaw-gateway || true; nohup openclaw gateway run --bind loopback --port 18789 --force > /tmp/openclaw-gateway.log 2>&1 &`\n- Verify: `openclaw channels status --probe`, `ss -ltnp | rg 18789`, `tail -n 120 /tmp/openclaw-gateway.log`.\n\n## Build, Test, and Development Commands\n\n- Runtime baseline: Node **22+** (keep Node + Bun paths working).\n- Install deps: `pnpm install`\n- Pre-commit hooks: `prek install` (runs same checks as CI)\n- Also supported: `bun install` (keep `pnpm-lock.yaml` + Bun patching in sync when touching deps/patches).\n- Prefer Bun for TypeScript execution (scripts, dev, tests): `bun <file.ts>` / `bunx <tool>`.\n- Run CLI in dev: `pnpm openclaw ...` (bun) or `pnpm dev`.\n- Node remains supported for running built output (`dist/*`) and production installs.\n- Mac packaging (dev): `scripts/package-mac-app.sh` defaults to current arch. Release checklist: `docs/platforms/mac/release.md`.\n- Type-check/build: `pnpm build`\n- TypeScript checks: `pnpm tsgo`\n- Lint/format: `pnpm check`\n- Tests: `pnpm test` (vitest); coverage: `pnpm test:coverage`\n\n## Coding Style & Naming Conventions\n\n- Language: TypeScript (ESM). Prefer strict typing; avoid `any`.\n- Formatting/linting via Oxlint and Oxfmt; run `pnpm check` before commits.\n- Add brief code comments for tricky or non-obvious logic.\n- Keep files concise; extract helpers instead of “V2” copies. Use existing patterns for CLI options and dependency injection via `createDefaultDeps`.\n- Aim to keep files under ~700 LOC; guideline only (not a hard guardrail). Split/refactor when it improves clarity or testability.\n- Naming: use **OpenClaw** for product/app/docs headings; use `openclaw` for CLI command, package/binary, paths, and config keys.\n\n## Release Channels (Naming)\n\n- stable: tagged releases only (e.g. `vYYYY.M.D`), npm dist-tag `latest`.\n- beta: prerelease tags `vYYYY.M.D-beta.N`, npm dist-tag `beta` (may ship without macOS app).\n- dev: moving head on `main` (no tag; git checkout main).\n\n## Testing Guidelines\n\n- Framework: Vitest with V8 coverage thresholds (70% lines/branches/functions/statements).\n- Naming: match source names with `*.test.ts`; e2e in `*.e2e.test.ts`.\n- Run `pnpm test` (or `pnpm test:coverage`) before pushing when you touch logic.\n- Do not set test workers above 16; tried already.\n- Live tests (real keys): `CLAWDBOT_LIVE_TEST=1 pnpm test:live` (OpenClaw-only) or `LIVE=1 pnpm test:live` (includes provider live tests). Docker: `pnpm test:docker:live-models`, `pnpm test:docker:live-gateway`. Onboarding Docker E2E: `pnpm test:docker:onboard`.\n- Full kit + what’s covered: `docs/testing.md`.\n- Pure test additions/fixes generally do **not** need a changelog entry unless they alter user-facing behavior or the user asks for one.\n- Mobile: before using a simulator, check for connected real devices (iOS + Android) and prefer them when available.\n\n## Commit & Pull Request Guidelines\n\n- Create commits with `scripts/committer \"<msg>\" <file...>`; avoid manual `git add`/`git commit` so staging stays scoped.\n- Follow concise, action-oriented commit messages (e.g., `CLI: add verbose flag to send`).\n- Group related changes; avoid bundling unrelated refactors.\n- Changelog workflow: keep latest released version at top (no `Unreleased`); after publishing, bump version and start a new top section.\n- PRs should summarize scope, note testing performed, and mention any user-facing changes or new flags.\n- Read this when submitting a PR: `docs/help/submitting-a-pr.md` ([Submitting a PR](https://docs.openclaw.ai/help/submitting-a-pr))\n- Read this when submitting an issue: `docs/help/submitting-an-issue.md` ([Submitting an Issue](https://docs.openclaw.ai/help/submitting-an-issue))\n- PR review flow: when given a PR link, review via `gh pr view`/`gh pr diff` and do **not** change branches.\n- PR review calls: prefer a single `gh pr view --json ...` to batch metadata/comments; run `gh pr diff` only when needed.\n- Before starting a review when a GH Issue/PR is pasted: run `git pull`; if there are local changes or unpushed commits, stop and alert the user before reviewing.\n- Goal: merge PRs. Prefer **rebase** when commits are clean; **squash** when history is messy.\n- PR merge flow: create a temp branch from `main`, merge the PR branch into it (prefer squash unless commit history is important; use rebase/merge when it is). Always try to merge the PR unless it’s truly difficult, then use another approach. If we squash, add the PR author as a co-contributor. Apply fixes, add changelog entry (include PR # + thanks), run full gate before the final commit, commit, merge back to `main`, delete the temp branch, and end on `main`.\n- If you review a PR and later do work on it, land via merge/squash (no direct-main commits) and always add the PR author as a co-contributor.\n- When working on a PR: add a changelog entry with the PR number and thank the contributor.\n- When working on an issue: reference the issue in the changelog entry.\n- When merging a PR: leave a PR comment that explains exactly what we did and include the SHA hashes.\n- When merging a PR from a new contributor: add their avatar to the README “Thanks to all clawtributors” thumbnail list.\n- After merging a PR: run `bun scripts/update-clawtributors.ts` if the contributor is missing, then commit the regenerated README.\n\n## Shorthand Commands\n\n- `sync`: if working tree is dirty, commit all changes (pick a sensible Conventional Commit message), then `git pull --rebase`; if rebase conflicts and cannot resolve, stop; otherwise `git push`.\n\n### PR Workflow (Review vs Land)\n\n- **Review mode (PR link only):** read `gh pr view/diff`; **do not** switch branches; **do not** change code.\n- **Landing mode:** create an integration branch from `main`, bring in PR commits (**prefer rebase** for linear history; **merge allowed** when complexity/conflicts make it safer), apply fixes, add changelog (+ thanks + PR #), run full gate **locally before committing** (`pnpm build && pnpm check && pnpm test`), commit, merge back to `main`, then `git switch main` (never stay on a topic branch after landing). Important: contributor needs to be in git graph after this!\n\n## Security & Configuration Tips\n\n- Web provider stores creds at `~/.openclaw/credentials/`; rerun `openclaw login` if logged out.\n- Pi sessions live under `~/.openclaw/sessions/` by default; the base directory is not configurable.\n- Environment variables: see `~/.profile`.\n- Never commit or publish real phone numbers, videos, or live configuration values. Use obviously fake placeholders in docs, tests, and examples.\n- Release flow: always read `docs/reference/RELEASING.md` and `docs/platforms/mac/release.md` before any release work; do not ask routine questions once those docs answer them.\n\n## Troubleshooting\n\n- Rebrand/migration issues or legacy config/service warnings: run `openclaw doctor` (see `docs/gateway/doctor.md`).\n\n## Agent-Specific Notes\n\n- Vocabulary: \"makeup\" = \"mac app\".\n- Never edit `node_modules` (global/Homebrew/npm/git installs too). Updates overwrite. Skill notes go in `tools.md` or `AGENTS.md`.\n- Signal: \"update fly\" => `fly ssh console -a flawd-bot -C \"bash -lc 'cd /data/clawd/openclaw && git pull --rebase origin main'\"` then `fly machines restart e825232f34d058 -a flawd-bot`.\n- When working on a GitHub Issue or PR, print the full URL at the end of the task.\n- When answering questions, respond with high-confidence answers only: verify in code; do not guess.\n- Never update the Carbon dependency.\n- Any dependency with `pnpm.patchedDependencies` must use an exact version (no `^`/`~`).\n- Patching dependencies (pnpm patches, overrides, or vendored changes) requires explicit approval; do not do this by default.\n- CLI progress: use `src/cli/progress.ts` (`osc-progress` + `@clack/prompts` spinner); don’t hand-roll spinners/bars.\n- Status output: keep tables + ANSI-safe wrapping (`src/terminal/table.ts`); `status --all` = read-only/pasteable, `status --deep` = probes.\n- Gateway currently runs only as the menubar app; there is no separate LaunchAgent/helper label installed. Restart via the OpenClaw Mac app or `scripts/restart-mac.sh`; to verify/kill use `launchctl print gui/$UID | grep openclaw` rather than assuming a fixed label. **When debugging on macOS, start/stop the gateway via the app, not ad-hoc tmux sessions; kill any temporary tunnels before handoff.**\n- macOS logs: use `./scripts/clawlog.sh` to query unified logs for the OpenClaw subsystem; it supports follow/tail/category filters and expects passwordless sudo for `/usr/bin/log`.\n- If shared guardrails are available locally, review them; otherwise follow this repo's guidance.\n- SwiftUI state management (iOS/macOS): prefer the `Observation` framework (`@Observable`, `@Bindable`) over `ObservableObject`/`@StateObject`; don’t introduce new `ObservableObject` unless required for compatibility, and migrate existing usages when touching related code.\n- Connection providers: when adding a new connection, update every UI surface and docs (macOS app, web UI, mobile if applicable, onboarding/overview docs) and add matching status + configuration forms so provider lists and settings stay in sync.\n- Version locations: `package.json` (CLI), `apps/android/app/build.gradle.kts` (versionName/versionCode), `apps/ios/Sources/Info.plist` + `apps/ios/Tests/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `apps/macos/Sources/OpenClaw/Resources/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `docs/install/updating.md` (pinned npm version), `docs/platforms/mac/release.md` (APP_VERSION/APP_BUILD examples), Peekaboo Xcode projects/Info.plists (MARKETING_VERSION/CURRENT_PROJECT_VERSION).\n- **Restart apps:** “restart iOS/Android apps” means rebuild (recompile/install) and relaunch, not just kill/launch.\n- **Device checks:** before testing, verify connected real devices (iOS/Android) before reaching for simulators/emulators.\n- iOS Team ID lookup: `security find-identity -p codesigning -v` → use Apple Development (…) TEAMID. Fallback: `defaults read com.apple.dt.Xcode IDEProvisioningTeamIdentifiers`.\n- A2UI bundle hash: `src/canvas-host/a2ui/.bundle.hash` is auto-generated; ignore unexpected changes, and only regenerate via `pnpm canvas:a2ui:bundle` (or `scripts/bundle-a2ui.sh`) when needed. Commit the hash as a separate commit.\n- Release signing/notary keys are managed outside the repo; follow internal release docs.\n- Notary auth env vars (`APP_STORE_CONNECT_ISSUER_ID`, `APP_STORE_CONNECT_KEY_ID`, `APP_STORE_CONNECT_API_KEY_P8`) are expected in your environment (per internal release docs).\n- **Multi-agent safety:** do **not** create/apply/drop `git stash` entries unless explicitly requested (this includes `git pull --rebase --autostash`). Assume other agents may be working; keep unrelated WIP untouched and avoid cross-cutting state changes.\n- **Multi-agent safety:** when the user says \"push\", you may `git pull --rebase` to integrate latest changes (never discard other agents' work). When the user says \"commit\", scope to your changes only. When the user says \"commit all\", commit everything in grouped chunks.\n- **Multi-agent safety:** do **not** create/remove/modify `git worktree` checkouts (or edit `.worktrees/*`) unless explicitly requested.\n- **Multi-agent safety:** do **not** switch branches / check out a different branch unless explicitly requested.\n- **Multi-agent safety:** running multiple agents is OK as long as each agent has its own session.\n- **Multi-agent safety:** when you see unrecognized files, keep going; focus on your changes and commit only those.\n- Lint/format churn:\n  - If staged+unstaged diffs are formatting-only, auto-resolve without asking.\n  - If commit/push already requested, auto-stage and include formatting-only follow-ups in the same commit (or a tiny follow-up commit if needed), no extra confirmation.\n  - Only ask when changes are semantic (logic/data/behavior).\n- Lobster seam: use the shared CLI palette in `src/terminal/palette.ts` (no hardcoded colors); apply palette to onboarding/config prompts and other TTY UI output as needed.\n- **Multi-agent safety:** focus reports on your edits; avoid guard-rail disclaimers unless truly blocked; when multiple agents touch the same file, continue if safe; end with a brief “other files present” note only if relevant.\n- Bug investigations: read source code of relevant npm dependencies and all related local code before concluding; aim for high-confidence root cause.\n- Code style: add brief comments for tricky logic; keep files under ~500 LOC when feasible (split/refactor as needed).\n- Tool schema guardrails (google-antigravity): avoid `Type.Union` in tool input schemas; no `anyOf`/`oneOf`/`allOf`. Use `stringEnum`/`optionalStringEnum` (Type.Unsafe enum) for string lists, and `Type.Optional(...)` instead of `... | null`. Keep top-level tool schema as `type: \"object\"` with `properties`.\n- Tool schema guardrails: avoid raw `format` property names in tool schemas; some validators treat `format` as a reserved keyword and reject the schema.\n- When asked to open a “session” file, open the Pi session logs under `~/.openclaw/agents/<agentId>/sessions/*.jsonl` (use the `agent=<id>` value in the Runtime line of the system prompt; newest unless a specific ID is given), not the default `sessions.json`. If logs are needed from another machine, SSH via Tailscale and read the same path there.\n- Do not rebuild the macOS app over SSH; rebuilds must be run directly on the Mac.\n- Never send streaming/partial replies to external messaging surfaces (WhatsApp, Telegram); only final replies should be delivered there. Streaming/tool events may still go to internal UIs/control channel.\n- Voice wake forwarding tips:\n  - Command template should stay `openclaw-mac agent --message \"${text}\" --thinking low`; `VoiceWakeForwarder` already shell-escapes `${text}`. Don’t add extra quotes.\n  - launchd PATH is minimal; ensure the app’s launch agent PATH includes standard system paths plus your pnpm bin (typically `$HOME/Library/pnpm`) so `pnpm`/`openclaw` binaries resolve when invoked via `openclaw-mac`.\n- For manual `openclaw message send` messages that include `!`, use the heredoc pattern noted below to avoid the Bash tool’s escaping.\n- Release guardrails: do not change version numbers without operator’s explicit consent; always ask permission before running any npm publish/release step.\n\n## NPM + 1Password (publish/verify)\n\n- Use the 1password skill; all `op` commands must run inside a fresh tmux session.\n- Sign in: `eval \"$(op signin --account my.1password.com)\"` (app unlocked + integration on).\n- OTP: `op read 'op://Private/Npmjs/one-time password?attribute=otp'`.\n- Publish: `npm publish --access public --otp=\"<otp>\"` (run from the package dir).\n- Verify without local npmrc side effects: `npm view <pkg> version --userconfig \"$(mktemp)\"`.\n- Kill the tmux session after publish.\n\n\n## Skills\nA skill is a set of local instructions to follow that is stored in a `SKILL.md` file. Below is the list of skills that can be used. Each entry includes a name, description, and file path so you can open the source for full instructions when using a specific skill.\n### Available skills\n- merge-pr: Merge a GitHub PR via squash after /preparepr. Use when asked to merge a ready PR. Do not push to main or modify code. Ensure the PR ends in MERGED state and clean up worktrees after success. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/merge-pr/SKILL.md)\n- prepare-pr: Prepare a GitHub PR for merge by rebasing onto main, fixing review findings, running gates, committing fixes, and pushing to the PR head branch. Use after /reviewpr. Never merge or push to main. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/prepare-pr/SKILL.md)\n- review-pr: Review-only GitHub pull request analysis with the gh CLI. Use when asked to review a PR, provide structured feedback, or assess readiness to land. Do not merge, push, or make code changes you intend to keep. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/review-pr/SKILL.md)\n- figma: Use the Figma MCP server to fetch design context, screenshots, variables, and assets from Figma, and to translate Figma nodes into production code. Trigger when a task involves Figma URLs, node IDs, design-to-code implementation, or Figma MCP setup and troubleshooting. (file: /home/ldr-cavetroll/.codex/skills/figma/SKILL.md)\n- skill-creator: Guide for creating effective skills. This skill should be used when users want to create a new skill (or update an existing skill) that extends Codex's capabilities with specialized knowledge, workflows, or tool integrations. (file: /home/ldr-cavetroll/.codex/skills/.system/skill-creator/SKILL.md)\n- skill-installer: Install Codex skills into $CODEX_HOME/skills from a curated list or a GitHub repo path. Use when a user asks to list installable skills, install a curated skill, or install a skill from another repo (including private repos). (file: /home/ldr-cavetroll/.codex/skills/.system/skill-installer/SKILL.md)\n### How to use skills\n- Discovery: The list above is the skills available in this session (name + description + file path). Skill bodies live on disk at the listed paths.\n- Trigger rules: If the user names a skill (with `$SkillName` or plain text) OR the task clearly matches a skill's description shown above, you must use that skill for that turn. Multiple mentions mean use them all. Do not carry skills across turns unless re-mentioned.\n- Missing/blocked: If a named skill isn't in the list or the path can't be read, say so briefly and continue with the best fallback.\n- How to use a skill (progressive disclosure):\n  1) After deciding to use a skill, open its `SKILL.md`. Read only enough to follow the workflow.\n  2) When `SKILL.md` references relative paths (e.g., `scripts/foo.py`), resolve them relative to the skill directory listed above first, and only consider other paths if needed.\n  3) If `SKILL.md` points to extra folders such as `references/`, load only the specific files needed for the request; don't bulk-load everything.\n  4) If `scripts/` exist, prefer running or patching them instead of retyping large code blocks.\n  5) If `assets/` or templates exist, reuse them instead of recreating from scratch.\n- Coordination and sequencing:\n  - If multiple skills apply, choose the minimal set that covers the request and state the order you'll use them.\n  - Announce which skill(s) you're using and why (one short line). If you skip an obvious skill, say why.\n- Context hygiene:\n  - Keep context small: summarize long sections instead of pasting them; only load extra files when needed.\n  - Avoid deep reference-chasing: prefer opening only files directly linked from `SKILL.md` unless you're blocked.\n  - When variants exist (frameworks, providers, domains), pick only the relevant reference file(s) and note that choice.\n- Safety and fallback: If a skill can't be applied cleanly (missing files, unclear instructions), state the issue, pick the next-best approach, and continue.","truncation_policy":{"mode":"tokens","limit":10000}}}
{"timestamp":"2026-02-07T08:09:07.661Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":331632,"cached_input_tokens":292608,"output_tokens":1871,"reasoning_output_tokens":384,"total_tokens":333503},"last_token_usage":{"input_tokens":28671,"cached_input_tokens":28288,"output_tokens":1270,"reasoning_output_tokens":384,"total_tokens":29941},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":2.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":8.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T08:09:08.953Z","type":"event_msg","payload":{"type":"agent_reasoning","text":"**Preparing to read file contents**"}}
{"timestamp":"2026-02-07T08:09:08.953Z","type":"response_item","payload":{"type":"reasoning","summary":[{"type":"summary_text","text":"**Preparing to read file contents**"}],"content":null,"encrypted_content":"gAAAAABphvMk37tPB0wWWu98xgBvT26OsTeJYAIwmSvoQ0d8_Xi_hYXvpP_9pMSmhufQW8QC-Dc3gdWtNWmuwfJfhYqB_hufbPrtASE5WMl8X_5Odg2kUiyOGOB6UkYPp7_Uf7dUJy06S-2O7SF7Fs0-xRKeLpVsikn7Pb2AMnd8LImycISJNieqzY7TzhX0_vyDqLXDRFVBqNSEx7kKzWDeH5-iuqQXeCMU_5clZb9xZAJ01kmrXiPpklzpB_EZ02z8bIPt8x3-oMtFOxcnuKUXYzOewer3LwZULXwNE5Zb0Mv5RSnVr9AC85ByEHtW-q5fsVEqxS6ZPt_cK8D4yBdjPIZQ6d7D_l4hm1yGocJMBWFQJuziCCwWP9kdAE9KNtnC4JNfpYsBu-md96mE8Ztx8USS4m5fmG2nfZRzAkZtF0sSKJ9JNxhN4suZ_ybb47QBdm94GdkACZiueyeIl05V_gLHXYRjNp-DLrgr3frehr1wURTwP6YfOX17MlvC_G4-ZXXPtrbWEkWD8EhvY528sFA_RRua115hDTHYdPxe6bU5gypNkqZn1PWiRfJZm6YwjXPOg3Ftx-GyayQt5NwbiO5WxXxWWxPqE8DBu1DGYEP5VEDg-TIH_TWMOpAJ9dOKicnaBatzqLkxD4k3shz7I1oocrc0JbIjzp73j-UGtxfrpun-kuYxf7oqBuSUPRMyyg6Vf1p7urYfoVOQMItk7Ct-BrR1eVlTzwZvtp4aQih-xQ0TAEsKbUSWL4XBfSB77VpLONcJG8ku6LwQ8Y3WD_3D0XW5LZ-wpYeD10VYtYvCEtHIwMFD7a_8zdLI-lUWK-PCiZP4vQ1ykUwRplVQBVwGhKyb8kq1PCMCccAxoGlA_3_wYYQ="}}
{"timestamp":"2026-02-07T08:09:09.253Z","type":"response_item","payload":{"type":"function_call","name":"exec_command","arguments":"{\"cmd\":\"sed -n '1,220p' docs/gateway/heartbeat.md\"}","call_id":"call_t0yd2vHlebMveq5fr78MZs7U"}}
{"timestamp":"2026-02-07T08:09:09.293Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":360958,"cached_input_tokens":311424,"output_tokens":1918,"reasoning_output_tokens":384,"total_tokens":362876},"last_token_usage":{"input_tokens":29326,"cached_input_tokens":18816,"output_tokens":47,"reasoning_output_tokens":0,"total_tokens":29373},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":2.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":8.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T08:09:09.339Z","type":"response_item","payload":{"type":"function_call_output","call_id":"call_t0yd2vHlebMveq5fr78MZs7U","output":"Chunk ID: 677da0\nWall time: 0.0508 seconds\nProcess exited with code 0\nOriginal token count: 2162\nOutput:\n---\nsummary: \"Heartbeat polling messages and notification rules\"\nread_when:\n  - Adjusting heartbeat cadence or messaging\n  - Deciding between heartbeat and cron for scheduled tasks\ntitle: \"Heartbeat\"\n---\n\n# Heartbeat (Gateway)\n\n> **Heartbeat vs Cron?** See [Cron vs Heartbeat](/automation/cron-vs-heartbeat) for guidance on when to use each.\n\nHeartbeat runs **periodic agent turns** in the main session so the model can\nsurface anything that needs attention without spamming you.\n\n## Quick start (beginner)\n\n1. Leave heartbeats enabled (default is `30m`, or `1h` for Anthropic OAuth/setup-token) or set your own cadence.\n2. Create a tiny `HEARTBEAT.md` checklist in the agent workspace (optional but recommended).\n3. Decide where heartbeat messages should go (`target: \"last\"` is the default).\n4. Optional: enable heartbeat reasoning delivery for transparency.\n5. Optional: restrict heartbeats to active hours (local time).\n\nExample config:\n\n```json5\n{\n  agents: {\n    defaults: {\n      heartbeat: {\n        every: \"30m\",\n        target: \"last\",\n        // activeHours: { start: \"08:00\", end: \"24:00\" },\n        // includeReasoning: true, // optional: send separate `Reasoning:` message too\n      },\n    },\n  },\n}\n```\n\n## Defaults\n\n- Interval: `30m` (or `1h` when Anthropic OAuth/setup-token is the detected auth mode). Set `agents.defaults.heartbeat.every` or per-agent `agents.list[].heartbeat.every`; use `0m` to disable.\n- Prompt body (configurable via `agents.defaults.heartbeat.prompt`):\n  `Read HEARTBEAT.md if it exists (workspace context). Follow it strictly. Do not infer or repeat old tasks from prior chats. If nothing needs attention, reply HEARTBEAT_OK.`\n- The heartbeat prompt is sent **verbatim** as the user message. The system\n  prompt includes a “Heartbeat” section and the run is flagged internally.\n- Active hours (`heartbeat.activeHours`) are checked in the configured timezone.\n  Outside the window, heartbeats are skipped until the next tick inside the window.\n\n## What the heartbeat prompt is for\n\nThe default prompt is intentionally broad:\n\n- **Background tasks**: “Consider outstanding tasks” nudges the agent to review\n  follow-ups (inbox, calendar, reminders, queued work) and surface anything urgent.\n- **Human check-in**: “Checkup sometimes on your human during day time” nudges an\n  occasional lightweight “anything you need?” message, but avoids night-time spam\n  by using your configured local timezone (see [/concepts/timezone](/concepts/timezone)).\n\nIf you want a heartbeat to do something very specific (e.g. “check Gmail PubSub\nstats” or “verify gateway health”), set `agents.defaults.heartbeat.prompt` (or\n`agents.list[].heartbeat.prompt`) to a custom body (sent verbatim).\n\n## Response contract\n\n- If nothing needs attention, reply with **`HEARTBEAT_OK`**.\n- During heartbeat runs, OpenClaw treats `HEARTBEAT_OK` as an ack when it appears\n  at the **start or end** of the reply. The token is stripped and the reply is\n  dropped if the remaining content is **≤ `ackMaxChars`** (default: 300).\n- If `HEARTBEAT_OK` appears in the **middle** of a reply, it is not treated\n  specially.\n- For alerts, **do not** include `HEARTBEAT_OK`; return only the alert text.\n\nOutside heartbeats, stray `HEARTBEAT_OK` at the start/end of a message is stripped\nand logged; a message that is only `HEARTBEAT_OK` is dropped.\n\n## Config\n\n```json5\n{\n  agents: {\n    defaults: {\n      heartbeat: {\n        every: \"30m\", // default: 30m (0m disables)\n        model: \"anthropic/claude-opus-4-6\",\n        includeReasoning: false, // default: false (deliver separate Reasoning: message when available)\n        target: \"last\", // last | none | <channel id> (core or plugin, e.g. \"bluebubbles\")\n        to: \"+15551234567\", // optional channel-specific override\n        accountId: \"ops-bot\", // optional multi-account channel id\n        prompt: \"Read HEARTBEAT.md if it exists (workspace context). Follow it strictly. Do not infer or repeat old tasks from prior chats. If nothing needs attention, reply HEARTBEAT_OK.\",\n        ackMaxChars: 300, // max chars allowed after HEARTBEAT_OK\n      },\n    },\n  },\n}\n```\n\n### Scope and precedence\n\n- `agents.defaults.heartbeat` sets global heartbeat behavior.\n- `agents.list[].heartbeat` merges on top; if any agent has a `heartbeat` block, **only those agents** run heartbeats.\n- `channels.defaults.heartbeat` sets visibility defaults for all channels.\n- `channels.<channel>.heartbeat` overrides channel defaults.\n- `channels.<channel>.accounts.<id>.heartbeat` (multi-account channels) overrides per-channel settings.\n\n### Per-agent heartbeats\n\nIf any `agents.list[]` entry includes a `heartbeat` block, **only those agents**\nrun heartbeats. The per-agent block merges on top of `agents.defaults.heartbeat`\n(so you can set shared defaults once and override per agent).\n\nExample: two agents, only the second agent runs heartbeats.\n\n```json5\n{\n  agents: {\n    defaults: {\n      heartbeat: {\n        every: \"30m\",\n        target: \"last\",\n      },\n    },\n    list: [\n      { id: \"main\", default: true },\n      {\n        id: \"ops\",\n        heartbeat: {\n          every: \"1h\",\n          target: \"whatsapp\",\n          to: \"+15551234567\",\n          prompt: \"Read HEARTBEAT.md if it exists (workspace context). Follow it strictly. Do not infer or repeat old tasks from prior chats. If nothing needs attention, reply HEARTBEAT_OK.\",\n        },\n      },\n    ],\n  },\n}\n```\n\n### Active hours example\n\nRestrict heartbeats to business hours in a specific timezone:\n\n```json5\n{\n  agents: {\n    defaults: {\n      heartbeat: {\n        every: \"30m\",\n        target: \"last\",\n        activeHours: {\n          start: \"09:00\",\n          end: \"22:00\",\n          timezone: \"America/New_York\", // optional; uses your userTimezone if set, otherwise host tz\n        },\n      },\n    },\n  },\n}\n```\n\nOutside this window (before 9am or after 10pm Eastern), heartbeats are skipped. The next scheduled tick inside the window will run normally.\n\n### Multi account example\n\nUse `accountId` to target a specific account on multi-account channels like Telegram:\n\n```json5\n{\n  agents: {\n    list: [\n      {\n        id: \"ops\",\n        heartbeat: {\n          every: \"1h\",\n          target: \"telegram\",\n          to: \"12345678\",\n          accountId: \"ops-bot\",\n        },\n      },\n    ],\n  },\n  channels: {\n    telegram: {\n      accounts: {\n        \"ops-bot\": { botToken: \"YOUR_TELEGRAM_BOT_TOKEN\" },\n      },\n    },\n  },\n}\n```\n\n### Field notes\n\n- `every`: heartbeat interval (duration string; default unit = minutes).\n- `model`: optional model override for heartbeat runs (`provider/model`).\n- `includeReasoning`: when enabled, also deliver the separate `Reasoning:` message when available (same shape as `/reasoning on`).\n- `session`: optional session key for heartbeat runs.\n  - `main` (default): agent main session.\n  - Explicit session key (copy from `openclaw sessions --json` or the [sessions CLI](/cli/sessions)).\n  - Session key formats: see [Sessions](/concepts/session) and [Groups](/concepts/groups).\n- `target`:\n  - `last` (default): deliver to the last used external channel.\n  - explicit channel: `whatsapp` / `telegram` / `discord` / `googlechat` / `slack` / `msteams` / `signal` / `imessage`.\n  - `none`: run the heartbeat but **do not deliver** externally.\n- `to`: optional recipient override (channel-specific id, e.g. E.164 for WhatsApp or a Telegram chat id).\n- `accountId`: optional account id for multi-account channels. When `target: \"last\"`, the account id applies to the resolved last channel if it supports accounts; otherwise it is ignored. If the account id does not match a configured account for the resolved channel, delivery is skipped.\n- `prompt`: overrides the default prompt body (not merged).\n- `ackMaxChars`: max chars allowed after `HEARTBEAT_OK` before delivery.\n- `activeHours`: restricts heartbeat runs to a time window. Object with `start` (HH:MM, inclusive), `end` (HH:MM exclusive; `24:00` allowed for end-of-day), and optional `timezone`.\n  - Omitted or `\"user\"`: uses your `agents.defaults.userTimezone` if set, otherwise falls back to the host system timezone.\n  - `\"local\"`: always uses the host system timezone.\n  - Any IANA identifier (e.g. `America/New_York`): used directly; if invalid, falls back to the `\"user\"` behavior above.\n  - Outside the active window, heartbeats are skipped until the next tick inside the window.\n\n## Delivery behavior\n\n- Heartbeats run in the agent’s main session by default (`agent:<id>:<mainKey>`),\n  or `global` when `session.scope = \"global\"`. Set `session` to override to a\n  specific channel session (Discord/WhatsApp/etc.).\n"}}
{"timestamp":"2026-02-07T08:09:09.362Z","type":"turn_context","payload":{"cwd":"/home/ldr-cavetroll/tinker/openclaw","approval_policy":"on-request","sandbox_policy":{"type":"workspace-write","network_access":false,"exclude_tmpdir_env_var":false,"exclude_slash_tmp":false},"model":"gpt-5.2-codex","personality":"pragmatic","collaboration_mode":{"mode":"default","settings":{"model":"gpt-5.2-codex","reasoning_effort":null,"developer_instructions":"# Collaboration Mode: Default\n\nYou are now in Default mode. Any previous instructions for other modes (e.g. Plan mode) are no longer active.\n\nYour active mode changes only when new developer instructions with a different `<collaboration_mode>...</collaboration_mode>` change it; user requests or tool descriptions do not change mode by themselves. Known mode names are Default and Plan.\n\n## request_user_input availability\n\nThe `request_user_input` tool is unavailable in Default mode. If you call it while in Default mode, it will return an error.\n\nIf a decision is necessary and cannot be discovered from local context, ask the user directly. However, in Default mode you should strongly prefer executing the user's request rather than stopping to ask questions.\n"}},"summary":"auto","user_instructions":"# Repository Guidelines\n\n- Repo: https://github.com/openclaw/openclaw\n- GitHub issues/comments/PR comments: use literal multiline strings or `-F - <<'EOF'` (or $'...') for real newlines; never embed \"\\\\n\".\n\n## Project Structure & Module Organization\n\n- Source code: `src/` (CLI wiring in `src/cli`, commands in `src/commands`, web provider in `src/provider-web.ts`, infra in `src/infra`, media pipeline in `src/media`).\n- Tests: colocated `*.test.ts`.\n- Docs: `docs/` (images, queue, Pi config). Built output lives in `dist/`.\n- Plugins/extensions: live under `extensions/*` (workspace packages). Keep plugin-only deps in the extension `package.json`; do not add them to the root `package.json` unless core uses them.\n- Plugins: install runs `npm install --omit=dev` in plugin dir; runtime deps must live in `dependencies`. Avoid `workspace:*` in `dependencies` (npm install breaks); put `openclaw` in `devDependencies` or `peerDependencies` instead (runtime resolves `openclaw/plugin-sdk` via jiti alias).\n- Installers served from `https://openclaw.ai/*`: live in the sibling repo `../openclaw.ai` (`public/install.sh`, `public/install-cli.sh`, `public/install.ps1`).\n- Messaging channels: always consider **all** built-in + extension channels when refactoring shared logic (routing, allowlists, pairing, command gating, onboarding, docs).\n  - Core channel docs: `docs/channels/`\n  - Core channel code: `src/telegram`, `src/discord`, `src/slack`, `src/signal`, `src/imessage`, `src/web` (WhatsApp web), `src/channels`, `src/routing`\n  - Extensions (channel plugins): `extensions/*` (e.g. `extensions/msteams`, `extensions/matrix`, `extensions/zalo`, `extensions/zalouser`, `extensions/voice-call`)\n- When adding channels/extensions/apps/docs, review `.github/labeler.yml` for label coverage.\n\n## Docs Linking (Mintlify)\n\n- Docs are hosted on Mintlify (docs.openclaw.ai).\n- Internal doc links in `docs/**/*.md`: root-relative, no `.md`/`.mdx` (example: `[Config](/configuration)`).\n- Section cross-references: use anchors on root-relative paths (example: `[Hooks](/configuration#hooks)`).\n- Doc headings and anchors: avoid em dashes and apostrophes in headings because they break Mintlify anchor links.\n- When Peter asks for links, reply with full `https://docs.openclaw.ai/...` URLs (not root-relative).\n- When you touch docs, end the reply with the `https://docs.openclaw.ai/...` URLs you referenced.\n- README (GitHub): keep absolute docs URLs (`https://docs.openclaw.ai/...`) so links work on GitHub.\n- Docs content must be generic: no personal device names/hostnames/paths; use placeholders like `user@gateway-host` and “gateway host”.\n\n## Docs i18n (zh-CN)\n\n- `docs/zh-CN/**` is generated; do not edit unless the user explicitly asks.\n- Pipeline: update English docs → adjust glossary (`docs/.i18n/glossary.zh-CN.json`) → run `scripts/docs-i18n` → apply targeted fixes only if instructed.\n- Translation memory: `docs/.i18n/zh-CN.tm.jsonl` (generated).\n- See `docs/.i18n/README.md`.\n- The pipeline can be slow/inefficient; if it’s dragging, ping @jospalmbier on Discord instead of hacking around it.\n\n## exe.dev VM ops (general)\n\n- Access: stable path is `ssh exe.dev` then `ssh vm-name` (assume SSH key already set).\n- SSH flaky: use exe.dev web terminal or Shelley (web agent); keep a tmux session for long ops.\n- Update: `sudo npm i -g openclaw@latest` (global install needs root on `/usr/lib/node_modules`).\n- Config: use `openclaw config set ...`; ensure `gateway.mode=local` is set.\n- Discord: store raw token only (no `DISCORD_BOT_TOKEN=` prefix).\n- Restart: stop old gateway and run:\n  `pkill -9 -f openclaw-gateway || true; nohup openclaw gateway run --bind loopback --port 18789 --force > /tmp/openclaw-gateway.log 2>&1 &`\n- Verify: `openclaw channels status --probe`, `ss -ltnp | rg 18789`, `tail -n 120 /tmp/openclaw-gateway.log`.\n\n## Build, Test, and Development Commands\n\n- Runtime baseline: Node **22+** (keep Node + Bun paths working).\n- Install deps: `pnpm install`\n- Pre-commit hooks: `prek install` (runs same checks as CI)\n- Also supported: `bun install` (keep `pnpm-lock.yaml` + Bun patching in sync when touching deps/patches).\n- Prefer Bun for TypeScript execution (scripts, dev, tests): `bun <file.ts>` / `bunx <tool>`.\n- Run CLI in dev: `pnpm openclaw ...` (bun) or `pnpm dev`.\n- Node remains supported for running built output (`dist/*`) and production installs.\n- Mac packaging (dev): `scripts/package-mac-app.sh` defaults to current arch. Release checklist: `docs/platforms/mac/release.md`.\n- Type-check/build: `pnpm build`\n- TypeScript checks: `pnpm tsgo`\n- Lint/format: `pnpm check`\n- Tests: `pnpm test` (vitest); coverage: `pnpm test:coverage`\n\n## Coding Style & Naming Conventions\n\n- Language: TypeScript (ESM). Prefer strict typing; avoid `any`.\n- Formatting/linting via Oxlint and Oxfmt; run `pnpm check` before commits.\n- Add brief code comments for tricky or non-obvious logic.\n- Keep files concise; extract helpers instead of “V2” copies. Use existing patterns for CLI options and dependency injection via `createDefaultDeps`.\n- Aim to keep files under ~700 LOC; guideline only (not a hard guardrail). Split/refactor when it improves clarity or testability.\n- Naming: use **OpenClaw** for product/app/docs headings; use `openclaw` for CLI command, package/binary, paths, and config keys.\n\n## Release Channels (Naming)\n\n- stable: tagged releases only (e.g. `vYYYY.M.D`), npm dist-tag `latest`.\n- beta: prerelease tags `vYYYY.M.D-beta.N`, npm dist-tag `beta` (may ship without macOS app).\n- dev: moving head on `main` (no tag; git checkout main).\n\n## Testing Guidelines\n\n- Framework: Vitest with V8 coverage thresholds (70% lines/branches/functions/statements).\n- Naming: match source names with `*.test.ts`; e2e in `*.e2e.test.ts`.\n- Run `pnpm test` (or `pnpm test:coverage`) before pushing when you touch logic.\n- Do not set test workers above 16; tried already.\n- Live tests (real keys): `CLAWDBOT_LIVE_TEST=1 pnpm test:live` (OpenClaw-only) or `LIVE=1 pnpm test:live` (includes provider live tests). Docker: `pnpm test:docker:live-models`, `pnpm test:docker:live-gateway`. Onboarding Docker E2E: `pnpm test:docker:onboard`.\n- Full kit + what’s covered: `docs/testing.md`.\n- Pure test additions/fixes generally do **not** need a changelog entry unless they alter user-facing behavior or the user asks for one.\n- Mobile: before using a simulator, check for connected real devices (iOS + Android) and prefer them when available.\n\n## Commit & Pull Request Guidelines\n\n- Create commits with `scripts/committer \"<msg>\" <file...>`; avoid manual `git add`/`git commit` so staging stays scoped.\n- Follow concise, action-oriented commit messages (e.g., `CLI: add verbose flag to send`).\n- Group related changes; avoid bundling unrelated refactors.\n- Changelog workflow: keep latest released version at top (no `Unreleased`); after publishing, bump version and start a new top section.\n- PRs should summarize scope, note testing performed, and mention any user-facing changes or new flags.\n- Read this when submitting a PR: `docs/help/submitting-a-pr.md` ([Submitting a PR](https://docs.openclaw.ai/help/submitting-a-pr))\n- Read this when submitting an issue: `docs/help/submitting-an-issue.md` ([Submitting an Issue](https://docs.openclaw.ai/help/submitting-an-issue))\n- PR review flow: when given a PR link, review via `gh pr view`/`gh pr diff` and do **not** change branches.\n- PR review calls: prefer a single `gh pr view --json ...` to batch metadata/comments; run `gh pr diff` only when needed.\n- Before starting a review when a GH Issue/PR is pasted: run `git pull`; if there are local changes or unpushed commits, stop and alert the user before reviewing.\n- Goal: merge PRs. Prefer **rebase** when commits are clean; **squash** when history is messy.\n- PR merge flow: create a temp branch from `main`, merge the PR branch into it (prefer squash unless commit history is important; use rebase/merge when it is). Always try to merge the PR unless it’s truly difficult, then use another approach. If we squash, add the PR author as a co-contributor. Apply fixes, add changelog entry (include PR # + thanks), run full gate before the final commit, commit, merge back to `main`, delete the temp branch, and end on `main`.\n- If you review a PR and later do work on it, land via merge/squash (no direct-main commits) and always add the PR author as a co-contributor.\n- When working on a PR: add a changelog entry with the PR number and thank the contributor.\n- When working on an issue: reference the issue in the changelog entry.\n- When merging a PR: leave a PR comment that explains exactly what we did and include the SHA hashes.\n- When merging a PR from a new contributor: add their avatar to the README “Thanks to all clawtributors” thumbnail list.\n- After merging a PR: run `bun scripts/update-clawtributors.ts` if the contributor is missing, then commit the regenerated README.\n\n## Shorthand Commands\n\n- `sync`: if working tree is dirty, commit all changes (pick a sensible Conventional Commit message), then `git pull --rebase`; if rebase conflicts and cannot resolve, stop; otherwise `git push`.\n\n### PR Workflow (Review vs Land)\n\n- **Review mode (PR link only):** read `gh pr view/diff`; **do not** switch branches; **do not** change code.\n- **Landing mode:** create an integration branch from `main`, bring in PR commits (**prefer rebase** for linear history; **merge allowed** when complexity/conflicts make it safer), apply fixes, add changelog (+ thanks + PR #), run full gate **locally before committing** (`pnpm build && pnpm check && pnpm test`), commit, merge back to `main`, then `git switch main` (never stay on a topic branch after landing). Important: contributor needs to be in git graph after this!\n\n## Security & Configuration Tips\n\n- Web provider stores creds at `~/.openclaw/credentials/`; rerun `openclaw login` if logged out.\n- Pi sessions live under `~/.openclaw/sessions/` by default; the base directory is not configurable.\n- Environment variables: see `~/.profile`.\n- Never commit or publish real phone numbers, videos, or live configuration values. Use obviously fake placeholders in docs, tests, and examples.\n- Release flow: always read `docs/reference/RELEASING.md` and `docs/platforms/mac/release.md` before any release work; do not ask routine questions once those docs answer them.\n\n## Troubleshooting\n\n- Rebrand/migration issues or legacy config/service warnings: run `openclaw doctor` (see `docs/gateway/doctor.md`).\n\n## Agent-Specific Notes\n\n- Vocabulary: \"makeup\" = \"mac app\".\n- Never edit `node_modules` (global/Homebrew/npm/git installs too). Updates overwrite. Skill notes go in `tools.md` or `AGENTS.md`.\n- Signal: \"update fly\" => `fly ssh console -a flawd-bot -C \"bash -lc 'cd /data/clawd/openclaw && git pull --rebase origin main'\"` then `fly machines restart e825232f34d058 -a flawd-bot`.\n- When working on a GitHub Issue or PR, print the full URL at the end of the task.\n- When answering questions, respond with high-confidence answers only: verify in code; do not guess.\n- Never update the Carbon dependency.\n- Any dependency with `pnpm.patchedDependencies` must use an exact version (no `^`/`~`).\n- Patching dependencies (pnpm patches, overrides, or vendored changes) requires explicit approval; do not do this by default.\n- CLI progress: use `src/cli/progress.ts` (`osc-progress` + `@clack/prompts` spinner); don’t hand-roll spinners/bars.\n- Status output: keep tables + ANSI-safe wrapping (`src/terminal/table.ts`); `status --all` = read-only/pasteable, `status --deep` = probes.\n- Gateway currently runs only as the menubar app; there is no separate LaunchAgent/helper label installed. Restart via the OpenClaw Mac app or `scripts/restart-mac.sh`; to verify/kill use `launchctl print gui/$UID | grep openclaw` rather than assuming a fixed label. **When debugging on macOS, start/stop the gateway via the app, not ad-hoc tmux sessions; kill any temporary tunnels before handoff.**\n- macOS logs: use `./scripts/clawlog.sh` to query unified logs for the OpenClaw subsystem; it supports follow/tail/category filters and expects passwordless sudo for `/usr/bin/log`.\n- If shared guardrails are available locally, review them; otherwise follow this repo's guidance.\n- SwiftUI state management (iOS/macOS): prefer the `Observation` framework (`@Observable`, `@Bindable`) over `ObservableObject`/`@StateObject`; don’t introduce new `ObservableObject` unless required for compatibility, and migrate existing usages when touching related code.\n- Connection providers: when adding a new connection, update every UI surface and docs (macOS app, web UI, mobile if applicable, onboarding/overview docs) and add matching status + configuration forms so provider lists and settings stay in sync.\n- Version locations: `package.json` (CLI), `apps/android/app/build.gradle.kts` (versionName/versionCode), `apps/ios/Sources/Info.plist` + `apps/ios/Tests/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `apps/macos/Sources/OpenClaw/Resources/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `docs/install/updating.md` (pinned npm version), `docs/platforms/mac/release.md` (APP_VERSION/APP_BUILD examples), Peekaboo Xcode projects/Info.plists (MARKETING_VERSION/CURRENT_PROJECT_VERSION).\n- **Restart apps:** “restart iOS/Android apps” means rebuild (recompile/install) and relaunch, not just kill/launch.\n- **Device checks:** before testing, verify connected real devices (iOS/Android) before reaching for simulators/emulators.\n- iOS Team ID lookup: `security find-identity -p codesigning -v` → use Apple Development (…) TEAMID. Fallback: `defaults read com.apple.dt.Xcode IDEProvisioningTeamIdentifiers`.\n- A2UI bundle hash: `src/canvas-host/a2ui/.bundle.hash` is auto-generated; ignore unexpected changes, and only regenerate via `pnpm canvas:a2ui:bundle` (or `scripts/bundle-a2ui.sh`) when needed. Commit the hash as a separate commit.\n- Release signing/notary keys are managed outside the repo; follow internal release docs.\n- Notary auth env vars (`APP_STORE_CONNECT_ISSUER_ID`, `APP_STORE_CONNECT_KEY_ID`, `APP_STORE_CONNECT_API_KEY_P8`) are expected in your environment (per internal release docs).\n- **Multi-agent safety:** do **not** create/apply/drop `git stash` entries unless explicitly requested (this includes `git pull --rebase --autostash`). Assume other agents may be working; keep unrelated WIP untouched and avoid cross-cutting state changes.\n- **Multi-agent safety:** when the user says \"push\", you may `git pull --rebase` to integrate latest changes (never discard other agents' work). When the user says \"commit\", scope to your changes only. When the user says \"commit all\", commit everything in grouped chunks.\n- **Multi-agent safety:** do **not** create/remove/modify `git worktree` checkouts (or edit `.worktrees/*`) unless explicitly requested.\n- **Multi-agent safety:** do **not** switch branches / check out a different branch unless explicitly requested.\n- **Multi-agent safety:** running multiple agents is OK as long as each agent has its own session.\n- **Multi-agent safety:** when you see unrecognized files, keep going; focus on your changes and commit only those.\n- Lint/format churn:\n  - If staged+unstaged diffs are formatting-only, auto-resolve without asking.\n  - If commit/push already requested, auto-stage and include formatting-only follow-ups in the same commit (or a tiny follow-up commit if needed), no extra confirmation.\n  - Only ask when changes are semantic (logic/data/behavior).\n- Lobster seam: use the shared CLI palette in `src/terminal/palette.ts` (no hardcoded colors); apply palette to onboarding/config prompts and other TTY UI output as needed.\n- **Multi-agent safety:** focus reports on your edits; avoid guard-rail disclaimers unless truly blocked; when multiple agents touch the same file, continue if safe; end with a brief “other files present” note only if relevant.\n- Bug investigations: read source code of relevant npm dependencies and all related local code before concluding; aim for high-confidence root cause.\n- Code style: add brief comments for tricky logic; keep files under ~500 LOC when feasible (split/refactor as needed).\n- Tool schema guardrails (google-antigravity): avoid `Type.Union` in tool input schemas; no `anyOf`/`oneOf`/`allOf`. Use `stringEnum`/`optionalStringEnum` (Type.Unsafe enum) for string lists, and `Type.Optional(...)` instead of `... | null`. Keep top-level tool schema as `type: \"object\"` with `properties`.\n- Tool schema guardrails: avoid raw `format` property names in tool schemas; some validators treat `format` as a reserved keyword and reject the schema.\n- When asked to open a “session” file, open the Pi session logs under `~/.openclaw/agents/<agentId>/sessions/*.jsonl` (use the `agent=<id>` value in the Runtime line of the system prompt; newest unless a specific ID is given), not the default `sessions.json`. If logs are needed from another machine, SSH via Tailscale and read the same path there.\n- Do not rebuild the macOS app over SSH; rebuilds must be run directly on the Mac.\n- Never send streaming/partial replies to external messaging surfaces (WhatsApp, Telegram); only final replies should be delivered there. Streaming/tool events may still go to internal UIs/control channel.\n- Voice wake forwarding tips:\n  - Command template should stay `openclaw-mac agent --message \"${text}\" --thinking low`; `VoiceWakeForwarder` already shell-escapes `${text}`. Don’t add extra quotes.\n  - launchd PATH is minimal; ensure the app’s launch agent PATH includes standard system paths plus your pnpm bin (typically `$HOME/Library/pnpm`) so `pnpm`/`openclaw` binaries resolve when invoked via `openclaw-mac`.\n- For manual `openclaw message send` messages that include `!`, use the heredoc pattern noted below to avoid the Bash tool’s escaping.\n- Release guardrails: do not change version numbers without operator’s explicit consent; always ask permission before running any npm publish/release step.\n\n## NPM + 1Password (publish/verify)\n\n- Use the 1password skill; all `op` commands must run inside a fresh tmux session.\n- Sign in: `eval \"$(op signin --account my.1password.com)\"` (app unlocked + integration on).\n- OTP: `op read 'op://Private/Npmjs/one-time password?attribute=otp'`.\n- Publish: `npm publish --access public --otp=\"<otp>\"` (run from the package dir).\n- Verify without local npmrc side effects: `npm view <pkg> version --userconfig \"$(mktemp)\"`.\n- Kill the tmux session after publish.\n\n\n## Skills\nA skill is a set of local instructions to follow that is stored in a `SKILL.md` file. Below is the list of skills that can be used. Each entry includes a name, description, and file path so you can open the source for full instructions when using a specific skill.\n### Available skills\n- merge-pr: Merge a GitHub PR via squash after /preparepr. Use when asked to merge a ready PR. Do not push to main or modify code. Ensure the PR ends in MERGED state and clean up worktrees after success. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/merge-pr/SKILL.md)\n- prepare-pr: Prepare a GitHub PR for merge by rebasing onto main, fixing review findings, running gates, committing fixes, and pushing to the PR head branch. Use after /reviewpr. Never merge or push to main. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/prepare-pr/SKILL.md)\n- review-pr: Review-only GitHub pull request analysis with the gh CLI. Use when asked to review a PR, provide structured feedback, or assess readiness to land. Do not merge, push, or make code changes you intend to keep. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/review-pr/SKILL.md)\n- figma: Use the Figma MCP server to fetch design context, screenshots, variables, and assets from Figma, and to translate Figma nodes into production code. Trigger when a task involves Figma URLs, node IDs, design-to-code implementation, or Figma MCP setup and troubleshooting. (file: /home/ldr-cavetroll/.codex/skills/figma/SKILL.md)\n- skill-creator: Guide for creating effective skills. This skill should be used when users want to create a new skill (or update an existing skill) that extends Codex's capabilities with specialized knowledge, workflows, or tool integrations. (file: /home/ldr-cavetroll/.codex/skills/.system/skill-creator/SKILL.md)\n- skill-installer: Install Codex skills into $CODEX_HOME/skills from a curated list or a GitHub repo path. Use when a user asks to list installable skills, install a curated skill, or install a skill from another repo (including private repos). (file: /home/ldr-cavetroll/.codex/skills/.system/skill-installer/SKILL.md)\n### How to use skills\n- Discovery: The list above is the skills available in this session (name + description + file path). Skill bodies live on disk at the listed paths.\n- Trigger rules: If the user names a skill (with `$SkillName` or plain text) OR the task clearly matches a skill's description shown above, you must use that skill for that turn. Multiple mentions mean use them all. Do not carry skills across turns unless re-mentioned.\n- Missing/blocked: If a named skill isn't in the list or the path can't be read, say so briefly and continue with the best fallback.\n- How to use a skill (progressive disclosure):\n  1) After deciding to use a skill, open its `SKILL.md`. Read only enough to follow the workflow.\n  2) When `SKILL.md` references relative paths (e.g., `scripts/foo.py`), resolve them relative to the skill directory listed above first, and only consider other paths if needed.\n  3) If `SKILL.md` points to extra folders such as `references/`, load only the specific files needed for the request; don't bulk-load everything.\n  4) If `scripts/` exist, prefer running or patching them instead of retyping large code blocks.\n  5) If `assets/` or templates exist, reuse them instead of recreating from scratch.\n- Coordination and sequencing:\n  - If multiple skills apply, choose the minimal set that covers the request and state the order you'll use them.\n  - Announce which skill(s) you're using and why (one short line). If you skip an obvious skill, say why.\n- Context hygiene:\n  - Keep context small: summarize long sections instead of pasting them; only load extra files when needed.\n  - Avoid deep reference-chasing: prefer opening only files directly linked from `SKILL.md` unless you're blocked.\n  - When variants exist (frameworks, providers, domains), pick only the relevant reference file(s) and note that choice.\n- Safety and fallback: If a skill can't be applied cleanly (missing files, unclear instructions), state the issue, pick the next-best approach, and continue.","truncation_policy":{"mode":"tokens","limit":10000}}}
{"timestamp":"2026-02-07T08:09:09.619Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":360958,"cached_input_tokens":311424,"output_tokens":1918,"reasoning_output_tokens":384,"total_tokens":362876},"last_token_usage":{"input_tokens":29326,"cached_input_tokens":18816,"output_tokens":47,"reasoning_output_tokens":0,"total_tokens":29373},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":2.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":8.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T08:09:11.302Z","type":"response_item","payload":{"type":"function_call","name":"exec_command","arguments":"{\"cmd\":\"sed -n '220,520p' docs/gateway/heartbeat.md\"}","call_id":"call_z95tdhwfoAW5Aymb2umEfszo"}}
{"timestamp":"2026-02-07T08:09:11.307Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":392488,"cached_input_tokens":340736,"output_tokens":1950,"reasoning_output_tokens":384,"total_tokens":394438},"last_token_usage":{"input_tokens":31530,"cached_input_tokens":29312,"output_tokens":32,"reasoning_output_tokens":0,"total_tokens":31562},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":2.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":8.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T08:09:11.391Z","type":"response_item","payload":{"type":"function_call_output","call_id":"call_z95tdhwfoAW5Aymb2umEfszo","output":"Chunk ID: 6538ae\nWall time: 0.0518 seconds\nProcess exited with code 0\nOriginal token count: 1349\nOutput:\n  specific channel session (Discord/WhatsApp/etc.).\n- `session` only affects the run context; delivery is controlled by `target` and `to`.\n- To deliver to a specific channel/recipient, set `target` + `to`. With\n  `target: \"last\"`, delivery uses the last external channel for that session.\n- If the main queue is busy, the heartbeat is skipped and retried later.\n- If `target` resolves to no external destination, the run still happens but no\n  outbound message is sent.\n- Heartbeat-only replies do **not** keep the session alive; the last `updatedAt`\n  is restored so idle expiry behaves normally.\n\n## Visibility controls\n\nBy default, `HEARTBEAT_OK` acknowledgments are suppressed while alert content is\ndelivered. You can adjust this per channel or per account:\n\n```yaml\nchannels:\n  defaults:\n    heartbeat:\n      showOk: false # Hide HEARTBEAT_OK (default)\n      showAlerts: true # Show alert messages (default)\n      useIndicator: true # Emit indicator events (default)\n  telegram:\n    heartbeat:\n      showOk: true # Show OK acknowledgments on Telegram\n  whatsapp:\n    accounts:\n      work:\n        heartbeat:\n          showAlerts: false # Suppress alert delivery for this account\n```\n\nPrecedence: per-account → per-channel → channel defaults → built-in defaults.\n\n### What each flag does\n\n- `showOk`: sends a `HEARTBEAT_OK` acknowledgment when the model returns an OK-only reply.\n- `showAlerts`: sends the alert content when the model returns a non-OK reply.\n- `useIndicator`: emits indicator events for UI status surfaces.\n\nIf **all three** are false, OpenClaw skips the heartbeat run entirely (no model call).\n\n### Per-channel vs per-account examples\n\n```yaml\nchannels:\n  defaults:\n    heartbeat:\n      showOk: false\n      showAlerts: true\n      useIndicator: true\n  slack:\n    heartbeat:\n      showOk: true # all Slack accounts\n    accounts:\n      ops:\n        heartbeat:\n          showAlerts: false # suppress alerts for the ops account only\n  telegram:\n    heartbeat:\n      showOk: true\n```\n\n### Common patterns\n\n| Goal                                     | Config                                                                                   |\n| ---------------------------------------- | ---------------------------------------------------------------------------------------- |\n| Default behavior (silent OKs, alerts on) | _(no config needed)_                                                                     |\n| Fully silent (no messages, no indicator) | `channels.defaults.heartbeat: { showOk: false, showAlerts: false, useIndicator: false }` |\n| Indicator-only (no messages)             | `channels.defaults.heartbeat: { showOk: false, showAlerts: false, useIndicator: true }`  |\n| OKs in one channel only                  | `channels.telegram.heartbeat: { showOk: true }`                                          |\n\n## HEARTBEAT.md (optional)\n\nIf a `HEARTBEAT.md` file exists in the workspace, the default prompt tells the\nagent to read it. Think of it as your “heartbeat checklist”: small, stable, and\nsafe to include every 30 minutes.\n\nIf `HEARTBEAT.md` exists but is effectively empty (only blank lines and markdown\nheaders like `# Heading`), OpenClaw skips the heartbeat run to save API calls.\nIf the file is missing, the heartbeat still runs and the model decides what to do.\n\nKeep it tiny (short checklist or reminders) to avoid prompt bloat.\n\nExample `HEARTBEAT.md`:\n\n```md\n# Heartbeat checklist\n\n- Quick scan: anything urgent in inboxes?\n- If it’s daytime, do a lightweight check-in if nothing else is pending.\n- If a task is blocked, write down _what is missing_ and ask Peter next time.\n```\n\n### Can the agent update HEARTBEAT.md?\n\nYes — if you ask it to.\n\n`HEARTBEAT.md` is just a normal file in the agent workspace, so you can tell the\nagent (in a normal chat) something like:\n\n- “Update `HEARTBEAT.md` to add a daily calendar check.”\n- “Rewrite `HEARTBEAT.md` so it’s shorter and focused on inbox follow-ups.”\n\nIf you want this to happen proactively, you can also include an explicit line in\nyour heartbeat prompt like: “If the checklist becomes stale, update HEARTBEAT.md\nwith a better one.”\n\nSafety note: don’t put secrets (API keys, phone numbers, private tokens) into\n`HEARTBEAT.md` — it becomes part of the prompt context.\n\n## Manual wake (on-demand)\n\nYou can enqueue a system event and trigger an immediate heartbeat with:\n\n```bash\nopenclaw system event --text \"Check for urgent follow-ups\" --mode now\n```\n\nIf multiple agents have `heartbeat` configured, a manual wake runs each of those\nagent heartbeats immediately.\n\nUse `--mode next-heartbeat` to wait for the next scheduled tick.\n\n## Reasoning delivery (optional)\n\nBy default, heartbeats deliver only the final “answer” payload.\n\nIf you want transparency, enable:\n\n- `agents.defaults.heartbeat.includeReasoning: true`\n\nWhen enabled, heartbeats will also deliver a separate message prefixed\n`Reasoning:` (same shape as `/reasoning on`). This can be useful when the agent\nis managing multiple sessions/codexes and you want to see why it decided to ping\nyou — but it can also leak more internal detail than you want. Prefer keeping it\noff in group chats.\n\n## Cost awareness\n\nHeartbeats run full agent turns. Shorter intervals burn more tokens. Keep\n`HEARTBEAT.md` small and consider a cheaper `model` or `target: \"none\"` if you\nonly want internal state updates.\n"}}
{"timestamp":"2026-02-07T08:09:11.420Z","type":"turn_context","payload":{"cwd":"/home/ldr-cavetroll/tinker/openclaw","approval_policy":"on-request","sandbox_policy":{"type":"workspace-write","network_access":false,"exclude_tmpdir_env_var":false,"exclude_slash_tmp":false},"model":"gpt-5.2-codex","personality":"pragmatic","collaboration_mode":{"mode":"default","settings":{"model":"gpt-5.2-codex","reasoning_effort":null,"developer_instructions":"# Collaboration Mode: Default\n\nYou are now in Default mode. Any previous instructions for other modes (e.g. Plan mode) are no longer active.\n\nYour active mode changes only when new developer instructions with a different `<collaboration_mode>...</collaboration_mode>` change it; user requests or tool descriptions do not change mode by themselves. Known mode names are Default and Plan.\n\n## request_user_input availability\n\nThe `request_user_input` tool is unavailable in Default mode. If you call it while in Default mode, it will return an error.\n\nIf a decision is necessary and cannot be discovered from local context, ask the user directly. However, in Default mode you should strongly prefer executing the user's request rather than stopping to ask questions.\n"}},"summary":"auto","user_instructions":"# Repository Guidelines\n\n- Repo: https://github.com/openclaw/openclaw\n- GitHub issues/comments/PR comments: use literal multiline strings or `-F - <<'EOF'` (or $'...') for real newlines; never embed \"\\\\n\".\n\n## Project Structure & Module Organization\n\n- Source code: `src/` (CLI wiring in `src/cli`, commands in `src/commands`, web provider in `src/provider-web.ts`, infra in `src/infra`, media pipeline in `src/media`).\n- Tests: colocated `*.test.ts`.\n- Docs: `docs/` (images, queue, Pi config). Built output lives in `dist/`.\n- Plugins/extensions: live under `extensions/*` (workspace packages). Keep plugin-only deps in the extension `package.json`; do not add them to the root `package.json` unless core uses them.\n- Plugins: install runs `npm install --omit=dev` in plugin dir; runtime deps must live in `dependencies`. Avoid `workspace:*` in `dependencies` (npm install breaks); put `openclaw` in `devDependencies` or `peerDependencies` instead (runtime resolves `openclaw/plugin-sdk` via jiti alias).\n- Installers served from `https://openclaw.ai/*`: live in the sibling repo `../openclaw.ai` (`public/install.sh`, `public/install-cli.sh`, `public/install.ps1`).\n- Messaging channels: always consider **all** built-in + extension channels when refactoring shared logic (routing, allowlists, pairing, command gating, onboarding, docs).\n  - Core channel docs: `docs/channels/`\n  - Core channel code: `src/telegram`, `src/discord`, `src/slack`, `src/signal`, `src/imessage`, `src/web` (WhatsApp web), `src/channels`, `src/routing`\n  - Extensions (channel plugins): `extensions/*` (e.g. `extensions/msteams`, `extensions/matrix`, `extensions/zalo`, `extensions/zalouser`, `extensions/voice-call`)\n- When adding channels/extensions/apps/docs, review `.github/labeler.yml` for label coverage.\n\n## Docs Linking (Mintlify)\n\n- Docs are hosted on Mintlify (docs.openclaw.ai).\n- Internal doc links in `docs/**/*.md`: root-relative, no `.md`/`.mdx` (example: `[Config](/configuration)`).\n- Section cross-references: use anchors on root-relative paths (example: `[Hooks](/configuration#hooks)`).\n- Doc headings and anchors: avoid em dashes and apostrophes in headings because they break Mintlify anchor links.\n- When Peter asks for links, reply with full `https://docs.openclaw.ai/...` URLs (not root-relative).\n- When you touch docs, end the reply with the `https://docs.openclaw.ai/...` URLs you referenced.\n- README (GitHub): keep absolute docs URLs (`https://docs.openclaw.ai/...`) so links work on GitHub.\n- Docs content must be generic: no personal device names/hostnames/paths; use placeholders like `user@gateway-host` and “gateway host”.\n\n## Docs i18n (zh-CN)\n\n- `docs/zh-CN/**` is generated; do not edit unless the user explicitly asks.\n- Pipeline: update English docs → adjust glossary (`docs/.i18n/glossary.zh-CN.json`) → run `scripts/docs-i18n` → apply targeted fixes only if instructed.\n- Translation memory: `docs/.i18n/zh-CN.tm.jsonl` (generated).\n- See `docs/.i18n/README.md`.\n- The pipeline can be slow/inefficient; if it’s dragging, ping @jospalmbier on Discord instead of hacking around it.\n\n## exe.dev VM ops (general)\n\n- Access: stable path is `ssh exe.dev` then `ssh vm-name` (assume SSH key already set).\n- SSH flaky: use exe.dev web terminal or Shelley (web agent); keep a tmux session for long ops.\n- Update: `sudo npm i -g openclaw@latest` (global install needs root on `/usr/lib/node_modules`).\n- Config: use `openclaw config set ...`; ensure `gateway.mode=local` is set.\n- Discord: store raw token only (no `DISCORD_BOT_TOKEN=` prefix).\n- Restart: stop old gateway and run:\n  `pkill -9 -f openclaw-gateway || true; nohup openclaw gateway run --bind loopback --port 18789 --force > /tmp/openclaw-gateway.log 2>&1 &`\n- Verify: `openclaw channels status --probe`, `ss -ltnp | rg 18789`, `tail -n 120 /tmp/openclaw-gateway.log`.\n\n## Build, Test, and Development Commands\n\n- Runtime baseline: Node **22+** (keep Node + Bun paths working).\n- Install deps: `pnpm install`\n- Pre-commit hooks: `prek install` (runs same checks as CI)\n- Also supported: `bun install` (keep `pnpm-lock.yaml` + Bun patching in sync when touching deps/patches).\n- Prefer Bun for TypeScript execution (scripts, dev, tests): `bun <file.ts>` / `bunx <tool>`.\n- Run CLI in dev: `pnpm openclaw ...` (bun) or `pnpm dev`.\n- Node remains supported for running built output (`dist/*`) and production installs.\n- Mac packaging (dev): `scripts/package-mac-app.sh` defaults to current arch. Release checklist: `docs/platforms/mac/release.md`.\n- Type-check/build: `pnpm build`\n- TypeScript checks: `pnpm tsgo`\n- Lint/format: `pnpm check`\n- Tests: `pnpm test` (vitest); coverage: `pnpm test:coverage`\n\n## Coding Style & Naming Conventions\n\n- Language: TypeScript (ESM). Prefer strict typing; avoid `any`.\n- Formatting/linting via Oxlint and Oxfmt; run `pnpm check` before commits.\n- Add brief code comments for tricky or non-obvious logic.\n- Keep files concise; extract helpers instead of “V2” copies. Use existing patterns for CLI options and dependency injection via `createDefaultDeps`.\n- Aim to keep files under ~700 LOC; guideline only (not a hard guardrail). Split/refactor when it improves clarity or testability.\n- Naming: use **OpenClaw** for product/app/docs headings; use `openclaw` for CLI command, package/binary, paths, and config keys.\n\n## Release Channels (Naming)\n\n- stable: tagged releases only (e.g. `vYYYY.M.D`), npm dist-tag `latest`.\n- beta: prerelease tags `vYYYY.M.D-beta.N`, npm dist-tag `beta` (may ship without macOS app).\n- dev: moving head on `main` (no tag; git checkout main).\n\n## Testing Guidelines\n\n- Framework: Vitest with V8 coverage thresholds (70% lines/branches/functions/statements).\n- Naming: match source names with `*.test.ts`; e2e in `*.e2e.test.ts`.\n- Run `pnpm test` (or `pnpm test:coverage`) before pushing when you touch logic.\n- Do not set test workers above 16; tried already.\n- Live tests (real keys): `CLAWDBOT_LIVE_TEST=1 pnpm test:live` (OpenClaw-only) or `LIVE=1 pnpm test:live` (includes provider live tests). Docker: `pnpm test:docker:live-models`, `pnpm test:docker:live-gateway`. Onboarding Docker E2E: `pnpm test:docker:onboard`.\n- Full kit + what’s covered: `docs/testing.md`.\n- Pure test additions/fixes generally do **not** need a changelog entry unless they alter user-facing behavior or the user asks for one.\n- Mobile: before using a simulator, check for connected real devices (iOS + Android) and prefer them when available.\n\n## Commit & Pull Request Guidelines\n\n- Create commits with `scripts/committer \"<msg>\" <file...>`; avoid manual `git add`/`git commit` so staging stays scoped.\n- Follow concise, action-oriented commit messages (e.g., `CLI: add verbose flag to send`).\n- Group related changes; avoid bundling unrelated refactors.\n- Changelog workflow: keep latest released version at top (no `Unreleased`); after publishing, bump version and start a new top section.\n- PRs should summarize scope, note testing performed, and mention any user-facing changes or new flags.\n- Read this when submitting a PR: `docs/help/submitting-a-pr.md` ([Submitting a PR](https://docs.openclaw.ai/help/submitting-a-pr))\n- Read this when submitting an issue: `docs/help/submitting-an-issue.md` ([Submitting an Issue](https://docs.openclaw.ai/help/submitting-an-issue))\n- PR review flow: when given a PR link, review via `gh pr view`/`gh pr diff` and do **not** change branches.\n- PR review calls: prefer a single `gh pr view --json ...` to batch metadata/comments; run `gh pr diff` only when needed.\n- Before starting a review when a GH Issue/PR is pasted: run `git pull`; if there are local changes or unpushed commits, stop and alert the user before reviewing.\n- Goal: merge PRs. Prefer **rebase** when commits are clean; **squash** when history is messy.\n- PR merge flow: create a temp branch from `main`, merge the PR branch into it (prefer squash unless commit history is important; use rebase/merge when it is). Always try to merge the PR unless it’s truly difficult, then use another approach. If we squash, add the PR author as a co-contributor. Apply fixes, add changelog entry (include PR # + thanks), run full gate before the final commit, commit, merge back to `main`, delete the temp branch, and end on `main`.\n- If you review a PR and later do work on it, land via merge/squash (no direct-main commits) and always add the PR author as a co-contributor.\n- When working on a PR: add a changelog entry with the PR number and thank the contributor.\n- When working on an issue: reference the issue in the changelog entry.\n- When merging a PR: leave a PR comment that explains exactly what we did and include the SHA hashes.\n- When merging a PR from a new contributor: add their avatar to the README “Thanks to all clawtributors” thumbnail list.\n- After merging a PR: run `bun scripts/update-clawtributors.ts` if the contributor is missing, then commit the regenerated README.\n\n## Shorthand Commands\n\n- `sync`: if working tree is dirty, commit all changes (pick a sensible Conventional Commit message), then `git pull --rebase`; if rebase conflicts and cannot resolve, stop; otherwise `git push`.\n\n### PR Workflow (Review vs Land)\n\n- **Review mode (PR link only):** read `gh pr view/diff`; **do not** switch branches; **do not** change code.\n- **Landing mode:** create an integration branch from `main`, bring in PR commits (**prefer rebase** for linear history; **merge allowed** when complexity/conflicts make it safer), apply fixes, add changelog (+ thanks + PR #), run full gate **locally before committing** (`pnpm build && pnpm check && pnpm test`), commit, merge back to `main`, then `git switch main` (never stay on a topic branch after landing). Important: contributor needs to be in git graph after this!\n\n## Security & Configuration Tips\n\n- Web provider stores creds at `~/.openclaw/credentials/`; rerun `openclaw login` if logged out.\n- Pi sessions live under `~/.openclaw/sessions/` by default; the base directory is not configurable.\n- Environment variables: see `~/.profile`.\n- Never commit or publish real phone numbers, videos, or live configuration values. Use obviously fake placeholders in docs, tests, and examples.\n- Release flow: always read `docs/reference/RELEASING.md` and `docs/platforms/mac/release.md` before any release work; do not ask routine questions once those docs answer them.\n\n## Troubleshooting\n\n- Rebrand/migration issues or legacy config/service warnings: run `openclaw doctor` (see `docs/gateway/doctor.md`).\n\n## Agent-Specific Notes\n\n- Vocabulary: \"makeup\" = \"mac app\".\n- Never edit `node_modules` (global/Homebrew/npm/git installs too). Updates overwrite. Skill notes go in `tools.md` or `AGENTS.md`.\n- Signal: \"update fly\" => `fly ssh console -a flawd-bot -C \"bash -lc 'cd /data/clawd/openclaw && git pull --rebase origin main'\"` then `fly machines restart e825232f34d058 -a flawd-bot`.\n- When working on a GitHub Issue or PR, print the full URL at the end of the task.\n- When answering questions, respond with high-confidence answers only: verify in code; do not guess.\n- Never update the Carbon dependency.\n- Any dependency with `pnpm.patchedDependencies` must use an exact version (no `^`/`~`).\n- Patching dependencies (pnpm patches, overrides, or vendored changes) requires explicit approval; do not do this by default.\n- CLI progress: use `src/cli/progress.ts` (`osc-progress` + `@clack/prompts` spinner); don’t hand-roll spinners/bars.\n- Status output: keep tables + ANSI-safe wrapping (`src/terminal/table.ts`); `status --all` = read-only/pasteable, `status --deep` = probes.\n- Gateway currently runs only as the menubar app; there is no separate LaunchAgent/helper label installed. Restart via the OpenClaw Mac app or `scripts/restart-mac.sh`; to verify/kill use `launchctl print gui/$UID | grep openclaw` rather than assuming a fixed label. **When debugging on macOS, start/stop the gateway via the app, not ad-hoc tmux sessions; kill any temporary tunnels before handoff.**\n- macOS logs: use `./scripts/clawlog.sh` to query unified logs for the OpenClaw subsystem; it supports follow/tail/category filters and expects passwordless sudo for `/usr/bin/log`.\n- If shared guardrails are available locally, review them; otherwise follow this repo's guidance.\n- SwiftUI state management (iOS/macOS): prefer the `Observation` framework (`@Observable`, `@Bindable`) over `ObservableObject`/`@StateObject`; don’t introduce new `ObservableObject` unless required for compatibility, and migrate existing usages when touching related code.\n- Connection providers: when adding a new connection, update every UI surface and docs (macOS app, web UI, mobile if applicable, onboarding/overview docs) and add matching status + configuration forms so provider lists and settings stay in sync.\n- Version locations: `package.json` (CLI), `apps/android/app/build.gradle.kts` (versionName/versionCode), `apps/ios/Sources/Info.plist` + `apps/ios/Tests/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `apps/macos/Sources/OpenClaw/Resources/Info.plist` (CFBundleShortVersionString/CFBundleVersion), `docs/install/updating.md` (pinned npm version), `docs/platforms/mac/release.md` (APP_VERSION/APP_BUILD examples), Peekaboo Xcode projects/Info.plists (MARKETING_VERSION/CURRENT_PROJECT_VERSION).\n- **Restart apps:** “restart iOS/Android apps” means rebuild (recompile/install) and relaunch, not just kill/launch.\n- **Device checks:** before testing, verify connected real devices (iOS/Android) before reaching for simulators/emulators.\n- iOS Team ID lookup: `security find-identity -p codesigning -v` → use Apple Development (…) TEAMID. Fallback: `defaults read com.apple.dt.Xcode IDEProvisioningTeamIdentifiers`.\n- A2UI bundle hash: `src/canvas-host/a2ui/.bundle.hash` is auto-generated; ignore unexpected changes, and only regenerate via `pnpm canvas:a2ui:bundle` (or `scripts/bundle-a2ui.sh`) when needed. Commit the hash as a separate commit.\n- Release signing/notary keys are managed outside the repo; follow internal release docs.\n- Notary auth env vars (`APP_STORE_CONNECT_ISSUER_ID`, `APP_STORE_CONNECT_KEY_ID`, `APP_STORE_CONNECT_API_KEY_P8`) are expected in your environment (per internal release docs).\n- **Multi-agent safety:** do **not** create/apply/drop `git stash` entries unless explicitly requested (this includes `git pull --rebase --autostash`). Assume other agents may be working; keep unrelated WIP untouched and avoid cross-cutting state changes.\n- **Multi-agent safety:** when the user says \"push\", you may `git pull --rebase` to integrate latest changes (never discard other agents' work). When the user says \"commit\", scope to your changes only. When the user says \"commit all\", commit everything in grouped chunks.\n- **Multi-agent safety:** do **not** create/remove/modify `git worktree` checkouts (or edit `.worktrees/*`) unless explicitly requested.\n- **Multi-agent safety:** do **not** switch branches / check out a different branch unless explicitly requested.\n- **Multi-agent safety:** running multiple agents is OK as long as each agent has its own session.\n- **Multi-agent safety:** when you see unrecognized files, keep going; focus on your changes and commit only those.\n- Lint/format churn:\n  - If staged+unstaged diffs are formatting-only, auto-resolve without asking.\n  - If commit/push already requested, auto-stage and include formatting-only follow-ups in the same commit (or a tiny follow-up commit if needed), no extra confirmation.\n  - Only ask when changes are semantic (logic/data/behavior).\n- Lobster seam: use the shared CLI palette in `src/terminal/palette.ts` (no hardcoded colors); apply palette to onboarding/config prompts and other TTY UI output as needed.\n- **Multi-agent safety:** focus reports on your edits; avoid guard-rail disclaimers unless truly blocked; when multiple agents touch the same file, continue if safe; end with a brief “other files present” note only if relevant.\n- Bug investigations: read source code of relevant npm dependencies and all related local code before concluding; aim for high-confidence root cause.\n- Code style: add brief comments for tricky logic; keep files under ~500 LOC when feasible (split/refactor as needed).\n- Tool schema guardrails (google-antigravity): avoid `Type.Union` in tool input schemas; no `anyOf`/`oneOf`/`allOf`. Use `stringEnum`/`optionalStringEnum` (Type.Unsafe enum) for string lists, and `Type.Optional(...)` instead of `... | null`. Keep top-level tool schema as `type: \"object\"` with `properties`.\n- Tool schema guardrails: avoid raw `format` property names in tool schemas; some validators treat `format` as a reserved keyword and reject the schema.\n- When asked to open a “session” file, open the Pi session logs under `~/.openclaw/agents/<agentId>/sessions/*.jsonl` (use the `agent=<id>` value in the Runtime line of the system prompt; newest unless a specific ID is given), not the default `sessions.json`. If logs are needed from another machine, SSH via Tailscale and read the same path there.\n- Do not rebuild the macOS app over SSH; rebuilds must be run directly on the Mac.\n- Never send streaming/partial replies to external messaging surfaces (WhatsApp, Telegram); only final replies should be delivered there. Streaming/tool events may still go to internal UIs/control channel.\n- Voice wake forwarding tips:\n  - Command template should stay `openclaw-mac agent --message \"${text}\" --thinking low`; `VoiceWakeForwarder` already shell-escapes `${text}`. Don’t add extra quotes.\n  - launchd PATH is minimal; ensure the app’s launch agent PATH includes standard system paths plus your pnpm bin (typically `$HOME/Library/pnpm`) so `pnpm`/`openclaw` binaries resolve when invoked via `openclaw-mac`.\n- For manual `openclaw message send` messages that include `!`, use the heredoc pattern noted below to avoid the Bash tool’s escaping.\n- Release guardrails: do not change version numbers without operator’s explicit consent; always ask permission before running any npm publish/release step.\n\n## NPM + 1Password (publish/verify)\n\n- Use the 1password skill; all `op` commands must run inside a fresh tmux session.\n- Sign in: `eval \"$(op signin --account my.1password.com)\"` (app unlocked + integration on).\n- OTP: `op read 'op://Private/Npmjs/one-time password?attribute=otp'`.\n- Publish: `npm publish --access public --otp=\"<otp>\"` (run from the package dir).\n- Verify without local npmrc side effects: `npm view <pkg> version --userconfig \"$(mktemp)\"`.\n- Kill the tmux session after publish.\n\n\n## Skills\nA skill is a set of local instructions to follow that is stored in a `SKILL.md` file. Below is the list of skills that can be used. Each entry includes a name, description, and file path so you can open the source for full instructions when using a specific skill.\n### Available skills\n- merge-pr: Merge a GitHub PR via squash after /preparepr. Use when asked to merge a ready PR. Do not push to main or modify code. Ensure the PR ends in MERGED state and clean up worktrees after success. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/merge-pr/SKILL.md)\n- prepare-pr: Prepare a GitHub PR for merge by rebasing onto main, fixing review findings, running gates, committing fixes, and pushing to the PR head branch. Use after /reviewpr. Never merge or push to main. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/prepare-pr/SKILL.md)\n- review-pr: Review-only GitHub pull request analysis with the gh CLI. Use when asked to review a PR, provide structured feedback, or assess readiness to land. Do not merge, push, or make code changes you intend to keep. (file: /home/ldr-cavetroll/tinker/openclaw/.agents/skills/review-pr/SKILL.md)\n- figma: Use the Figma MCP server to fetch design context, screenshots, variables, and assets from Figma, and to translate Figma nodes into production code. Trigger when a task involves Figma URLs, node IDs, design-to-code implementation, or Figma MCP setup and troubleshooting. (file: /home/ldr-cavetroll/.codex/skills/figma/SKILL.md)\n- skill-creator: Guide for creating effective skills. This skill should be used when users want to create a new skill (or update an existing skill) that extends Codex's capabilities with specialized knowledge, workflows, or tool integrations. (file: /home/ldr-cavetroll/.codex/skills/.system/skill-creator/SKILL.md)\n- skill-installer: Install Codex skills into $CODEX_HOME/skills from a curated list or a GitHub repo path. Use when a user asks to list installable skills, install a curated skill, or install a skill from another repo (including private repos). (file: /home/ldr-cavetroll/.codex/skills/.system/skill-installer/SKILL.md)\n### How to use skills\n- Discovery: The list above is the skills available in this session (name + description + file path). Skill bodies live on disk at the listed paths.\n- Trigger rules: If the user names a skill (with `$SkillName` or plain text) OR the task clearly matches a skill's description shown above, you must use that skill for that turn. Multiple mentions mean use them all. Do not carry skills across turns unless re-mentioned.\n- Missing/blocked: If a named skill isn't in the list or the path can't be read, say so briefly and continue with the best fallback.\n- How to use a skill (progressive disclosure):\n  1) After deciding to use a skill, open its `SKILL.md`. Read only enough to follow the workflow.\n  2) When `SKILL.md` references relative paths (e.g., `scripts/foo.py`), resolve them relative to the skill directory listed above first, and only consider other paths if needed.\n  3) If `SKILL.md` points to extra folders such as `references/`, load only the specific files needed for the request; don't bulk-load everything.\n  4) If `scripts/` exist, prefer running or patching them instead of retyping large code blocks.\n  5) If `assets/` or templates exist, reuse them instead of recreating from scratch.\n- Coordination and sequencing:\n  - If multiple skills apply, choose the minimal set that covers the request and state the order you'll use them.\n  - Announce which skill(s) you're using and why (one short line). If you skip an obvious skill, say why.\n- Context hygiene:\n  - Keep context small: summarize long sections instead of pasting them; only load extra files when needed.\n  - Avoid deep reference-chasing: prefer opening only files directly linked from `SKILL.md` unless you're blocked.\n  - When variants exist (frameworks, providers, domains), pick only the relevant reference file(s) and note that choice.\n- Safety and fallback: If a skill can't be applied cleanly (missing files, unclear instructions), state the issue, pick the next-best approach, and continue.","truncation_policy":{"mode":"tokens","limit":10000}}}
{"timestamp":"2026-02-07T08:09:11.689Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":392488,"cached_input_tokens":340736,"output_tokens":1950,"reasoning_output_tokens":384,"total_tokens":394438},"last_token_usage":{"input_tokens":31530,"cached_input_tokens":29312,"output_tokens":32,"reasoning_output_tokens":0,"total_tokens":31562},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":2.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":8.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
{"timestamp":"2026-02-07T08:09:21.969Z","type":"event_msg","payload":{"type":"agent_message","message":"Here’s how heartbeats work, distilled directly from `docs/gateway/heartbeat.md`.\n\n**What a heartbeat is**  \nA heartbeat is a periodic, scheduled agent turn run in the main session. It’s designed to surface things that need attention without spamming you. It runs a normal model call with a special prompt and tagging.\n\n**Default cadence and behavior**  \n- Default interval is `30m`, or `1h` if Anthropic OAuth/setup-token auth is detected.  \n- Set `agents.defaults.heartbeat.every` (or per-agent override).  \n- Use `0m` to disable.  \n- The default heartbeat prompt is sent verbatim as a user message:  \n  `Read HEARTBEAT.md if it exists (workspace context). Follow it strictly. Do not infer or repeat old tasks from prior chats. If nothing needs attention, reply HEARTBEAT_OK.`\n\n**Response contract**  \n- If nothing needs attention, reply with `HEARTBEAT_OK`.  \n- If `HEARTBEAT_OK` appears at start or end, it’s treated as an ack and stripped.  \n- If the remaining reply after stripping is ≤ `ackMaxChars` (default `300`), it’s dropped.  \n- If `HEARTBEAT_OK` appears in the middle, it’s not special.  \n- For alerts, don’t include `HEARTBEAT_OK` at all.\n\n**Active hours**  \n- Optional `heartbeat.activeHours` can skip runs outside a local time window.  \n- Window is checked in configured timezone (or user/host fallback).  \n- If outside the window, the heartbeat is skipped until the next tick within the window.\n\n**Delivery routing**  \n- Runs in the agent’s main session by default.  \n- `target` controls delivery:  \n  - `last` (default): last external channel for that session  \n  - explicit channel (whatsapp/telegram/etc.)  \n  - `none`: run but don’t deliver  \n- `to` and `accountId` optionally override recipient/account.  \n- If the main queue is busy, the heartbeat is skipped and retried later.  \n- Heartbeat-only replies don’t keep the session alive; `updatedAt` is restored.\n\n**Visibility controls**  \nPer-channel and per-account flags control what gets delivered:\n- `showOk` (default false)  \n- `showAlerts` (default true)  \n- `useIndicator` (default true)  \nIf all three are false, the heartbeat doesn’t run at all.\n\n**HEARTBEAT.md checklist**  \n- If `HEARTBEAT.md` exists, the default prompt tells the agent to read it.  \n- If `HEARTBEAT.md` is effectively empty (only blank lines/headers), the run is skipped to save tokens.  \n- If missing, the heartbeat still runs.  \n- You can ask the agent to edit `HEARTBEAT.md`.\n\n**Manual wake**  \nYou can trigger an immediate heartbeat with:\n```bash\nopenclaw system event --text \"Check for urgent follow-ups\" --mode now\n```\n\nIf you want, I can point you to the code paths that implement the heartbeat scheduler and delivery gating."}}
{"timestamp":"2026-02-07T08:09:21.969Z","type":"response_item","payload":{"type":"message","role":"assistant","content":[{"type":"output_text","text":"Here’s how heartbeats work, distilled directly from `docs/gateway/heartbeat.md`.\n\n**What a heartbeat is**  \nA heartbeat is a periodic, scheduled agent turn run in the main session. It’s designed to surface things that need attention without spamming you. It runs a normal model call with a special prompt and tagging.\n\n**Default cadence and behavior**  \n- Default interval is `30m`, or `1h` if Anthropic OAuth/setup-token auth is detected.  \n- Set `agents.defaults.heartbeat.every` (or per-agent override).  \n- Use `0m` to disable.  \n- The default heartbeat prompt is sent verbatim as a user message:  \n  `Read HEARTBEAT.md if it exists (workspace context). Follow it strictly. Do not infer or repeat old tasks from prior chats. If nothing needs attention, reply HEARTBEAT_OK.`\n\n**Response contract**  \n- If nothing needs attention, reply with `HEARTBEAT_OK`.  \n- If `HEARTBEAT_OK` appears at start or end, it’s treated as an ack and stripped.  \n- If the remaining reply after stripping is ≤ `ackMaxChars` (default `300`), it’s dropped.  \n- If `HEARTBEAT_OK` appears in the middle, it’s not special.  \n- For alerts, don’t include `HEARTBEAT_OK` at all.\n\n**Active hours**  \n- Optional `heartbeat.activeHours` can skip runs outside a local time window.  \n- Window is checked in configured timezone (or user/host fallback).  \n- If outside the window, the heartbeat is skipped until the next tick within the window.\n\n**Delivery routing**  \n- Runs in the agent’s main session by default.  \n- `target` controls delivery:  \n  - `last` (default): last external channel for that session  \n  - explicit channel (whatsapp/telegram/etc.)  \n  - `none`: run but don’t deliver  \n- `to` and `accountId` optionally override recipient/account.  \n- If the main queue is busy, the heartbeat is skipped and retried later.  \n- Heartbeat-only replies don’t keep the session alive; `updatedAt` is restored.\n\n**Visibility controls**  \nPer-channel and per-account flags control what gets delivered:\n- `showOk` (default false)  \n- `showAlerts` (default true)  \n- `useIndicator` (default true)  \nIf all three are false, the heartbeat doesn’t run at all.\n\n**HEARTBEAT.md checklist**  \n- If `HEARTBEAT.md` exists, the default prompt tells the agent to read it.  \n- If `HEARTBEAT.md` is effectively empty (only blank lines/headers), the run is skipped to save tokens.  \n- If missing, the heartbeat still runs.  \n- You can ask the agent to edit `HEARTBEAT.md`.\n\n**Manual wake**  \nYou can trigger an immediate heartbeat with:\n```bash\nopenclaw system event --text \"Check for urgent follow-ups\" --mode now\n```\n\nIf you want, I can point you to the code paths that implement the heartbeat scheduler and delivery gating."}]}}
{"timestamp":"2026-02-07T08:09:21.971Z","type":"event_msg","payload":{"type":"token_count","info":{"total_token_usage":{"input_tokens":425293,"cached_input_tokens":359552,"output_tokens":2613,"reasoning_output_tokens":384,"total_tokens":427906},"last_token_usage":{"input_tokens":32805,"cached_input_tokens":18816,"output_tokens":663,"reasoning_output_tokens":0,"total_tokens":33468},"model_context_window":258400},"rate_limits":{"primary":{"used_percent":2.0,"window_minutes":300,"resets_at":1770468853},"secondary":{"used_percent":8.0,"window_minutes":10080,"resets_at":1770720924},"credits":{"has_credits":false,"unlimited":false,"balance":null},"plan_type":null}}}
